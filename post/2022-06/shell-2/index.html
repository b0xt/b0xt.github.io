<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>How to use the shell (2/3) - The new era of the shell - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="Explore the shell for a new era." /><meta name="keywords" content="shell" />






<meta name="generator" content="Hugo 0.101.0 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2022-06/shell-2/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link href="/lib/fancybox/jquery.fancybox-3.1.20.min.css" rel="stylesheet">


<meta property="og:title" content="How to use the shell (2/3) - The new era of the shell" />
<meta property="og:description" content="Explore the shell for a new era." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2022-06/shell-2/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-06-26T10:57:07+08:00" />
<meta property="article:modified_time" content="2022-06-26T10:57:07+08:00" />

<meta itemprop="name" content="How to use the shell (2/3) - The new era of the shell">
<meta itemprop="description" content="Explore the shell for a new era."><meta itemprop="datePublished" content="2022-06-26T10:57:07+08:00" />
<meta itemprop="dateModified" content="2022-06-26T10:57:07+08:00" />
<meta itemprop="wordCount" content="2976">
<meta itemprop="keywords" content="shell," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="How to use the shell (2/3) - The new era of the shell"/>
<meta name="twitter:description" content="Explore the shell for a new era."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SOBYTE</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SOBYTE</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">How to use the shell (2/3) - The new era of the shell</h1>

      <div class="post-meta">
        <span class="post-time"> 2022-06-26 10:57:07 </span>
        <div class="post-category">
            <a href="/categories/tutorials/"> tutorials </a>
            </div>
          <span class="more-meta"> 2976 words </span>
          <span class="more-meta"> 6 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#fish-friendly-interactive-shell">Fish (Friendly Interactive shell)</a>
          <ul>
            <li><a href="#setting-variables">Setting variables</a></li>
            <li><a href="#configuration-framework-and-plugin-management">Configuration framework and plugin management</a></li>
          </ul>
        </li>
        <li><a href="#elvish">Elvish</a>
          <ul>
            <li><a href="#what-should-the-pipeline-transmit">What should the pipeline transmit?</a></li>
          </ul>
        </li>
        <li><a href="#ion-shell">Ion Shell</a>
          <ul>
            <li><a href="#file-descriptor-fd-file-descriptor">File Descriptor FD (File Descriptor)</a></li>
          </ul>
        </li>
        <li><a href="#powershell-pwsh">PowerShell (pwsh)</a></li>
        <li><a href="#nushell">NuShell</a></li>
        <li><a href="#using-repl-read-eval-print-loop-as-a-shell">Using REPL (Read-Eval-Print Loop) as a shell</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <h2 id="fish-friendly-interactive-shell">Fish (Friendly Interactive shell)</h2>
<p>This is a groundbreaking shell that creates a new shell user interaction experience. Syntax highlighting, auto-completion based on manpage, auto-suggestions are all its firsts!</p>
<blockquote>
<p>2B youth with bash, ordinary youth with zsh, literary youth with fish.</p>
</blockquote>
<p>The default configuration of fish is really good, the configuration file is: <code>~/.config/fish/config.fish</code></p>
<p>fish uses functions to set behavior: fish fully uses functions to customize behavior, you can customize fish&rsquo;s behavior by adding some special functions, for example prompt, fish doesn&rsquo;t have special variables like <code>PS1</code>, but uses functions.</p>
<p>Syntax highlighting, auto-suggestion</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># 语法高亮</span>
</span></span><span class="line"><span class="cl">grep
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 路径建议</span>
</span></span><span class="line"><span class="cl">cat /bin/hostname
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 参数建议</span>
</span></span><span class="line"><span class="cl">grep --invert-match
</span></span></code></pre></td></tr></table>
</div>
</div><p>Path folding <code>~/D/E/detail</code> to avoid long paths</p>
<p>Easy to understand syntax, this is not POSIX shell compatible, it has its own syntax</p>
<p>Here doc is not supported (of course neither is here string).</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">cat <span class="s">&lt;&lt; EOF &gt; file.txt
</span></span></span><span class="line"><span class="cl"><span class="s"># file content
</span></span></span><span class="line"><span class="cl"><span class="s">...
</span></span></span><span class="line"><span class="cl"><span class="s">EOF</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The official explanation is because you can substitute other commands, e.g.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="nb">printf</span> <span class="s2">&#34;\
</span></span></span><span class="line"><span class="cl"><span class="s2"># file content
</span></span></span><span class="line"><span class="cl"><span class="s2">...
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;</span> &gt; file.txt
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>printf</code> but the way it is written can also be used in bash, but there are differences in the details from fish.</p>
<ul>
<li>fish uses <code>$status</code> to get the exit status of the previous command instead of <code>$?</code>.</li>
<li>The array count in fish starts at <code>1</code>, not <code>0</code> as in most programs.</li>
<li>fish does not use the <code>&amp;&amp;</code> and <code>||</code> syntax to combine commands, but rather the <code>and</code> and <code>or</code> commands: but fish 3.x already supports <code>&amp;&amp;</code>, <code>||</code>.</li>
<li>fish uses <code>echo (echo 233)</code> instead of &ldquo;echo <code>echo 233</code>&rdquo;.</li>
</ul>
<p>The odd command <code>fish_config</code>, this opens an http server and configures it on the web page. As a shell, I&rsquo;ve always found it strange to open a browser to set up a shell.</p>
<h3 id="setting-variables">Setting variables</h3>
<p>Many people think that fish is too weird to set variables. In fact, it&rsquo;s the POSIX shell that&rsquo;s stranger</p>
<p>Recall that the scope of Shell variables can be divided into three types.</p>
<ul>
<li>Some variables can only be used inside a function, this is called a local variable</li>
<li>Some variables can be used within the current shell process, which is called a global variable</li>
<li>And there are variables that can be used in child processes, which are called environment variables.</li>
</ul>
<p>We usually know the variables of normal programming languages.</p>
<ul>
<li><code>g / --global</code> global variable (default), valid in the current runtime environment</li>
<li><code>l / --local</code> local variables, valid only in the current scope</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="nv">gvar</span><span class="o">=</span><span class="s2">&#34;Global content changed&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 换成 fish 写法</span>
</span></span><span class="line"><span class="cl"><span class="nb">set</span> -g gvar <span class="s2">&#34;Global content changed&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">local</span> <span class="nv">lvar</span><span class="o">=</span><span class="s2">&#34;Local content&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 局部变量 fish 写法</span>
</span></span><span class="line"><span class="cl"><span class="nb">set</span> -l lvar <span class="s2">&#34;Local content&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Environment variables (environment variables are actually ordinary variables whether or not they have the <code>export</code> attribute).</p>
<ul>
<li><code>x / --export</code> (default) This variable can be passed to child processes</li>
<li><code>u / --unexport</code> (default) This variable cannot be passed to child processes</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># 平时最常使用的命令</span>
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">foo</span><span class="o">=</span>xxx
</span></span><span class="line"><span class="cl"><span class="nb">declare</span> -x <span class="nv">foo</span><span class="o">=</span>xxx
</span></span><span class="line"><span class="cl"><span class="nb">typeset</span> -x <span class="nv">foo</span><span class="o">=</span>xxx
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># fish 的写法</span>
</span></span><span class="line"><span class="cl"><span class="nb">set</span> -x foo xxx
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 去除环境变量（或者说去除变量的 export 属性）</span>
</span></span><span class="line"><span class="cl"><span class="nb">declare</span> +x <span class="nv">foo</span><span class="o">=</span>xxx
</span></span><span class="line"><span class="cl"><span class="nb">typeset</span> +x <span class="nv">foo</span><span class="o">=</span>xxx
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># fish 的写法</span>
</span></span><span class="line"><span class="cl"><span class="nb">set</span> -u foo xxx
</span></span></code></pre></td></tr></table>
</div>
</div><p>The operators of <code>declare</code> are <code>+</code>, <code>-</code>: <code>-</code> means enable this property, <code>+</code> means cancel this property. Yes, I wrote it correctly, he is the opposite.</p>
<p><code>export</code> is essentially the <code>declare -x</code> command.</p>
<p>According to the GNU bash documentation: the <code>typeset</code> command is provided for compatibility with the Korn shell. It is the same as the <code>declare</code> command.</p>
<p>The <code>POSIX shell</code> stores strings, integers and arrays are just a special property (the variable property of <code>fish</code> cannot be added or removed). These are the more commonly used ones (see the <a href="https://www.gnu.org/software/bash/manual/bash.html">official manual</a> for the complete list, also large (<code>u</code> upcase) and small (<code>l</code> lowcase) write conversions, etc.)</p>
<ul>
<li><code>a</code> indexed array variable</li>
<li><code>A</code> associative array variable</li>
<li><code>f</code> function name</li>
<li><code>i</code> The variable will be treated as an integer</li>
<li><code>r</code> read-only, can&rsquo;t change can&rsquo;t <code>unset</code></li>
<li><code>t</code> debug to keep track of this variable. (presumably bash-specific)</li>
<li><code>x</code> export variables into environment variables</li>
</ul>
<p>Persistent and clear variables.</p>
<ul>
<li><code>U / --universal</code> Universal variables, all valid under the current user, and persistent (will save)</li>
<li><code>e / --erase</code> clear a variable</li>
</ul>
<p><code>U</code> is equivalent to writing in the configuration file, <code>e</code> is equivalent to the <code>unset</code> command</p>
<p>For example: <code>set -Ux EDITOR vim</code> will make the environment variables global and persistent, even if the shell restarts. It is recommended to use <code>set -Ux</code> to save common environment variables, which are automatically saved to <code>~/.config/fish/fish_variables</code>.</p>
<p>For operations on arrays.</p>
<ul>
<li><code>a / --append</code> Append values to the current array of variables. Can be used with <code>--prepend</code> to add and append at the same time. This cannot be used when assigning to a mutable slice.</li>
<li><code>p / --prepend</code> The values are pre-set to the current set of values for that variable. It can be used together with <code>--append</code> to insert to the top of the array. This function cannot be used when assigning to variable slices</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="nv">PATH</span><span class="o">=</span><span class="s2">&#34;</span><span class="nv">$PATH</span><span class="s2">:</span><span class="nv">$HOME</span><span class="s2">/go/bin&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:~/go/bin
</span></span><span class="line"><span class="cl"><span class="c1"># fish 的写法</span>
</span></span><span class="line"><span class="cl"><span class="nb">set</span> -a PATH ~/go/bin/
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">PATH</span><span class="o">=</span><span class="s2">&#34;</span><span class="nv">$HOME</span><span class="s2">/go/bin:</span><span class="nv">$PATH</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">PATH</span><span class="o">=</span>~/go/bin:<span class="nv">$PATH</span>
</span></span><span class="line"><span class="cl"><span class="c1"># fish 的写法</span>
</span></span><span class="line"><span class="cl"><span class="nb">set</span> -ap PATH ~/go/bin/
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>~</code> and <code>$HOME</code> are not equivalent, <code>PATH=&quot;$PATH:~/go/bin&quot;</code> just doesn&rsquo;t work. <code>&quot;&quot;</code> only explains the variables, not the <code>~</code> expansion. Also <code>~</code> must appear at the top of the expression, otherwise it is a normal character. After <code>:</code> it will be treated as a separate expression, so it is normal too. It is recommended to use <code>$HOME</code> whenever possible</p>
<p><code>NODE_ENV=production node index.js</code> is not available inside fish, so you can switch to a more generic way of writing it, using the <code>env</code> command.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">env <span class="nv">NODE_ENV</span><span class="o">=</span>production node index.js
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="configuration-framework-and-plugin-management">Configuration framework and plugin management</h3>
<ul>
<li>Oh-my-fish</li>
</ul>
<p>A configuration framework similar to oh-my-zsh, which incidentally comes with a package manager</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">omf install <span class="o">[</span>&lt;name&gt;<span class="p">|</span>&lt;url&gt;<span class="o">]</span>
</span></span><span class="line"><span class="cl">omf list
</span></span></code></pre></td></tr></table>
</div>
</div><p>Of course, fish already works very well by default. It doesn&rsquo;t need much configuration, but you can still find some better uses from oh-my-fish configuration (like Elvish-like navigation mode).</p>
<ul>
<li><a href="https://github.com/jorgebucaran/fisher">Fisher</a> This was originally called fisherman</li>
</ul>
<p>This is an extremely streamlined fish plugin manager.</p>
<h2 id="elvish">Elvish</h2>
<p>tuna used to be the president of the shell developed by Xiao Ti</p>
<p>So far Elvish has not released version 1.0</p>
<p>Elvish&rsquo;s improvements for interaction</p>
<ul>
<li><code>Ctrl-R</code> is optimized for search history</li>
<li><code>Ctrl-L</code> Show directory stack. Equivalent to list selection <code>dirs -v</code> for jumping</li>
<li><code>Ctrl-N</code> Navigation mode This is my favorite feature, similar to ranger or nnn file management, this feature is great!</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/06/26/98084cf04d984c1f9a421561f94acba6.png" alt="Elvish"></p>
<p>Elvish also integrates its own package management.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">use epm
</span></span><span class="line"><span class="cl">epm:install &lt;package name&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="what-should-the-pipeline-transmit">What should the pipeline transmit?</h3>
<p>Unix&rsquo;s pipeline transfers one character after another, with no other structure. A character can convey very little information; to overcome this difficulty, most Unix tools treat a line as a piece of data. For example, <code>sed</code> can perform operations such as substitution for each line, and <code>grep</code> finds all lines containing a given character. This &ldquo;structure&rdquo; is not inherent to the pipeline, but rather to the tool&rsquo;s conventions.</p>
<p>This makes it problematic when the data itself contains newline characters. For example, this code to delete the <code>.bak</code> file in the current directory and its arbitrary level subdirectories (if you don&rsquo;t understand this code, see <a href="https://explainshell.com/explain?cmd=find+.+-name+%27*.bak%27+%7C+xargs+rm">here</a>).</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">find . -name <span class="s1">&#39;*.bak&#39;</span> <span class="p">|</span> xargs rm
</span></span></code></pre></td></tr></table>
</div>
</div><p>If there is a file named <code>a\n.bak</code> in the current directory, then <code>rm</code> will try to delete the file <code>a</code> and the file <code>.bak</code> instead of <code>a\n.bak</code>. This is because <code>xargs</code> cannot distinguish between newlines that separate data and newlines that are internal to the data.</p>
<p>It is common practice to have <code>find</code> separate the output items with <code>\0</code> and to have <code>xargs</code> also separate the reads with <code>\0</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">find . -name <span class="s1">&#39;*.bak&#39;</span> -print0 <span class="p">|</span> xargs -0 rm
</span></span></code></pre></td></tr></table>
</div>
</div><p>We&rsquo;re lucky in the case of filenames, because Unix filenames don&rsquo;t allow <code>\0</code>. What if the data we want to process also happens to contain <code>\0</code>?</p>
<p>This kind of plain text processing will always be ambiguous, so to solve this situation, we have to transfer a &ldquo;type&rdquo; field</p>
<p>I don&rsquo;t know how to describe it, but I&rsquo;ll borrow from <a href="https://zhuanlan.zhihu.com/p/20625453">elvish author&rsquo;s description</a>: it&rsquo;s divided into <strong>poor pipe</strong> and <strong>rich pipe</strong></p>
<ul>
<li>A poor pipe is a traditional raw transfer (the POSIX shell transfer method)</li>
<li>A rich pipe is a typed handle (a piece of data plus a type, that&rsquo;s two fields, or a transfer object)</li>
</ul>
<p>The rich pipe is used for the transfer of all built-in commands, and is compatible with the external command interaction with the poor pipe.</p>
<p>The rich pipe transfers objects, the more famous PowerShell also transfers <code>dotnet</code> objects inside this pipe</p>
<h2 id="ion-shell">Ion Shell</h2>
<p>This is the default shell for Redox OS, created by a bunch of crazy people.</p>
<p>The focus is on syntax and execution efficiency, and it&rsquo;s pretty much the same as the default bash / zsh, which is not POSIX shell compatible.</p>
<p>Ion uses a new syntax for data redirection <code>^</code>, which I think is probably not a good improvement. Maybe with Redox OS this might be good</p>
<p>There are three standard IO&rsquo;s.</p>
<ul>
<li><code>stdin</code> standard input <code>/dev/stdin</code></li>
<li><code>stdout</code> standard output <code>/dev/stdout</code></li>
<li><code>stderr</code> standard error <code>/dev/stderr</code></li>
</ul>
<p>The output messages are <code>stdout</code> and <code>stderr</code> and can be redirected separately</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>POSIX shell</th>
<th>Fish</th>
<th>Elvish</th>
<th>Ion</th>
<th>PowerShell</th>
<th>Nushell</th>
</tr>
</thead>
<tbody>
<tr>
<td>From file to standard input</td>
<td>&lt;</td>
<td>&lt;</td>
<td>&lt;</td>
<td>&lt;</td>
<td>&lt;</td>
<td>&lt;</td>
</tr>
<tr>
<td>Writing output to a file</td>
<td>&gt; , 1&gt;</td>
<td>&gt; , 1&gt;</td>
<td>&gt; , 1&gt;</td>
<td>&gt;</td>
<td>&gt; , 1&gt;</td>
<td>&gt; , 1&gt;</td>
</tr>
<tr>
<td>Output append write to a file</td>
<td>&raquo; , 1&raquo;</td>
<td>&raquo; , 1&raquo;</td>
<td>&raquo; , 1&raquo;</td>
<td>&raquo;</td>
<td>&raquo; , 1&raquo;</td>
<td>&raquo; , 1&raquo;</td>
</tr>
<tr>
<td>Writing errors to a file</td>
<td>2&gt;</td>
<td>^ , 2&gt;</td>
<td>2&gt;</td>
<td>^&gt;</td>
<td>2&gt;</td>
<td>2&gt;</td>
</tr>
<tr>
<td>Writing error append to a file</td>
<td>2&raquo;</td>
<td>^^ , 2&raquo;</td>
<td>2&raquo;</td>
<td>^&raquo;</td>
<td>2&raquo;</td>
<td>2&raquo;</td>
</tr>
<tr>
<td>Write all to one file</td>
<td>&amp;&gt;</td>
<td>&amp;&gt;</td>
<td>Not supported</td>
<td>&amp;&gt;</td>
<td>Not supported</td>
<td>&amp;&gt;</td>
</tr>
<tr>
<td>Output and error writing to a file</td>
<td>&gt; file 2&gt;&amp;1</td>
<td>&gt; file 2&gt;&amp;1</td>
<td>&gt; file 2&gt;&amp;1</td>
<td>Not supported</td>
<td>Yes, but the semantics are different</td>
<td>&gt; file 2&gt;&amp;1</td>
</tr>
</tbody>
</table>
<p>Writing <strong>all to a file</strong> and <strong>output and error writing to a file</strong> (<code>command &gt;file 2&gt;&amp;1</code> or append write <code>command &gt;&gt;file 2&gt;&amp;1</code>) are exactly equivalent</p>
<p>Fish also supports <code>&gt;?</code> , <code>^?</code> does not write output if the file exists, ion also supports multiple redirects <code>command &gt; stdout ^&gt; stderr &amp;&gt; combined</code></p>
<h3 id="file-descriptor-fd-file-descriptor">File Descriptor FD (File Descriptor)</h3>
<p>The <code>^</code> description <code>stderr</code> syntax of fish and ion looks much better. But why does the POSIX shell use <code>1</code> and <code>2</code> to distinguish between <code>stdout</code> and <code>stderr</code>?</p>
<p>On Unix systems, everything is a file, and each process opens three files as input, output, and error by default, with the first three file descriptors being (in a constant order)</p>
<ul>
<li><code>0</code> : <code>stdin</code></li>
<li><code>1</code> : <code>stdout</code></li>
<li><code>2</code> : <code>stderr</code></li>
</ul>
<p>Here, it is easy to understand that the standard input and output of a Unix system is essentially the reading and writing of three files, <code>1&gt;</code> , <code>2&gt;</code> referring to the file descriptors. So it may not make sense to use <code>^</code> to describe errors (this is a convention, not a rule)</p>
<p>Opening a file will assign a unique FD from 3 onwards, or you can specify it manually. (You can see the correspondence between FD and file in <code>/proc/self/fd</code>)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># std.sh</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># stdin 自己对自己的输入</span>
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="m">000</span> &gt;<span class="p">&amp;</span><span class="m">0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 打印 stdin 的数据</span>
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> -n &lt;<span class="p">&amp;</span><span class="m">0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># stdout</span>
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="m">111</span> &gt;<span class="p">&amp;</span><span class="m">1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># stderr</span>
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="m">222</span> &gt;<span class="p">&amp;</span><span class="m">2</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 打开文件， FD 设置为 3</span>
</span></span><span class="line"><span class="cl"><span class="nb">exec</span> 3&lt;&gt; /tmp/foo
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 刚打开了新的文件，可以看到映射关系</span>
</span></span><span class="line"><span class="cl">ls -l /proc/self/fd
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 写入内容</span>
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="m">333</span> &gt;<span class="p">&amp;</span><span class="m">3</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 关闭文件（关闭 3 这个 FD）</span>
</span></span><span class="line"><span class="cl"><span class="nb">exec</span> 3&gt;<span class="p">&amp;</span>-
</span></span></code></pre></td></tr></table>
</div>
</div><p>Note here: <code>sh -c &quot;echo 000 &gt;&amp;0; echo -n &lt;&amp;0&quot;</code> Passing data inside the script, <code>stdin</code> is always in interactive input (using <code>cat</code> will block because it cannot read the end of the file)</p>
<p>The pipeline will write <code>stdin</code> data followed by the terminator <code>EOF</code>, which is written as follows</p>
<ul>
<li><code>echo 000 | sh -c &quot;cat &lt;&amp;0&quot;</code></li>
<li><code>sh -c &quot;cat &lt;&amp;0&quot; &lt;&lt;&lt; 000</code></li>
<li><code>echo 000 | sh -c &quot;cat /dev/stdin&quot;</code> Of course, <code>/dev/stdin</code> and <code>&lt;&amp;0</code> are the same</li>
</ul>
<p>Be aware when using <code>ls</code> to view <code>fd</code> that because of the way <code>ls</code> works, a temporary <code>fd</code> is created</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">ls -l /proc/self/fd
</span></span><span class="line"><span class="cl">total <span class="m">0</span>
</span></span><span class="line"><span class="cl">lrwx------ <span class="m">1</span> metal metal <span class="m">64</span> May  <span class="m">5</span> 13:21 <span class="m">0</span> -&gt; /dev/pts/89
</span></span><span class="line"><span class="cl">lrwx------ <span class="m">1</span> metal metal <span class="m">64</span> May  <span class="m">5</span> 13:21 <span class="m">1</span> -&gt; /dev/pts/89
</span></span><span class="line"><span class="cl">lrwx------ <span class="m">1</span> metal metal <span class="m">64</span> May  <span class="m">5</span> 13:21 <span class="m">2</span> -&gt; /dev/pts/89
</span></span><span class="line"><span class="cl">lr-x------ <span class="m">1</span> metal metal <span class="m">64</span> May  <span class="m">5</span> 13:21 <span class="m">3</span> -&gt; /proc/2663987/fd
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="powershell-pwsh">PowerShell (pwsh)</h2>
<p>PowerShell is a task automation and configuration management framework from Microsoft that consists of a command line shell and an associated scripting language.</p>
<p>Originally, it was just a Windows component known as Windows PowerShell, and on August 18, 2016, with the introduction of PowerShell Core, it is now split into two versions: Windows PowerShell and the cross-platform PowerShell Core</p>
<p>PowerShell doesn&rsquo;t seem to work well outside of Windows. Maybe it&rsquo;s because I don&rsquo;t know how to use it</p>
<p>PowerShell&rsquo;s pipeline passes <code>.net object</code> instead of <code>raw</code> strings</p>
<p>which has a modern syntax, similar to the operations of a scripting language like python or ruby. Everything is treated as a dotnet object (somewhat similar to ipython, pry). It is possible to understand common data structures</p>
<h2 id="nushell">NuShell</h2>
<p>Much like the PowerShell idea, it can also be understood as a data structure, or as a &ldquo;PowerShell&rdquo; for Linux.</p>
<p>Look at the default <code>ls</code>, that&rsquo;s what a modern shell should look like. Of course, this <code>ls</code> is a built-in command, and Nushell has a lot of common commands built in, which gives you a brighter look and feel.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">/Users/metal/Code/blog<span class="o">(</span>master<span class="o">)</span>&gt; ls
</span></span><span class="line"><span class="cl">────┬──────────────┬──────┬──────────┬──────────────
</span></span><span class="line"><span class="cl"> <span class="c1">#  │     name     │ type │   size   │   modified</span>
</span></span><span class="line"><span class="cl">────┼──────────────┼──────┼──────────┼──────────────
</span></span><span class="line"><span class="cl">  <span class="m">0</span> │ 404.html     │ File │    <span class="m">398</span> B │ <span class="m">3</span> months ago
</span></span><span class="line"><span class="cl">  <span class="m">1</span> │ Gemfile      │ File │   1.2 KB │ <span class="m">3</span> months ago
</span></span><span class="line"><span class="cl">  <span class="m">2</span> │ Gemfile.lock │ File │   2.2 KB │ <span class="m">3</span> months ago
</span></span><span class="line"><span class="cl">  <span class="m">3</span> │ README.md    │ File │    <span class="m">322</span> B │ <span class="m">3</span> months ago
</span></span><span class="line"><span class="cl">  <span class="m">4</span> │ _config.yml  │ File │   2.0 KB │ <span class="m">2</span> months ago
</span></span><span class="line"><span class="cl">  <span class="m">5</span> │ _drafts      │ Dir  │     <span class="m">96</span> B │ <span class="m">3</span> months ago
</span></span><span class="line"><span class="cl">  <span class="m">6</span> │ _includes    │ Dir  │    <span class="m">160</span> B │ <span class="m">3</span> months ago
</span></span><span class="line"><span class="cl">  <span class="m">7</span> │ _layouts     │ Dir  │     <span class="m">96</span> B │ <span class="m">4</span> days ago
</span></span><span class="line"><span class="cl">  <span class="m">8</span> │ _posts       │ Dir  │   1.9 KB │ <span class="m">4</span> days ago
</span></span><span class="line"><span class="cl">  <span class="m">9</span> │ _site        │ Dir  │   1.3 KB │ <span class="m">4</span> days ago
</span></span><span class="line"><span class="cl"> <span class="m">10</span> │ about.md     │ File │   1.6 KB │ <span class="m">3</span> months ago
</span></span><span class="line"><span class="cl"> <span class="m">11</span> │ assets       │ Dir  │    <span class="m">224</span> B │ <span class="m">3</span> months ago
</span></span><span class="line"><span class="cl"> <span class="m">12</span> │ equipment.md │ File │   8.3 KB │ <span class="m">3</span> months ago
</span></span><span class="line"><span class="cl"> <span class="m">13</span> │ favicon.ico  │ File │ 238.1 KB │ <span class="m">3</span> months ago
</span></span><span class="line"><span class="cl"> <span class="m">14</span> │ index.md     │ File │    <span class="m">239</span> B │ <span class="m">3</span> months ago
</span></span><span class="line"><span class="cl"> <span class="m">15</span> │ links.md     │ File │   1.7 KB │ <span class="m">2</span> months ago
</span></span><span class="line"><span class="cl"> <span class="m">16</span> │ new.rb       │ File │   1.1 KB │ <span class="m">3</span> months ago
</span></span><span class="line"><span class="cl"> <span class="m">17</span> │ projects.md  │ File │   7.7 KB │ <span class="m">3</span> months ago
</span></span><span class="line"><span class="cl"> <span class="m">18</span> │ vendor       │ Dir  │     <span class="m">96</span> B │ <span class="m">3</span> months ago
</span></span><span class="line"><span class="cl">────┴──────────────┴──────┴──────────┴──────────────
</span></span></code></pre></td></tr></table>
</div>
</div><p>nushell has an extremely rich data structure, just like a modern programming language</p>
<p>Common data formats are supported: * json</p>
<ul>
<li>json</li>
<li>yaml</li>
<li>toml</li>
<li>xml</li>
<li>csv</li>
<li>ini</li>
</ul>
<p>With a more logical syntax.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">open people.txt <span class="p">|</span> lines <span class="p">|</span> split column <span class="s2">&#34;|&#34;</span> <span class="p">|</span> str trim
</span></span></code></pre></td></tr></table>
</div>
</div><p>Even integrated curl-like commands (using nushell to understand and parse xml)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">/home/metal/Code&gt; fetch https://a-wing.top/feed.xml <span class="p">|</span> get feed.children.subtitle.children.0
</span></span><span class="line"><span class="cl">新一的个人博客
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="using-repl-read-eval-print-loop-as-a-shell">Using REPL (Read-Eval-Print Loop) as a shell</h2>
<p>The interactive environment of modern programming languages, such as <code>IPython</code>, <code>Pry</code>, seems to work as a login shell. It&rsquo;s not a shell in the traditional sense, but it&rsquo;s often suggested as a login shell, but it&rsquo;s too slow to start.</p>
<p>Also, as a shell, most of the time it is used to execute external commands, and it is very tiring to type an extra character every time.</p>
<p>Perhaps we could fuse a common shell with REPL. e.g. xonsh fuses python and shell, either written in shell or using python directly.</p>
<p>Similarly, there are fusions of other languages, such as <a href="https://github.com/rikumi/fresh-shell">fresh-shell</a> which fuses <code>Node.js</code>.</p>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/shell/">shell</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2022-06/shell-3/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">How to use the shell (3/3) - Configuring zsh</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2022-06/shell-1/">
            <span class="next-text nav-default">How to use the shell (1/3) - shell compatibility and history</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  <script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox-3.1.20.min.js"></script>



<script type="text/javascript" src="/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
