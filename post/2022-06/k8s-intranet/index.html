<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Offline deployment of K8s in an intranet ubuntu environment  - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="Learn how to deploy K8s offline in an intranet ubuntu environment." /><meta name="keywords" content="Kubernetes, Offline, intranet, ubuntu" />






<meta name="generator" content="Hugo 0.96.0 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2022-06/k8s-intranet/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link href="/lib/fancybox/jquery.fancybox-3.1.20.min.css" rel="stylesheet">


<meta property="og:title" content="Offline deployment of K8s in an intranet ubuntu environment " />
<meta property="og:description" content="Learn how to deploy K8s offline in an intranet ubuntu environment." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2022-06/k8s-intranet/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-06-12T11:32:38+08:00" />
<meta property="article:modified_time" content="2022-06-12T11:32:38+08:00" />

<meta itemprop="name" content="Offline deployment of K8s in an intranet ubuntu environment ">
<meta itemprop="description" content="Learn how to deploy K8s offline in an intranet ubuntu environment."><meta itemprop="datePublished" content="2022-06-12T11:32:38+08:00" />
<meta itemprop="dateModified" content="2022-06-12T11:32:38+08:00" />
<meta itemprop="wordCount" content="747">
<meta itemprop="keywords" content="Kubernetes," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Offline deployment of K8s in an intranet ubuntu environment "/>
<meta name="twitter:description" content="Learn how to deploy K8s offline in an intranet ubuntu environment."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SOBYTE</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SOBYTE</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Offline deployment of K8s in an intranet ubuntu environment </h1>

      <div class="post-meta">
        <span class="post-time"> 2022-06-12 11:32:38 </span>
        <div class="post-category">
            <a href="/categories/tutorials/"> tutorials </a>
            </div>
          <span class="more-meta"> 747 words </span>
          <span class="more-meta"> 2 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#deployment-material-preparation">Deployment material preparation</a>
          <ul>
            <li><a href="#server">Server</a></li>
            <li><a href="#docker">docker</a></li>
            <li><a href="#k8s">K8S</a></li>
            <li><a href="#mirroring-if-you-are-a-chinese-user">Mirroring (if you are a Chinese user)</a></li>
            <li><a href="#flannel">Flannel</a></li>
          </ul>
        </li>
        <li><a href="#implement">Implement</a>
          <ul>
            <li><a href="#close-swap-partition">Close swap partition</a></li>
            <li><a href="#turn-off-the-firewall">Turn off the firewall</a></li>
            <li><a href="#install-docker">Install docker</a></li>
            <li><a href="#install-kubeadm-kubelet-and-kubectl">Install kubeadm, kubelet and kubectl</a></li>
            <li><a href="#enable-flannel-network">Enable Flannel Network</a></li>
            <li><a href="#add-worker-nodes">Add worker nodes</a></li>
            <li><a href="#install-kuboard-v3x">Install Kuboard v3.x</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>Recently working in an intranet environment, I needed to build a K8s cluster from scratch and perform a microservice migration.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/06/12/b4c7b00b3297427f9ea724031419e345.png" alt="k8s"></p>
<p>The following table shows the pre-researched scenarios for offline deployment of K8S.</p>
<table>
<thead>
<tr>
<th>Item</th>
<th>Language</th>
<th>Star</th>
<th>Fork</th>
<th>Off-line deployment support</th>
</tr>
</thead>
<tbody>
<tr>
<td>kops</td>
<td>Golang</td>
<td>13.2k</td>
<td>4.1k</td>
<td>Not supported</td>
</tr>
<tr>
<td>kubespray</td>
<td>Ansible</td>
<td>11.1k</td>
<td>4.7k</td>
<td>Support, you need to build your own installation package</td>
</tr>
<tr>
<td>kubeasz</td>
<td>Ansible</td>
<td>7.2k</td>
<td>2.7k</td>
<td>Support, you need to build your own installation package</td>
</tr>
<tr>
<td>sealos</td>
<td>Golang</td>
<td>4.1k</td>
<td>790</td>
<td>Support, payment required</td>
</tr>
<tr>
<td>RKE</td>
<td>Golang</td>
<td>2.5k</td>
<td>480</td>
<td>Not supported, you need to install docker by yourself</td>
</tr>
<tr>
<td>sealer</td>
<td>Golang</td>
<td>503</td>
<td>112</td>
<td>Support, from sealos</td>
</tr>
<tr>
<td>kubekey</td>
<td>Golang</td>
<td>471</td>
<td>155</td>
<td>Partially supported, only mirrors available offline</td>
</tr>
</tbody>
</table>
<p>I tried <a href="https://github.com/fanux/sealos">sealos</a> and ku<a href="https://github.com/kubesphere/kubekey">kubekey</a>bekey for the above solution, but the cni has been unable to pull up properly due to the unclean network environment of the machine itself that was initially given to me. And these deployment tools simplify the deployment, but also shield a lot of details, resulting in locating the problem is more trouble, the follow-up or use kubeadm to build their own.</p>
<h2 id="deployment-material-preparation">Deployment material preparation</h2>
<h3 id="server">Server</h3>
<ul>
<li>System environment: Ubuntu 18.04</li>
<li>Machine: 3</li>
</ul>
<h3 id="docker">docker</h3>
<ul>
<li>Version: 19.03</li>
<li>Download the installation package at: <a href="https://download.docker.com/linux/ubuntu/dists/bionic/pool/stable/amd64/">https://download.docker.com/linux/ubuntu/dists/bionic/pool/stable/amd64/</a></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">wget -P /home/deploy/deb/docker/ https://download.docker.com/linux/ubuntu/dists/bionic/pool/stable/amd64/docker-ce_19.03.13~3-0~ubuntu-bionic_amd64.deb
</span></span><span class="line"><span class="cl">wget -P /home/deploy/deb/docker/ https://download.docker.com/linux/ubuntu/dists/bionic/pool/stable/amd64/containerd.io_1.3.7-1_amd64.deb
</span></span><span class="line"><span class="cl">wget -P /home/deploy/deb/docker/ https://download.docker.com/linux/ubuntu/dists/bionic/pool/stable/amd64/docker-ce-cli_19.03.13~3-0~ubuntu-bionic_amd64.deb
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="k8s">K8S</h3>
<ul>
<li>Version: 1.19.16</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">apt-get update <span class="o">&amp;&amp;</span> apt-get install -y apt-transport-https
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">curl https://mirrors.aliyun.com/kubernetes/apt/doc/apt-key.gpg <span class="p">|</span> apt-key add -
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">cat &gt; /etc/apt/sources.list.d/kubernetes.list <span class="s">&lt;&lt; ERIC
</span></span></span><span class="line"><span class="cl"><span class="s">deb https://mirrors.aliyun.com/kubernetes/apt/ kubernetes-xenial main
</span></span></span><span class="line"><span class="cl"><span class="s">ERIC</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">apt-get update
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">apt-cache madison kubeadm
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">VERSION</span><span class="o">=</span>1.19.16-00
</span></span><span class="line"><span class="cl"><span class="c1">###### Download the package locally</span>
</span></span><span class="line"><span class="cl">apt-get install -y --download-only -o dir::cache::archives<span class="o">=</span>/home/deploy/deb/k8s <span class="nv">kubelet</span><span class="o">=</span><span class="nv">$VERSION</span> <span class="nv">kubeadm</span><span class="o">=</span><span class="nv">$VERSION</span> <span class="nv">kubectl</span><span class="o">=</span><span class="nv">$VERSION</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="mirroring-if-you-are-a-chinese-user">Mirroring (if you are a Chinese user)</h3>
<p>Domestic mirror preparation</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">registry.cn-hangzhou.aliyuncs.com/google_containers
</span></span></code></pre></td></tr></table>
</div>
</div><p>Prepare the following images in a networked environment.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">➜  ~ kubeadm config images  --kubernetes-version<span class="o">=</span>v1.19.16 --image-repository registry.cn-hangzhou.aliyuncs.com/google_containers
</span></span><span class="line"><span class="cl">registry.cn-hangzhou.aliyuncs.com/google_containers/kube-apiserver:v1.19.16
</span></span><span class="line"><span class="cl">registry.cn-hangzhou.aliyuncs.com/google_containers/kube-controller-manager:v1.19.16
</span></span><span class="line"><span class="cl">registry.cn-hangzhou.aliyuncs.com/google_containers/kube-scheduler:v1.19.16
</span></span><span class="line"><span class="cl">registry.cn-hangzhou.aliyuncs.com/google_containers/kube-proxy:v1.19.16
</span></span><span class="line"><span class="cl">registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.2
</span></span><span class="line"><span class="cl">registry.cn-hangzhou.aliyuncs.com/google_containers/etcd:3.4.13-0
</span></span><span class="line"><span class="cl">registry.cn-hangzhou.aliyuncs.com/google_containers/coredns:1.7.0
</span></span></code></pre></td></tr></table>
</div>
</div><p>pull</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">docker pull registry.cn-hangzhou.aliyuncs.com/google_containers/kube-apiserver:v1.19.16
</span></span><span class="line"><span class="cl">docker pull registry.cn-hangzhou.aliyuncs.com/google_containers/kube-controller-manager:v1.19.16
</span></span><span class="line"><span class="cl">docker pull registry.cn-hangzhou.aliyuncs.com/google_containers/kube-scheduler:v1.19.16
</span></span><span class="line"><span class="cl">docker pull registry.cn-hangzhou.aliyuncs.com/google_containers/kube-proxy:v1.19.16
</span></span><span class="line"><span class="cl">docker pull registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.2
</span></span><span class="line"><span class="cl">docker pull registry.cn-hangzhou.aliyuncs.com/google_containers/etcd:3.4.13-0
</span></span><span class="line"><span class="cl">docker pull registry.cn-hangzhou.aliyuncs.com/google_containers/coredns:1.7.0
</span></span></code></pre></td></tr></table>
</div>
</div><p>save</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">docker save -o k8s.tar registry.cn-hangzhou.aliyuncs.com/google_containers/kube-apiserver:v1.19.16
</span></span><span class="line"><span class="cl">registry.cn-hangzhou.aliyuncs.com/google_containers/kube-controller-manager:v1.19.16
</span></span><span class="line"><span class="cl">registry.cn-hangzhou.aliyuncs.com/google_containers/kube-scheduler:v1.19.16
</span></span><span class="line"><span class="cl">registry.cn-hangzhou.aliyuncs.com/google_containers/kube-proxy:v1.19.16
</span></span><span class="line"><span class="cl">registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.2
</span></span><span class="line"><span class="cl">registry.cn-hangzhou.aliyuncs.com/google_containers/etcd:3.4.13-0
</span></span><span class="line"><span class="cl">registry.cn-hangzhou.aliyuncs.com/google_containers/coredns:1.7.0
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="flannel">Flannel</h3>
<p>Download: <a href="https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml">https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml</a></p>
<h2 id="implement">Implement</h2>
<h3 id="close-swap-partition">Close swap partition</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">sudo swapoff -a
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="turn-off-the-firewall">Turn off the firewall</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">systemctl disable ufw <span class="o">&amp;&amp;</span> systemctl stop ufw
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="install-docker">Install docker</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">dpkg -i /home/deploy/deb/docker/*.deb
</span></span></code></pre></td></tr></table>
</div>
</div><p>After installation the default cgroups driver uses cgroupfs , which needs to be adjusted to systemd, so edit the docker configuration file and execute.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">sudo vi /etc/docker/daemon.json
</span></span></code></pre></td></tr></table>
</div>
</div><p>Add the following.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="nt">&#34;exec-opts&#34;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&#34;native.cgroupdriver=systemd&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Restart docker.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">sudo systemctl daemon-reload <span class="o">&amp;&amp;</span> sudo systemctl restart docker
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="install-kubeadm-kubelet-and-kubectl">Install kubeadm, kubelet and kubectl</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1">###### Offline installation of k8s</span>
</span></span><span class="line"><span class="cl">dpkg -i /home/deploy/deb/k8s/*.deb
</span></span></code></pre></td></tr></table>
</div>
</div><p>Import Mirror</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">docker load &lt; k8s.tar
</span></span></code></pre></td></tr></table>
</div>
</div><p>Start</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">sudo kubeadm init --pod-network-cidr 10.244.0.0/16 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>--image-repository registry.cn-hangzhou.aliyuncs.com/google_containers
</span></span></code></pre></td></tr></table>
</div>
</div><p>After executing init successfully, record the last two lines starting with &ldquo;kubeadm join&rdquo;.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">kubeadm join 192.168.20.104:6443 --token 0mj488.h6v5r010bfhlq9b1 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --discovery-token-ca-cert-hash sha256:3ea2cc19ceb0f109834f82bde13f5d29c534aba115cd41f8d3719db6b8ec074b
</span></span><span class="line"><span class="cl">root@master01:/home/deploy/deb/yaml
</span></span></code></pre></td></tr></table>
</div>
</div><p>Finally, in order of execution.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">mkdir -p <span class="nv">$HOME</span>/.kube
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">sudo cp -i /etc/kubernetes/admin.conf <span class="nv">$HOME</span>/.kube/config
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">sudo chown <span class="k">$(</span>id -u<span class="k">)</span>:<span class="k">$(</span>id -g<span class="k">)</span> <span class="nv">$HOME</span>/.kube/config
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="enable-flannel-network">Enable Flannel Network</h3>
<p>Execute</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">kubectl apply -f ./kube-flannel.yml 
</span></span></code></pre></td></tr></table>
</div>
</div><p>After successful execution, wait for 3 or 5 minutes and execute kubectl get nodes and kubectl get pods -all-namespaces again, you will see that the status is normal.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">yance@yance-ub:~$ kubectl get pod -n kube-system
</span></span><span class="line"><span class="cl">NAME                               READY   STATUS    RESTARTS   AGE
</span></span><span class="line"><span class="cl">coredns-6c76c8bb89-vjghr           1/1     Running   <span class="m">0</span>          46m
</span></span><span class="line"><span class="cl">coredns-6c76c8bb89-zswv9           1/1     Running   <span class="m">0</span>          46m
</span></span><span class="line"><span class="cl">etcd-yance-ub                      1/1     Running   <span class="m">0</span>          46m
</span></span><span class="line"><span class="cl">kube-apiserver-yance-ub            1/1     Running   <span class="m">0</span>          46m
</span></span><span class="line"><span class="cl">kube-controller-manager-yance-ub   1/1     Running   <span class="m">0</span>          46m
</span></span><span class="line"><span class="cl">kube-flannel-ds-dlxgv              1/1     Running   <span class="m">0</span>          23m
</span></span><span class="line"><span class="cl">kube-proxy-nhdwj                   1/1     Running   <span class="m">0</span>          46m
</span></span><span class="line"><span class="cl">kube-scheduler-yance-ub            1/1     Running   <span class="m">0</span>          46m
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="add-worker-nodes">Add worker nodes</h3>
<p>On each worker node, execute:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">kubeadm join 192.168.20.104:6443 --token 0mj488.h6v5r010bfhlq9b1 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --discovery-token-ca-cert-hash sha256:3ea2cc19ceb0f109834f82bde13f5d29c534aba115cd41f8d3719db6b8ec074b
</span></span><span class="line"><span class="cl">root@master01:/home/deploy/deb/yaml
</span></span></code></pre></td></tr></table>
</div>
</div><p>Execute on master:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">kubectl label node node_name node-role.kubernetes.io/worker<span class="o">=</span>worker 
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="install-kuboard-v3x">Install Kuboard v3.x</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">sudo docker run -d <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --restart<span class="o">=</span>unless-stopped <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --name<span class="o">=</span>kuboard <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  -p 80:80/tcp <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  -p 10081:10081/tcp <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  -e <span class="nv">KUBOARD_ENDPOINT</span><span class="o">=</span><span class="s2">&#34;http://内网IP:80&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  -e <span class="nv">KUBOARD_AGENT_SERVER_TCP_PORT</span><span class="o">=</span><span class="s2">&#34;10081&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  -v /root/kuboard-data:/data <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  eipwork/kuboard:v3
</span></span></code></pre></td></tr></table>
</div>
</div><p>The Kuboard v3.x interface can be accessed by entering <code>http://your-host-ip:80</code> in your browser and logging in as follows</p>
<ul>
<li>User name: <code>admin</code></li>
<li>Password: <code>Kuboard123</code></li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/06/12/892140b5e8f540938af56199c9e2f4ad.png" alt="Kuboard"></p>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/kubernetes/">Kubernetes</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2022-06/go-sync-pool/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Use sync.Pool in Golang to reduce GC pressure</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2022-06/k8s-descheduler/">
            <span class="next-text nav-default">Descheduler Secondary scheduling for a more balanced Kubernetes load</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  <script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox-3.1.20.min.js"></script>



<script type="text/javascript" src="/js/main.min.64437849d125a2d603b3e71d6de5225d641a32d17168a58106e0b61852079683.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
