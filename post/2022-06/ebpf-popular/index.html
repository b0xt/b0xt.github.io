<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Why is eBPF so popular? - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="Explore what makes eBPF so effective and why it is so popular." /><meta name="keywords" content="Ebpf" />






<meta name="generator" content="Hugo 0.102.0 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2022-06/ebpf-popular/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link href="/lib/fancybox/jquery.fancybox-3.1.20.min.css" rel="stylesheet">


<meta property="og:title" content="Why is eBPF so popular?" />
<meta property="og:description" content="Explore what makes eBPF so effective and why it is so popular." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2022-06/ebpf-popular/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-06-24T12:30:00+08:00" />
<meta property="article:modified_time" content="2022-06-24T12:30:00+08:00" />

<meta itemprop="name" content="Why is eBPF so popular?">
<meta itemprop="description" content="Explore what makes eBPF so effective and why it is so popular."><meta itemprop="datePublished" content="2022-06-24T12:30:00+08:00" />
<meta itemprop="dateModified" content="2022-06-24T12:30:00+08:00" />
<meta itemprop="wordCount" content="641">
<meta itemprop="keywords" content="Ebpf," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Why is eBPF so popular?"/>
<meta name="twitter:description" content="Explore what makes eBPF so effective and why it is so popular."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SOBYTE</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SOBYTE</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Why is eBPF so popular?</h1>

      <div class="post-meta">
        <span class="post-time"> 2022-06-24 12:30:00 </span>
        <div class="post-category">
            <a href="/categories/tutorials/"> tutorials </a>
            </div>
          <span class="more-meta"> 641 words </span>
          <span class="more-meta"> 4 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#introduction-to-ebpf">Introduction to eBPF</a></li>
        <li><a href="#why-is-ebpf-so-efficient">Why is eBPF so efficient?</a></li>
        <li><a href="#ebpf-mapping-ebpf-map">eBPF Mapping (eBPF Map)</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>The eBPF is a register-based virtual machine originally designed to filter network packets, and is known as the Extended Berkeley Packet Filter (eBPF) since the original <a href="https://www.tcpdump.org/papers/bpf-usenix93.pdf">paper</a> was written at the Lawrence Berkeley National Laboratory. This paper will explain why eBPF is so popular in easy-to-understand language.</p>
<h2 id="introduction-to-ebpf">Introduction to eBPF</h2>
<p>In layman&rsquo;s terms, eBPF is a custom program that runs in the kernel of the operating system when triggered by an event. You can think of eBPF programs as event-driven functions (e.g. AWS lamda, ðŸ‘‰OpenFunction). eBPF programs have access to a subset of kernel functions as well as memory. When an eBPF program is loaded into the kernel, there is a validator to ensure that it is safe to run, and if it cannot be validated, it will be rejected. This means that even garbage eBPF code will not crash the kernel.</p>
<p>In the container world, eBPF is becoming more and more popular, with the most popular products being <a href="https://github.com/cilium/cilium">Cilium</a> and <a href="https://github.com/pixie-io/pixie">Pixie</a>. Among them, Cilium is a CNI plug-in based on eBPF and also provides <a href="https://cilium.io/blog/2021/12/01/cilium-service-mesh-beta">Service Mesh without Sidecar</a>.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/06/24/1b8ebdc5d7954a47a273001336e27f9e.png" alt="eBPF"></p>
<p>Pixie, on the other hand, is focused on using eBPF to achieve observability.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/06/24/c5b91ad22f36425da7e505df93103fce.png" alt="Pixie"></p>
<p>More eBPF usage scenarios.</p>
<ul>
<li><strong>Debugging and tracing</strong>: tracing arbitrary system calls, kernel functions, and arbitrary processes in user space. Representative tool: <a href="https://github.com/iovisor/bpftrace">bpftrace</a>.</li>
<li><strong>Networking</strong>: Monitor, filter, and control traffic. A user-space program can attach a filter to any socket to monitor the traffic passing through it and perform various actions on it, such as allowing passage, denying passage, redirecting, etc.</li>
<li><strong>Security Monitoring and Isolation</strong>: eBPF programs can monitor and report on system calls that occur in the kernel, and can also prevent applications from executing certain system calls in the kernel (such as deleting files).</li>
</ul>
<p>Although Linux has long supported these features mentioned above, eBPF can help us perform these tasks more efficiently, consuming less CPU and memory resources.</p>
<h2 id="why-is-ebpf-so-efficient">Why is eBPF so efficient?</h2>
<p>eBPF programs &ldquo;run&rdquo; faster than traditional programs because their code is executed directly in kernel space.</p>
<p>Imagine a scenario where a program wants to count the number of bytes it sends out from a Linux system.</p>
<p>First, when network activity occurs, the kernel generates raw data, which contains a lot of information, most of which is not related to the &ldquo;bytes&rdquo; information. So, whatever raw data is generated, if you want to count the number of bytes sent out, you have to filter it over and over and do the math on it. This process is repeated hundreds of times a minute (or more).</p>
<p>Traditional monitoring programs run in user space, and all the raw data generated by the kernel must be copied from kernel space to user space, and this data copying and filtering is extremely taxing on the CPU. This is why ptrace is &ldquo;slow&rdquo; and <a href="https://github.com/iovisor/bpftrace">bpftrace</a> is &ldquo;fast&rdquo;.</p>
<p>Instead of copying data from kernel space to user space, eBPF allows you to run monitors directly in kernel space to aggregate observable data and send it to user space. eBPF can also filter data and create Histograms directly in kernel space, which is much faster than exchanging large amounts of data between user space and kernel space.</p>
<h2 id="ebpf-mapping-ebpf-map">eBPF Mapping (eBPF Map)</h2>
<p>eBPF has another hack that allows bidirectional data exchange between user space and kernel space using <strong>eBPF Map</strong>. In Linux, maps are a generic type of storage used to share data between user space and kernel space, and they are key-value stores that reside in the kernel.</p>
<p>For application scenarios like observability, eBPF programs perform calculations directly in kernel space and write the results to an eBPF map that can be read/written by user-space applications.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/06/24/47b46835b3fb4ae9a51ec4abcbb1b2b6.png" alt="eBPF Map"></p>
<p>Now you should understand why eBPF is so efficient, right? The main reason is that <strong>eBPF provides a way to run custom programs directly in kernel space and avoid copying extraneous data between kernel space and user space.</strong></p>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/ebpf/">Ebpf</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2022-06/loki-microservice/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Deploying a production cluster using the Loki microservice model</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2022-06/http3-quic/">
            <span class="next-text nav-default">HTTP/3 Principles and Practices</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  <script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox-3.1.20.min.js"></script>



<script type="text/javascript" src="/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js"></script>








</body>
</html>
