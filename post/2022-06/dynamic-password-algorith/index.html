<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Dynamic Password Algorith - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="Explore the algorithm for implementing dynamic passwords." /><meta name="keywords" content="Dynamic Password, HOTP, TOTP" />






<meta name="generator" content="Hugo 0.101.0 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2022-06/dynamic-password-algorith/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link href="/lib/fancybox/jquery.fancybox-3.1.20.min.css" rel="stylesheet">


<meta property="og:title" content="Dynamic Password Algorith" />
<meta property="og:description" content="Explore the algorithm for implementing dynamic passwords." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2022-06/dynamic-password-algorith/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-06-23T13:22:41+08:00" />
<meta property="article:modified_time" content="2022-06-23T13:22:41+08:00" />

<meta itemprop="name" content="Dynamic Password Algorith">
<meta itemprop="description" content="Explore the algorithm for implementing dynamic passwords."><meta itemprop="datePublished" content="2022-06-23T13:22:41+08:00" />
<meta itemprop="dateModified" content="2022-06-23T13:22:41+08:00" />
<meta itemprop="wordCount" content="2439">
<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Dynamic Password Algorith"/>
<meta name="twitter:description" content="Explore the algorithm for implementing dynamic passwords."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SOBYTE</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SOBYTE</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Dynamic Password Algorith</h1>

      <div class="post-meta">
        <span class="post-time"> 2022-06-23 13:22:41 </span>
        <div class="post-category">
            <a href="/categories/tutorials/"> tutorials </a>
            </div>
          <span class="more-meta"> 2439 words </span>
          <span class="more-meta"> 5 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#pre-reading-guide">Pre-reading guide</a></li>
        <li><a href="#background-on-dynamic-passwords">Background on dynamic passwords</a></li>
        <li><a href="#a-journey-of-dynamic-cryptographic-algorithm-exploration">A journey of dynamic cryptographic algorithm exploration</a>
          <ul>
            <li><a href="#classification-of-dynamic-passwords">Classification of dynamic passwords</a></li>
            <li><a href="#hotp">HOTP</a></li>
            <li><a href="#totp">TOTP</a></li>
          </ul>
        </li>
        <li><a href="#google-authenticator">Google Authenticator</a></li>
        <li><a href="#summary-1">Summary</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>Dynamic password, also known as One Time Password (OTP), is an efficient, simple and relatively secure password generation algorithm, which can be found everywhere in our lives and work, and as developers, we have more or less integrated two-step authentication mechanism in our business systems. So, what is the principle of dynamic password algorithm?</p>
<h2 id="pre-reading-guide">Pre-reading guide</h2>
<ul>
<li>With this article, you can learn about the following.
<ul>
<li>Background knowledge of dynamic passwords</li>
<li>Classification of dynamic passwords</li>
<li>Different dynamic password generation algorithms, HOTP and TOTP</li>
<li>A simple Ruby programming language implementation of HOTP and TOTP</li>
<li>Notes on each of the two types of algorithms</li>
</ul>
</li>
<li>For the sake of space, I will not discuss the following points, but if you are interested, you can refer to the references given at the end of my article for.
<ul>
<li>An analysis of the security of different dynamic passwords</li>
<li>How to ensure that the password is not used twice during the validity period of a timed dynamic password</li>
</ul>
</li>
</ul>
<h2 id="background-on-dynamic-passwords">Background on dynamic passwords</h2>
<p>From my point of view, a dynamic password is a password that is regenerated with the occurrence of a certain event (password being used, passage of a certain amount of time, etc.), because the biggest advantage of dynamic passwords themselves is that they are resistant to repeated execution attacks (replay attack), which can well avoid the defects of similar static passwords that can be brute-force cracked, etc. In reality, they are generally used The combination of &ldquo;static password + dynamic password&rdquo; two-factor authentication, we also call two-step authentication.</p>
<p>The dynamic password actually appeared in our lives a long time ago, before the development of mobile payments, Internet banking was the most popular online payment channel, when banks to ensure that everyone&rsquo;s Internet banking account payment security, will be issued to Internet banking customers with a dynamic password card, such as the Bank of China electronic password card (according to the time difference in the generation of new passwords, password card comes with a battery to ensure continuous use for several years), or ICBC&rsquo;s electronic banking password card (Internet banking payment web page generates a different row serial number each time, the user scratches the coating on the password card according to the specified row combination to obtain the password, the password expires after use), or the mandatory requirement of the bank SMS verification code, these can be included in the category of dynamic password.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/06/23/f722140c267548f788727d084d0d4b9f.png" alt="dynamic passwords">
<img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/06/23/4e0b5f0f6c1f4268a880d3689d9657fe.png" alt="dynamic passwords"></p>
<p>And with the development of the mobile Internet and the continuous improvement of the intelligence of mobile devices, the synchronization ability between devices has increased significantly, and the dynamic password generation technology that used to rely on independent devices soon evolved into dynamic password generation software on cell phones to generate dynamic passwords in the form of cell phone software has greatly improved the portability of dynamic passwords, and a user a cell phone can manage any number of dynamic passwords generation, which also makes the promotion of two-step verification on the site much less resistance, because in the past customers may refuse to open the two-step verification mechanism because it is too cumbersome to use the password card, thus exposing their accounts to risk. The most well-known dynamic password generation software is Google&rsquo;s Authenticator APP.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/06/23/3239541e5c7d4698b521428108bee572.png" alt="Authenticator App"></p>
<h2 id="a-journey-of-dynamic-cryptographic-algorithm-exploration">A journey of dynamic cryptographic algorithm exploration</h2>
<h3 id="classification-of-dynamic-passwords">Classification of dynamic passwords</h3>
<p>In general, there are two types of common dynamic passwords.</p>
<ul>
<li><strong>Counted-use:</strong> After the output of the counted-use OTP, it can be used at any time until the next successful use, when the counter is added 1 to generate a new password. The algorithm used to achieve the counted use of dynamic passwords is called HOTP, which will be introduced next.</li>
<li><strong>Timed use:</strong> Timed use of OTP can set the password validity time, ranging from 30 seconds to two minutes, and the OTP is discarded after the authentication, the next authentication must use a new password. The algorithm used to implement the time-based dynamic password is called TOTP, which will be introduced next.</li>
</ul>
<p>Before the real algorithm is introduced, it is necessary to add that the basic authentication principle of dynamic passwords is to share the key, also known as the seed key, and the same seed key used for an event count, or time value of the cryptographic algorithm calculation, the use of algorithms such as symmetric algorithms, HASH, HMAC. Remember this, this is the basis for the implementation of all dynamic cryptographic algorithms.</p>
<h3 id="hotp">HOTP</h3>
<p>HOTP algorithm, full name is &ldquo;An HMAC-Based One-Time Password Algorithm&rdquo;, is a one-time password generation algorithm based on event counting, detailed algorithm description can be found in <a href="https://tools.ietf.org/html/rfc4226">RFC 4226</a>. In fact, the algorithm itself is very simple, and the algorithm itself can be described by two short expressions.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">HOTP(K,C) = Truncate(HMAC-SHA-1(K,C)) PWD(K,C,digit) = HOTP(K,C) mod 10^Digit
</span></span></code></pre></td></tr></table>
</div>
</div><p>In the above equation.</p>
<ul>
<li>K represents the key we share between the authentication server side and the password generation side (client device), in RFC 4226, the authors require the minimum length of the shared key to be 128 bits, while the authors themselves recommend using a 160-bit length key</li>
<li>C is the value of the event count, an 8-byte integer called the moving factor, and it should be noted that the integer value of C needs to be expressed as a binary string, e.g., if the event count is 3, C is <code>&quot;11&quot;</code> (the leading binary digit 0 is omitted here)</li>
<li>HMAC-SHA-1 means to encrypt the shared key and the shift factor with the SHA1 algorithm of HMAC, and get the encryption result of 160 bits length (20 bytes)</li>
<li>Truncate is the truncation function, which will be described later.</li>
<li>digit specifies the length of the dynamic password, for example, we commonly use a 6-bit dynamic password</li>
</ul>
<h4 id="truncate-truncate-function">Truncate truncate function</h4>
<p>Since the SHA-1 algorithm is an existing algorithm and not the focus of our discussion, the Truncate function is the most critical part of the entire algorithm. The following is a step-by-step description of the Truncate function.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">DT(String) // String = String[0]…String[19] Let OffsetBits be the low-order 4 bits of
</span></span><span class="line"><span class="cl">String[19] Offset = StToNum(OffsetBits) // 0 &lt;= OffSet &lt;= 15 Let P = String[OffSet]…
</span></span><span class="line"><span class="cl">String[OffSet+3] Return the Last 31 bits of P
</span></span></code></pre></td></tr></table>
</div>
</div><p>Combined with the above formula, it is roughly described as follows.</p>
<ol>
<li>first select the 4 bits of the last byte of the low byte bit from the result of the 20-byte length obtained by SHA-1 algorithm encryption in the first step (note: the big-endian storage used in the dynamic cipher algorithm).</li>
<li>convert the binary value of these 4 bits to an unscented integer value to obtain a number between 0 and 15 (inclusive), which is used as the offset from 0 in the 20 bytes.</li>
<li>then intercept 4 consecutive bytes (32 bits) starting from the specified offset, and finally return the next 31 bits of the 32 bits.</li>
</ol>
<p>Returning to the algorithm itself, after obtaining the 31-bit truncated result, we convert it to an integer value with no punctuation at the big end, which takes values from 0 to 2^31, i.e., 0 to 2.147483648E9, and finally we modulo this number by multiplying by 10 (digit exponent range 1-10) to obtain a remainder value, which is preceded by 0 to obtain the specified number of bits of We get the string with the specified number of digits.</p>
<h4 id="code-example">Code Example</h4>
<p>The following code example is also available at <a href="https://gist.github.com/Martin91/15a3a29acd9d138b0d6e125d8fbd5ab0">Gist</a>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">require</span> <span class="s1">&#39;openssl&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">hotp</span><span class="p">(</span><span class="n">secret</span><span class="p">,</span> <span class="n">counter</span><span class="p">,</span> <span class="n">digits</span> <span class="o">=</span> <span class="mi">6</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nb">hash</span> <span class="o">=</span> <span class="n">OpenSSL</span><span class="p">::</span><span class="n">HMAC</span><span class="o">.</span><span class="n">digest</span><span class="p">(</span><span class="n">OpenSSL</span><span class="p">::</span><span class="n">Digest</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;sha1&#39;</span><span class="p">),</span> <span class="n">secret</span><span class="p">,</span> <span class="n">int_to_bytestring</span><span class="p">(</span><span class="n">counter</span><span class="p">))</span>  <span class="c1"># SHA-1 算法加密</span>
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;%0#</span><span class="si">{digits}</span><span class="s2">i&#34;</span> <span class="o">%</span> <span class="p">(</span><span class="n">truncate</span><span class="p">(</span><span class="nb">hash</span><span class="p">)</span> <span class="o">%</span> <span class="mi">10</span><span class="o">**</span><span class="n">digits</span><span class="p">)</span>  <span class="c1"># 取模获取指定长度数字密码</span>
</span></span><span class="line"><span class="cl"><span class="n">end</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">truncate</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="n">offset</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">bytes</span><span class="o">.</span><span class="n">last</span> <span class="o">&amp;</span> <span class="mh">0xf</span>           <span class="c1"># 取最后一个字节</span>
</span></span><span class="line"><span class="cl">  <span class="n">partial</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">bytes</span><span class="p">[</span><span class="n">offset</span><span class="o">..</span><span class="n">offset</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span>   <span class="c1"># 从偏移量开始，连续取 4 个字节</span>
</span></span><span class="line"><span class="cl">  <span class="n">partial</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&#34;C*&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&#34;N&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span> <span class="o">&amp;</span> <span class="mh">0x7fffffff</span>    <span class="c1"># 取后面 31 位结果后得到整数</span>
</span></span><span class="line"><span class="cl"><span class="n">end</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">int_to_bytestring</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">padding</span> <span class="o">=</span> <span class="mi">8</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">  <span class="n">until</span> <span class="nb">int</span> <span class="o">==</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">    <span class="n">result</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="nb">int</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">)</span><span class="o">.</span><span class="n">chr</span>
</span></span><span class="line"><span class="cl">    <span class="nb">int</span> <span class="o">&gt;&gt;=</span> <span class="mi">8</span>
</span></span><span class="line"><span class="cl">  <span class="n">end</span>
</span></span><span class="line"><span class="cl">  <span class="n">result</span><span class="o">.</span><span class="n">reverse</span><span class="o">.</span><span class="n">join</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="n">padding</span><span class="p">,</span> <span class="mf">0.</span><span class="n">chr</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">end</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The above algorithm implements a small amount of code, the core is just a number of mask operations and bit manipulation according to the algorithm description.</p>
<h4 id="password-failure-mechanism">Password Failure Mechanism</h4>
<p>From the above analysis, we can see that the generation of a dynamic password depends on the shared key and the value of the move factor, which remains constant, and ultimately only the move factor determines the result of the password generation. Therefore, in the HOTP algorithm, it is required that each time a password is successfully verified, the authentication server side as well as the password generator (client side) should add 1 to the counter value to ensure that a new password is obtained.</p>
<p>However, a problem is introduced here, if the communication between the authentication server and the password generator is out of sync due to a communication failure or other unforeseen circumstances, then the passwords generated by the two sides will not match correctly. In order to solve this problem, the algorithm suggests in the analysis that the authentication server side can take the initiative to try whether the new password regenerated after the counter minus 1 is the same as the password submitted by the client after the password verification fails, and if so, it can be assumed that the client counter is not synchronized, in which case it can pass the verification and ask the client to resynchronize the counter value.</p>
<p>In addition to the above mentioned problem of the counter not being synchronized, I was thinking that if the client has multiple password generators (assuming iPad and iPhone) generating passwords for the same account, then the synchronization of the counter between multiple devices may require a separate consideration.</p>
<h4 id="summary">Summary</h4>
<p>The algorithm for HOTP is actually much more concise than I thought before reading the algorithm, and still robust enough. The algorithm itself cleverly uses a cryptographic algorithm to encrypt the shared key and counter to ensure that the two dynamic password generation factors are not tampered with, and then a truncate function to obtain a random decimal integer of up to 10 bits, ultimately enabling support for dynamic passwords of 1 - 10 bits in length. The simplicity of the algorithm itself ensures that the algorithm itself can be implemented on a variety of devices.</p>
<h3 id="totp">TOTP</h3>
<p>The TOTP algorithm, known as TOTP: Time-Based One-Time Password Algorithm, is based on the HOTP algorithm and is centered on changing the move factor from event counting in HOTP to time difference. The complete description of the TOTP algorithm can be found in <a href="https://tools.ietf.org/html/rfc6238">RFC 6238</a>, and its formula description is very simple.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">TOTP = HOTP(K, T) // T is an integer and represents the number of time steps between the initial counter time T0 and the current Unix time More specifically, T = (Current Unix time - T0) / X, where the default floor function is used in the computation.
</span></span></code></pre></td></tr></table>
</div>
</div><p>Generally speaking, the time difference used in TOTP is the current timestamp, and TOTP divides the time difference by the time window (password validity, default 30 seconds) to get the time window count, which is used as the shift factor of the dynamic password algorithm, so that it is easy to get a time-based dynamic password based on the HOTP algorithm.</p>
<p><strong>Note:</strong> RFC 6238 mentions that in the TOTP algorithm, a different keyed hash algorithm can be specified, for example, in HOTP the HMAC-SHA1 algorithm is used, while in TOTP, in addition, HMAC-SHA256 or HMAC-SHA512 can be used.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">TOTP implementations MAY use HMAC-SHA-256 or HMAC-SHA-512 functions, based on SHA-256 or SHA-512 [SHA2] hash functions, instead of the HMAC-SHA-1 function that has been specified for the HOTP computation in [RFC4226].
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="code-example-1">Code Example</h4>
<p>The following code example is also available at <a href="https://gist.github.com/Martin91/15a3a29acd9d138b0d6e125d8fbd5ab0">Gist</a>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">require</span> <span class="s1">&#39;hotp&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">totp</span><span class="p">(</span><span class="n">secret</span><span class="p">,</span> <span class="n">digits</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span> <span class="n">initial_time</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="n">steps</span> <span class="o">=</span> <span class="p">(</span><span class="n">Time</span><span class="o">.</span><span class="n">now</span><span class="o">.</span><span class="n">to_i</span> <span class="o">-</span> <span class="n">initial_time</span><span class="p">)</span> <span class="o">/</span> <span class="n">step</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">hotp</span><span class="p">(</span><span class="n">secret</span><span class="p">,</span> <span class="n">steps</span><span class="p">,</span> <span class="n">digits</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">end</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>See, extremely short implementation code! A time-counting dynamic password algorithm was born. Such a simple algorithm, but the cornerstone of the security operation of many business systems, quite a four-two-thousand pounds of pleasure!</p>
<h4 id="questions-to-discuss">Questions to discuss</h4>
<ol>
<li>the main problem in the ROTP algorithm is the synchronization of counters, and TOTP is no exception, but the problem lies in the synchronization of time between the server and the client, due to the development of the Internet now, coupled with mobile devices are generally set in accordance with the network time device time, basically the relative synchronization of time is not a problem.</li>
<li>another problem of time synchronization is actually a boundary problem, if the client generates the password for exactly 29 seconds, and due to network delays and other reasons, the server accepts the verification just at the first second of the next time window, this time will lead to password verification failure. Therefore, TOTP algorithm in its algorithm discussion also suggests that the server can try to regenerate the password after the failed password verification by subtracting 1 from its own time window value, and if the verification passes, it means that the failed verification is caused by the boundary problem of the time window, and then the password verification can be considered as passed.</li>
<li>Another advantage of time-based dynamic password is that it avoids the counter synchronization problem among multiple devices based on counters, because each device as well as the server can calibrate itself with the network time (common time standard) without relying on the server&rsquo;s time.</li>
</ol>
<h2 id="google-authenticator">Google Authenticator</h2>
<p>In Google Authenticator&rsquo;s <a href="https://github.com/google/google-authenticator">open source project</a> the README explicitly mentions.</p>
<blockquote>
<p>These implementations support the HMAC-Based One-time Password (HOTP) algorithm specified in RFC 4226 and the Time-based One-time Password (TOTP) algorithm specified in RFC 6238.</p>
</blockquote>
<p>At this point, we also understand that the core of the Google Authenticator algorithm is also HOTP and TOTP, after understanding the core of the entire dynamic password algorithm, there is a feeling of clarity?</p>
<h2 id="summary-1">Summary</h2>
<p>This article briefly introduced two common types of dynamic password generation algorithms, the algorithm itself is simple and uncomplicated, efficient and robust enough. The purpose of this article is to facilitate people like me who want to understand the core of the algorithm. There is still a lot of discussion about the security aspects of the algorithms themselves in the RFC documentation, so check it out if you are interested.</p>

    </div>

    
<footer class="post-footer">
      
      <nav class="post-nav">
        <a class="prev" href="/post/2022-06/mv-and-rename/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Mv and Rename</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2022-06/python-monkey-patch/">
            <span class="next-text nav-default">Beware of monkey patches and tips for troubleshooting monkey patches in Python</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  <script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox-3.1.20.min.js"></script>



<script type="text/javascript" src="/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
