<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Design specifications for the Open API - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="This article attempts to explore a suitable Open API open specification around many factors." /><meta name="keywords" content="Open API, specifications" />






<meta name="generator" content="Hugo 0.101.0 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2022-06/open-api-specifications/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link href="/lib/fancybox/jquery.fancybox-3.1.20.min.css" rel="stylesheet">


<meta property="og:title" content="Design specifications for the Open API" />
<meta property="og:description" content="This article attempts to explore a suitable Open API open specification around many factors." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2022-06/open-api-specifications/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-06-22T12:40:43+08:00" />
<meta property="article:modified_time" content="2022-06-22T12:40:43+08:00" />

<meta itemprop="name" content="Design specifications for the Open API">
<meta itemprop="description" content="This article attempts to explore a suitable Open API open specification around many factors."><meta itemprop="datePublished" content="2022-06-22T12:40:43+08:00" />
<meta itemprop="dateModified" content="2022-06-22T12:40:43+08:00" />
<meta itemprop="wordCount" content="2361">
<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Design specifications for the Open API"/>
<meta name="twitter:description" content="This article attempts to explore a suitable Open API open specification around many factors."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SOBYTE</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SOBYTE</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Design specifications for the Open API</h1>

      <div class="post-meta">
        <span class="post-time"> 2022-06-22 12:40:43 </span>
        <div class="post-category">
            <a href="/categories/tutorials/"> tutorials </a>
            </div>
          <span class="more-meta"> 2361 words </span>
          <span class="more-meta"> 12 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#background">Background</a></li>
        <li><a href="#open-api-design-considerations">Open API Design Considerations</a></li>
        <li><a href="#the-restful-specification-debate">The restful specification debate</a></li>
        <li><a href="#roa-and-rpc">ROA and RPC</a>
          <ul>
            <li><a href="#roa-style">ROA style</a></li>
            <li><a href="#rpc-style">RPC style</a></li>
          </ul>
        </li>
        <li><a href="#a-detailed-example-of-rpc-interface-documentation">A detailed example of RPC interface documentation</a>
          <ul>
            <li><a href="#creating-a-service">Creating a service</a></li>
          </ul>
        </li>
        <li><a href="#summary">Summary</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <h2 id="background">Background</h2>
<p>Recently, due to business requirements, I participated in the development of the cloud product CSB need to open the Open API to the public, originally it was not a difficult task, because our internal Open API open mechanism has been very mature, there is no need for me to design, but this time the demand is mainly for some independent deployment scenarios, the need to design a set of specifications, that means, the need for Open API for That means that there is a need for some specification constraints on the Open API, so I have this article.</p>
<p>Open API and front-end pages are always the face of the product, so if the Open API is not standardized, it will lower the professionalism of the product. In the cloud scenario, many users will choose to build their own portals to connect to the Open APIs of cloud products, which puts forward the demand for us to build a mature Open API mechanism.</p>
<p>From the business perspective, there are some guiding principles to guide us to improve the Open API mechanism.</p>
<ul>
<li>The interfaces used in front-end pages and the interfaces provided by Open API are the same set of interfaces</li>
<li>Any front-end page interface should have a corresponding Open API</li>
</ul>
<p>From a technical point of view, there are many API open standards for our reference, and the Open API documentation of some open source products is also very complete. On the one hand, I will take the essence of them, on the other hand, we should consider the specificity of our own product output form. In this article, we will try to explore a suitable Open API open specification around many factors.</p>
<h2 id="open-api-design-considerations">Open API Design Considerations</h2>
<p>What exactly should a well-designed Open API specification specify?</p>
<p>From the design point of view, we need to consider: naming specification, composition specification, path specification, in/out specification, data type specification, uniform return value specification, error code specification, paging specification.</p>
<p>From the team&rsquo;s point of view, whether the back-end junior and mid-level developers and front-end developers in the team have enough experience to understand and implement the API specification. At the same time, along with the staff turnover, whether the Open API specification can be passed on well.</p>
<p>From the industry&rsquo;s point of view, we need to consider whether the market where the Open API is provided is mature and the API style may already have a corresponding specification.</p>
<p>From a product perspective, the API style is different for each product, and we will focus on this perspective below.</p>
<p>In short, the design of Open API is something that is difficult to conclude. Before I introduce the Open API specification that my product eventually adopts, I will first talk about some familiar concepts, such as restful.</p>
<h2 id="the-restful-specification-debate">The restful specification debate</h2>
<p>If you&rsquo;ve been around the code world, you&rsquo;ve heard of the restful specification.</p>
<ul>
<li>add, delete, change should be declared as: POST, DELETE, PUT, PATCH, GET</li>
<li>verbs should not appear, verbs are unified by the HTTP Method</li>
<li>Reflect the abstraction of &ldquo;resource&rdquo;</li>
<li>Use pathVariable, queryParam, header, statusCode to express a lot of business semantics</li>
</ul>
<p>The restful specification may look good, but if you&rsquo;ve actually tried to get it off the ground, you&rsquo;re bound to encounter some similar problems.</p>
<ul>
<li>Take the user login interface as an example, such interface is difficult to map to resource addition, deletion, and checking.</li>
<li>Take querying the error rate of interface requests in the last 7 hours as an example, derived to complex query scenarios such as graphQL, which often requires a json structure, GET is unable to achieve this, only POST can be passed.</li>
</ul>
<p>For this reason, the restful specification is gradually gaining opposition.</p>
<ul>
<li>Forcing everything to be &ldquo;resourceful&rdquo; goes against common development sense, and interfaces can&rsquo;t always be mapped by simple additions, deletions, and queries.</li>
<li>Complex query semantics can&rsquo;t always be expressed in GET.</li>
</ul>
<p>The restful style has its fans, and there is no shortage of objections to these statements, and the community is full of comments like &ldquo;the main people who reject the restful style are low-level, uninspired architects and front- and back-end programmers, and it&rsquo;s the people who can&rsquo;t design, not the specification&rdquo;. At the same time, restful was sublimated: the problem of retrieving complex parameters should have been classified as post in the restful semantics, because the behavior is not the location of resources (GET), but the retrieval of resources (POST).</p>
<p>This obviously irritates the nerves of restful style opponents, who disdainfully say, &ldquo;Oh, silly restful fundamentalists.</p>
<p>I wonder if you are a restful fan or opponent? Or maybe you are a neutral.</p>
<p>This is the end of the restful debate, which is purely fictional, so don&rsquo;t worry about it. Regardless of how you view restful, you can be a neutral in my discussion below, otherwise the effect is halved.</p>
<h2 id="roa-and-rpc">ROA and RPC</h2>
<p>API design is not just a restful specification, in a larger perspective, the mainstream API design style can actually be divided into</p>
<ul>
<li>Resource oriented design, i.e. ROA (Resource oriented architecture)</li>
<li>Process-oriented design, i.e. RPC (Remote Procedure Call)</li>
</ul>
<p>restful is a typical example of ROA style, while RPC style is relatively less familiar, but in fact, most of the system interfaces are probably RPC style, but the concept of RPC style is not well known.</p>
<p>Take the CRUD of the user module as an example, and compare the two styles.</p>
<h3 id="roa-style">ROA style</h3>
<h4 id="create-user-post">Create User (POST)</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">Request:
</span></span><span class="line"><span class="cl">POST /users
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">{&#34;name&#34;: &#34;kirito&#34;, &#34;age&#34;: 18}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Response:
</span></span><span class="line"><span class="cl">HTTP 201 Created
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">{&#34;id&#34;: 1, &#34;name&#34;: &#34;kirito&#34;, &#34;age&#34;: 18}
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="query-user-get">Query user (GET)</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">Request:
</span></span><span class="line"><span class="cl">GET /users/1
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Response:
</span></span><span class="line"><span class="cl">HTTP 200 OK
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">{&#34;id&#34;: 1, &#34;name&#34;: &#34;kirito&#34;, &#34;age&#34;: 18}
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="query-user-list-get">Query user list (GET)</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">Request:
</span></span><span class="line"><span class="cl">GET /users
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Response:
</span></span><span class="line"><span class="cl">HTTP 200 OK
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">{[{&#34;id&#34;: 1, &#34;name&#34;: &#34;kirito&#34;, &#34;age&#34;: 18}], &#34;next&#34;: &#34;/users?offset=1&#34;}
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="createmodify-users-put">Create/modify users (PUT)</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">Request:
</span></span><span class="line"><span class="cl">PUT /users/1
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">{&#34;name&#34;: &#34;kirito&#34;, &#34;age&#34;: 19}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Response:
</span></span><span class="line"><span class="cl">HTTP 200 OK
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">{&#34;id&#34;: 1, &#34;name&#34;: &#34;kirito&#34;, &#34;age&#34;: 19}
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="modify-user-patch">Modify user (PATCH)</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">Request:
</span></span><span class="line"><span class="cl">PATCH /users/1
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">{&#34;age&#34;: 20}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Response:
</span></span><span class="line"><span class="cl">HTTP 200 OK
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">{&#34;id&#34;: 1, &#34;name&#34;: &#34;kirito&#34;, &#34;age&#34;: 20}
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="delete-user-delete">Delete user (DELETE)</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">Request:
</span></span><span class="line"><span class="cl">DELETE /users/1
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Response:
</span></span><span class="line"><span class="cl">HTTP 204 No Content
</span></span></code></pre></td></tr></table>
</div>
</div><p>ROA style and restful specification is the same thing, in order to facilitate its comparison with RPC style interface, here are some points of interest in the above example.</p>
<ul>
<li>Using HTTP response codes (200, 201, 204) to complete the mapping of HTTP semantics and business semantics, exception streams also appear 404, 401 and so on (for space considerations, this article does not do the introduction of exception streams)</li>
<li>PATCH part of the modified resource, the request body is the content of the modified part; PUT create/modify the resource, the request body is all the content of the new resource</li>
<li>id is the resource locator, while age and name are attributes</li>
</ul>
<h3 id="rpc-style">RPC style</h3>
<h4 id="create-user-post-1">Create User (POST)</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">Request:
</span></span><span class="line"><span class="cl">POST /user/createUser
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">{&#34;name&#34;: &#34;kirito&#34;, &#34;age&#34;: 18}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Response:
</span></span><span class="line"><span class="cl">HTTP 200 OK
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">{&#34;code&#34;: 0, &#34;message&#34;: &#34;&#34;, &#34;data&#34;: {&#34;id&#34;: 1, &#34;name&#34;: &#34;kirito&#34;, &#34;age&#34;: 18}}
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="query-user-post">Query user (POST)</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">Request:
</span></span><span class="line"><span class="cl">POST /user/getUser
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">{&#34;id&#34;: 1}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Response:
</span></span><span class="line"><span class="cl">HTTP 200 OK
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">{&#34;code&#34;: 0, &#34;message&#34;: &#34;&#34;, &#34;data&#34;: {&#34;id&#34;: 1, &#34;name&#34;: &#34;kirito&#34;, &#34;age&#34;: 18}}
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="query-user-list-post">Query user list (POST)</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">Request:
</span></span><span class="line"><span class="cl">POST /user/listUsers
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Response:
</span></span><span class="line"><span class="cl">HTTP 200 OK
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">{&#34;code&#34;: 0, &#34;message&#34;: &#34;&#34;, &#34;data&#34;: {&#34;user&#34;: [{&#34;id&#34;: 1, &#34;name&#34;: &#34;kirito&#34;, &#34;age&#34;: 18}], &#34;next&#34;: &#34;/user/listUsers?offset=1&#34;}}
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="modify-user-post">Modify user (POST)</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">Request:
</span></span><span class="line"><span class="cl">POST /user/modifyUser
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">{&#34;id&#34;: 1, &#34;name&#34;: &#34;kirito&#34;, &#34;age&#34;: 19}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Response:
</span></span><span class="line"><span class="cl">HTTP 200 OK
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">{&#34;code&#34;: 0, &#34;message&#34;: &#34;&#34;, &#34;data&#34;: {&#34;id&#34;: 1, &#34;name&#34;: &#34;kirito&#34;, &#34;age&#34;: 19}}
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="modify-user-name-post">Modify user name (POST)</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">Request:
</span></span><span class="line"><span class="cl">POST /user/modifyUserAge
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">{&#34;id&#34;: 1, &#34;age&#34;: 20}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Response:
</span></span><span class="line"><span class="cl">HTTP 200 OK
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">{&#34;code&#34;: 0, &#34;message&#34;: &#34;&#34;, &#34;data&#34;: {&#34;id&#34;: 1, &#34;name&#34;: &#34;kirito&#34;, &#34;age&#34;: 20}}
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="delete-user-delete-1">Delete user (DELETE)</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">Request:
</span></span><span class="line"><span class="cl">POST /user/deleteUser
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">{&#34;id&#34;: 1}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Response:
</span></span><span class="line"><span class="cl">{&#34;code&#34;: 0, &#34;message&#34;: &#34;&#34;}
</span></span></code></pre></td></tr></table>
</div>
</div><p>The RPC style is not like the restful ROA style, there are some agreed specifications, each business system in the implementation, there are differences, so this is only the author&rsquo;s personal experience, but I hope the reader can seek common ground while preserving differences.</p>
<ul>
<li>user is the name of the module, do not need to use the plural form like ROA style.</li>
<li>Use an explicit verb-object structure instead of mapping CRUD to HTTP Method, which uses POST uniformly, and GET for query scenarios.</li>
<li>The return value carries code, message and data to map the response status and response information, generally you can define your own code status code, this article uses 0 to mark the success of the request, message is only meaningful when the business response fails, data represents the business response results.</li>
</ul>
<p>The decision of how to choose RPC and ROA is based on the business situation of the product itself. There are the following guiding principles.</p>
<ul>
<li>RPC style is appropriate for APIs with complex business logic that cannot be described by simple add, delete, change and check.</li>
<li>If the industry standard of the business requires restful style API or ROA to meet the business requirements, it is appropriate to use ROA style.</li>
</ul>
<p>AWS mainly uses RPC style, Azure, Google mainly uses ROA (restful) style, AliCloud OpenAPI supports both RPC and ROA, with RPC as the main.</p>
<p>Although the specification is innocent, but in the ROA style in the process of practice, I have seen a lot of &ldquo;traps&rdquo;:</p>
<ul>
<li>Require resources first, i.e., design resources first, then design interfaces, which requires high software development process.</li>
<li>Wrong ROA design case 1: tomcat and other application servers do not allow the request body to be carried by default when handling HTTP requests for DELETE methods, and need to be explicitly enabled, resulting in deletion failure. (This case is a designer&rsquo;s problem, complex deletion scenarios should not be mapped to DELELE, but should be changed to POST, DELETE should not carry the request body).</li>
<li>Wrong ROA design case 2: the parameters carried in the restful path may cause regular matching problems, such as mistakenly using email as a path parameter, or conflicting multi-level path matching problems (this case is a designer&rsquo;s problem, complex query scenarios should not be mapped to GET, but should be changed to POST, only resource locators should appear in the path, and should not carry attribute).</li>
<li>When the response code is 404, it is difficult to distinguish whether the path really does not exist, or the resource does not exist</li>
<li>Not good for docking gateways and other scenarios that require configured route forwarding.</li>
</ul>
<p>CSB&rsquo;s Open API specification hopes to meet the following requirements.</p>
<ul>
<li>A clear design concept for back-end development to design interfaces, so that they don&rsquo;t have to spend too much time on resource abstraction (which doesn&rsquo;t mean that resources don&rsquo;t need to be designed) because they don&rsquo;t have to struggle with whether to use POST or GET for an interface.</li>
<li>When front-end development interface, it is faster to collaborate with the back-end and facilitate the encapsulation of the front-end interface.</li>
<li>The overall style of the user interface to the Open API is consistent and the modules are clear
In summary, I plan to adopt the RPC design specification in the design style selection. To summarize the advantages of RPC style.</li>
<li>API design is less difficult, easy to implement</li>
<li>Most of the mature IAAS layer products in Aliyun use RPC specification.</li>
<li>Suitable for complex business scenarios</li>
</ul>
<h2 id="a-detailed-example-of-rpc-interface-documentation">A detailed example of RPC interface documentation</h2>
<h3 id="creating-a-service">Creating a service</h3>
<h4 id="request-parameters">request parameters</h4>
<table>
<thead>
<tr>
<th>Serial Number</th>
<th>Field Name in Chinese</th>
<th>Field Name in English</th>
<th>Data Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Name</td>
<td>name</td>
<td>string</td>
<td>yes</td>
<td>Displayed name</td>
</tr>
<tr>
<td>2</td>
<td>protocol</td>
<td>protocol</td>
<td>string</td>
<td>yes</td>
<td>Enumerated valuesï¼šhttp/grpc/webservice</td>
</tr>
<tr>
<td>3</td>
<td>loadbalanced</td>
<td>lb</td>
<td>string</td>
<td>yes</td>
<td>enumeration value: random/roundrobin</td>
</tr>
<tr>
<td>4</td>
<td>upstreamType</td>
<td>upstreamType</td>
<td>string</td>
<td>yes</td>
<td>enumerated values: fixed/discovery</td>
</tr>
<tr>
<td>5</td>
<td>node list</td>
<td>nodes</td>
<td>array</td>
<td>no</td>
<td>upstreamType=fixed required, example: [{host: 1.1.1.1,port: 80,weight: 1}]</td>
</tr>
<tr>
<td>6</td>
<td>origin id</td>
<td>originId</td>
<td>string</td>
<td>no</td>
<td></td>
</tr>
<tr>
<td>7</td>
<td>serviceName</td>
<td>serviceName</td>
<td>string</td>
<td>No</td>
<td>Name in the registry, required when upstreamType=discovery</td>
</tr>
<tr>
<td>8</td>
<td>service description</td>
<td>description</td>
<td>string</td>
<td>no</td>
<td></td>
</tr>
<tr>
<td>9</td>
<td>gateway id</td>
<td>gatewayId</td>
<td>string</td>
<td>yes</td>
<td></td>
</tr>
</tbody>
</table>
<h4 id="return-parameter">return parameter</h4>
<table>
<thead>
<tr>
<th>Serial Number</th>
<th>Field Name in Chinese</th>
<th>Field Name in English</th>
<th>Data Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>response code</td>
<td>code</td>
<td>int</td>
<td>0 identifies success; 1 identifies failure</td>
</tr>
<tr>
<td>2</td>
<td>Response Message</td>
<td>message</td>
<td>string</td>
<td></td>
</tr>
<tr>
<td>3</td>
<td>response result</td>
<td>data</td>
<td>string</td>
<td>return service id</td>
</tr>
</tbody>
</table>
<h4 id="example-of-a-request">Example of a request</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">POST /service/createService
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Request:
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">  &#34;name&#34;: &#34;httpbin&#34;,
</span></span><span class="line"><span class="cl">  &#34;protocol&#34;: &#34;http&#34;,
</span></span><span class="line"><span class="cl">  &#34;lb&#34;: &#34;random&#34;,
</span></span><span class="line"><span class="cl">  &#34;upstreamType&#34;: &#34;fixed&#34;,
</span></span><span class="line"><span class="cl">  &#34;nodes&#34;: [
</span></span><span class="line"><span class="cl">    {
</span></span><span class="line"><span class="cl">      &#34;host&#34;: &#34;httpbin.org&#34;,
</span></span><span class="line"><span class="cl">      &#34;port&#34;: &#34;80&#34;,
</span></span><span class="line"><span class="cl">      &#34;weight&#34;: &#34;1&#34;
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">  ],
</span></span><span class="line"><span class="cl">  &#34;gatewayId&#34;: &#34;gw-1qw2e3e4&#34;
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Response:
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">  &#34;code&#34;: 0,
</span></span><span class="line"><span class="cl">  &#34;message&#34;: &#34;&#34;,
</span></span><span class="line"><span class="cl">  &#34;serviceId&#34;: &#34;s-1qw2e3e4&#34;
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="request-sample-api-naming-convention">request sample API naming convention</h4>
<ul>
<li>APIs should be spelled correctly in English and conform to grammatical conventions, including singular and plural, tense and language conventions</li>
<li>No multiple APIs with similar meanings but no real difference in functionality, such as /user/getUser and /user/describeUser at the same time</li>
<li>Language conventions: Pinyin is prohibited</li>
<li>The naming rules are fixed for the following common scenarios
<ul>
<li>Parameters of date and time type should be named XxxxTime. e.g. CreateTime</li>
</ul>
</li>
<li>Common operation name specification
<ul>
<li><code>creat</code>: create</li>
<li><code>modif</code>: change</li>
<li><code>delete</code>: delete</li>
<li><code>get</code>: get individual resource details</li>
<li><code>list</code>: get a list of resources</li>
<li><code>establishRelation</code>: create a resource relationship</li>
<li><code>destroyRelation</code>: destroy a resource relationship</li>
</ul>
</li>
</ul>
<h2 id="summary">Summary</h2>
<p>Take for example one of the specifications promoted in this article: &ldquo;Use POST for all interfaces&rdquo;. This is not to accommodate low-level, unmotivated architects and front- and back-end programmers (as I&rsquo;ve seen in the community forums), but to improve development efficiency, reduce communication costs, reduce the cost of operations and error location, and invest the cost of blind tossing in other areas such as business architecture design, testing systems, online monitoring, disaster recovery and downgrading.</p>
<p>The interface specification is not only RPC and ROA as I summarized, there are also some comments to classify GraphQL as a separate class of API design style for complex query scenarios, interested students can refer to es API documentation.</p>
<p>To sum up, I plan to adopt the RPC API design style.</p>

    </div>

    
<footer class="post-footer">
      
      <nav class="post-nav">
        <a class="prev" href="/post/2022-06/go-data-race/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Data Race Detection and Data Race Patterns in Golang</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2022-06/podman-desktop/">
            <span class="next-text nav-default">Can Podman Desktop replace Docker Desktop?</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  <script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox-3.1.20.min.js"></script>



<script type="text/javascript" src="/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
