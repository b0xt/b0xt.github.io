<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>How to use the shell (3/3) - Configuring zsh - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="Lightweight, clean, simple. This is what I&#39;m looking for in a zsh configuration" /><meta name="keywords" content="shell" />






<meta name="generator" content="Hugo 0.101.0 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2022-06/shell-3/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link href="/lib/fancybox/jquery.fancybox-3.1.20.min.css" rel="stylesheet">


<meta property="og:title" content="How to use the shell (3/3) - Configuring zsh" />
<meta property="og:description" content="Lightweight, clean, simple. This is what I&#39;m looking for in a zsh configuration" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2022-06/shell-3/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-06-26T11:10:57+08:00" />
<meta property="article:modified_time" content="2022-06-26T11:10:57+08:00" />

<meta itemprop="name" content="How to use the shell (3/3) - Configuring zsh">
<meta itemprop="description" content="Lightweight, clean, simple. This is what I&#39;m looking for in a zsh configuration"><meta itemprop="datePublished" content="2022-06-26T11:10:57+08:00" />
<meta itemprop="dateModified" content="2022-06-26T11:10:57+08:00" />
<meta itemprop="wordCount" content="3037">
<meta itemprop="keywords" content="shell," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="How to use the shell (3/3) - Configuring zsh"/>
<meta name="twitter:description" content="Lightweight, clean, simple. This is what I&#39;m looking for in a zsh configuration"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SOBYTE</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SOBYTE</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">How to use the shell (3/3) - Configuring zsh</h1>

      <div class="post-meta">
        <span class="post-time"> 2022-06-26 11:10:57 </span>
        <div class="post-category">
            <a href="/categories/tutorials/"> tutorials </a>
            </div>
          <span class="more-meta"> 3037 words </span>
          <span class="more-meta"> 7 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#starting-the-shell">Starting the shell</a>
          <ul>
            <li><a href="#interaction">Interaction</a></li>
            <li><a href="#login">Login</a></li>
            <li><a href="#motd">motd</a></li>
          </ul>
        </li>
        <li><a href="#themes-and-configuration-framework">Themes and configuration framework</a>
          <ul>
            <li><a href="#oh-my-zsh">oh-my-zsh</a></li>
            <li><a href="#prezto">prezto</a></li>
            <li><a href="#zimfw">zimfw</a></li>
            <li><a href="#grml-zsh-config">grml-zsh-config</a></li>
            <li><a href="#powerlevel-series">powerlevel series</a></li>
            <li><a href="#pure">pure</a></li>
          </ul>
        </li>
        <li><a href="#separate-prompt">Separate prompt</a>
          <ul>
            <li><a href="#liquid-prompt">Liquid Prompt</a></li>
            <li><a href="#spaceship-prompt">spaceship-prompt</a></li>
            <li><a href="#starship">starship</a></li>
            <li><a href="#oh-my-posh">oh-my-posh</a></li>
          </ul>
        </li>
        <li><a href="#plugin-manager">Plugin Manager</a>
          <ul>
            <li><a href="#antigen">antigen</a></li>
            <li><a href="#antibody">antibody</a></li>
            <li><a href="#zplug">zplug</a></li>
            <li><a href="#zgen">zgen</a></li>
            <li><a href="#zinit">zinit</a></li>
          </ul>
        </li>
        <li><a href="#zsh-plugins">zsh plugins</a>
          <ul>
            <li><a href="#zsh-users-family">zsh-users family</a></li>
            <li><a href="#zinit-series">zinit series</a></li>
            <li><a href="#thefuck">thefuck</a></li>
            <li><a href="#autojump">autojump</a></li>
          </ul>
        </li>
        <li><a href="#custom-functions">Custom Functions</a>
          <ul>
            <li><a href="#turn-off-flow-control">Turn off flow control</a></li>
            <li><a href="#push-line">push-line</a></li>
            <li><a href="#quick-sudo">Quick sudo</a></li>
            <li><a href="#command-complementary-load-optimization">Command Complementary Load Optimization</a></li>
            <li><a href="#fzf-and-shell">fzf and shell</a></li>
            <li><a href="#recent-directories">Recent directories</a></li>
            <li><a href="#navigation-mode-navigation-mode">Navigation mode (Navigation mode)</a></li>
            <li><a href="#variables">Variables</a></li>
            <li><a href="#performance">Performance</a></li>
          </ul>
        </li>
        <li><a href="#what-configuration-do-i-use">What configuration do I use</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>Lightweight, clean, simple. This is what I&rsquo;m looking for in a zsh configuration</p>
<h2 id="starting-the-shell">Starting the shell</h2>
<p>First, let&rsquo;s review the shell login and interaction</p>
<h3 id="interaction">Interaction</h3>
<p>The shell may or may not interact. Normal startup requires interaction if you type a command and wait for it to return, but no interaction is required if you run the script directly</p>
<p><code>echo $-</code> determines if there is an interaction, each letter represents an attribute. <code>i</code> is for interactive (interactive)</p>
<p>The interactive shell will have PROMPT, so there will be a <code>PS1</code> variable, and you can use the <code>PS1</code> variable to determine if it is interactive or not.</p>
<h3 id="login">Login</h3>
<p>login shell, bash by <code>shopt</code>, zsh by <code>setopt</code>. (zsh&rsquo;s <code>echo $-</code> can also determine if you are logged in). Remember that <code>setopt</code> is the command that sets all of zsh&rsquo;s features with <code>setopt</code>, unsetopt noxxx<code>or</code>unsetopt`.</p>
<p>Open terminal and ssh are both logged-in shells by default. directly executing <code>bash</code> / <code>zsh</code> is a non-login shell, specify the <code>---login</code> argument. The <code>su</code> command is also non-login by default, specify the <code>su -</code> or <code>su -l</code> argument. <code>-</code> and <code>-l</code> are exactly the same</p>
<p>The combination of interactive and login permutations can be divided into four cases.</p>
<ul>
<li>non-interactive non-login</li>
<li>non-interactive login</li>
<li>Interactive non-login</li>
<li>Interactive login</li>
</ul>
<p>They also load different configuration files. To simplify the process, just ignore the other files and use only <code>bashrc</code> or <code>zshrc</code>. Delete all the others (<code>.bash_profile</code> , <code>.bash_login</code> , <code>.zprofile</code> , <code>.zlogin</code> all of them), which will definitely read the <code>.bashrc</code> or <code>.zshrc</code> file</p>
<h3 id="motd">motd</h3>
<p>Anyone familiar with Linux will be familiar with the full name of motd, Message Of The Day</p>
<p>Put the contents in <code>/etc/motd</code> and display the contents every time you log in</p>
<p>The motd itself is plain text, and traditionally motd is only plain text. Of course, we can do something similar to motd by displaying something when the shell starts executing commands</p>
<p>For example, use <code>cowsay</code> to display a welcome message (put this command in the shell&rsquo;s configuration file)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ <span class="nb">echo</span> <span class="s2">&#34;Hello! </span><span class="si">${</span><span class="nv">USERNAME</span><span class="si">}</span><span class="s2">&#34;</span> <span class="p">|</span> cowsay -f tux
</span></span><span class="line"><span class="cl"> ______________
</span></span><span class="line"><span class="cl">&lt; Hello! metal &gt;
</span></span><span class="line"><span class="cl"> --------------
</span></span><span class="line"><span class="cl">   <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>        .--.
</span></span><span class="line"><span class="cl">       <span class="p">|</span>o_o <span class="p">|</span>
</span></span><span class="line"><span class="cl">       <span class="p">|</span>:_/ <span class="p">|</span>
</span></span><span class="line"><span class="cl">      //   <span class="se">\ \
</span></span></span><span class="line"><span class="cl"><span class="se"></span>     <span class="o">(</span><span class="p">|</span>     <span class="p">|</span> <span class="o">)</span>
</span></span><span class="line"><span class="cl">    /<span class="err">&#39;</span><span class="se">\_</span>   _/<span class="sb">`</span><span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="se">\_</span>__<span class="o">)=(</span>___/
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="themes-and-configuration-framework">Themes and configuration framework</h2>
<p>If you don&rsquo;t use any theme, you will have to deal with the <code>$PS1</code> variables yourself, and there are four variables in <code>PS</code>. Consider the complexity of setting them up yourself. The preferred option is of course to use the big boys&rsquo; configuration</p>
<p>zsh is basically the same as it was decades ago due to its history, but nowadays zsh has a lot of very powerful features. It&rsquo;s just that the default is not to turn on</p>
<h3 id="oh-my-zsh">oh-my-zsh</h3>
<p>The most famous configuration framework for zsh. Configuring zsh can even be said for oh-my-zsh and non-oh-my-zsh</p>
<p>automatically sets the color section, just enable it to override the ugly as hell default color scheme. The default configuration is perfect</p>
<p>A lot of useful functions and themes are integrated (personally I recommend the <code>ys</code> theme), more extreme users will even use the ramdom theme and choose one randomly each time you turn it on to ensure freshness</p>
<p>oh-my-zsh has a lot of stuff to manage. oh-my-zsh&rsquo;s various plugins are basically full of aliases. it is recommended not to use any of them</p>
<h3 id="prezto">prezto</h3>
<p>An alternative to oh-my-zsh, or an alternative to it. It&rsquo;s a bit lighter than oh-my-zsh.</p>
<h3 id="zimfw">zimfw</h3>
<p>Use ruby&rsquo;s <code>erb</code> stencil engine to compile the final configuration file.</p>
<p>Configure the enabled plugins in <code>zimrc</code>, then compile to produce the <code>~/.zshrc</code> file. You&rsquo;ll have to recompile every time you make a change, but that&rsquo;s not a big deal.</p>
<p>By default, the git plugin will be enabled, so be careful to disable it (I recommend disabling it), it&rsquo;s all git aliases.</p>
<h3 id="grml-zsh-config">grml-zsh-config</h3>
<p>The default zsh configuration for Grml OS, which is a Debian-based Linux distribution. It is mainly designed for live CDs</p>
<p>I like grml&rsquo;s configuration, it&rsquo;s simple and lightweight. This is the new age default. grml does not include the ability to manage plugins. It is a pure <code>zshrc</code> file</p>
<p>grml has several themes built in.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># 列出主题</span>
</span></span><span class="line"><span class="cl">prompt -l
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 预览主题</span>
</span></span><span class="line"><span class="cl">prompt -p adam2
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 设置主题</span>
</span></span><span class="line"><span class="cl">prompt -s adam2
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 关闭主题，使用其他的主题</span>
</span></span><span class="line"><span class="cl">prompt off
</span></span></code></pre></td></tr></table>
</div>
</div><p>The grml zsh configuration is very flexible, and the default grml theme supports vsc (git show current branch) which allows you to customize the various items displayed. For example, to make prompt display two lines like this.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># Set Theme</span>
</span></span><span class="line"><span class="cl"><span class="c1"># http://bewatermyfriend.org/p/2013/001/</span>
</span></span><span class="line"><span class="cl">zstyle <span class="s1">&#39;:prompt:grml:left:setup&#39;</span> items rc change-root user at host path vcs newline percent
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">prompt grml
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="powerlevel-series">powerlevel series</h3>
<p>Themes for the zsh version of the powerline series</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/06/26/2772249ffc57449e89ed1efa1cf86673.png" alt="powerline series"></p>
<p>powerlevel9k is an extremely complex theme that will definitely catch your eye, or should be called the most powerful zsh theme on the planet. The most distinctive thing about this theme is probably the integration with various programming environments, even recognizing some web frameworks, VM environments of programming languages</p>
<p>Later on, someone developed powerlevel10k, which is just like powerlevel9k, but with good performance.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/06/26/fa4714d3ff7643d5b0750809e512cc73.png" alt="powerlevel10k"></p>
<h3 id="pure">pure</h3>
<p>This is a very nice theme. It calls itself prompt, but it should be classified as a theme. Because for the shell, the topic is prompt</p>
<h2 id="separate-prompt">Separate prompt</h2>
<p>It&rsquo;s too complicated to implement a complex prompt in the shell, so let&rsquo;s just put a layer on the outside. Then came a new idea. Put an interactive shell on top of the old shell. I&rsquo;ve taken it upon myself to call it &ldquo;detached prompt&rdquo;. The detached prompt is powerful, though. But do we really need such a powerful prompt?</p>
<h3 id="liquid-prompt">Liquid Prompt</h3>
<p>Liquid Prompt was probably the first to do this, making prompt a separate component. Configuration management is independent of other functions, and supports bash and zsh</p>
<h3 id="spaceship-prompt">spaceship-prompt</h3>
<p>This is a prompt optimized for zsh, but still a pure shell implementation, so you could say that spaceship directly raises the complexity of prompt by one level. Towards a separate prompt for front and back ends</p>
<h3 id="starship">starship</h3>
<p>Just a prompt, using a rust implementation that is exceptionally fast and efficient. This acts as an interactive front-end, with a shell as the back-end. It supports most shells, and has moved towards a completely separate prompt.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/06/26/5005e66e24984e25ad146c0eb57d9e7d.gif" alt="starship"></p>
<h3 id="oh-my-posh">oh-my-posh</h3>
<p>It was originally written specifically for powershell, but was later rewritten in golang to make it a separate prompt for the front and back ends, and you can specify a different back end</p>
<h2 id="plugin-manager">Plugin Manager</h2>
<p>I personally don&rsquo;t use this plugin manager, it just makes it easier to toss back and forth, but it&rsquo;s not right to toss shell configuration every day</p>
<h3 id="antigen">antigen</h3>
<p>This is the official zsh plugin management tool, and it&rsquo;s absolutely clean. It&rsquo;s a pure package manager. Oh no, it has special adaptations for oh-my-zsh and prezto</p>
<h3 id="antibody">antibody</h3>
<p>A package manager written in golang. As you can see from the name, it&rsquo;s a counterpart to antigen</p>
<h3 id="zplug">zplug</h3>
<p>A vim-plug-like plugin manager</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/06/26/212017203bf24839a9455190933083c8.gif" alt="zplug"></p>
<h3 id="zgen">zgen</h3>
<p>A lightweight plugin manager with only 500 lines of code</p>
<h3 id="zinit">zinit</h3>
<p>is a plugin manager implemented in C, with very high performance and probably the fastest. zplugin and zinit are one project, zplugin is the previous name.</p>
<p>Like zimfw, you can compile plugins to run faster. Unlike zimfw, no configuration is provided, this is just the plugin manager and compiler.</p>
<h2 id="zsh-plugins">zsh plugins</h2>
<p>fish has a lot of useful features, code highlighting, auto-suggestions. fish has a lot of interactive features that are already implemented in zsh</p>
<h3 id="zsh-users-family">zsh-users family</h3>
<p>zsh-users is an official zsh repository with several great plugins that are integrated into basically all zsh configuration frameworks:</p>
<ul>
<li>zsh-syntax-highlighting (code highlighting)</li>
<li>zsh-autosuggestions (auto-suggestions)</li>
<li>zsh-history-substring-search (prefix search)</li>
</ul>
<p>And for example: <a href="https://github.com/zsh-users/zsh-apple-touchbar">zsh-users/zsh-apple-touchbar</a> My MBP doesn&rsquo;t have a touchbar so I won&rsquo;t comment on it</p>
<h3 id="zinit-series">zinit series</h3>
<ul>
<li>fast-syntax-highlighting (high performance code highlighting)</li>
<li>history-search-multi-word (enhanced version of <code>Crtl-R</code>)</li>
</ul>
<p>Plugins written by the author of zinit, can be used here to replace the zsh-users series</p>
<h3 id="thefuck">thefuck</h3>
<p>to correct spelling errors. There seems to be a lot of people who use a plugin, I don&rsquo;t use this and don&rsquo;t recommend it.</p>
<p>I&rsquo;d like to know what the mentality of people who use this plugin is fuck, fuck, fuuuu&hellip;</p>
<h3 id="autojump">autojump</h3>
<p>According to the use of habits to automatically jump to the directory, he will maintain a database to record which directories are usually used</p>
<h2 id="custom-functions">Custom Functions</h2>
<p>MacOS needs to set the default shortcuts, <code>Crtl + left/right arrow</code> is occupied by Mission Control function</p>
<p>Change the <code>Crtl + left/right arrow</code> shortcut in <code>System Preferences &gt; Keyboard &gt; Shortcuts</code>, otherwise the ability to jump a word will be lost. I changed it to <code>Crtl + Command + left/right arrow</code>. I remember that this is the default key for switching virtual desktops in Deepin Linux</p>
<h3 id="turn-off-flow-control">Turn off flow control</h3>
<p>The shell and terminal (iTerm2 ignores this feature) need to support both to see the effect, most terminals are supported. shell is enabled by default</p>
<p>This is an old feature, historically (and still is in some terminals), <code>Ctrl-S</code> pauses output while <code>Ctrl-Q</code> continues. From today&rsquo;s point of view, this feature is basically useless. It also takes up two shortcut keys</p>
<p>The default setting in many frameworks is not to disable <code>flowcontrol</code>. Only oh-my-zsh is set to be disabled in the configuration framework</p>
<p>Let&rsquo;s turn it off: <code>setopt noflowcontrol</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># 关掉 flowcontrol</span>
</span></span><span class="line"><span class="cl">unsetopt flowcontrol
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 上面的设置在 Tmux 里面无效</span>
</span></span><span class="line"><span class="cl">stty -ixon
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="push-line">push-line</h3>
<p>I don&rsquo;t know how to describe this function, but oh-my-zsh has a <code>Ctrl-Q</code> shortcut that saves the current input, then executes a new command, and releases the saved content afterwards. This feature is very useful.</p>
<p>Many setups and frameworks will set <code>Ctrl-Q</code> to <code>push-line</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">bindkey <span class="s2">&#34;\eq&#34;</span> push-line
</span></span></code></pre></td></tr></table>
</div>
</div><p>But <code>push-line</code> can&rsquo;t handle the here doc case.</p>
<p>You can set it to <code>push-line-or-edit</code> and it will handle here docs.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">bindkey <span class="s2">&#34;\eq&#34;</span> push-line-or-edit
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>push-line</code> and <code>push-line-or-edit</code> are useful, and are built-in features of zsh. They are not enabled by default, and there are many other features in zsh that are not enabled by default. Before writing a new feature, it&rsquo;s best to check <code>man zshzle</code> to see if it&rsquo;s available.</p>
<h3 id="quick-sudo">Quick sudo</h3>
<p>Perhaps you will often <code>sudo !!</code> to use <code>sudo</code> to execute the previous command.</p>
<p><code>sudo</code> is used a lot, so let&rsquo;s customize a shortcut.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">sudo-command-line<span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="o">[[</span> -z <span class="nv">$BUFFER</span> <span class="o">]]</span> <span class="o">&amp;&amp;</span> zle up-history
</span></span><span class="line"><span class="cl">  <span class="nb">local</span> <span class="nv">cmd</span><span class="o">=</span><span class="s2">&#34;sudo &#34;</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="o">[[</span> <span class="si">${</span><span class="nv">BUFFER</span><span class="si">}</span> <span class="o">==</span> <span class="si">${</span><span class="nv">cmd</span><span class="si">}</span>* <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">    <span class="nv">CURSOR</span><span class="o">=</span><span class="k">$((</span> CURSOR-<span class="si">${#</span><span class="nv">cmd</span><span class="si">}</span> <span class="k">))</span>
</span></span><span class="line"><span class="cl">    <span class="nv">BUFFER</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">BUFFER</span><span class="p">#</span><span class="nv">$cmd</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="k">else</span>
</span></span><span class="line"><span class="cl">    <span class="nv">BUFFER</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">cmd</span><span class="si">}${</span><span class="nv">BUFFER</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">CURSOR</span><span class="o">=</span><span class="k">$((</span> CURSOR+<span class="si">${#</span><span class="nv">cmd</span><span class="si">}</span> <span class="k">))</span>
</span></span><span class="line"><span class="cl">  <span class="k">fi</span>
</span></span><span class="line"><span class="cl">  zle reset-prompt
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">zle     -N   sudo-command-line
</span></span><span class="line"><span class="cl"><span class="c1"># Ctrl-S</span>
</span></span><span class="line"><span class="cl">bindkey <span class="s1">&#39;^S&#39;</span> sudo-command-line
</span></span></code></pre></td></tr></table>
</div>
</div><p>This way you can quickly add <code>sudo</code> directly with <code>Ctrl-S</code>, and automatically remove <code>sudo</code> if it is preceded by <code>sudo</code>.</p>
<p><del>grml comes with a similar configuration, but it only supports adding <code>sudo</code>, so there is a difference between the way I changed it and grml.</del></p>
<p>Now the grml zsh configuration is the same as mine <a href="https://github.com/grml/grml-etc-core/pull/119">grml/zshrc#119</a></p>
<h3 id="command-complementary-load-optimization">Command Complementary Load Optimization</h3>
<p>The <code>kubectl</code> command is typical, this patch file is very large, with tens of thousands of lines</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">kubectl completion zsh <span class="p">|</span> wc -l
</span></span><span class="line"><span class="cl"><span class="m">13090</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The official documentation puts this in <code>.zshrc</code>, which is a very poor way of writing performance</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="nb">source</span> &lt;<span class="o">(</span>kubectl completion zsh<span class="o">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Generating a file and putting it in <code>$FPATH</code> would be a better option.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">kubectl completion zsh &gt; ~/.zsh-completions/_kubectl.zsh
</span></span></code></pre></td></tr></table>
</div>
</div><p>Put this in the zsh configuration file.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="k">if</span> <span class="o">[[</span> -d <span class="s2">&#34;</span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span><span class="s2">/.zsh-completions&#34;</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">  <span class="nv">FPATH</span><span class="o">=</span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/.zsh-completions:<span class="nv">$FPATH</span>
</span></span><span class="line"><span class="cl"><span class="k">fi</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Or use the Lazyload method, where you define a placeholder function first and then load it on input. But <code>$FPATH</code> is already a lazyload. I&rsquo;ve always thought it was a mistake to use Lazyload for completion (I&rsquo;ve seen people use it this way, feel free to argue me down).</p>
<h3 id="fzf-and-shell">fzf and shell</h3>
<p>fzf provides a shortcut to the shell, you need to enable this feature yourself.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/06/26/bb9b0c2fab3b40faaf96f61ec2f8ec0a.png" alt="fzf and shell"></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># brew --prefix fzf</span>
</span></span><span class="line"><span class="cl"><span class="c1"># source $(brew --prefix fzf)/shell/completion.zsh</span>
</span></span><span class="line"><span class="cl"><span class="c1"># source $(brew --prefix fzf)/shell/key-bindings.zsh</span>
</span></span><span class="line"><span class="cl"><span class="nb">source</span> /usr/local/opt/fzf/shell/completion.zsh
</span></span><span class="line"><span class="cl"><span class="nb">source</span> /usr/local/opt/fzf/shell/key-bindings.zsh
</span></span></code></pre></td></tr></table>
</div>
</div><p>Three binding shortcuts are provided</p>
<ul>
<li><code>Ctrl-R</code> Enhanced history search</li>
<li><code>Crtl-T</code> fuzzy path selection</li>
<li><code>Alt-C</code> fuzzy path jumping</li>
</ul>
<p>Complement function provides <code>**</code> and then press <code>&lt;TAB&gt;</code> syntax, use fzf to select complement</p>
<p><code>Crtl-T</code> is actually a zsh default shortcut, the fuzzy path selection function provided by fzf is too infrequently used, so here it is set back to the default shortcut.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">bindkey <span class="s1">&#39;^T&#39;</span> transpose-chars
</span></span></code></pre></td></tr></table>
</div>
</div><p>For Apple computers, the <code>Alt-C</code> shortcut has to be handled</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># Default ALT-C, For Mac OS: Option-C</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="o">[[</span> <span class="sb">`</span>uname<span class="sb">`</span> <span class="o">==</span> <span class="s2">&#34;Darwin&#34;</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">  bindkey <span class="s1">&#39;ç&#39;</span> fzf-cd-widget
</span></span><span class="line"><span class="cl"><span class="k">fi</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="recent-directories">Recent directories</h3>
<p>Remember Elvish&rsquo;s <code>Crtl-L</code> list selection to jump to the most recent directory?</p>
<p>Use fzf to implement one, and since the <code>Crtl-L</code> shortcut is already occupied, use <code>ALT-X</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">fzf-dirs-widget<span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># eval cd $(dirs -v | fzf --height 40% --reverse | cut -b3-)</span>
</span></span><span class="line"><span class="cl">  <span class="nb">local</span> <span class="nv">dir</span><span class="o">=</span><span class="k">$(</span><span class="nb">dirs</span> -v <span class="p">|</span> fzf --height <span class="si">${</span><span class="nv">FZF_TMUX_HEIGHT</span><span class="k">:-</span><span class="nv">40</span><span class="p">%</span><span class="si">}</span> --reverse <span class="p">|</span> cut -b3-<span class="k">)</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="o">[[</span> -z <span class="s2">&#34;</span><span class="nv">$dir</span><span class="s2">&#34;</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">    zle redisplay
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="m">0</span>
</span></span><span class="line"><span class="cl">  <span class="k">fi</span>
</span></span><span class="line"><span class="cl">  <span class="nb">eval</span> <span class="nb">cd</span> <span class="si">${</span><span class="nv">dir</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">  <span class="nb">local</span> <span class="nv">ret</span><span class="o">=</span><span class="nv">$?</span>
</span></span><span class="line"><span class="cl">  <span class="nb">unset</span> dir <span class="c1"># ensure this doesn&#39;t end up appearing in prompt expansion</span>
</span></span><span class="line"><span class="cl">  zle reset-prompt
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nv">$ret</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">zle     -N    fzf-dirs-widget
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Default ALT-X, For Mac OS: Option-X</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="o">[[</span> <span class="sb">`</span>uname<span class="sb">`</span> <span class="o">==</span> <span class="s2">&#34;Darwin&#34;</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">  bindkey <span class="s1">&#39;≈&#39;</span> fzf-dirs-widget
</span></span><span class="line"><span class="cl"><span class="k">else</span>
</span></span><span class="line"><span class="cl">  bindkey <span class="s1">&#39;\ex&#39;</span> fzf-dirs-widget
</span></span><span class="line"><span class="cl"><span class="k">fi</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="navigation-mode-navigation-mode">Navigation mode (Navigation mode)</h3>
<p>Elvish <code>Crtl-N</code> shortcut to start the navigation mode. Similar to ranger or nnn&rsquo;s tui to select a directory inside</p>
<p>This feature can be adapted with ranger or nnn. Both projects provide examples, but I prefer ranger, nnn is faster. There is also a very lean implementation of a pure shell <a href="https://github.com/vifon/deer">vifon/deer</a></p>
<ul>
<li>
<p>ranger</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/06/26/23a8f454dda54f3a809b14dbc9fcc67c.png" alt="ranger"></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># Fork from: https://github.com/ranger/ranger/blob/master/examples/shell_automatic_cd.sh</span>
</span></span><span class="line"><span class="cl">ranger_cd<span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl"><span class="nb">local</span> <span class="nv">temp_file</span><span class="o">=</span><span class="s2">&#34;</span><span class="k">$(</span>mktemp -t <span class="s2">&#34;ranger_cd.</span><span class="si">${</span><span class="nv">USERNAME</span><span class="si">}</span><span class="s2">&#34;</span><span class="k">)</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">ranger --choosedir<span class="o">=</span><span class="s2">&#34;</span><span class="nv">$temp_file</span><span class="s2">&#34;</span> -- <span class="s2">&#34;</span><span class="si">${</span><span class="p">@</span><span class="k">:-</span><span class="nv">$PWD</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="nv">chosen_dir</span><span class="o">=</span><span class="s2">&#34;</span><span class="k">$(</span>cat -- <span class="s2">&#34;</span><span class="nv">$temp_file</span><span class="s2">&#34;</span><span class="k">)</span><span class="s2">&#34;</span> <span class="o">&amp;&amp;</span> <span class="o">[</span> -n <span class="s2">&#34;</span><span class="nv">$chosen_dir</span><span class="s2">&#34;</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$chosen_dir</span><span class="s2">&#34;</span> !<span class="o">=</span> <span class="s2">&#34;</span><span class="nv">$PWD</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">    <span class="nb">cd</span> -- <span class="s2">&#34;</span><span class="nv">$chosen_dir</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl"><span class="k">fi</span>
</span></span><span class="line"><span class="cl">rm -f -- <span class="s2">&#34;</span><span class="nv">$temp_file</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># This binds Ctrl-N to ranger_cd:</span>
</span></span><span class="line"><span class="cl">bindkey -s <span class="s1">&#39;^N&#39;</span> <span class="s1">&#39;ranger_cd\n&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>nnn</p>
<p>Some packages include this script as well, such as Archlinux, so you can just <code>source</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="nb">source</span> /usr/share/nnn/quitcd/quitcd.bash_zsh
</span></span><span class="line"><span class="cl">bindkey -s <span class="err">&#39;</span>^
</span></span></code></pre></td></tr></table>
</div>
</div><p>MacOS homebrew does not provide a <code>quitcd</code> script, so you need to set it up yourself.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># Frok from: https://github.com/jarun/nnn/blob/master/misc/quitcd/quitcd.bash_zsh</span>
</span></span><span class="line"><span class="cl">nnn_cd <span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Block nesting of nnn in subshells</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="o">[</span> -n <span class="nv">$NNNLVL</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">NNNLVL</span><span class="k">:-</span><span class="nv">0</span><span class="si">}</span><span class="s2">&#34;</span> -ge <span class="m">1</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;nnn is already running&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span>
</span></span><span class="line"><span class="cl"><span class="k">fi</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># The default behaviour is to cd on quit (nnn checks if NNN_TMPFILE is set)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># To cd on quit only on ^G, remove the &#34;export&#34; as in:</span>
</span></span><span class="line"><span class="cl"><span class="c1">#     NNN_TMPFILE=&#34;${XDG_CONFIG_HOME:-$HOME/.config}/nnn/.lastd&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># NOTE: NNN_TMPFILE is fixed, should not be modified</span>
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">NNN_TMPFILE</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">XDG_CONFIG_HOME</span><span class="k">:-</span><span class="nv">$HOME</span><span class="p">/.config</span><span class="si">}</span><span class="s2">/nnn/.lastd&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Unmask ^Q (, ^V etc.) (if required, see `stty -a`) to Quit nnn</span>
</span></span><span class="line"><span class="cl"><span class="c1"># stty start undef</span>
</span></span><span class="line"><span class="cl"><span class="c1"># stty stop undef</span>
</span></span><span class="line"><span class="cl"><span class="c1"># stty lwrap undef</span>
</span></span><span class="line"><span class="cl"><span class="c1"># stty lnext undef</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">nnn <span class="s2">&#34;</span><span class="nv">$@</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="o">[</span> -f <span class="s2">&#34;</span><span class="nv">$NNN_TMPFILE</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">    . <span class="s2">&#34;</span><span class="nv">$NNN_TMPFILE</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">    rm -f <span class="s2">&#34;</span><span class="nv">$NNN_TMPFILE</span><span class="s2">&#34;</span> &gt; /dev/null
</span></span><span class="line"><span class="cl"><span class="k">fi</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">bindkey -s <span class="s1">&#39;^N&#39;</span> <span class="s1">&#39;nnn_cd\n&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>lf</p>
<p>If you think <code>ranger</code> is slow written in python and you don&rsquo;t like <code>nnn</code>. Then you can try <code>lf</code> written by golang.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">Frok from: https://github.com/gokcehan/lf/blob/master/etc/lfcd.sh
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">lfcd <span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl"><span class="nv">tmp</span><span class="o">=</span><span class="s2">&#34;</span><span class="k">$(</span>mktemp<span class="k">)</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">lf -last-dir-path<span class="o">=</span><span class="s2">&#34;</span><span class="nv">$tmp</span><span class="s2">&#34;</span> <span class="s2">&#34;</span><span class="nv">$@</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="o">[</span> -f <span class="s2">&#34;</span><span class="nv">$tmp</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">    <span class="nv">dir</span><span class="o">=</span><span class="s2">&#34;</span><span class="k">$(</span>cat <span class="s2">&#34;</span><span class="nv">$tmp</span><span class="s2">&#34;</span><span class="k">)</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">    rm -f <span class="s2">&#34;</span><span class="nv">$tmp</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">[</span> -d <span class="s2">&#34;</span><span class="nv">$dir</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$dir</span><span class="s2">&#34;</span> !<span class="o">=</span> <span class="s2">&#34;</span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">        <span class="nb">cd</span> <span class="s2">&#34;</span><span class="nv">$dir</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">fi</span>
</span></span><span class="line"><span class="cl">    <span class="k">fi</span>
</span></span><span class="line"><span class="cl"><span class="k">fi</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">bindkey -s <span class="s1">&#39;^N&#39;</span> <span class="s1">&#39;lfcd\n&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>hunter</p>
<p>This is a command line file manager written in Rust. There is no way to link with the shell yet, maybe in the future this feature will be available.</p>
</li>
</ul>
<h3 id="variables">Variables</h3>
<p>We&rsquo;ve certainly all seen this written before</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="k">if</span> <span class="o">[</span> -d <span class="s2">&#34;</span><span class="nv">$HOME</span><span class="s2">/go/bin&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">  <span class="nv">PATH</span><span class="o">=</span><span class="s2">&#34;</span><span class="nv">$HOME</span><span class="s2">/go/bin:</span><span class="nv">$PATH</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl"><span class="k">fi</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>There are more paths, let&rsquo;s unify them</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># Load path</span>
</span></span><span class="line"><span class="cl"><span class="nv">_enabled_paths</span><span class="o">=(</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;go/bin&#39;</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;.bin&#39;</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;.local/bin&#39;</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;.cargo/bin&#39;</span>
</span></span><span class="line"><span class="cl"><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> _enabled_path in <span class="nv">$_enabled_paths</span><span class="o">[</span>@<span class="o">]</span><span class="p">;</span> <span class="k">do</span>
</span></span><span class="line"><span class="cl">  <span class="o">[[</span> -d <span class="s2">&#34;</span><span class="nv">$HOME</span><span class="s2">/</span><span class="si">${</span><span class="nv">_enabled_path</span><span class="si">}</span><span class="s2">&#34;</span> <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="nv">PATH</span><span class="o">=</span><span class="s2">&#34;</span><span class="nv">$HOME</span><span class="s2">/</span><span class="si">${</span><span class="nv">_enabled_path</span><span class="si">}</span><span class="s2">:</span><span class="nv">$PATH</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl"><span class="k">done</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">LANG</span><span class="o">=</span>en_US.UTF-8
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">LC_CTYPE</span><span class="o">=</span>en_US.UTF-8
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">EDITOR</span><span class="o">=</span><span class="s1">&#39;vi&#39;</span>
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">VISUAL</span><span class="o">=</span><span class="s1">&#39;nvim&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>VISUAL</code> and <code>EDITOR</code>, will give priority to <code>VISUAL</code> and will use <code>EDITOR</code> only when it is not available.</p>
<h3 id="performance">Performance</h3>
<p>This is several orders of magnitude faster than oh-my-zsh, which is slower than hell.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="k">for</span> i in <span class="k">$(</span>seq <span class="m">1</span> 5<span class="k">)</span><span class="p">;</span> <span class="k">do</span> <span class="nb">time</span> /bin/zsh -i -c exit<span class="p">;</span> <span class="k">done</span>
</span></span><span class="line"><span class="cl">/bin/zsh -i -c <span class="nb">exit</span>  0.11s user 0.07s system 86% cpu 0.211 total
</span></span><span class="line"><span class="cl">/bin/zsh -i -c <span class="nb">exit</span>  0.12s user 0.05s system 93% cpu 0.188 total
</span></span><span class="line"><span class="cl">/bin/zsh -i -c <span class="nb">exit</span>  0.11s user 0.06s system 91% cpu 0.187 total
</span></span><span class="line"><span class="cl">/bin/zsh -i -c <span class="nb">exit</span>  0.12s user 0.06s system 89% cpu 0.199 total
</span></span><span class="line"><span class="cl">/bin/zsh -i -c <span class="nb">exit</span>  0.12s user 0.06s system 84% cpu 0.219 total
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="what-configuration-do-i-use">What configuration do I use</h2>
<p>The pictures in this article don&rsquo;t say much, I&rsquo;ve selected some visually appealing plugins for the pictures, in fact, my personal configuration is very lean. The most practical configurations don&rsquo;t look anything high-end in the pictures. <strong>The practical configuration that really works looks pretty much the same as the default</strong></p>
<p>Good prompt.</p>
<ul>
<li>current path</li>
<li>git branch (should be optional, as a software developer, this is necessary)</li>
<li>The result of the last command execution <code>$?</code></li>
<li>If it&rsquo;s a server, it&rsquo;s better to show the hostname and user</li>
<li>personal preference, preference for two lines</li>
<li>Try not to have special fonts and special characters (ascii characters)</li>
</ul>
<p>I use the default configuration of zimfw on my main machine MPB, plus a little bit of self-defined functions, and the default configuration of grml on all other machines.</p>
<p>If you are interested in my configuration you can come here: <a href="https://github.com/a-wing/dotfiles/tree/master/zsh">a-wing/dotfiles#zsh</a></p>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/shell/">shell</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2022-06/iptables/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">iptables 15-Minute Tutorial &amp; Common Commands Summary</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2022-06/shell-2/">
            <span class="next-text nav-default">How to use the shell (2/3) - The new era of the shell</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  <script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox-3.1.20.min.js"></script>



<script type="text/javascript" src="/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
