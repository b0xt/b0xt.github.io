<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Go 1.19 New Features Preview - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="This article describes some of the important changes in Go 1.19." /><meta name="keywords" content="Golang, 1.19" />






<meta name="generator" content="Hugo 0.101.0 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2022-06/go-1-19/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link href="/lib/fancybox/jquery.fancybox-3.1.20.min.css" rel="stylesheet">


<meta property="og:title" content="Go 1.19 New Features Preview" />
<meta property="og:description" content="This article describes some of the important changes in Go 1.19." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2022-06/go-1-19/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-06-13T14:04:17+08:00" />
<meta property="article:modified_time" content="2022-06-13T14:04:17+08:00" />

<meta itemprop="name" content="Go 1.19 New Features Preview">
<meta itemprop="description" content="This article describes some of the important changes in Go 1.19."><meta itemprop="datePublished" content="2022-06-13T14:04:17+08:00" />
<meta itemprop="dateModified" content="2022-06-13T14:04:17+08:00" />
<meta itemprop="wordCount" content="1432">
<meta itemprop="keywords" content="golang," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Go 1.19 New Features Preview"/>
<meta name="twitter:description" content="This article describes some of the important changes in Go 1.19."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SOBYTE</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SOBYTE</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Go 1.19 New Features Preview</h1>

      <div class="post-meta">
        <span class="post-time"> 2022-06-13 14:04:17 </span>
        <div class="post-category">
            <a href="/categories/news/"> news </a>
            </div>
          <span class="more-meta"> 1432 words </span>
          <span class="more-meta"> 7 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#fixes-for-generic-issues">Fixes for generic issues</a></li>
        <li><a href="#revising-the-go-memory-model">Revising the Go memory model</a></li>
        <li><a href="#revising-the-go-doc-comment-format">Revising the go doc comment format</a></li>
        <li><a href="#runtimesetmemorylimit">runtime.SetMemoryLimit</a></li>
        <li><a href="#go-119-will-raise-the-open-file-limit-by-default-at-startup">Go 1.19 will raise the open file limit by default at startup</a></li>
        <li><a href="#go-119-race-detector-will-be-upgraded-to-version-v3-of-the-thread-sanitizer">Go 1.19 race detector will be upgraded to version v3 of the thread sanitizer</a></li>
        <li><a href="#go-119-adds-unix-build-tag">Go 1.19 adds &ldquo;unix&rdquo; build tag</a></li>
        <li><a href="#some-changes-to-the-standard-library">Some changes to the standard library</a>
          <ul>
            <li><a href="#net-package-will-use-edns">net package will use EDNS</a></li>
            <li><a href="#flag-package-adds-textvar-function">flag package adds TextVar function</a></li>
          </ul>
        </li>
        <li><a href="#other">Other</a></li>
        <li><a href="#summary">Summary</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>On May 7, 2022, the Go 1.19 development branch entered the new feature freeze phase, which means that only bugs can be fixed and no new features can be added to Go 1.19. As the previous version of Go 1.18 was delayed by one month due to the introduction of generic changes, this directly led to a shortened development cycle for Go 1.19.</p>
<p>Although the development cycle is nearly a month shorter, Go 1.19 is still on track for an August 2022 release. And <a href="https://github.com/golang/go/releases/tag/go1.19beta1">the first beta of Go 1.19</a> was released early yesterday morning. What are the important changes in Go 1.19, I&rsquo;ll take you through this article for a first look.</p>
<blockquote>
<p>Version feature changes are subject to final release! This article is only a preview and will not go into too much detail. We will talk about the details after the official release of Go 1.19.</p>
</blockquote>
<h2 id="fixes-for-generic-issues">Fixes for generic issues</h2>
<p>Although the Go core team put a lot of effort into Go 1.18 generics, there are still known innate limitations in this piece of Go 1.18 release of generics, as well as some problems found gradually afterwards, and Go 1.19 version will <a href="https://github.com/golang/go/issues?q=is%3Aopen+is%3Aissue+label%3Agenerics+milestone%3AGo1.19">continue to polish Go generics</a>, and focus on fixing the generic issues found in Go 1.18. Currently <a href="https://github.com/golang/go/issues?q=is%3Aissue+label%3Agenerics+milestone%3AGo1.19+is%3Aopen">there are about 5-6 generic issues to be fixed in Go 1.19 development release</a>. The possibility of liberalizing some of the generalization constraints talked about earlier is not expected to be fulfilled in Go 1.19.</p>
<p>What is certain, however, is that Go 1.19 will include <a href="https://github.com/golang/go/issues/52038">a fix for generics in the Go syntax specification</a>.</p>
<p>Old description:</p>
<blockquote>
<p>The scope of an identifier denoting a type parameter of a function or declared by a method receiver is the function body and all parameter lists of the function.</p>
</blockquote>
<p>New description:</p>
<blockquote>
<p>The scope of an identifier denoting a type parameter of a function or declared by a method receiver starts after the function name and ends at the end of the function body.</p>
</blockquote>
<p>Such a change allows the source code that would have compiled with an error under the current version of the Go compiler (Go 1.18.x) to compile properly in Go 1.19.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">T</span><span class="p">[</span><span class="nx">T</span> <span class="nx">any</span><span class="p">]</span> <span class="kd">struct</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">T</span><span class="p">[</span><span class="nx">T</span><span class="p">])</span> <span class="nf">m</span><span class="p">()</span> <span class="p">{}</span> <span class="c1">// error: T is not a generic type
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="revising-the-go-memory-model">Revising the Go memory model</h2>
<p><a href="https://github.com/golang/go/issues/50859">Revising the Go memory model</a>.</p>
<p>The <a href="https://go.dev/ref/mem">Go memory model</a> is one of the most abstract pieces of Go documentation, bar none! As Go has evolved, the original Go memory model description was less formal in many places and lacked descriptions of some synchronization mechanisms, such as atomic.</p>
<p>This revision, which refers to Hans-J. Boehm and Sarita V. Adve in <a href="https://www.hpl.hp.com/techreports/2008/HPL-2008-56.pdf">&ldquo;Foundations of the C++ Concurrency Memory Model, (PLDI 2008)&rdquo;</a> describe the C++ memory model in a way that gives a more formal overall description of the Go memory model, adding a more formal description of multiword competing states, runtime.SetFinalizer, more sync types, atomic operations, and compiler optimizations.</p>
<h2 id="revising-the-go-doc-comment-format">Revising the go doc comment format</h2>
<p>Go has the built-in ability to extract comments directly into package documentation. This is different from other languages that generate documentation via third-party tools. go doc comment provides a great convenience for Gopher. However, go doc comment was designed in 2009 and is somewhat outdated. There is insufficient support for many presentation forms or lack of more precise formatting descriptions. Russ Cox led a revision of go doc comment this time, <a href="https://github.com/golang/go/issues/51082">adding support for hyperlinks, lists, headings, standard library API references, and other formatting</a>, and the revised go doc comment is not markdown syntax, but borrows from markdown syntax, and is compatible with the old comment format. Here are some rendered images of the new doc comment provided by Russ Cox.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/06/13/e772d9882f994cdea663a6004fa8d47a.png" alt="go doc comment format"></p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/06/13/d7dce0c235464fe4aefb2e9a55dc837c.png" alt="go doc comment format"></p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/06/13/c84f3504868442a5a88238ef6ee61e22.png" alt="go doc comment format"></p>
<p>Also, the Go team provides the <code>go/doc/comment</code> package, which gopher uses to easily parse go doc comments.</p>
<h2 id="runtimesetmemorylimit">runtime.SetMemoryLimit</h2>
<p>In Go 1.19, a new runtime.SetMemoryLimit function was introduced along with a GOMEMLIMIT environment variable. With this memory soft limit, the Go runtime will attempt to maintain this memory limit by limiting the size of the heap and by returning memory more aggressively to the underlying os to try to prevent Go programs from being killed for allocating too much heap and exceeding the system memory resource limit.</p>
<p>The default memory limit is <code>math.MaxInt64</code>. Once the limit is set by SetMemoryLimit, the go runtime will respect this memory limit and keep the total size of memory controlled by the go runtime under the limit by adjusting the GC recovery frequency and returning the memory to os in a timely manner.</p>
<p>Note: The limit is on the total amount of memory controlled by the go runtime, but not on the memory requested by the developer from os (e.g., via mmap). The details of the limit can be found in the <a href="https://github.com/golang/proposal/blob/master/design/48409-soft-memory-limit.md">proposal design document</a>.</p>
<p>Also note: the limit does not eliminate 100% of the out-of-memory cases.</p>
<h2 id="go-119-will-raise-the-open-file-limit-by-default-at-startup">Go 1.19 will raise the open file limit by default at startup</h2>
<p>Upon investigation, some systems set an artificial soft limit on the number of open files, mainly for compatibility with code that uses select and its hard-coded maximum file descriptor (limited by the size of fd_set). Usually the limit is 1024, some are smaller, e.g. 256, so that even simple programs like gofmt can easily encounter an open file descriptor overload error when they traverse a file tree in parallel.</p>
<p>Go does not use select, so it should not be affected by these limits. So for go programs that import os packages, <a href="https://github.com/golang/go/issues/46279">Go will raise these limits by default in 1.19</a> to hard limit.</p>
<h2 id="go-119-race-detector-will-be-upgraded-to-version-v3-of-the-thread-sanitizer">Go 1.19 race detector will be upgraded to version v3 of the thread sanitizer</h2>
<p>The upgraded <a href="https://github.com/golang/go/issues/49761">new race detector</a> will have 1.5x-2x better race detection performance compared to the previous version, half the memory overhead, and no upper limit on the number of goroutines.</p>
<blockquote>
<p>The thread sanitizer detects how data contention works: it records information about each memory access and detects whether there is contention between threads for that piece of memory. Based on this principle, we also know that once race detection is enabled, the execution efficiency of Go programs will be greatly affected and the running overhead will increase significantly. v3 thread sanitizer has been optimized, but the overall impact on the program is still there and still significant.</p>
</blockquote>
<h2 id="go-119-adds-unix-build-tag">Go 1.19 adds &ldquo;unix&rdquo; build tag</h2>
<p>Go 1.19 will add the &ldquo;unix&rdquo; build tag.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">//go:build unix
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Equivalent to:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">//go:build aix || linux || darwin || dragonfly || freebsd || openbsd || netbsd || solaris
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Note, however, that &ldquo;*_unix.go&rdquo; retains its original semantics and cannot be recognized. so that it is backwards compatible with existing files. This is <a href="https://github.com/golang/go/issues/20322#issuecomment-1057682650">especially true for use outside of the go standard library</a>.</p>
<h2 id="some-changes-to-the-standard-library">Some changes to the standard library</h2>
<h3 id="net-package-will-use-edns">net package will use EDNS</h3>
<p>In Go 1.19, <a href="https://github.com/golang/go/issues/51153">the net package will use EDNS to increase the size of DNS packets</a> to comply with modern DNS standards and implementations. This should help with some DNS server issues.</p>
<h3 id="flag-package-adds-textvar-function">flag package adds TextVar function</h3>
<p><a href="https://github.com/golang/go/issues/45754">Go flag package adds TextVar function</a>, so that the flag package can be integrated with any Go type that implements encoding.Text{Marshaler,Unmarshaler}. For example.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">flag</span><span class="p">.</span><span class="nf">TextVar</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">ipaddr</span><span class="p">,</span> <span class="s">&#34;ipaddr&#34;</span><span class="p">,</span> <span class="nx">net</span><span class="p">.</span><span class="nf">IPv4</span><span class="p">(</span><span class="mi">192</span><span class="p">,</span> <span class="mi">168</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="s">&#34;what server to connect to?&#34;</span><span class="p">)</span> <span class="c1">// with net.IPv4 type
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">flag</span><span class="p">.</span><span class="nf">TextVar</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">start</span><span class="p">,</span> <span class="s">&#34;start&#34;</span><span class="p">,</span> <span class="nx">time</span><span class="p">.</span><span class="nf">Now</span><span class="p">(),</span> <span class="s">&#34;when should we start processing?&#34;</span><span class="p">)</span> <span class="c1">// with the time.Time type
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="other">Other</h2>
<ul>
<li>On linux, Go officially supports 64-bit loong cpu architecture (GOOS=linux, GOARCH=loong64).</li>
<li>In the case where Go GC goes into a periodic GC loop when the Go application is idle (once every 2 minutes), the Go runtime will now schedule fewer GC worker goroutines on idle OS threads, reducing the usage of os resources by the Go application when idle.</li>
<li>Go runtime will allocate the initial goroutine stack based on the goroutine&rsquo;s historical average stack usage, avoiding up to 2x the wasted goroutine stack space for some goroutines.</li>
<li>sync/atomic package adds new advanced atomic types Bool, Int32, Int64, Uint32, Uint64, Uintptr and Pointer to improve the experience.</li>
<li>Go 1.19 Go compiler re-implemented switch statements for large integer numbers and string types using jump tables, improving performance by about 20% on average.</li>
</ul>
<h2 id="summary">Summary</h2>
<p>Compared to Go 1.18, Go 1.19 is indeed a &ldquo;minor release&rdquo;. But Go 1.19&rsquo;s updates to the memory model, the addition of SetMemoryLimit, the revision of the go doc comment, and the continued polishing of go runtime can still generate a little &ldquo;excitement&rdquo; among gophers, <strong>especially The addition of SetMemoryLimit will improve the situation of Go applications being killed due to untimely GC</strong>, let&rsquo;s wait and see.</p>
<p>The milestone for Go 1.19 is <a href="https://github.com/golang/go/milestone/224">here</a>, and all features and fixes can be seen in that milestone.</p>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/golang/">golang</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2022-06/rust-basics/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">The basics of Rust</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2022-06/k8s-pod-graceful/">
            <span class="next-text nav-default">Graceful exit mechanism for Pods in Kubernetes</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  <script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox-3.1.20.min.js"></script>



<script type="text/javascript" src="/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
