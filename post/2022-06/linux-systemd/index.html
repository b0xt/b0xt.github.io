<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Linux Systemd Getting Started - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="Learn how to use Systemd on Linux." /><meta name="keywords" content="Systemd" />






<meta name="generator" content="Hugo 0.101.0 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2022-06/linux-systemd/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link href="/lib/fancybox/jquery.fancybox-3.1.20.min.css" rel="stylesheet">


<meta property="og:title" content="Linux Systemd Getting Started" />
<meta property="og:description" content="Learn how to use Systemd on Linux." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2022-06/linux-systemd/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-06-11T11:36:36+08:00" />
<meta property="article:modified_time" content="2022-06-11T11:36:36+08:00" />

<meta itemprop="name" content="Linux Systemd Getting Started">
<meta itemprop="description" content="Learn how to use Systemd on Linux."><meta itemprop="datePublished" content="2022-06-11T11:36:36+08:00" />
<meta itemprop="dateModified" content="2022-06-11T11:36:36+08:00" />
<meta itemprop="wordCount" content="2011">
<meta itemprop="keywords" content="linux," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Linux Systemd Getting Started"/>
<meta name="twitter:description" content="Learn how to use Systemd on Linux."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SOBYTE</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SOBYTE</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Linux Systemd Getting Started</h1>

      <div class="post-meta">
        <span class="post-time"> 2022-06-11 11:36:36 </span>
        <div class="post-category">
            <a href="/categories/tutorials/"> tutorials </a>
            </div>
          <span class="more-meta"> 2011 words </span>
          <span class="more-meta"> 10 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#list-of-common-commands">List of common commands</a></li>
        <li><a href="#boot-up">Boot up</a></li>
        <li><a href="#unit">Unit</a>
          <ul>
            <li><a href="#configuration-file">Configuration file</a></li>
            <li><a href="#template-example">Template example</a></li>
          </ul>
        </li>
        <li><a href="#target">Target</a>
          <ul>
            <li><a href="#configuration-file-1">Configuration file</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/06/11/5fd9646f7b5849b596939a13bb033263.png" alt="Linux Systemd"></p>
<p>Systemd is a centralized system and setup manager for the Linux computer operating system, including daemons, libraries and applications, developed by Lennart Poettering. The goal was to provide a better framework to represent the dependencies between system services, to enable parallel startup of services during system initialization, and to reduce the system overhead of the shell, eventually replacing the System V and BSD style init programs that are now commonly used.</p>
<p>Most Linux distributions now use systemd instead of System V.</p>
<h2 id="list-of-common-commands">List of common commands</h2>
<ul>
<li>List all loaded units: <code>systemctl list-units</code></li>
<li>View the configuration of the specified unit: <code>systemctl cat [serviceName]</code> <em>(e.g. <code>systemctl cat sshd.service</code> )</em></li>
<li>Modify the configuration of the specified unit: <code>systemctl edit [serviceName]</code> <em>(e.g. <code>systemctl edit sshd.service</code> )</em></li>
<li>Check the operational status of the specified unit: <code>systemctl status [serviceName|pid]</code> <em>(e.g. <code>systemctl status sshd.service</code> )</em>
<ul>
<li>If a unit name is specified, then the runtime status information for the specified units is displayed, along with the most recent log data for those units.</li>
<li>If a PID is specified, then the runtime status information of the unit to which the specified PID belongs is displayed, along with the most recent log data for those units.</li>
<li>If no units or PIDs are specified, then status information is displayed for the entire system, or, if used with <code>-all</code>, for all loaded units (you can use <code>-t</code> to specify the unit type).</li>
</ul>
</li>
<li>Start the specified unit: <code>systemctl start [serviceName]</code> <em>(e.g. <code>systemctl start sshd.service</code>)</em>
<ul>
<li>The specified unit must already be loaded.</li>
</ul>
</li>
<li>Restart the specified unit: <code>systemctl restart [serviceName]</code> <em>(e.g. <code>systemctl restart sshd.service</code> )</em>
<ul>
<li>If the specified units are not started, start them directly.</li>
</ul>
</li>
<li>Stop the specified unit: <code>systemctl stop [serviceName]</code> <em>(e.g. <code>systemctl stop sshd.service</code> )</em></li>
<li>Enable the specified unit: <code>systemctl enable [serviceName]</code> <em>(e.g. <code>systemctl enable sshd.service</code> )</em></li>
<li>Disable the specified unit: <code>systemctl disable [serviceName]</code> <em>(e.g. <code>systemctl disable sshd.service</code> )</em></li>
<li>Reload the configuration of the specified unit: <code>systemctl reload [serviceName]</code> <em>(e.g. <code>systemctl reload sshd.service</code> )</em></li>
<li>Reload all modified configuration files: <code>systemctl daemon-reload</code></li>
</ul>
<h2 id="boot-up">Boot up</h2>
<p>For those software that support Systemd, a configuration file is automatically added to the <code>/usr/lib/systemd/system</code> directory when it is installed.</p>
<p>If you want the software to boot, execute the following command (take <code>sshd.service</code> as an example).</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">sudo systemctl <span class="nb">enable</span> sshd.service
</span></span></code></pre></td></tr></table>
</div>
</div><p>The above command is equivalent to adding a symbolic link to the <code>/etc/systemd/system</code> directory, pointing to the <code>sshd.service</code> file in <code>/usr/lib/systemd/system</code>.</p>
<p>This is because at boot time, Systemd only executes the configuration file inside the <code>/etc/systemd/system</code> directory. This also means that if you put the modified configuration file in that directory, you can achieve the effect of overwriting the original configuration.</p>
<h2 id="unit">Unit</h2>
<h3 id="configuration-file">Configuration file</h3>
<p>For software that does not natively support Systemd, you can write your own configuration file for the purpose of boot-up.</p>
<p>Let&rsquo;s take the <code>sshd.service</code> configuration file as an example and analyze the Systemd configuration file.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># /lib/systemd/system/ssh.service
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">[Unit]
</span></span><span class="line"><span class="cl">Description=OpenBSD Secure Shell server
</span></span><span class="line"><span class="cl">Documentation=man:sshd(8) man:sshd_config(5)
</span></span><span class="line"><span class="cl">After=network.target auditd.service
</span></span><span class="line"><span class="cl">ConditionPathExists=!/etc/ssh/sshd_not_to_be_run
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">[Service]
</span></span><span class="line"><span class="cl">EnvironmentFile=-/etc/default/ssh
</span></span><span class="line"><span class="cl">ExecStartPre=/usr/sbin/sshd -t
</span></span><span class="line"><span class="cl">ExecStart=/usr/sbin/sshd -D $SSHD_OPTS
</span></span><span class="line"><span class="cl">ExecReload=/usr/sbin/sshd -t
</span></span><span class="line"><span class="cl">ExecReload=/bin/kill -HUP $MAINPID
</span></span><span class="line"><span class="cl">KillMode=process
</span></span><span class="line"><span class="cl">Restart=on-failure
</span></span><span class="line"><span class="cl">RestartPreventExitStatus=255
</span></span><span class="line"><span class="cl">Type=notify
</span></span><span class="line"><span class="cl">RuntimeDirectory=sshd
</span></span><span class="line"><span class="cl">RuntimeDirectoryMode=0755
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">[Install]
</span></span><span class="line"><span class="cl">WantedBy=multi-user.target
</span></span><span class="line"><span class="cl">Alias=sshd.service
</span></span></code></pre></td></tr></table>
</div>
</div><p>As you can see there are three sections in this file: <code>[Unit]</code> , <code>[Service]</code> and <code>[Install]</code> .</p>
<p>The configuration items are usually repeatable, but the later configuration items replace the previous ones with the same name.
So if you want to zero out a setting, you can zero out the setting by adding a null entry (e.g. <code>After=</code>) at the end of the section where the configuration is located.</p>
<h4 id="unit-startup-order-and-dependencies">[Unit]: Startup Order and Dependencies</h4>
<p>This section has the following main configuration items.</p>
<ul>
<li><code>Description</code> : A short description of the current service</li>
<li><code>Documentation</code> : document location (separated by spaces)
<ul>
<li>This can be a link to a web page, the name of a manpages, or a file path.</li>
</ul>
</li>
<li><code>Before</code> : before which services were started
<ul>
<li>This field does not involve dependencies, it just indicates the start order</li>
</ul>
</li>
<li><code>After</code> : Which services are started after
<ul>
<li>This field does not involve dependencies, it just indicates the order of startup</li>
<li>Take the configuration in <code>sshd.service</code> as an example, the service needs to be started after <code>network.target</code> and <code>auditd.service</code></li>
</ul>
</li>
<li><code>Wants</code> : weakly dependent services
<ul>
<li>If the dependent service is stopped, this service does not need to be stopped</li>
</ul>
</li>
<li><code>Requires</code> : Strongly dependent services
<ul>
<li>This service cannot be started if the dependent service is not started</li>
<li>If the dependent service is stopped, this service must also be stopped</li>
</ul>
</li>
<li><code>Conflicts</code> : conflicting services
<ul>
<li>If one of the listed services is already running, then this service cannot be started</li>
</ul>
</li>
</ul>
<h4 id="service-startup-behavior">[Service]: Startup behavior</h4>
<p>This section has the following main configuration items.</p>
<ul>
<li><code>Type</code>: the type of startup. The default value is <code>simple</code> and the optional values are as follows.
<ul>
<li><code>simple</code> : Make the item started by the <code>ExecStart</code> item the main process</li>
<li><code>forking</code> : The <code>ExecStart</code> item will be started as <code>fork()</code>, when the parent process will exit and the child process will become the master process</li>
<li><code>oneshot</code> : similar to <code>simple</code>, but only executed once, Systemd will wait for it to finish before starting other services</li>
<li><code>dbus</code> : similar to <code>simple</code>, but will wait for the <code>D-Bus</code> signal before starting</li>
<li><code>notify</code> : similar to <code>simple</code>, it will send a notification signal when it finishes, and then Systemd will start other services.</li>
<li><code>idle</code> : Similar to <code>simple</code>, but will not start the service until all other tasks are executed.
<ul>
<li>One use of this option is to keep the output of the service from being mixed with the output of other services.</li>
<li>Another use of this option is to execute programs that only need to be executed once at boot time</li>
</ul>
</li>
</ul>
</li>
<li><code>Environment</code> : Specifies the environment variables</li>
<li><code>EnvironmentFile</code> : Environment variable configuration file, the configuration in the form of <code>key=value</code> inside the file can be obtained with <code>$key</code> in the current file</li>
<li><code>ExecStart</code> : The command to be executed when the service starts</li>
<li><code>ExecReload</code> : The command to be executed when the service is restarted</li>
<li><code>ExecStop</code> : Command to be executed when the service is stopped</li>
<li><code>ExecStartPre</code> : Command executed before the service starts</li>
<li><code>ExecStartPost</code> : Command executed after the service is started</li>
<li><code>ExecStopPost</code> : Command executed after the service is stopped</li>
<li><code>Restart</code> : The restart method after the service exits, the default value is <code>no</code>
<ul>
<li><code>no</code> : process will not be restarted after exiting</li>
<li><code>on-success</code> : restart when the process exits normally (exit status code is 0)</li>
<li><code>on-failure</code> : restart when the process exits abnormally (exit status code is not 0, terminated by signal, program timeout)</li>
<li><code>on-abnormal</code> : restart when the process is terminated by a signal or program timeout</li>
<li><code>on-abort</code> : restart when a signal is received that is not caught</li>
<li><code>on-watchdog</code> : restart when the process times out</li>
<li><code>always</code> : always restart (regardless of the reason)</li>
<li>For daemons, the recommended setting is <code>on-failure</code>. For services that are allowed to exit with errors, you can set it to <code>on-abnormal</code>.</li>
</ul>
</li>
<li><code>RemainAfterExit</code> : Whether to restart after exiting
<ul>
<li>When <code>RemainAfterExit=1</code> is set, this service will try to start again after all programs belonging to this service have been terminated. This is useful for <code>Type=oneshot</code> services</li>
</ul>
</li>
<li><code>TimeoutSec</code> : The number of seconds to wait for this service to fail to enter the &ldquo;force end&rdquo; state when starting or stopping.</li>
<li><code>KillMode</code> : Defines how Systemd stops this service, defaults to <code>control-group</code>.
<ul>
<li><code>control-group</code> : Shut down all processes in this control group when the service is stopped</li>
<li><code>process</code> : Terminate only the main process when the service is stopped (the command after the ExecStart string)</li>
<li><code>mixed</code> : The main process will receive the <strong>SIGTERM</strong> signal and the child processes will receive the <strong>SIGKILL</strong> signal</li>
<li><code>none</code> : no process will be killed, only the stop command of the service will be executed</li>
</ul>
</li>
<li><code>RestartSec</code> : The number of seconds Systemd will wait before restarting the service (default is 100ms)</li>
</ul>
<p>All startup settings can be preceded by a hyphen ( <code>-</code> ) to indicate &ldquo;error suppression&rdquo;, i.e. when an error occurs, it does not affect the execution of other commands. Take <code>sshd.service</code> for example, <code>EnvironmentFile=-/etc/sysconfig/sshd</code> (note the hyphen after the equal sign) in the file means that the <code>/etc/sysconfig/sshd</code> file does not exist and no error will be thrown.</p>
<h4 id="install-installation-behavior">[Install]: Installation behavior</h4>
<p>This section has the following main configuration items.</p>
<ul>
<li><code>WantedBy</code> : Indicates the Target where the service is located
<ul>
<li>Generally, service units are listed under <code>multi-user.target</code>.</li>
</ul>
</li>
<li><code>Also</code> : the unit that needs to be enabled when the service is enabled</li>
<li><code>Alias</code> : Specifies the alias file that links to the unit&rsquo;s configuration file when creating a soft link</li>
</ul>
<h3 id="template-example">Template example</h3>
<p>The <code>getty@.service</code> file is used here as an example to analyze how it is possible to start multiple services using a single configuration file.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># /lib/systemd/system/getty@.service
</span></span><span class="line"><span class="cl">#
</span></span><span class="line"><span class="cl">#  SPDX-License-Identifier: LGPL-2.1+
</span></span><span class="line"><span class="cl">#
</span></span><span class="line"><span class="cl">#  This file is part of systemd.
</span></span><span class="line"><span class="cl">#
</span></span><span class="line"><span class="cl">#  systemd is free software; you can redistribute it and/or modify it
</span></span><span class="line"><span class="cl">#  under the terms of the GNU Lesser General Public License as published by
</span></span><span class="line"><span class="cl">#  the Free Software Foundation; either version 2.1 of the License, or
</span></span><span class="line"><span class="cl">#  (at your option) any later version.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">[Unit]
</span></span><span class="line"><span class="cl">Description=Getty on %I
</span></span><span class="line"><span class="cl">Documentation=man:agetty(8) man:systemd-getty-generator(8)
</span></span><span class="line"><span class="cl">Documentation=http://0pointer.de/blog/projects/serial-console.html
</span></span><span class="line"><span class="cl">After=systemd-user-sessions.service plymouth-quit-wait.service getty-pre.target
</span></span><span class="line"><span class="cl">After=rc-local.service
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># If additional gettys are spawned during boot then we should make
</span></span><span class="line"><span class="cl"># sure that this is synchronized before getty.target, even though
</span></span><span class="line"><span class="cl"># getty.target didn&#39;t actually pull it in.
</span></span><span class="line"><span class="cl">Before=getty.target
</span></span><span class="line"><span class="cl">IgnoreOnIsolate=yes
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># IgnoreOnIsolate causes issues with sulogin, if someone isolates
</span></span><span class="line"><span class="cl"># rescue.target or starts rescue.service from multi-user.target or
</span></span><span class="line"><span class="cl"># graphical.target.
</span></span><span class="line"><span class="cl">Conflicts=rescue.service
</span></span><span class="line"><span class="cl">Before=rescue.service
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># On systems without virtual consoles, don&#39;t start any getty. Note
</span></span><span class="line"><span class="cl"># that serial gettys are covered by serial-getty@.service, not this
</span></span><span class="line"><span class="cl"># unit.
</span></span><span class="line"><span class="cl">ConditionPathExists=/dev/tty0
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">[Service]
</span></span><span class="line"><span class="cl"># the VT is cleared by TTYVTDisallocate
</span></span><span class="line"><span class="cl"># The &#39;-o&#39; option value tells agetty to replace &#39;login&#39; arguments with an
</span></span><span class="line"><span class="cl"># option to preserve environment (-p), followed by &#39;--&#39; for safety, and then
</span></span><span class="line"><span class="cl"># the entered username.
</span></span><span class="line"><span class="cl">ExecStart=-/sbin/agetty -o &#39;-p -- \\u&#39; --noclear %I $TERM
</span></span><span class="line"><span class="cl">Type=idle
</span></span><span class="line"><span class="cl">Restart=always
</span></span><span class="line"><span class="cl">RestartSec=0
</span></span><span class="line"><span class="cl">UtmpIdentifier=%I
</span></span><span class="line"><span class="cl">TTYPath=/dev/%I
</span></span><span class="line"><span class="cl">TTYReset=yes
</span></span><span class="line"><span class="cl">TTYVHangup=yes
</span></span><span class="line"><span class="cl">TTYVTDisallocate=yes
</span></span><span class="line"><span class="cl">KillMode=process
</span></span><span class="line"><span class="cl">IgnoreSIGPIPE=no
</span></span><span class="line"><span class="cl">SendSIGHUP=yes
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># Unset locale for the console getty since the console has problems
</span></span><span class="line"><span class="cl"># displaying some internationalized messages.
</span></span><span class="line"><span class="cl">UnsetEnvironment=LANG LANGUAGE LC_CTYPE LC_NUMERIC LC_TIME LC_COLLATE LC_MONETARY LC_MESSAGES LC_PAPER LC_NAME LC_ADDRESS LC_TELEPHONE LC_MEASUREMENT LC_IDENTIFICATION
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">[Install]
</span></span><span class="line"><span class="cl">WantedBy=getty.target
</span></span><span class="line"><span class="cl">DefaultInstance=tty1
</span></span></code></pre></td></tr></table>
</div>
</div><p>Run the <code>systemctl status getty@tty1.service</code> command and you will see the output as shown below.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/06/11/c53d9fbb75854016b9c120dd4ec38c26.png" alt="systemctl status getty@tty1.service"></p>
<p>It is easy to see that the orange character in the diagram corresponds to <code>%I</code> in the configuration file above, and the name of the configuration file is not <code>getty@tty1.service</code> but <code>getty@.service</code>, which is called &ldquo;template instance&rdquo;.</p>
<p>To start it, just add the parameter that needs to be filled in the <code>%I</code> position after <code>@</code>, e.g. <code>getty@tty9.service</code>.</p>
<h2 id="target">Target</h2>
<p>In general, there are two common Targets: <code>multi-user.target</code>, which represents the multi-user command line state, and <code>graphical.target</code>, which represents the graphical user state (which depends on <code>multi-user.target</code>), much like SysVinit&rsquo;s runlevel .</p>
<p>A very clear official Target dependency diagram is provided as follows.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/06/11/c63c5e735d0e4ae58d87cf0794292bb9.png" alt="Target dependency diagram"></p>
<blockquote>
<p><a href="https://www.freedesktop.org/software/systemd/man/bootup.html#System%20Manager%20Bootup">https://www.freedesktop.org/software/systemd/man/bootup.html#System Manager Bootup</a></p>
</blockquote>
<h3 id="configuration-file-1">Configuration file</h3>
<p>Using the file <code>multi-user.target</code> as an example, let&rsquo;s briefly explain the main items in Target&rsquo;s configuration file.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># /lib/systemd/system/multi-user.target
</span></span><span class="line"><span class="cl">#
</span></span><span class="line"><span class="cl">#  SPDX-License-Identifier: LGPL-2.1+
</span></span><span class="line"><span class="cl">#
</span></span><span class="line"><span class="cl">#  This file is part of systemd.
</span></span><span class="line"><span class="cl">#
</span></span><span class="line"><span class="cl">#  systemd is free software; you can redistribute it and/or modify it
</span></span><span class="line"><span class="cl">#  under the terms of the GNU Lesser General Public License as published by
</span></span><span class="line"><span class="cl">#  the Free Software Foundation; either version 2.1 of the License, or
</span></span><span class="line"><span class="cl">#  (at your option) any later version.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">[Unit]
</span></span><span class="line"><span class="cl">Description=Multi-User System
</span></span><span class="line"><span class="cl">Documentation=man:systemd.special(7)
</span></span><span class="line"><span class="cl">Requires=basic.target
</span></span><span class="line"><span class="cl">Conflicts=rescue.service rescue.target
</span></span><span class="line"><span class="cl">After=basic.target rescue.service rescue.target
</span></span><span class="line"><span class="cl">AllowIsolate=yes
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><code>Requires</code> : Requirement to run with a Target</li>
<li><code>Conflicts</code> : conflicting Targets</li>
<li><code>After</code> : Which Targets to start after</li>
<li><code>AllowIsolate</code> : Whether to allow switching to this Target using the <code>systemctl isolate</code> command</li>
</ul>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/linux/">linux</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2022-06/modify-git-mail/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Batch Modify Git Repository Commit Mailboxes</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2022-06/github-atom/">
            <span class="next-text nav-default">Microsoft GitHub Announces &#34;Phasing Out&#34; of Atom Code Editor! The focus will shift to VSCode</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  <script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox-3.1.20.min.js"></script>



<script type="text/javascript" src="/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js"></script>








</body>
</html>
