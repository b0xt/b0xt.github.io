<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>iptables 15-Minute Tutorial &amp; Common Commands Summary - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="This article is designed to get newbies up to speed on common iptables operations in 15 minutes, and to quickly look up the commands they want as needed." /><meta name="keywords" content="iptables" />






<meta name="generator" content="Hugo 0.101.0 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2022-06/iptables/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link href="/lib/fancybox/jquery.fancybox-3.1.20.min.css" rel="stylesheet">


<meta property="og:title" content="iptables 15-Minute Tutorial &amp; Common Commands Summary" />
<meta property="og:description" content="This article is designed to get newbies up to speed on common iptables operations in 15 minutes, and to quickly look up the commands they want as needed." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2022-06/iptables/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-06-26T11:31:31+08:00" />
<meta property="article:modified_time" content="2022-06-26T11:31:31+08:00" />

<meta itemprop="name" content="iptables 15-Minute Tutorial &amp; Common Commands Summary">
<meta itemprop="description" content="This article is designed to get newbies up to speed on common iptables operations in 15 minutes, and to quickly look up the commands they want as needed."><meta itemprop="datePublished" content="2022-06-26T11:31:31+08:00" />
<meta itemprop="dateModified" content="2022-06-26T11:31:31+08:00" />
<meta itemprop="wordCount" content="1356">
<meta itemprop="keywords" content="linux," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="iptables 15-Minute Tutorial &amp; Common Commands Summary"/>
<meta name="twitter:description" content="This article is designed to get newbies up to speed on common iptables operations in 15 minutes, and to quickly look up the commands they want as needed."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SOBYTE</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SOBYTE</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">iptables 15-Minute Tutorial &amp; Common Commands Summary</h1>

      <div class="post-meta">
        <span class="post-time"> 2022-06-26 11:31:31 </span>
        <div class="post-category">
            <a href="/categories/tutorials/"> tutorials </a>
            </div>
          <span class="more-meta"> 1356 words </span>
          <span class="more-meta"> 3 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#iptables-concepts">iptables concepts</a></li>
        <li><a href="#iptables-common-commands">iptables common commands</a>
          <ul>
            <li><a href="#configure-global-policy">Configure global policy</a></li>
            <li><a href="#show-iptables-rules">Show iptables rules</a></li>
            <li><a href="#iptables-adddelete">iptables Add/Delete</a></li>
            <li><a href="#iptables-packet-filtering">iptables packet filtering</a></li>
            <li><a href="#iptables-packet-forwarding">iptables packet forwarding</a></li>
            <li><a href="#iptables-packet-flow-restriction">iptables packet flow restriction</a></li>
          </ul>
        </li>
        <li><a href="#iptables-save--load--autoload">iptables save &amp; load &amp; autoload</a></li>
        <li><a href="#iptables-save-configuration-file-reading-and-writing">iptables-save configuration file reading and writing</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>iptables is a very classic firewall tool for Linux, but the learning curve is very high due to its complex structure, long official documentation, many parameters, and awkward configuration (default does not support persistence, commands added to take effect, etc.), and risky configuration (accidentally lose connection with the server). It is extremely unfriendly to Linux newbies or people with poor memory (I have a very poor memory). The purpose of this article is to let iptables newbies master iptables common operations in 15 minutes, and be able to quickly look up the commands they want as needed.</p>
<p>Disclaimer: This article is the author&rsquo;s personal use of the process of sharing notes, please understand what you are doing before using the commands in the notes, it is recommended to operate in the experimental environment first, and then apply in the production environment! If you are not sure what you are doing or what you want to do, it is recommended to read the official documentation of iptables: <a href="https://linux.die.net/man/8/iptables">iptables(8) - Linux man page</a> first.</p>
<h2 id="iptables-concepts">iptables concepts</h2>
<ul>
<li>tables: kernel modules corresponding to different processing of packets
<ul>
<li><code>filter</code>: filtering</li>
<li>kernel module: <code>iptables_filter</code></li>
<li><code>nat</code>: network address translation</li>
<li>kernel module: <code>iptables_nat</code></li>
<li><code>mangle</code>: disassembly and encapsulation of packets</li>
<li>raw: the table that first touches the packet and allows a packet to skip the filtering principle</li>
</ul>
</li>
</ul>
<blockquote>
<p>table order is raw -&gt; mangle -&gt; nat -&gt; filter</p>
</blockquote>
<ul>
<li>chaining: different access paths go through different chains
<ul>
<li>prerouting</li>
<li>input</li>
<li>output</li>
<li>forward</li>
<li>postrouting</li>
</ul>
</li>
</ul>
<p>Chain order in different tables.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/06/26/35bebe81397c4306b35e893a1f548675.png" alt="Chain order in different tables"></p>
<h2 id="iptables-common-commands">iptables common commands</h2>
<h3 id="configure-global-policy">Configure global policy</h3>
<blockquote>
<p>Danger! It is best to configure the global policy when a VNC connection is available, or after the configuration is finished.</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">iptables --policy INPUT DROP
</span></span><span class="line"><span class="cl">iptables --policy OUTPUT ACCEPT
</span></span><span class="line"><span class="cl">iptables --policy FORWARD ACCEPT
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="show-iptables-rules">Show iptables rules</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># All-purpose medicine</span>
</span></span><span class="line"><span class="cl">iptables -n -L -v --line-numbers
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Show all rules in the default table (filter)</span>
</span></span><span class="line"><span class="cl">iptables -n -L
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Record traffic when displaying rules</span>
</span></span><span class="line"><span class="cl">iptables -n -L -v
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Record line number when displaying rules (for insertion)</span>
</span></span><span class="line"><span class="cl">iptables -n -L --line-numbers
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Specify a sub-table (most commonly used as nat)</span>
</span></span><span class="line"><span class="cl">iptables -n -L -t nat
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 只显示某链的规则</span>
</span></span><span class="line"><span class="cl">iptables -L INPUT
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 以 iptables-save 格式显示规则</span>
</span></span><span class="line"><span class="cl">iptables -S INPUT
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="iptables-adddelete">iptables Add/Delete</h3>
<h4 id="add">add</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># Insert a rule after the input chain n position</span>
</span></span><span class="line"><span class="cl">iptables -I INPUT <span class="o">{</span>n<span class="o">}</span> ...
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Add the rule at the end of the INPUT chain</span>
</span></span><span class="line"><span class="cl">iptables -A INPUT ...
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="delete">Delete</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># Deletes records in the n position of the INPUT chain</span>
</span></span><span class="line"><span class="cl">iptables -D INPUT <span class="o">{</span>n<span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Delete records based on specific parameters</span>
</span></span><span class="line"><span class="cl">iptables -D INPUT -m conntrack --ctstate INVALID -j DROP
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Delete all records under the specified chain</span>
</span></span><span class="line"><span class="cl">iptables -F INPUT
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Delete all records under the specified table</span>
</span></span><span class="line"><span class="cl">iptables -t nat -F
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Delete all records</span>
</span></span><span class="line"><span class="cl">iptables -F
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="iptables-packet-filtering">iptables packet filtering</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># Allow specific TCP ports to pass through</span>
</span></span><span class="line"><span class="cl">iptables -A INPUT -p tcp --dport <span class="m">22</span> -j ACCEPT
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Allow specific TCP port segments to pass.</span>
</span></span><span class="line"><span class="cl">iptables -A INPUT -p tcp --dport 8000:8800 -j ACCEPT
</span></span><span class="line"><span class="cl">iptables -A INPUT -p tcp -m multiport --dport 80,443 -j ACCEPT
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Allow specific IPs to pass.</span>
</span></span><span class="line"><span class="cl">iptables -A INPUT -p tcp -s 192.168.1.0/24 --dport <span class="m">22</span> -j ACCEPT
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Allow passage from a specific NIC.</span>
</span></span><span class="line"><span class="cl">iptables -A INPUT -i eth1 -p tcp --dport <span class="m">3306</span> -m conntrack --ctstate NEW,ESTABLISHED -j ACCEPT
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Disabling specific ports.</span>
</span></span><span class="line"><span class="cl">iptables -A OUTPUT -p tcp --dport <span class="m">25</span> -j REJECT
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Prohibit and record.</span>
</span></span><span class="line"><span class="cl">iptables -A INPUT -i eth1 -s 10.0.0.0/8 -j LOG --log-prefix <span class="s2">&#34;IP_SPOOF A: &#34;</span>
</span></span><span class="line"><span class="cl">iptables -A INPUT -i eth1 -s 10.0.0.0/8 -j DROP
</span></span><span class="line"><span class="cl">tail -f /var/log/messagesgrep --color <span class="s1">&#39;IP SPOOF&#39;</span> /var/log/messages
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Filtering based on specific packet content (non-encrypted).</span>
</span></span><span class="line"><span class="cl">iptables -A FORWARD -m string --string <span class="s1">&#39;.exe&#39;</span> -j DROP
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="iptables-packet-forwarding">iptables packet forwarding</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># Packet forwarding prerequisite: ip_forward enabled</span>
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">&#34;net.ipv4.ip_forward = 1&#34;</span> &gt;&gt; /etc/sysctl.conf
</span></span><span class="line"><span class="cl">sudo sysctl -p
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># iptables implementation of NAT gateway</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Assume the intranet segment is 10.0.0.0/24</span>
</span></span><span class="line"><span class="cl">iptables -t nat -A POSTROUTING -s 10.0.0.0/24 -j MASQUERADE
</span></span><span class="line"><span class="cl">iptables -t filter -A FORWARD -s 10.0.0.0/24 -j ACCEPT
</span></span><span class="line"><span class="cl">iptables -t filter -A FORWARD -d 10.0.0.0/24 -j ACCEPT
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># iptables port mapping</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Forward the local (192.168.75.5) ports 80~88 to 192.168.75.3:8008</span>
</span></span><span class="line"><span class="cl">iptables -t nat -A PREROUTING -p tcp -d 192.168.75.5 --dport 80:88 -j DNAT --to-destination 192.168.75.3:8000-8008
</span></span><span class="line"><span class="cl">iptables -t nat -A POSTROUTING -p tcp -d 192.168.75.3 --dport 8000:8008 -j SNAT --to-source 192.168.75.5
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="iptables-packet-flow-restriction">iptables packet flow restriction</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># Restricted traffic</span>
</span></span><span class="line"><span class="cl">iptables -A INPUT -p tcp -m multiport --dport 80,443 -m limit --limit 20/s --limit-burst <span class="m">5</span> -j ACCEPT
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Limit time</span>
</span></span><span class="line"><span class="cl">iptables -A INPUT -p tcp -m multiport --dport 80,443 -m <span class="nb">time</span> --timestart 21:30 --timestop 22:30 --days Mon,Tue,Wed,Thu,Fri -j ACCEPT
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Prevention of violent attacks</span>
</span></span><span class="line"><span class="cl">iptables -A INPUT -p tcp -m multiport --dport ssh -m conntrack --ctstate NEW -m recent --setiptables -A INPUT -p tcp --dport ssh -m conntrack --ctstate NEW -m recent --update --seconds <span class="m">60</span> --hitcount <span class="m">10</span> -j DROP
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Prevent port scanning</span>
</span></span><span class="line"><span class="cl">iptables -N port-scanningiptables -A port-scanning -p tcp --tcp-flags SYN,ACK,FIN,RST RST -m limit --limit 1/s --limit-burst <span class="m">2</span> -j RETURNiptables -A port-scanning -j DROP
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="iptables-save--load--autoload">iptables save &amp; load &amp; autoload</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># Save</span>
</span></span><span class="line"><span class="cl">iptables-save &gt; /etc/iptables/rules.v4
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Load</span>
</span></span><span class="line"><span class="cl">iptables-restore &lt; /etc/iptables/rules.v4
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Autoload</span>
</span></span><span class="line"><span class="cl"><span class="c1"># deb system</span>
</span></span><span class="line"><span class="cl">apt install iptables-persistent
</span></span><span class="line"><span class="cl"><span class="c1"># Automatically read configuration files from /etc/iptables/rules.v4 and /etc/iptables/rules.v4</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># RHEL System</span>
</span></span><span class="line"><span class="cl">dnf install iptables-services
</span></span><span class="line"><span class="cl">sudo systemctl stop firewalld
</span></span><span class="line"><span class="cl">sudo systemctl disable firewalld
</span></span><span class="line"><span class="cl">sudo systemctl start iptables
</span></span><span class="line"><span class="cl">sudo systemctl <span class="nb">enable</span> iptables
</span></span><span class="line"><span class="cl"><span class="c1"># Read configuration files from /etc/sysconfig/iptables and /etc/sysconfig/ip6tables</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="iptables-save-configuration-file-reading-and-writing">iptables-save configuration file reading and writing</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># Generated by iptables-save v1.4.21 on Tue Jan 15 15:42:32 2019</span>
</span></span><span class="line"><span class="cl">--This is a comment
</span></span><span class="line"><span class="cl">*nat
</span></span><span class="line"><span class="cl">-- This means that the following is the configuration in the nat table
</span></span><span class="line"><span class="cl">:PREROUTING ACCEPT <span class="o">[</span>5129516:445315174<span class="o">]</span>
</span></span><span class="line"><span class="cl">-- :PREROUTING ACCEPT, indicates that the default message policy <span class="k">for</span> the PREROUTING chain in the nat table is accept <span class="o">(</span>no match rule continues<span class="o">)</span>,
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">-- <span class="o">[</span>5129516:445315174<span class="o">]</span> i.e. <span class="o">[</span>packet, bytes<span class="o">]</span>，indicates that there are currently <span class="m">5129516</span> packages <span class="o">(</span><span class="m">445315174</span> bytes）PREROUTING chain through nat table
</span></span><span class="line"><span class="cl">:INPUT ACCEPT <span class="o">[</span>942957:151143842<span class="o">]</span>
</span></span><span class="line"><span class="cl">:OUTPUT ACCEPT <span class="o">[</span>23898:3536261<span class="o">]</span>
</span></span><span class="line"><span class="cl">:POSTROUTING ACCEPT <span class="o">[</span>23898:3536261<span class="o">]</span>
</span></span><span class="line"><span class="cl">-- Explanation as above
</span></span><span class="line"><span class="cl">:DOCKER - <span class="o">[</span>0:0<span class="o">]</span>
</span></span><span class="line"><span class="cl">-- Explanation as above <span class="o">(</span>this article is a custom chain<span class="o">)</span>
</span></span><span class="line"><span class="cl">---------- Here is how to output all the rules by article ----------
</span></span><span class="line"><span class="cl"><span class="o">[</span>4075:366986<span class="o">]</span> -A PREROUTING -m addrtype --dst-type LOCAL -j DOCKER
</span></span><span class="line"><span class="cl">-- <span class="o">[</span>4075:366986<span class="o">]</span> i.e. <span class="o">[</span>packet, bytes<span class="o">]</span>，Indicates the number of packets, in bytes, that passed through this rule. The latter part is the <span class="nb">command</span> to configure this rule with the iptables <span class="nb">command</span> <span class="o">(</span>see the iptables <span class="nb">help</span> <span class="k">for</span> more details on the options<span class="o">)</span>。
</span></span><span class="line"><span class="cl"><span class="o">[</span>0:0<span class="o">]</span> -A OUTPUT ! -d 127.0.0.0/8 -m addrtype --dst-type LOCAL -j DOCKER
</span></span><span class="line"><span class="cl"><span class="o">[</span>0:0<span class="o">]</span> -A POSTROUTING -s 172.17.0.0/16 ! -o docker0 -j MASQUERADE
</span></span><span class="line"><span class="cl"><span class="o">[</span>2:188<span class="o">]</span> -A POSTROUTING -s 192.168.122.0/24 -d 224.0.0.0/24 -j RETURN
</span></span><span class="line"><span class="cl"><span class="o">[</span>0:0<span class="o">]</span> -A POSTROUTING -s 192.168.122.0/24 -d 255.255.255.255/32 -j RETURN
</span></span><span class="line"><span class="cl"><span class="o">[</span>0:0<span class="o">]</span> -A POSTROUTING -s 192.168.122.0/24 ! -d 192.168.122.0/24 -p tcp -j MASQUERADE --to-ports 1024-65535
</span></span><span class="line"><span class="cl"><span class="o">[</span>0:0<span class="o">]</span> -A POSTROUTING -s 192.168.122.0/24 ! -d 192.168.122.0/24 -p udp -j MASQUERADE --to-ports 1024-65535
</span></span><span class="line"><span class="cl"><span class="o">[</span>0:0<span class="o">]</span> -A POSTROUTING -s 192.168.122.0/24 ! -d 192.168.122.0/24 -j MASQUERADE
</span></span><span class="line"><span class="cl"><span class="o">[</span>0:0<span class="o">]</span> -A DOCKER -i docker0 -j RETURN
</span></span><span class="line"><span class="cl">--The above rules are the same as the explanation of the first rule
</span></span><span class="line"><span class="cl">COMMIT
</span></span><span class="line"><span class="cl">-- Apply the above configuration
</span></span><span class="line"><span class="cl"><span class="c1"># Completed on Tue Jan 15 15:42:32 2019</span>
</span></span></code></pre></td></tr></table>
</div>
</div>
    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/linux/">linux</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2022-06/webassembly/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Most commonly used WebAssembly languages: Rust and JavaScript</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2022-06/shell-3/">
            <span class="next-text nav-default">How to use the shell (3/3) - Configuring zsh</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  <script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox-3.1.20.min.js"></script>



<script type="text/javascript" src="/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
