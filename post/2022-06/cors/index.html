<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Cross-origin resource sharing（CORS） - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="Learn how to use  Cross-origin resource sharing（CORS）." /><meta name="keywords" content="cors" />






<meta name="generator" content="Hugo 0.101.0 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2022-06/cors/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link href="/lib/fancybox/jquery.fancybox-3.1.20.min.css" rel="stylesheet">


<meta property="og:title" content="Cross-origin resource sharing（CORS）" />
<meta property="og:description" content="Learn how to use  Cross-origin resource sharing（CORS）." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2022-06/cors/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-06-11T11:56:43+08:00" />
<meta property="article:modified_time" content="2022-06-11T11:56:43+08:00" />

<meta itemprop="name" content="Cross-origin resource sharing（CORS）">
<meta itemprop="description" content="Learn how to use  Cross-origin resource sharing（CORS）."><meta itemprop="datePublished" content="2022-06-11T11:56:43+08:00" />
<meta itemprop="dateModified" content="2022-06-11T11:56:43+08:00" />
<meta itemprop="wordCount" content="1131">
<meta itemprop="keywords" content="cors," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Cross-origin resource sharing（CORS）"/>
<meta name="twitter:description" content="Learn how to use  Cross-origin resource sharing（CORS）."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SOBYTE</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SOBYTE</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Cross-origin resource sharing（CORS）</h1>

      <div class="post-meta">
        <span class="post-time"> 2022-06-11 11:56:43 </span>
        <div class="post-category">
            <a href="/categories/tutorials/"> tutorials </a>
            </div>
          <span class="more-meta"> 1131 words </span>
          <span class="more-meta"> 6 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#simple-requests">Simple Requests</a>
          <ul>
            <li><a href="#definition">Definition</a></li>
            <li><a href="#basic-flow">Basic flow</a></li>
            <li><a href="#code-example">Code example</a></li>
          </ul>
        </li>
        <li><a href="#non-simple-requests---pre-check-requests">Non-simple requests - Pre-check requests</a>
          <ul>
            <li><a href="#basic-flow-1">Basic flow</a></li>
            <li><a href="#code-example-1">Code example</a></li>
          </ul>
        </li>
        <li><a href="#cors-requests-with-identity-credentials">CORS requests with identity credentials</a>
          <ul>
            <li><a href="#code-example-2">Code example</a></li>
          </ul>
        </li>
        <li><a href="#comparison-with-jsonp">Comparison with JSONP</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/06/11/23349a386782458ea6cdceb96a7d2522.png" alt="sharing（CORS）"></p>
<p>Cross-origin resource sharing (CORS) is a mechanism for making restricted resources of a web page accessible to pages from other domains based on HTTP headers. Through this mechanism, pages can freely use images, styles, scripts, iframes, and videos from different sources (cross-origin).</p>
<p>In general, some cross-origin requests (especially ajax) are prohibited by the same-origin policy. CORS defines a way to allow web application servers to perform cross-origin access control, thus enabling secure cross-origin data transfer.</p>
<p>CORS is currently supported by almost all modern browsers and can be found at <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/CORS#%E6%B5%8F%E8%A7%88%E5%99%A8%E5%85%BC%E5%AE%B9%E6%80%A7">MDN</a> for information on browser compatibility.</p>
<p>Browsers divide CORS requests into two categories: simple requests and not-so-simple requests. <em>These two terms are not part of the Fetch specification.</em></p>
<h2 id="simple-requests">Simple Requests</h2>
<p>Some requests do not trigger a CORS preflight request. Such requests are referred to as &ldquo;simple requests&rdquo; in this document.</p>
<h3 id="definition">Definition</h3>
<p>A request is considered a &ldquo;simple request&rdquo; if it meets all of the following conditions: 1.</p>
<ol>
<li>
<p>the request method is <code>HEAD</code>, <code>GET</code> or <code>POST</code>.</p>
</li>
<li>
<p>HTTP headers are allowed to contain only the set of <a href="https://fetch.spec.whatwg.org/#cors-safelisted-request-header">CORS-safe initial fields</a> defined by the Fetch specification, except for those fields that are automatically set by the user agent and those defined in the Fetch specification as <a href="https://fetch.spec.whatwg.org/#forbidden-header-name">disabled header</a> names.</p>
<ul>
<li><code>Accept</code></li>
<li><code>Accept-Language</code></li>
<li><code>Content-Language</code></li>
<li><code>Last-Event-ID</code></li>
<li><code>Content-Type</code> is limited to three values: <code>application/x-www-form-urlencoded</code>, <code>multipart/form-data</code> or <code>text/plain</code>.</li>
</ul>
</li>
<li>
<p>Any <code>XMLHttpRequestUpload</code> object in the request does not have any event listeners registered; the <code>XMLHttpRequestUpload</code> object can be accessed using the <code>XMLHttpRequest.upload</code> property.</p>
</li>
<li>
<p>No <code>ReadableStream</code> object is used in the request.</p>
</li>
</ol>
<p>Simple requests are designed to be compatible with forms, which have historically been able to make cross-domain requests.</p>
<h3 id="basic-flow">Basic flow</h3>
<p>For simple requests, the browser makes a CORS request directly. Specifically, a field named <code>Origin</code> is added to the HTTP header.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">GET /cors HTTP/1.1
</span></span><span class="line"><span class="cl">Origin: http://foo.example
</span></span><span class="line"><span class="cl">Host: foo.example
</span></span><span class="line"><span class="cl">Accept-Language: zh-CN
</span></span><span class="line"><span class="cl">Connection: keep-alive
</span></span><span class="line"><span class="cl">User-Agent: Mozilla/5.0...
</span></span></code></pre></td></tr></table>
</div>
</div><p>In the above header, the <code>Origin</code> field is used to indicate the source of this request, and the server side decides whether to grant the request based on this value.</p>
<p>If the source specified by <code>Origin</code> is within the permitted range, the response header returned by the server will add the following fields.</p>
<ul>
<li>The <code>Access-Control-Allow-Origin</code> field indicates the source of the request allowed by the server, and its value is either the value of the Origin field at the time of the request or <code>*</code>.</li>
<li>The <code>Access-Control-Allow-Credentials</code> field indicates whether the server is allowed to send credential information; this field is optional, and by default, no credential information is allowed.</li>
<li>The <code>Access-Control-Expose-Headers</code> field indicates the allowed HTTP header fields specified by the server, which is optional.</li>
</ul>
<p>If the source specified by <code>Origin</code> is not in the permitted range, the server returns a normal HTTP response without the <code>Access-Control-Allow-Origin</code> field. When the browser finds that this field is not included it knows that the request is in error and will throw an exception. Note that the HTTP response code for this error may be 200 or 204, and therefore cannot be identified by the status code.</p>
<h3 id="code-example">Code example</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;https://baoshuo.ren&#39;</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">mode</span><span class="o">:</span> <span class="s1">&#39;no-cors&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="non-simple-requests---pre-check-requests">Non-simple requests - Pre-check requests</h2>
<p>As mentioned above, CORS requests have non-simple requests in addition to simple requests. In short, non-simple requests are requests that have special requirements for the server, such as a request method of <code>PUT</code> or <code>DELETE</code>, or the value of the <code>Content-Type</code> field in the HTTP header is not one of the three &ldquo;CORS-safe <code>Content-type</code> field values&rdquo; described above.</p>
<h3 id="basic-flow-1">Basic flow</h3>
<p>CORS requests that are not simple requests add an HTTP query request called a &ldquo;preflight&rdquo; before the formal communication.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/06/11/1c54a16e6a3b4a9399b0c4d4edaf221e.png" alt="CORS Basic flow"></p>
<p>As you can see from the above message, the browser first sends a &ldquo;preflight request&rdquo; using the <code>OPTIONS</code> method, which is a method defined in the HTTP/1.1 protocol to obtain more information from the server. This method has no impact on the server resources. The preflight request carries both of the following prefix fields.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">Access-Control-Request-Method: POST
</span></span><span class="line"><span class="cl">Access-Control-Request-Headers: X-PINGOTHER, Content-Type
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>The <code>Access-Control-Request-Method</code> field will inform the server of the method that will be used for the actual request.</li>
<li>The <code>Access-Control-Request-Headers</code> field will inform the server of the custom request header fields that will be carried by the actual request.</li>
</ul>
<p>The server will decide accordingly whether to allow the actual request and return the appropriate response.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">Access-Control-Allow-Origin: http://foo.example
</span></span><span class="line"><span class="cl">Access-Control-Allow-Methods: POST, GET, OPTIONS
</span></span><span class="line"><span class="cl">Access-Control-Allow-Headers: X-PINGOTHER, Content-Type
</span></span><span class="line"><span class="cl">Access-Control-Allow-Credentials: true
</span></span><span class="line"><span class="cl">Access-Control-Max-Age: 86400
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>The <code>Access-Control-Allow-Origin</code> field does not differ from when a simple request is made.</li>
<li>The <code>Access-Control-Allow-Methods</code> field indicates which methods the server allows to initiate requests.</li>
<li>The <code>Access-Control-Allow-Headers</code> field indicates the additional fields the server allows to be carried in the request headers.</li>
<li>The <code>Access-Control-Allow-Credentials</code> field does not differ from when a simple request is made.</li>
<li>The <code>Access-Control-Max-Age</code> field indicates the validity time of the response, during which the browser is not required to initiate another preflight request for the same request. Note that the browser itself maintains a maximum validity time, and if the value of this field exceeds the maximum validity time maintained by the browser, it will not take effect.</li>
</ul>
<p>If the server &ldquo;denies&rdquo; a preflight request, it also returns a normal HTTP response, but does not contain any HTTP header fields related to CORS. At this point the browser assumes that the server did not agree to the preflight request and throws an error.</p>
<p>Once the preflight request is passed, the next steps are the same as for a simple request, so I won&rsquo;t go over them here.</p>
<h3 id="code-example-1">Code example</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;https://baoshuo.ren&#39;</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">mode</span><span class="o">:</span> <span class="s1">&#39;cors&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="cors-requests-with-identity-credentials">CORS requests with identity credentials</h2>
<p>As mentioned above, CORS requests do not send credential information (cookies and HTTP authentication information) by default. To send credentials to the server, not only does the server need to specify the <code>Access-Control-Allow-Credentials</code> field in the HTTP header, but it also needs to specify whether to send credential information when requesting.</p>
<h3 id="code-example-2">Code example</h3>
<p>The <code>withCredentials</code> flag needs to be set to <code>true</code> when making a CORS request to the server using <code>XmlHttpRequest</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">xhr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nx">xhr</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;https://baoshuo.ren&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">xhr</span><span class="p">.</span><span class="nx">withCredentials</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nx">xhr</span><span class="p">.</span><span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="nx">handler</span><span class="p">;</span> <span class="c1">// The Handler here needs to be defined by yourself
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">xhr</span><span class="p">.</span><span class="nx">send</span><span class="p">();</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Requests made with fetch require <code>credentials</code> to be set to <code>include</code> in order for the browser to send a request with credentials to a cross-domain source.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;https://baoshuo.ren&#39;</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">credentials</span><span class="o">:</span> <span class="s1">&#39;include&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="comparison-with-jsonp">Comparison with JSONP</h2>
<p>CORS and JSONP are used for the same purpose, but CORS is more powerful than JSONP.</p>
<p>The disadvantage of JSONP is that it only supports GET requests, while CORS supports all types of HTTP requests. If a site needs to be compatible with older browsers or needs to request data from sites that do not support CORS, you still need to use JSONP.</p>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/cors/">cors</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2022-06/linux-file-witr-speed/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">4 Ways to View Log File Write Speed in Linux</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2022-06/modify-git-mail/">
            <span class="next-text nav-default">Batch Modify Git Repository Commit Mailboxes</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  <script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox-3.1.20.min.js"></script>



<script type="text/javascript" src="/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
