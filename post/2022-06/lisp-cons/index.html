<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Cons, an interesting data structure - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="Learn cons, an interesting data structure, through typescript." /><meta name="keywords" content="cons" />






<meta name="generator" content="Hugo 0.96.0 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2022-06/lisp-cons/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link href="/lib/fancybox/jquery.fancybox-3.1.20.min.css" rel="stylesheet">


<meta property="og:title" content="Cons, an interesting data structure" />
<meta property="og:description" content="Learn cons, an interesting data structure, through typescript." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2022-06/lisp-cons/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-06-10T13:17:15+08:00" />
<meta property="article:modified_time" content="2022-06-10T13:17:15+08:00" />

<meta itemprop="name" content="Cons, an interesting data structure">
<meta itemprop="description" content="Learn cons, an interesting data structure, through typescript."><meta itemprop="datePublished" content="2022-06-10T13:17:15+08:00" />
<meta itemprop="dateModified" content="2022-06-10T13:17:15+08:00" />
<meta itemprop="wordCount" content="2196">
<meta itemprop="keywords" content="Lisp," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Cons, an interesting data structure"/>
<meta name="twitter:description" content="Learn cons, an interesting data structure, through typescript."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SOBYTE</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SOBYTE</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Cons, an interesting data structure</h1>

      <div class="post-meta">
        <span class="post-time"> 2022-06-10 13:17:15 </span>
        <div class="post-category">
            <a href="/categories/tutorials/"> tutorials </a>
            </div>
          <span class="more-meta"> 2196 words </span>
          <span class="more-meta"> 11 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#preface">Preface</a></li>
        <li><a href="#initial-implementation">Initial Implementation</a></li>
        <li><a href="#linked-list">Linked list</a></li>
        <li><a href="#support-for-modifying-carcdr">Support for modifying car/cdr</a></li>
        <li><a href="#trees">Trees</a></li>
        <li><a href="#conclusion">Conclusion</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <h2 id="preface">Preface</h2>
<p>There is an interesting data structure in lisp, Cons, which uses function closures to encapsulate a two-tuple data structure and build any other data structure needed on top of that. Before this, although I knew about closures and such, and had written some higher-order functions, I hadn&rsquo;t thought about the possibility of using functions to build data structures, and I&rsquo;ll explain how to do that in ts below.</p>
<blockquote>
<p><a href="https://zh.wikipedia.org/zh-cn/%E5%88%97%E8%A1%A8%E6%A7%8B%E9%80%A0%E5%87%BD%E6%95%B8">lisp cons&rsquo;s wiki</a></p>
</blockquote>
<p>The basic definition is as follows.</p>
<p>$$
c=cons(a,b)<br>
car(c)=a<br>
cdr(c)=b
$$</p>
<h2 id="initial-implementation">Initial Implementation</h2>
<p>The cons initial implementation is simple and can be implemented in just a few lines of code. As you can see, it simply binds the arguments a and b using closures and returns them when the function is executed.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">cons</span><span class="p">(</span><span class="nx">a</span>: <span class="kt">number</span><span class="p">,</span> <span class="nx">b</span>: <span class="kt">number</span><span class="p">)</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span>: <span class="kt">number</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="kt">number</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="p">(</span><span class="nx">n</span>: <span class="kt">number</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">n</span> <span class="o">===</span> <span class="mi">0</span> <span class="o">?</span> <span class="nx">a</span> : <span class="kt">b</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">car</span><span class="p">(</span><span class="nx">cons</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span>: <span class="kt">number</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="kt">number</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">cons</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">cdr</span><span class="p">(</span><span class="nx">cons</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span>: <span class="kt">number</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="kt">number</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">cons</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>It can be used in the following way.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">n</span> <span class="o">=</span> <span class="nx">cons</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">car</span><span class="p">(</span><span class="nx">n</span><span class="p">));</span> <span class="c1">// 1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">cdr</span><span class="p">(</span><span class="nx">n</span><span class="p">));</span> <span class="c1">// 2
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>To make it look a little more practical, first supplement its type with a generic type.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kr">export</span> <span class="kr">interface</span> <span class="nx">Cons</span><span class="p">&lt;</span><span class="nt">A</span><span class="err">,</span> <span class="na">B</span><span class="p">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nx">s</span>: <span class="kt">0</span><span class="p">)</span><span class="o">:</span> <span class="nx">A</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nx">s</span>: <span class="kt">1</span><span class="p">)</span><span class="o">:</span> <span class="nx">B</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">_0</span>: <span class="kt">A</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">_1</span>: <span class="kt">B</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="kd">function</span> <span class="nx">cons</span><span class="p">&lt;</span><span class="nt">A</span><span class="err">,</span> <span class="na">B</span><span class="p">&gt;(</span><span class="nx">a</span>: <span class="kt">A</span><span class="p">,</span> <span class="nx">b</span>: <span class="kt">B</span><span class="p">)</span><span class="o">:</span> <span class="nx">Cons</span><span class="p">&lt;</span><span class="nt">A</span><span class="err">,</span> <span class="na">B</span><span class="p">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="p">((</span><span class="nx">s</span>: <span class="kt">0</span> <span class="o">|</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">s</span> <span class="o">===</span> <span class="mi">0</span> <span class="o">?</span> <span class="nx">a</span> : <span class="kt">b</span><span class="p">))</span> <span class="kr">as</span> <span class="kt">any</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="kd">function</span> <span class="nx">car</span><span class="p">&lt;</span><span class="nt">T</span> <span class="na">extends</span> <span class="na">Cons</span><span class="err">&lt;</span><span class="na">any</span><span class="err">,</span> <span class="na">any</span><span class="p">&gt;</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">cons</span>: <span class="kt">T</span><span class="p">)</span><span class="o">:</span> <span class="nx">T</span><span class="p">[</span><span class="s2">&#34;_0&#34;</span><span class="p">]</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">cons</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="kd">function</span> <span class="nx">cdr</span><span class="p">&lt;</span><span class="nt">T</span> <span class="na">extends</span> <span class="na">Cons</span><span class="err">&lt;</span><span class="na">any</span><span class="err">,</span> <span class="na">any</span><span class="p">&gt;</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">cons</span>: <span class="kt">T</span><span class="p">)</span><span class="o">:</span> <span class="nx">T</span><span class="p">[</span><span class="s2">&#34;_1&#34;</span><span class="p">]</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">cons</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Verify it using the following unit tests.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="nx">it</span><span class="p">(</span><span class="s2">&#34;cons&#34;</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">c</span> <span class="o">=</span> <span class="nx">cons</span><span class="p">(</span><span class="s2">&#34;hello&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nx">expect</span><span class="p">(</span><span class="nx">car</span><span class="p">(</span><span class="nx">c</span><span class="p">)</span> <span class="kr">as</span> <span class="kt">string</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="s2">&#34;hello&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nx">expect</span><span class="p">(</span><span class="nx">cdr</span><span class="p">(</span><span class="nx">c</span><span class="p">)</span> <span class="kr">as</span> <span class="kt">number</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>It doesn&rsquo;t look like much use. But it will be used below (the simplest binary structure) to combine into more complex data structures such as chains and trees.</p>
<h2 id="linked-list">Linked list</h2>
<p>In fact, once you have a binary, you can go on to combine any data structure you need, and a Linked list is a simple example of this.
Here the car part of cons stores the value of the current node in the Linked list, and cdr stores a pointer to the next node.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/06/10/fcc979e5329c4e38b67880dd79dfc416.png" alt="Linked list"></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kr">type</span> <span class="nx">List</span><span class="p">&lt;</span><span class="nt">T</span><span class="p">&gt;</span> <span class="o">=</span> <span class="nx">Cons</span><span class="p">&lt;</span><span class="nt">T</span><span class="err">,</span> <span class="na">List</span><span class="err">&lt;</span><span class="na">T</span><span class="p">&gt;</span><span class="o">&gt;</span> <span class="o">|</span> <span class="kc">null</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">list</span><span class="p">()</span><span class="o">:</span> <span class="kc">null</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">list</span><span class="p">&lt;</span><span class="nt">T</span><span class="p">&gt;(...</span><span class="nx">args</span>: <span class="kt">T</span><span class="p">[])</span><span class="o">:</span> <span class="nx">Exclude</span><span class="p">&lt;</span><span class="nt">List</span><span class="err">&lt;</span><span class="na">T</span><span class="p">&gt;,</span> <span class="kc">null</span><span class="o">&gt;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">list</span><span class="p">&lt;</span><span class="nt">T</span><span class="p">&gt;(...</span><span class="nx">args</span>: <span class="kt">T</span><span class="p">[])</span><span class="o">:</span> <span class="nx">List</span><span class="p">&lt;</span><span class="nt">T</span><span class="p">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">function</span> <span class="nx">iter</span><span class="p">(</span><span class="nx">i</span>: <span class="kt">number</span><span class="p">)</span><span class="o">:</span> <span class="nx">List</span><span class="p">&lt;</span><span class="nt">T</span><span class="p">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">i</span> <span class="o">===</span> <span class="nx">args</span><span class="p">.</span><span class="nx">length</span> <span class="o">?</span> <span class="kc">null</span> <span class="o">:</span> <span class="nx">cons</span><span class="p">(</span><span class="nx">args</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">iter</span><span class="p">(</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">iter</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The following is a Linked list that stores 4 elements.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="nx">list</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>It will be a cons nested call procedure.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="nx">cons</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nx">cons</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nx">cons</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="nx">cons</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="kc">null</span><span class="p">))));</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/06/10/92161a7377824c5bbbf1e768f04eeba8.png" alt="Linked list"></p>
<p>You can write <code>map/filter/reduce</code> functions for it.</p>
<p>map/filter is nothing complicated, just recursive processing of each node.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">map</span><span class="p">&lt;</span><span class="nt">T</span><span class="err">,</span> <span class="na">R</span><span class="p">&gt;(</span><span class="nx">list</span>: <span class="kt">List</span><span class="p">&lt;</span><span class="nt">T</span><span class="p">&gt;,</span> <span class="nx">f</span><span class="o">:</span> <span class="p">(</span><span class="nx">i</span>: <span class="kt">T</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">R</span><span class="p">)</span><span class="o">:</span> <span class="nx">List</span><span class="p">&lt;</span><span class="nt">R</span><span class="p">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">list</span> <span class="o">===</span> <span class="kc">null</span> <span class="o">?</span> <span class="kc">null</span> <span class="o">:</span> <span class="p">(</span><span class="nx">cons</span><span class="p">(</span><span class="nx">f</span><span class="p">(</span><span class="nx">car</span><span class="p">(</span><span class="nx">list</span><span class="p">)),</span> <span class="nx">map</span><span class="p">(</span><span class="nx">cdr</span><span class="p">(</span><span class="nx">list</span><span class="p">)</span><span class="o">!</span><span class="p">,</span> <span class="nx">f</span><span class="p">))</span> <span class="kr">as</span> <span class="kt">any</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">filter</span><span class="p">&lt;</span><span class="nt">T</span><span class="p">&gt;(</span><span class="nx">list</span>: <span class="kt">List</span><span class="p">&lt;</span><span class="nt">T</span><span class="p">&gt;,</span> <span class="nx">f</span><span class="o">:</span> <span class="p">(</span><span class="nx">i</span>: <span class="kt">T</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="kr">boolean</span><span class="p">)</span><span class="o">:</span> <span class="nx">List</span><span class="p">&lt;</span><span class="nt">T</span><span class="p">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">list</span> <span class="o">===</span> <span class="kc">null</span>
</span></span><span class="line"><span class="cl">    <span class="o">?</span> <span class="kc">null</span>
</span></span><span class="line"><span class="cl">    <span class="o">:</span> <span class="nx">f</span><span class="p">(</span><span class="nx">car</span><span class="p">(</span><span class="nx">list</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="o">?</span> <span class="nx">cons</span><span class="p">(</span><span class="nx">car</span><span class="p">(</span><span class="nx">list</span><span class="p">),</span> <span class="nx">filter</span><span class="p">(</span><span class="nx">cdr</span><span class="p">(</span><span class="nx">list</span><span class="p">),</span> <span class="nx">f</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="o">:</span> <span class="nx">filter</span><span class="p">(</span><span class="nx">cdr</span><span class="p">(</span><span class="nx">list</span><span class="p">),</span> <span class="nx">f</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The following is a schematic diagram of processing using map.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/06/10/f760bea85f544aea83b75d966c24d554.png" alt="processing"></p>
<p>reduce will be a little special in that it is an iterative recursion.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">reduce</span><span class="p">&lt;</span><span class="nt">T</span><span class="p">&gt;(</span><span class="nx">list</span>: <span class="kt">List</span><span class="p">&lt;</span><span class="nt">T</span><span class="p">&gt;,</span> <span class="nx">f</span><span class="o">:</span> <span class="p">(</span><span class="nx">res</span>: <span class="kt">T</span><span class="p">,</span> <span class="nx">v</span>: <span class="kt">T</span><span class="p">,</span> <span class="nx">i</span>: <span class="kt">number</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">T</span><span class="p">)</span><span class="o">:</span> <span class="nx">T</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">reduce</span><span class="p">&lt;</span><span class="nt">T</span><span class="err">,</span> <span class="na">R</span><span class="p">&gt;(</span>
</span></span><span class="line"><span class="cl">  <span class="nx">list</span>: <span class="kt">List</span><span class="p">&lt;</span><span class="nt">T</span><span class="p">&gt;,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">f</span><span class="o">:</span> <span class="p">(</span><span class="nx">res</span>: <span class="kt">R</span><span class="p">,</span> <span class="nx">v</span>: <span class="kt">T</span><span class="p">,</span> <span class="nx">i</span>: <span class="kt">number</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">R</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">init</span>: <span class="kt">R</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span><span class="o">:</span> <span class="nx">R</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">reduce</span><span class="p">&lt;</span><span class="nt">T</span><span class="err">,</span> <span class="na">R</span><span class="p">&gt;(</span>
</span></span><span class="line"><span class="cl">  <span class="nx">list</span>: <span class="kt">List</span><span class="p">&lt;</span><span class="nt">T</span><span class="p">&gt;,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">f</span><span class="o">:</span> <span class="p">(</span><span class="nx">res</span>: <span class="kt">R</span><span class="p">,</span> <span class="nx">v</span>: <span class="kt">T</span><span class="p">,</span> <span class="nx">i</span>: <span class="kt">number</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">R</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">init?</span>: <span class="kt">R</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span><span class="o">:</span> <span class="nx">R</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">function</span> <span class="nx">iter</span><span class="p">(</span><span class="nx">list</span>: <span class="kt">List</span><span class="p">&lt;</span><span class="nt">T</span><span class="p">&gt;,</span> <span class="nx">init</span>: <span class="kt">R</span><span class="p">,</span> <span class="nx">i</span>: <span class="kt">number</span><span class="p">)</span><span class="o">:</span> <span class="nx">R</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">list</span> <span class="o">===</span> <span class="kc">null</span>
</span></span><span class="line"><span class="cl">      <span class="o">?</span> <span class="nx">init</span>
</span></span><span class="line"><span class="cl">      : <span class="kt">iter</span><span class="p">(</span><span class="nx">cdr</span><span class="p">(</span><span class="nx">list</span><span class="p">)</span><span class="o">!</span><span class="p">,</span> <span class="nx">f</span><span class="p">(</span><span class="nx">init</span><span class="p">,</span> <span class="nx">car</span><span class="p">(</span><span class="nx">list</span><span class="p">),</span> <span class="nx">i</span><span class="p">),</span> <span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">init</span> <span class="o">!==</span> <span class="kc">undefined</span>
</span></span><span class="line"><span class="cl">    <span class="o">?</span> <span class="nx">iter</span><span class="p">(</span><span class="nx">list</span><span class="p">,</span> <span class="nx">init</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">:</span> <span class="nx">iter</span><span class="p">(</span><span class="nx">cdr</span><span class="p">(</span><span class="nx">list</span><span class="o">!</span><span class="p">),</span> <span class="nx">car</span><span class="p">(</span><span class="nx">list</span><span class="o">!</span><span class="p">)</span> <span class="kr">as</span> <span class="kt">unknown</span> <span class="kr">as</span> <span class="nx">R</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>It can be used in the following ways.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">res</span> <span class="o">=</span> <span class="nx">reduce</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="nx">map</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="nx">filter</span><span class="p">(</span><span class="nx">list</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">===</span> <span class="mi">0</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">i</span> <span class="o">*</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl">  <span class="p">),</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">a</span> <span class="o">+</span> <span class="nx">b</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">res</span><span class="p">);</span> <span class="c1">// 12
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>In theory, it should be easy to convert map/filter to a higher-order function based on reduce, such as the following code which implements map/filter based on reduce in js.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">map</span><span class="o">&lt;</span><span class="nx">T</span><span class="p">,</span> <span class="nx">R</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">list</span><span class="o">:</span> <span class="nx">T</span><span class="p">[],</span> <span class="nx">f</span><span class="o">:</span> <span class="p">(</span><span class="nx">i</span><span class="o">:</span> <span class="nx">T</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">R</span><span class="p">)</span><span class="o">:</span> <span class="nx">R</span><span class="p">[]</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">list</span><span class="p">.</span><span class="nx">reduce</span><span class="p">((</span><span class="nx">res</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">res</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">f</span><span class="p">(</span><span class="nx">i</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">res</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span> <span class="p">[]</span> <span class="nx">as</span> <span class="nx">R</span><span class="p">[]);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">filter</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">list</span><span class="o">:</span> <span class="nx">T</span><span class="p">[],</span> <span class="nx">f</span><span class="o">:</span> <span class="p">(</span><span class="nx">i</span><span class="o">:</span> <span class="nx">T</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="kr">boolean</span><span class="p">)</span><span class="o">:</span> <span class="nx">T</span><span class="p">[]</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">list</span><span class="p">.</span><span class="nx">reduce</span><span class="p">((</span><span class="nx">res</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">f</span><span class="p">(</span><span class="nx">i</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">res</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">res</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span> <span class="p">[]</span> <span class="nx">as</span> <span class="nx">T</span><span class="p">[]);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>If one wishes to base the map/filter implementation of the Linked list here on reduce, this is currently not possible. Note that the above code uses push, which is a <strong>modify</strong> operation that is more recommended for immutable state in functional programming. So, is there some way to do this without changing the state? I will try to implement it.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">concat</span><span class="p">&lt;</span><span class="nt">T</span><span class="p">&gt;(</span><span class="nx">a</span>: <span class="kt">List</span><span class="p">&lt;</span><span class="nt">T</span><span class="p">&gt;,</span> <span class="nx">b</span>: <span class="kt">List</span><span class="p">&lt;</span><span class="nt">T</span><span class="p">&gt;)</span><span class="o">:</span> <span class="nx">List</span><span class="p">&lt;</span><span class="nt">T</span><span class="p">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">a</span> <span class="o">===</span> <span class="kc">null</span> <span class="o">?</span> <span class="nx">b</span> : <span class="kt">cons</span><span class="p">(</span><span class="nx">car</span><span class="p">(</span><span class="nx">a</span><span class="p">),</span> <span class="nx">concat</span><span class="p">(</span><span class="nx">cdr</span><span class="p">(</span><span class="nx">a</span><span class="p">),</span> <span class="nx">b</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">mapForReduce</span><span class="p">&lt;</span><span class="nt">T</span><span class="err">,</span> <span class="na">R</span><span class="p">&gt;(</span><span class="nx">arr</span>: <span class="kt">List</span><span class="p">&lt;</span><span class="nt">T</span><span class="p">&gt;,</span> <span class="nx">f</span><span class="o">:</span> <span class="p">(</span><span class="nx">i</span>: <span class="kt">T</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">R</span><span class="p">)</span><span class="o">:</span> <span class="nx">List</span><span class="p">&lt;</span><span class="nt">R</span><span class="p">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">reduce</span><span class="p">(</span><span class="nx">arr</span><span class="p">,</span> <span class="p">(</span><span class="nx">res</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">concat</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span> <span class="nx">list</span><span class="p">(</span><span class="nx">f</span><span class="p">(</span><span class="nx">i</span><span class="p">))),</span> <span class="kc">null</span> <span class="kr">as</span> <span class="nx">List</span><span class="p">&lt;</span><span class="nt">R</span><span class="p">&gt;);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">filterForReduce</span><span class="p">&lt;</span><span class="nt">T</span><span class="p">&gt;(</span><span class="nx">arr</span>: <span class="kt">List</span><span class="p">&lt;</span><span class="nt">T</span><span class="p">&gt;,</span> <span class="nx">f</span><span class="o">:</span> <span class="p">(</span><span class="nx">i</span>: <span class="kt">T</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="kr">boolean</span><span class="p">)</span><span class="o">:</span> <span class="nx">List</span><span class="p">&lt;</span><span class="nt">T</span><span class="p">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">reduce</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="nx">arr</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nx">res</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">f</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="o">?</span> <span class="nx">concat</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span> <span class="nx">list</span><span class="p">(</span><span class="nx">i</span><span class="p">))</span> <span class="o">:</span> <span class="nx">res</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="kc">null</span> <span class="kr">as</span> <span class="nx">List</span><span class="p">&lt;</span><span class="nt">T</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Of course, someone might say: Isn&rsquo;t it inefficient to link two Linked lists each time you iterate over an element? Yes, it is, so there is another, slightly more bizarre, method that can be used.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">mapForReduce</span><span class="p">&lt;</span><span class="nt">T</span><span class="err">,</span> <span class="na">R</span><span class="p">&gt;(</span><span class="nx">list</span>: <span class="kt">List</span><span class="p">&lt;</span><span class="nt">T</span><span class="p">&gt;,</span> <span class="nx">f</span><span class="o">:</span> <span class="p">(</span><span class="nx">i</span>: <span class="kt">T</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">R</span><span class="p">)</span><span class="o">:</span> <span class="nx">List</span><span class="p">&lt;</span><span class="nt">R</span><span class="p">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">reduce</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="nx">list</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nx">res</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="nx">i</span> <span class="o">===</span> <span class="kc">null</span> <span class="o">?</span> <span class="nx">res</span> <span class="o">:</span> <span class="p">(</span><span class="nx">next</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">res</span><span class="p">(</span><span class="nx">cons</span><span class="p">(</span><span class="nx">f</span><span class="p">(</span><span class="nx">i</span><span class="p">),</span> <span class="nx">next</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nx">r</span>: <span class="kt">List</span><span class="p">&lt;</span><span class="nt">R</span><span class="p">&gt;)</span> <span class="o">=&gt;</span> <span class="nx">r</span>
</span></span><span class="line"><span class="cl">  <span class="p">)(</span><span class="kc">null</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">filterForReduce</span><span class="p">&lt;</span><span class="nt">T</span><span class="p">&gt;(</span><span class="nx">list</span>: <span class="kt">List</span><span class="p">&lt;</span><span class="nt">T</span><span class="p">&gt;,</span> <span class="nx">f</span><span class="o">:</span> <span class="p">(</span><span class="nx">i</span>: <span class="kt">T</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="kr">boolean</span><span class="p">)</span><span class="o">:</span> <span class="nx">List</span><span class="p">&lt;</span><span class="nt">T</span><span class="p">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">reduce</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="nx">list</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nx">res</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">f</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="o">?</span> <span class="p">(</span><span class="nx">next</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">res</span><span class="p">(</span><span class="nx">cons</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">next</span><span class="p">))</span> <span class="o">:</span> <span class="nx">res</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nx">r</span>: <span class="kt">List</span><span class="p">&lt;</span><span class="nt">T</span><span class="p">&gt;)</span> <span class="o">=&gt;</span> <span class="nx">r</span>
</span></span><span class="line"><span class="cl">  <span class="p">)(</span><span class="kc">null</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Admittedly, this approach does not seem to accumulate a stack on each recursion, but it also wraps the res function over and over, eventually calling it all at once by passing a single argument at the end of reduce, which does not solve the fundamental problem, so the following implementation of <code>setCar/setCdr</code>.</p>
<h2 id="support-for-modifying-carcdr">Support for modifying car/cdr</h2>
<p>To implement set, you actually have to modify the parameters of the closure binding.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kr">export</span> <span class="kr">interface</span> <span class="nx">Cons</span><span class="p">&lt;</span><span class="nt">A</span><span class="err">,</span> <span class="na">B</span><span class="p">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nx">s</span><span class="o">:</span> <span class="s2">&#34;car&#34;</span><span class="p">)</span><span class="o">:</span> <span class="nx">A</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nx">s</span><span class="o">:</span> <span class="s2">&#34;cdr&#34;</span><span class="p">)</span><span class="o">:</span> <span class="nx">B</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nx">s</span><span class="o">:</span> <span class="s2">&#34;setCar&#34;</span><span class="p">)</span><span class="o">:</span> <span class="p">(</span><span class="nx">v</span>: <span class="kt">A</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nx">s</span><span class="o">:</span> <span class="s2">&#34;setCdr&#34;</span><span class="p">)</span><span class="o">:</span> <span class="p">(</span><span class="nx">v</span>: <span class="kt">B</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">_0</span>: <span class="kt">A</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">_1</span>: <span class="kt">B</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="kd">function</span> <span class="nx">cons</span><span class="p">&lt;</span><span class="nt">A</span><span class="err">,</span> <span class="na">B</span><span class="p">&gt;(</span><span class="nx">a</span>: <span class="kt">A</span><span class="p">,</span> <span class="nx">b</span>: <span class="kt">B</span><span class="p">)</span><span class="o">:</span> <span class="nx">Cons</span><span class="p">&lt;</span><span class="nt">A</span><span class="err">,</span> <span class="na">B</span><span class="p">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="p">((</span><span class="nx">s</span>: <span class="kt">string</span><span class="p">)</span> <span class="o">=&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">s</span> <span class="o">===</span> <span class="s2">&#34;car&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="o">?</span> <span class="nx">a</span>
</span></span><span class="line"><span class="cl">      : <span class="kt">s</span> <span class="o">===</span> <span class="s2">&#34;cdr&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="o">?</span> <span class="nx">b</span>
</span></span><span class="line"><span class="cl">      : <span class="kt">s</span> <span class="o">===</span> <span class="s2">&#34;setCar&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="o">?</span> <span class="p">(</span><span class="nx">v</span>: <span class="kt">A</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">a</span> <span class="o">=</span> <span class="nx">v</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="o">:</span> <span class="p">(</span><span class="nx">v</span>: <span class="kt">B</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">b</span> <span class="o">=</span> <span class="nx">v</span><span class="p">))</span> <span class="kr">as</span> <span class="kt">any</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="kd">function</span> <span class="nx">car</span><span class="p">&lt;</span><span class="nt">T</span> <span class="na">extends</span> <span class="na">Cons</span><span class="err">&lt;</span><span class="na">any</span><span class="err">,</span> <span class="na">any</span><span class="p">&gt;</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">cons</span>: <span class="kt">T</span><span class="p">)</span><span class="o">:</span> <span class="nx">T</span><span class="p">[</span><span class="s2">&#34;_0&#34;</span><span class="p">]</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">cons</span><span class="p">(</span><span class="s2">&#34;car&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="kd">function</span> <span class="nx">cdr</span><span class="p">&lt;</span><span class="nt">T</span> <span class="na">extends</span> <span class="na">Cons</span><span class="err">&lt;</span><span class="na">any</span><span class="err">,</span> <span class="na">any</span><span class="p">&gt;</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">cons</span>: <span class="kt">T</span><span class="p">)</span><span class="o">:</span> <span class="nx">T</span><span class="p">[</span><span class="s2">&#34;_1&#34;</span><span class="p">]</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">cons</span><span class="p">(</span><span class="s2">&#34;cdr&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="kd">function</span> <span class="nx">setCar</span><span class="p">&lt;</span><span class="nt">T</span> <span class="na">extends</span> <span class="na">Cons</span><span class="err">&lt;</span><span class="na">any</span><span class="err">,</span> <span class="na">any</span><span class="p">&gt;</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">cons</span>: <span class="kt">T</span><span class="p">,</span> <span class="nx">v</span>: <span class="kt">T</span><span class="p">[</span><span class="s2">&#34;_0&#34;</span><span class="p">])</span><span class="o">:</span> <span class="k">void</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">cons</span><span class="p">(</span><span class="s2">&#34;setCar&#34;</span><span class="p">)(</span><span class="nx">v</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="kd">function</span> <span class="nx">setCdr</span><span class="p">&lt;</span><span class="nt">T</span> <span class="na">extends</span> <span class="na">Cons</span><span class="err">&lt;</span><span class="na">any</span><span class="err">,</span> <span class="na">any</span><span class="p">&gt;</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">cons</span>: <span class="kt">T</span><span class="p">,</span> <span class="nx">v</span>: <span class="kt">T</span><span class="p">[</span><span class="s2">&#34;_1&#34;</span><span class="p">])</span><span class="o">:</span> <span class="k">void</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">cons</span><span class="p">(</span><span class="s2">&#34;setCdr&#34;</span><span class="p">)(</span><span class="nx">v</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>This can be verified using the following unit tests.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="nx">it</span><span class="p">(</span><span class="s2">&#34;cons&#34;</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">c</span> <span class="o">=</span> <span class="nx">cons</span><span class="p">(</span><span class="s2">&#34;hello&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nx">expect</span><span class="p">(</span><span class="nx">car</span><span class="p">(</span><span class="nx">c</span><span class="p">)</span> <span class="kr">as</span> <span class="kt">string</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="s2">&#34;hello&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nx">expect</span><span class="p">(</span><span class="nx">cdr</span><span class="p">(</span><span class="nx">c</span><span class="p">)</span> <span class="kr">as</span> <span class="kt">number</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nx">setCar</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span> <span class="s2">&#34;liuli&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nx">setCdr</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nx">expect</span><span class="p">(</span><span class="nx">car</span><span class="p">(</span><span class="nx">c</span><span class="p">)</span> <span class="kr">as</span> <span class="kt">string</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="s2">&#34;liuli&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nx">expect</span><span class="p">(</span><span class="nx">cdr</span><span class="p">(</span><span class="nx">c</span><span class="p">)</span> <span class="kr">as</span> <span class="kt">number</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>However, an alternative implementation is proposed in the course, which is implemented entirely using higher-order functions and does not use internal judgments in cons.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kr">export</span> <span class="kr">interface</span> <span class="nx">Cons</span><span class="p">&lt;</span><span class="nt">A</span><span class="err">,</span> <span class="na">B</span><span class="p">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nx">m</span><span class="o">:</span> <span class="p">(</span><span class="nx">a</span>: <span class="kt">A</span><span class="p">,</span> <span class="nx">b</span>: <span class="kt">B</span><span class="p">,</span> <span class="nx">setA</span><span class="o">:</span> <span class="p">(</span><span class="nx">a</span>: <span class="kt">A</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="p">,</span> <span class="nx">setB</span><span class="o">:</span> <span class="p">(</span><span class="nx">b</span>: <span class="kt">B</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="kt">any</span><span class="p">)</span><span class="o">:</span> <span class="kt">any</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">_0</span>: <span class="kt">A</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">_1</span>: <span class="kt">B</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="kd">function</span> <span class="nx">cons</span><span class="p">&lt;</span><span class="nt">A</span><span class="err">,</span> <span class="na">B</span><span class="p">&gt;(</span><span class="nx">a</span>: <span class="kt">A</span><span class="p">,</span> <span class="nx">b</span>: <span class="kt">B</span><span class="p">)</span><span class="o">:</span> <span class="nx">Cons</span><span class="p">&lt;</span><span class="nt">A</span><span class="err">,</span> <span class="na">B</span><span class="p">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="p">((</span>
</span></span><span class="line"><span class="cl">    <span class="nx">m</span><span class="o">:</span> <span class="p">(</span><span class="nx">a</span>: <span class="kt">A</span><span class="p">,</span> <span class="nx">b</span>: <span class="kt">B</span><span class="p">,</span> <span class="nx">setA</span><span class="o">:</span> <span class="p">(</span><span class="nx">a</span>: <span class="kt">A</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="p">,</span> <span class="nx">setB</span><span class="o">:</span> <span class="p">(</span><span class="nx">b</span>: <span class="kt">B</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="kt">any</span>
</span></span><span class="line"><span class="cl">  <span class="p">)</span> <span class="o">=&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">m</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">      <span class="nx">a</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">b</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nx">n</span>: <span class="kt">A</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">a</span> <span class="o">=</span> <span class="nx">n</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nx">n</span>: <span class="kt">B</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">b</span> <span class="o">=</span> <span class="nx">n</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">))</span> <span class="kr">as</span> <span class="kt">any</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="kd">function</span> <span class="nx">car</span><span class="p">&lt;</span><span class="nt">T</span> <span class="na">extends</span> <span class="na">Cons</span><span class="err">&lt;</span><span class="na">any</span><span class="err">,</span> <span class="na">any</span><span class="p">&gt;</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">cons</span>: <span class="kt">T</span><span class="p">)</span><span class="o">:</span> <span class="nx">T</span><span class="p">[</span><span class="s2">&#34;_0&#34;</span><span class="p">]</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">cons</span><span class="p">((</span><span class="nx">a</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">a</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="kd">function</span> <span class="nx">cdr</span><span class="p">&lt;</span><span class="nt">T</span> <span class="na">extends</span> <span class="na">Cons</span><span class="err">&lt;</span><span class="na">any</span><span class="err">,</span> <span class="na">any</span><span class="p">&gt;</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">cons</span>: <span class="kt">T</span><span class="p">)</span><span class="o">:</span> <span class="nx">T</span><span class="p">[</span><span class="s2">&#34;_1&#34;</span><span class="p">]</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">cons</span><span class="p">((</span><span class="nx">_a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">b</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="kd">function</span> <span class="nx">setCar</span><span class="p">&lt;</span><span class="nt">T</span> <span class="na">extends</span> <span class="na">Cons</span><span class="err">&lt;</span><span class="na">any</span><span class="err">,</span> <span class="na">any</span><span class="p">&gt;</span><span class="o">&gt;</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="nx">cons</span>: <span class="kt">T</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">value</span>: <span class="kt">T</span><span class="p">[</span><span class="s2">&#34;_0&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span><span class="o">:</span> <span class="k">void</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">cons</span><span class="p">((</span><span class="nx">_a</span><span class="p">,</span> <span class="nx">_b</span><span class="p">,</span> <span class="nx">setA</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">setA</span><span class="p">(</span><span class="nx">value</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="kd">function</span> <span class="nx">setCdr</span><span class="p">&lt;</span><span class="nt">T</span> <span class="na">extends</span> <span class="na">Cons</span><span class="err">&lt;</span><span class="na">any</span><span class="err">,</span> <span class="na">any</span><span class="p">&gt;</span><span class="o">&gt;</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="nx">cons</span>: <span class="kt">T</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">value</span>: <span class="kt">T</span><span class="p">[</span><span class="s2">&#34;_1&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span><span class="o">:</span> <span class="k">void</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">cons</span><span class="p">((</span><span class="nx">_a</span><span class="p">,</span> <span class="nx">_b</span><span class="p">,</span> <span class="nx">_setA</span><span class="p">,</span> <span class="nx">setB</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">setB</span><span class="p">(</span><span class="nx">value</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Now, re-implement mapForReduce/filterForReduce.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">mapForReduce</span><span class="p">&lt;</span><span class="nt">T</span><span class="err">,</span> <span class="na">R</span><span class="p">&gt;(</span><span class="nx">list</span>: <span class="kt">List</span><span class="p">&lt;</span><span class="nt">T</span><span class="p">&gt;,</span> <span class="nx">f</span><span class="o">:</span> <span class="p">(</span><span class="nx">i</span>: <span class="kt">T</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">R</span><span class="p">)</span><span class="o">:</span> <span class="nx">List</span><span class="p">&lt;</span><span class="nt">R</span><span class="p">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">init</span> <span class="o">=</span> <span class="nx">cons</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">)</span> <span class="kr">as</span> <span class="kt">unknown</span> <span class="kr">as</span> <span class="nx">List</span><span class="p">&lt;</span><span class="nt">R</span><span class="p">&gt;;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">reduce</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="nx">list</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nx">curr</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="kr">const</span> <span class="nx">next</span> <span class="o">=</span> <span class="nx">cons</span><span class="p">(</span><span class="nx">f</span><span class="p">(</span><span class="nx">i</span><span class="p">),</span> <span class="kc">null</span><span class="p">)</span> <span class="kr">as</span> <span class="nx">List</span><span class="p">&lt;</span><span class="nt">R</span><span class="p">&gt;;</span>
</span></span><span class="line"><span class="cl">      <span class="nx">setCdr</span><span class="p">(</span><span class="nx">curr</span><span class="o">!</span><span class="p">,</span> <span class="nx">next</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="nx">next</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nx">init</span>
</span></span><span class="line"><span class="cl">  <span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">cdr</span><span class="p">(</span><span class="nx">init</span><span class="o">!</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">filterForReduce</span><span class="p">&lt;</span><span class="nt">T</span><span class="p">&gt;(</span><span class="nx">list</span>: <span class="kt">List</span><span class="p">&lt;</span><span class="nt">T</span><span class="p">&gt;,</span> <span class="nx">f</span><span class="o">:</span> <span class="p">(</span><span class="nx">i</span>: <span class="kt">T</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="kr">boolean</span><span class="p">)</span><span class="o">:</span> <span class="nx">List</span><span class="p">&lt;</span><span class="nt">T</span><span class="p">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">init</span> <span class="o">=</span> <span class="nx">cons</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">)</span> <span class="kr">as</span> <span class="kt">unknown</span> <span class="kr">as</span> <span class="nx">List</span><span class="p">&lt;</span><span class="nt">T</span><span class="p">&gt;;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">reduce</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="nx">list</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nx">curr</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">f</span><span class="p">(</span><span class="nx">i</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nx">curr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="kr">const</span> <span class="nx">next</span> <span class="o">=</span> <span class="nx">cons</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="kc">null</span><span class="p">)</span> <span class="kr">as</span> <span class="nx">List</span><span class="p">&lt;</span><span class="nt">T</span><span class="p">&gt;;</span>
</span></span><span class="line"><span class="cl">      <span class="nx">setCdr</span><span class="p">(</span><span class="nx">curr</span><span class="o">!</span><span class="p">,</span> <span class="nx">next</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="nx">next</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nx">init</span>
</span></span><span class="line"><span class="cl">  <span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">cdr</span><span class="p">(</span><span class="nx">init</span><span class="o">!</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>For the code <code>mapForReduce(list(1, 2, 3, 4), i =&gt; i)</code> the iterative process is plotted.</p>
<table>
<thead>
<tr>
<th>i</th>
<th>curr</th>
<th>init</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>(null, null)</td>
<td>(null, null)</td>
</tr>
<tr>
<td>2</td>
<td>(1, null)</td>
<td>(null, (1, null))</td>
</tr>
<tr>
<td>3</td>
<td>(2, null)</td>
<td>(null, (1, (2, null)))</td>
</tr>
<tr>
<td>4</td>
<td>(3, null)</td>
<td>(null, (1, (2, (3, null))))</td>
</tr>
<tr>
<td>return</td>
<td></td>
<td>(null, (1, (2, (3, (4, null)))))</td>
</tr>
</tbody>
</table>
<p>As you can see, each time the previous node is modified and the current value is used to construct a new node with cons as the next iteration value, the entire list is eventually traversed and a copy of the entire list is made.</p>
<h2 id="trees">Trees</h2>
<p>Since you can construct a Linked List via cons, you can naturally construct a tree structure as well, just by defining a tree structure.</p>
<p>A node is composed of a value and possible children, so we define a tree node this way.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="nx">cons</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">list</span><span class="p">(</span><span class="nx">sub1</span><span class="p">,</span> <span class="nx">sub2</span><span class="p">,</span> <span class="p">...</span><span class="nx">subN</span><span class="p">));</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/06/10/01acf819ff8145cca2049d0fe5edfeaa.png" alt="tree"></p>
<p>Very simple to implement.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kr">type</span> <span class="nx">Tree</span><span class="p">&lt;</span><span class="nt">T</span><span class="p">&gt;</span> <span class="o">=</span> <span class="nx">Cons</span><span class="p">&lt;</span><span class="nt">T</span><span class="err">,</span> <span class="na">List</span><span class="err">&lt;</span><span class="na">Tree</span><span class="err">&lt;</span><span class="na">T</span><span class="p">&gt;</span><span class="o">&gt;&gt;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">tree</span><span class="p">&lt;</span><span class="nt">T</span><span class="p">&gt;(</span><span class="nx">value</span>: <span class="kt">T</span><span class="p">,</span> <span class="nx">children</span>: <span class="kt">List</span><span class="p">&lt;</span><span class="nt">Tree</span><span class="err">&lt;</span><span class="na">T</span><span class="p">&gt;</span><span class="o">&gt;</span> <span class="o">=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">cons</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">children</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">t</span> <span class="o">=</span> <span class="nx">tree</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nx">list</span><span class="p">(</span><span class="nx">tree</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nx">list</span><span class="p">(</span><span class="nx">tree</span><span class="p">(</span><span class="mi">3</span><span class="p">))),</span> <span class="nx">tree</span><span class="p">(</span><span class="mi">4</span><span class="p">)));</span>
</span></span><span class="line"><span class="cl"><span class="nx">expect</span><span class="p">(</span><span class="nx">car</span><span class="p">(</span><span class="nx">t</span><span class="p">)).</span><span class="nx">toBe</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">expect</span><span class="p">(</span><span class="nx">car</span><span class="p">(</span><span class="nx">car</span><span class="p">(</span><span class="nx">cdr</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span><span class="o">!</span><span class="p">))).</span><span class="nx">toBe</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>It is also possible to implement map/filter/reduce for tree structures, as you can see the previous implementations are simple list-based map/filter implementations.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">treeReduce</span><span class="p">&lt;</span><span class="nt">T</span><span class="err">,</span> <span class="na">R</span><span class="p">&gt;(</span><span class="nx">tree</span>: <span class="kt">Tree</span><span class="p">&lt;</span><span class="nt">T</span><span class="p">&gt;,</span> <span class="nx">f</span><span class="o">:</span> <span class="p">(</span><span class="nx">r</span>: <span class="kt">R</span><span class="p">,</span> <span class="nx">v</span>: <span class="kt">T</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">R</span><span class="p">,</span> <span class="nx">init</span>: <span class="kt">R</span><span class="p">)</span><span class="o">:</span> <span class="nx">R</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">init</span> <span class="o">=</span> <span class="nx">f</span><span class="p">(</span><span class="nx">init</span><span class="p">,</span> <span class="nx">car</span><span class="p">(</span><span class="nx">tree</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">  <span class="nx">map</span><span class="p">(</span><span class="nx">cdr</span><span class="p">(</span><span class="nx">tree</span><span class="p">),</span> <span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">init</span> <span class="o">=</span> <span class="nx">treeReduce</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">f</span><span class="p">,</span> <span class="nx">init</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">init</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">treeMap</span><span class="p">&lt;</span><span class="nt">T</span><span class="err">,</span> <span class="na">R</span><span class="p">&gt;(</span><span class="nx">tree</span>: <span class="kt">Tree</span><span class="p">&lt;</span><span class="nt">T</span><span class="p">&gt;,</span> <span class="nx">f</span><span class="o">:</span> <span class="p">(</span><span class="nx">v</span>: <span class="kt">T</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">R</span><span class="p">)</span><span class="o">:</span> <span class="nx">Tree</span><span class="p">&lt;</span><span class="nt">R</span><span class="p">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">cons</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="nx">f</span><span class="p">(</span><span class="nx">car</span><span class="p">(</span><span class="nx">tree</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">    <span class="nx">map</span><span class="p">(</span><span class="nx">cdr</span><span class="p">(</span><span class="nx">tree</span><span class="p">)</span><span class="o">!</span><span class="p">,</span> <span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">treeMap</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">f</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">treeFilter</span><span class="p">&lt;</span><span class="nt">T</span><span class="p">&gt;(</span><span class="nx">tree</span>: <span class="kt">Tree</span><span class="p">&lt;</span><span class="nt">T</span><span class="p">&gt;,</span> <span class="nx">f</span><span class="o">:</span> <span class="p">(</span><span class="nx">v</span>: <span class="kt">T</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="kr">boolean</span><span class="p">)</span><span class="o">:</span> <span class="nx">Tree</span><span class="p">&lt;</span><span class="nt">T</span><span class="p">&gt;</span> <span class="o">|</span> <span class="kc">null</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">f</span><span class="p">(</span><span class="nx">car</span><span class="p">(</span><span class="nx">tree</span><span class="p">)))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">cons</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="nx">car</span><span class="p">(</span><span class="nx">tree</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="nx">filter</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">      <span class="nx">map</span><span class="p">(</span><span class="nx">cdr</span><span class="p">(</span><span class="nx">tree</span><span class="p">)</span><span class="o">!</span><span class="p">,</span> <span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">treeFilter</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">f</span><span class="p">)</span><span class="o">!</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">i</span> <span class="o">!==</span> <span class="kc">null</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Test it.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">t</span> <span class="o">=</span> <span class="nx">tree</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nx">list</span><span class="p">(</span><span class="nx">tree</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nx">list</span><span class="p">(</span><span class="nx">tree</span><span class="p">(</span><span class="mi">3</span><span class="p">))),</span> <span class="nx">tree</span><span class="p">(</span><span class="mi">4</span><span class="p">)));</span>
</span></span><span class="line"><span class="cl"><span class="nx">it</span><span class="p">(</span><span class="s2">&#34;basic&#34;</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">expect</span><span class="p">(</span><span class="nx">car</span><span class="p">(</span><span class="nx">t</span><span class="p">)).</span><span class="nx">toBe</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nx">expect</span><span class="p">(</span><span class="nx">car</span><span class="p">(</span><span class="nx">car</span><span class="p">(</span><span class="nx">cdr</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span><span class="o">!</span><span class="p">))).</span><span class="nx">toBe</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="nx">it</span><span class="p">(</span><span class="s2">&#34;treeReduce&#34;</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">expect</span><span class="p">(</span><span class="nx">treeReduce</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">[...</span><span class="nx">r</span><span class="p">,</span> <span class="nx">i</span><span class="p">],</span> <span class="p">[]</span> <span class="kr">as</span> <span class="kt">number</span><span class="p">[])).</span><span class="nx">toEqual</span><span class="p">([</span>
</span></span><span class="line"><span class="cl">    <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">]);</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="nx">it</span><span class="p">(</span><span class="s2">&#34;treeMap&#34;</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">expect</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="nx">treeReduce</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">      <span class="nx">treeMap</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">i</span> <span class="o">*</span> <span class="mi">2</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">[...</span><span class="nx">r</span><span class="p">,</span> <span class="nx">i</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="p">[]</span> <span class="kr">as</span> <span class="kt">number</span><span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">).</span><span class="nx">toEqual</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">].</span><span class="nx">map</span><span class="p">((</span><span class="nx">i</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">i</span> <span class="o">*</span> <span class="mi">2</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="nx">it</span><span class="p">(</span><span class="s2">&#34;treeFilter&#34;</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">res</span> <span class="o">=</span> <span class="nx">treeFilter</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">===</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nx">expect</span><span class="p">(</span><span class="nx">treeReduce</span><span class="p">(</span><span class="nx">res</span><span class="o">!</span><span class="p">,</span> <span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">[...</span><span class="nx">r</span><span class="p">,</span> <span class="nx">i</span><span class="p">],</span> <span class="p">[]</span> <span class="kr">as</span> <span class="kt">number</span><span class="p">[])).</span><span class="nx">toEqual</span><span class="p">([</span><span class="mi">1</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="conclusion">Conclusion</h2>
<p>lisp is a seemingly simple language, because it seems to be all about expressions, and it doesn&rsquo;t offer as many ways to construct complex data (like object objects, structs, classes, etc.) as modern languages. But as you can see here, it is possible to construct arbitrarily complex data structures by supporting the simplest complex data, and the building blocks of all complex data are so simple as to be unbelievable.</p>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/lisp/">Lisp</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2022-06/github-atom/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Microsoft GitHub Announces &#34;Phasing Out&#34; of Atom Code Editor! The focus will shift to VSCode</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2022-06/kubeseal/">
            <span class="next-text nav-default">Using kubeseal to encrypt and manage secrets for k8s clusters</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  <script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox-3.1.20.min.js"></script>



<script type="text/javascript" src="/js/main.min.64437849d125a2d603b3e71d6de5225d641a32d17168a58106e0b61852079683.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
