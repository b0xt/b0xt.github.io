<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Instant Performance Analysis Tool Pyroscope - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="Learn how to use Pyroscope to analyze performance issues in golang." /><meta name="keywords" content="Pyroscope, golang" />






<meta name="generator" content="Hugo 0.101.0 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2022-06/pyroscope/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link href="/lib/fancybox/jquery.fancybox-3.1.20.min.css" rel="stylesheet">


<meta property="og:title" content="Instant Performance Analysis Tool Pyroscope" />
<meta property="og:description" content="Learn how to use Pyroscope to analyze performance issues in golang." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2022-06/pyroscope/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-06-01T17:34:44+08:00" />
<meta property="article:modified_time" content="2022-06-01T17:34:44+08:00" />

<meta itemprop="name" content="Instant Performance Analysis Tool Pyroscope">
<meta itemprop="description" content="Learn how to use Pyroscope to analyze performance issues in golang."><meta itemprop="datePublished" content="2022-06-01T17:34:44+08:00" />
<meta itemprop="dateModified" content="2022-06-01T17:34:44+08:00" />
<meta itemprop="wordCount" content="493">
<meta itemprop="keywords" content="golang," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Instant Performance Analysis Tool Pyroscope"/>
<meta name="twitter:description" content="Learn how to use Pyroscope to analyze performance issues in golang."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SOBYTE</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SOBYTE</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Instant Performance Analysis Tool Pyroscope</h1>

      <div class="post-meta">
        <span class="post-time"> 2022-06-01 17:34:44 </span>
        <div class="post-category">
            <a href="/categories/tutorials/"> tutorials </a>
            </div>
          <span class="more-meta"> 493 words </span>
          <span class="more-meta"> 3 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#what-is-pyroscope">What is Pyroscope?</a></li>
        <li><a href="#pyroscope-architecture">Pyroscope Architecture</a></li>
        <li><a href="#start-pyroscope-service">Start Pyroscope service</a></li>
        <li><a href="#installing-agent-in-go">Installing agent in Go</a></li>
        <li><a href="#summary">Summary</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>When the website is online, the increase of traffic or temporary function failure will cause the user experience is quite bad, and how to find the bottleneck of performance quickly? Usually when the CPU is rushed to 100%, it is sometimes quite difficult to replicate and find out the key problem points. This article will introduce a set of tools called <a href="https://pyroscope.io/">pyroscope</a>, which allows developers to quickly find the code of performance bottlenecks.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/06/01/0648ee6fcca14dac8538c8bd815132d9.png" alt="Pyroscope"></p>
<p>pyroscope currently supports the <a href="https://www.python.org/">Python</a>, <a href="https://www.ruby-lang.org/en/">Ruby</a> or <a href="https://golang.org/">Go</a> environments. The author will introduce the Go environment below.</p>
<h2 id="what-is-pyroscope">What is Pyroscope?</h2>
<p>Pyroscope is an open source performance monitoring platform with a simple Server and Agent architecture that allows developers to easily monitor code performance. Whether you are looking for performance data within 10 seconds or minutes, you can quickly and instantly see it. The storage behind Pyroscope uses <a href="https://github.com/dgraph-io/badger">Badger</a>, a Key-Value database, and the performance is very good. Currently, only 3 languages are supported (Python, Ruby and Go) and NodeJS is expected to be supported in the <a href="https://github.com/pyroscope-io/pyroscope/issues/8">future</a>. If you have not yet imported any performance analysis tool or platform, Pyroscope is your best choice.</p>
<h2 id="pyroscope-architecture">Pyroscope Architecture</h2>
<p>If you are looking for a performance analysis tool platform, Pyroscope offers three major advantages that developers can use with confidence</p>
<ol>
<li>low CPU usage, no impact on existing platforms</li>
<li>the ability to store years of data and look at it at a granularity as small as 10 seconds</li>
<li>compressed data storage, reducing wasted hard disk space</li>
</ol>
<p>The architecture is only divided into Server and Agent, you can refer to the following architecture diagram. In addition to the Go language, Python and Ruby App both use the pyroscope command to start the relevant app to monitor the system performance. The following architecture diagram <a href="https://pyroscope.io/docs/how-pyroscope-works">from the official website</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/06/01/77629581d4f94343864cb42d4a1be832.png" alt="Pyroscope Architecture"></p>
<h2 id="start-pyroscope-service">Start Pyroscope service</h2>
<p>There are two ways to start Pyroscope, the first is to start it directly with the docker command</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">docker run -it -p 4040:4040 pyroscope/pyroscope:latest server
</span></span></code></pre></td></tr></table>
</div>
</div><p>Another option is to use docker-compose to start</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yml" data-lang="yml"><span class="line"><span class="cl"><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">services</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">pyroscope</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;pyroscope/pyroscope:latest&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="s2">&#34;4040:4040&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="s2">&#34;server&#34;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="installing-agent-in-go">Installing agent in Go</h2>
<p>This article uses the Go language as an example, first import package</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">import</span> <span class="s">&#34;github.com/pyroscope-io/pyroscope/pkg/agent/profiler&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Then just write the following code in <code>main.go</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">profiler</span><span class="p">.</span><span class="nf">Start</span><span class="p">(</span><span class="nx">profiler</span><span class="p">.</span><span class="nx">Config</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">ApplicationName</span><span class="p">:</span> <span class="s">&#34;simple.golang.app&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">ServerAddress</span><span class="p">:</span>   <span class="s">&#34;http://pyroscope:4040&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>You can replace <code>http://pyroscope</code> with a custom hostname, and then open the above URL to see the performance monitoring screen.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/06/01/d990d51046dd4dd79986f4e473425009.png" alt="performance monitoring screen"></p>
<p>The screen allows you to quickly find out which SQL or function is taking too long to execute.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/06/01/cbbc43a73e454e7dad11a5f9d40d9126.png" alt="performance monitoring screen"></p>
<h2 id="summary">Summary</h2>
<p>This set of tools is very convenient, in Go language although you can use pprof to quickly find the problem, but inevitably still need to manually some places to find out the performance bottleneck, with this set of platform, you can monitor all the App, when the user has any problems, you can quickly check through Pyroscope to see which side of the code has problems.</p>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/golang/">golang</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2022-06/windows-msdt-zero-day-now-exploited/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Windows high-risk 0day vulnerability: &#34;Follina&#34;</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2022-06/signal-channel/">
            <span class="next-text nav-default">Why does signal.Notify use buffered channel?</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  <script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox-3.1.20.min.js"></script>



<script type="text/javascript" src="/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js"></script>








</body>
</html>
