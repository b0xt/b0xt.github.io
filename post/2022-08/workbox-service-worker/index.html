<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Getting Started with Service Worker - Rapid Development of Service Worker with Workbox - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="Learn how to use Workbox to quickly develop Service Worker." /><meta name="keywords" content="Workbox, Service Worker" />






<meta name="generator" content="Hugo 0.101.0 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2022-08/workbox-service-worker/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link href="/lib/fancybox/jquery.fancybox-3.1.20.min.css" rel="stylesheet">


<meta property="og:title" content="Getting Started with Service Worker - Rapid Development of Service Worker with Workbox" />
<meta property="og:description" content="Learn how to use Workbox to quickly develop Service Worker." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2022-08/workbox-service-worker/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-08-05T16:25:59+08:00" />
<meta property="article:modified_time" content="2022-08-05T16:25:59+08:00" />

<meta itemprop="name" content="Getting Started with Service Worker - Rapid Development of Service Worker with Workbox">
<meta itemprop="description" content="Learn how to use Workbox to quickly develop Service Worker."><meta itemprop="datePublished" content="2022-08-05T16:25:59+08:00" />
<meta itemprop="dateModified" content="2022-08-05T16:25:59+08:00" />
<meta itemprop="wordCount" content="1588">
<meta itemprop="keywords" content="javascript," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Getting Started with Service Worker - Rapid Development of Service Worker with Workbox"/>
<meta name="twitter:description" content="Learn how to use Workbox to quickly develop Service Worker."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SOBYTE</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SOBYTE</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Getting Started with Service Worker - Rapid Development of Service Worker with Workbox</h1>

      <div class="post-meta">
        <span class="post-time"> 2022-08-05 16:25:59 </span>
        <div class="post-category">
            <a href="/categories/tutorials/"> tutorials </a>
            </div>
          <span class="more-meta"> 1588 words </span>
          <span class="more-meta"> 4 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#registering-a-service-worker">Registering a Service Worker</a></li>
        <li><a href="#workbox-policy">Workbox Policy</a>
          <ul>
            <li><a href="#stale-while-revalidate">Stale While Revalidate</a></li>
            <li><a href="#network-first">Network First</a></li>
            <li><a href="#cache-first">Cache First</a></li>
            <li><a href="#network-only">Network Only</a></li>
            <li><a href="#cache-only">Cache Only</a></li>
            <li><a href="#policy-configuration">Policy Configuration</a></li>
          </ul>
        </li>
        <li><a href="#custom-policies-in-workbox">Custom Policies in Workbox</a></li>
        <li><a href="#workbox-practices">Workbox Practices</a>
          <ul>
            <li><a href="#google-fonts">Google Fonts</a></li>
            <li><a href="#jsdelivr-cdn">jsDelivr CDN</a></li>
            <li><a href="#google-analytics">Google Analytics</a></li>
            <li><a href="#pictures">Pictures</a></li>
            <li><a href="#links">Links</a></li>
            <li><a href="#disqus-comments">Disqus Comments</a></li>
            <li><a href="#suffix-matching">Suffix Matching</a></li>
            <li><a href="#default-behavior">Default behavior</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/08/05/d25c9dbf11c74efdb97ac9b2c9868cae.png" alt="Workbox"></p>
<p>For optimizing front-end loading performance, many people use http-cache, asynchronous loading, 304 status codes, file compression, CDN and other methods to solve the problem.
In fact, in addition to these methods, there is one more powerful than all of them, and that is Service Worker.</p>
<p>We can use Google Chrome team&rsquo;s <a href="https://github.com/GoogleChrome/workbox">Workbox</a> to implement Service Worker for rapid development.</p>
<h2 id="registering-a-service-worker">Registering a Service Worker</h2>
<p>Add the following to the page to register a Service Worker.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 检测是否支持 Service Worker
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1">// 也可使用 navigator.serviceWorker 判断
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;serviceWorker&#39;</span> <span class="k">in</span> <span class="nx">navigator</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 为了保证首屏渲染性能，在页面 onload 完之后注册 Service Worker
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// 不使用 window.onload 以免冲突
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;load&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">navigator</span><span class="p">.</span><span class="nx">serviceWorker</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s1">&#39;/sw.js&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="err">/script&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Of course, you need to have a Service Worker code <code>/sw.js</code> before you can do that.</p>
<p>You can write the following code in this file to check if the Service Worker is successfully registered.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">clear</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Successful registered service worker.&#39;</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/08/05/f17bc5f3fe6647c8b36345324252a5b8.png" alt="service worker"></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">importScripts</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;https://storage.googleapis.com/workbox-cdn/releases/6.1.1/workbox-sw.js&#39;</span>
</span></span><span class="line"><span class="cl"><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>If you think Google&rsquo;s CDN is not very reliable, you can use <code>workbox-cli</code> to store the resources locally.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">npm</span> <span class="nx">i</span> <span class="nx">workbox</span><span class="o">-</span><span class="nx">cli</span> <span class="o">-</span><span class="nx">g</span>
</span></span><span class="line"><span class="cl"><span class="nx">workbox</span> <span class="nx">copyLibraries</span> <span class="p">{</span><span class="nx">path</span><span class="o">/</span><span class="nx">to</span><span class="o">/</span><span class="nx">workbox</span><span class="o">/</span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In this case, you need to replace the content written above at the beginning of <code>sw.js</code> with the following</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">importScripts</span><span class="p">(</span><span class="s1">&#39;{path/to}/workbox/workbox-sw.js&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">workbox</span><span class="p">.</span><span class="nx">setConfig</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">modulePathPrefix</span><span class="o">:</span> <span class="s1">&#39;{path/to}/workbox/&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="workbox-policy">Workbox Policy</h2>
<h3 id="stale-while-revalidate">Stale While Revalidate</h3>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/08/05/85d8f99c11ca46b096b72bd24894b26a.png" alt="Stale While Revalidate"></p>
<p>This policy will respond to network requests using a cache (if available) and update the cache in the background. If it is not cached, it will wait for a network response and use it.
This is a fairly safe policy because it means that the user will update its cache periodically. The disadvantage of this policy is that it always requests resources from the network, which is more wasteful of the user&rsquo;s bandwidth.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">registerRoute</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="nx">matchString</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">  <span class="k">new</span> <span class="nx">workbox</span><span class="p">.</span><span class="nx">strategies</span><span class="p">.</span><span class="nx">StaleWhileRevalidate</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="network-first">Network First</h3>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/08/05/31e82a33ffeb457bb77b58b723f61906.png" alt="Network First"></p>
<p>This policy will try to get a response from the network first. If a response is received, it will pass it to the browser and save it to the cache. If the network request fails, the last cached response will be used.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">registerRoute</span><span class="p">(</span><span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="nx">matchString</span><span class="p">),</span> <span class="k">new</span> <span class="nx">workbox</span><span class="p">.</span><span class="nx">strategies</span><span class="p">.</span><span class="nx">NetworkFirst</span><span class="p">());</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="cache-first">Cache First</h3>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/08/05/cf75fdc10a9a415fb080df6000821762.png" alt="Cache First"></p>
<p>This policy will first check to see if there is a response in the cache and if so, use the policy. If the request is not in the cache, the network will be used and any valid response will be added to the cache before being passed to the browser.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">registerRoute</span><span class="p">(</span><span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="nx">matchString</span><span class="p">),</span> <span class="k">new</span> <span class="nx">workbox</span><span class="p">.</span><span class="nx">strategies</span><span class="p">.</span><span class="nx">CacheFirst</span><span class="p">());</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="network-only">Network Only</h3>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/08/05/f7f10a670d224fe5b2a5b15705839f4e.png" alt="Network Only"></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">registerRoute</span><span class="p">(</span><span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="nx">matchString</span><span class="p">),</span> <span class="k">new</span> <span class="nx">workbox</span><span class="p">.</span><span class="nx">strategies</span><span class="p">.</span><span class="nx">NetworkOnly</span><span class="p">());</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Forced to let the response come from the network.</p>
<h3 id="cache-only">Cache Only</h3>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/08/05/0ebaf6458da3401784a8b8d12a2a06d5.png" alt="Cache Only"></p>
<p>Force the response to come from the cache.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">registerRoute</span><span class="p">(</span><span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="nx">matchString</span><span class="p">),</span> <span class="k">new</span> <span class="nx">workbox</span><span class="p">.</span><span class="nx">strategies</span><span class="p">.</span><span class="nx">CacheOnly</span><span class="p">());</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="policy-configuration">Policy Configuration</h3>
<p>You can customize the behavior of the route by defining the plugins to be used.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="k">new</span> <span class="nx">workbox</span><span class="p">.</span><span class="nx">strategies</span><span class="p">.</span><span class="nx">StaleWhileRevalidate</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Use a custom cache for this route.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">cacheName</span><span class="o">:</span> <span class="s1">&#39;my-cache-name&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Add an array of custom plugins (e.g. `ExpirationPlugin`).
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="p">...</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="custom-policies-in-workbox">Custom Policies in Workbox</h2>
<p>In some cases, you may want to use your own alternative policy to respond to requests, or just generate requests in the Service Worker via a template.
To do this, you can provide a function <code>handler</code> that returns a <code>Response</code> object asynchronously.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">handler</span> <span class="o">=</span> <span class="kr">async</span> <span class="p">({</span> <span class="nx">url</span><span class="p">,</span> <span class="nx">event</span> <span class="p">})</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="k">new</span> <span class="nx">Response</span><span class="p">(</span><span class="sb">`Custom handler response.`</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">workbox</span><span class="p">.</span><span class="nx">routing</span><span class="p">.</span><span class="nx">registerRoute</span><span class="p">(</span><span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="nx">matchString</span><span class="p">),</span> <span class="nx">handler</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Note that if a value is returned in a <code>match</code> callback, it passes <code>handler</code> as a <code>params</code> parameter to the callback.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">match</span> <span class="o">=</span> <span class="p">({</span> <span class="nx">url</span><span class="p">,</span> <span class="nx">event</span> <span class="p">})</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nx">url</span><span class="p">.</span><span class="nx">pathname</span> <span class="o">===</span> <span class="s1">&#39;/example&#39;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Workbox&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;guide&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">handler</span> <span class="o">=</span> <span class="kr">async</span> <span class="p">({</span> <span class="nx">url</span><span class="p">,</span> <span class="nx">event</span><span class="p">,</span> <span class="nx">params</span> <span class="p">})</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// Response will be &#34;A guide to Workbox&#34;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">return</span> <span class="k">new</span> <span class="nx">Response</span><span class="p">(</span><span class="sb">`A </span><span class="si">${</span><span class="nx">params</span><span class="p">.</span><span class="nx">type</span><span class="si">}</span><span class="sb"> to </span><span class="si">${</span><span class="nx">params</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">workbox</span><span class="p">.</span><span class="nx">routing</span><span class="p">.</span><span class="nx">registerRoute</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">handler</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>It may be useful for <code>handler</code> if some information in the URL can be parsed once in the match callback and used in it.</p>
<h2 id="workbox-practices">Workbox Practices</h2>
<p>For most projects that use Workbox, you will usually introduce the appropriate gulp or webpack plugin, register the Service Worker in the build process, Precache the specified URL, generate sw.js, and so on.
But for static site generators like Hexo, Jekyll, or CMSs like WordPress or Typecho, if you don&rsquo;t install the corresponding plugins, you need to write a <code>sw.js</code> from scratch.</p>
<p>Let&rsquo;s write the general configuration first.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">cacheSuffixVersion</span> <span class="o">=</span> <span class="s1">&#39;-210227&#39;</span><span class="p">;</span> <span class="c1">// 缓存版本号
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">maxEntries</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span> <span class="c1">// 最大条目数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="nx">core</span><span class="p">.</span><span class="nx">setCacheNameDetails</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">prefix</span><span class="o">:</span> <span class="s1">&#39;baoshuo-blog&#39;</span><span class="p">,</span> <span class="c1">// 前缀
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">suffix</span><span class="o">:</span> <span class="nx">cacheSuffixVersion</span><span class="p">,</span> <span class="c1">// 后缀
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">});</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="google-fonts">Google Fonts</h3>
<p>Google Fonts uses two main domains: <code>fonts.googleapis.com</code> and <code>fonts.gstatic.com</code>, so only caching is required when these two domains are matched.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">workbox</span><span class="p">.</span><span class="nx">routing</span><span class="p">.</span><span class="nx">registerRoute</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 匹配 fonts.googleapis.com 和 fonts.gstatic.com 两个域名
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s1">&#39;^https://(?:fonts\\.googleapis\\.com|fonts\\.gstatic\\.com)&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">  <span class="k">new</span> <span class="nx">workbox</span><span class="p">.</span><span class="nx">strategies</span><span class="p">.</span><span class="nx">StaleWhileRevalidate</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// cache storage 名称和版本号
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">cacheName</span><span class="o">:</span> <span class="s1">&#39;font-cache&#39;</span> <span class="o">+</span> <span class="nx">cacheSuffixVersion</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// 使用 expiration 插件实现缓存条目数目和时间控制
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="k">new</span> <span class="nx">workbox</span><span class="p">.</span><span class="nx">expiration</span><span class="p">.</span><span class="nx">ExpirationPlugin</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// 最大保存项目
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nx">maxEntries</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// 缓存 30 天
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nx">maxAgeSeconds</span><span class="o">:</span> <span class="mi">30</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">}),</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// 使用 cacheableResponse 插件缓存状态码为 0 的请求
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="k">new</span> <span class="nx">workbox</span><span class="p">.</span><span class="nx">cacheableResponse</span><span class="p">.</span><span class="nx">CacheableResponsePlugin</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">        <span class="nx">statuses</span><span class="o">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">200</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="p">}),</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="jsdelivr-cdn">jsDelivr CDN</h3>
<p>When using the jsDelivr CDN, if you specify the version of the library, the corresponding files can be said to be permanently unchanged, so use <code>CacheFirst</code> for caching.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">workbox</span><span class="p">.</span><span class="nx">routing</span><span class="p">.</span><span class="nx">registerRoute</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s1">&#39;^https://cdn\\.jsdelivr\\.net&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">  <span class="k">new</span> <span class="nx">workbox</span><span class="p">.</span><span class="nx">strategies</span><span class="p">.</span><span class="nx">CacheFirst</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">    <span class="nx">cacheName</span><span class="o">:</span> <span class="s1">&#39;static-immutable&#39;</span> <span class="o">+</span> <span class="nx">cacheSuffixVersion</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">fetchOptions</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">mode</span><span class="o">:</span> <span class="s1">&#39;cors&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">credentials</span><span class="o">:</span> <span class="s1">&#39;omit&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="k">new</span> <span class="nx">workbox</span><span class="p">.</span><span class="nx">expiration</span><span class="p">.</span><span class="nx">ExpirationPlugin</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">        <span class="nx">maxAgeSeconds</span><span class="o">:</span> <span class="mi">30</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">purgeOnQuotaError</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">}),</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="google-analytics">Google Analytics</h3>
<p>Workbox has a <a href="https://developers.google.com/web/tools/workbox/guides/enable-offline-analytics">Google Analytics Offline Statistics Plugin</a>, but unfortunately I use the Sukka-written <a href="https://github.com/SukkaW/cloudflare-workers-async-google-analytics">Unofficial Google Analytics Implementation</a>, so I can only add a <code>NetworkOnly</code> to drop offline stats.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">workbox</span><span class="p">.</span><span class="nx">routing</span><span class="p">.</span><span class="nx">registerRoute</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s1">&#39;^https://api\\.baoshuo\\.ren/cfga/(.*)&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">  <span class="k">new</span> <span class="nx">workbox</span><span class="p">.</span><span class="nx">strategies</span><span class="p">.</span><span class="nx">NetworkOnly</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">    <span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="k">new</span> <span class="nx">workbox</span><span class="p">.</span><span class="nx">backgroundSync</span><span class="p">.</span><span class="nx">BackgroundSyncPlugin</span><span class="p">(</span><span class="s1">&#39;Optical_Collect&#39;</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">maxRetentionTime</span><span class="o">:</span> <span class="mi">12</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="c1">// Retry for max of 12 Hours (specified in minutes)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="p">}),</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="pictures">Pictures</h3>
<p>I am a LifeTime Premium VIP of <a href="http://sm.ms/">SM.MS</a>, so of course the pictures should be saved here~</p>
<p><a href="http://sm.ms/">MS</a> has these image domains: <code>i.loli.net</code>, <code>vip1.loli.net</code>, <code>vip2.loli.net</code>, <code>s1.baoshuo.ren</code>, <code>s1.baoshuo.ren</code>, just write a regular match.</p>
<p>Since the files corresponding to the image links, like jsDelivr, are also almost never changed, use <code>CacheFirst</code> to cache them.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">workbox</span><span class="p">.</span><span class="nx">routing</span><span class="p">.</span><span class="nx">registerRoute</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s1">&#39;^https://(?:i|vip[0-9])\\.loli\\.(?:io|net)&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">  <span class="k">new</span> <span class="nx">workbox</span><span class="p">.</span><span class="nx">strategies</span><span class="p">.</span><span class="nx">CacheFirst</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">    <span class="nx">cacheName</span><span class="o">:</span> <span class="s1">&#39;img-cache&#39;</span> <span class="o">+</span> <span class="nx">cacheSuffixVersion</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// 使用 expiration 插件实现缓存条目数目和时间控制
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="k">new</span> <span class="nx">workbox</span><span class="p">.</span><span class="nx">expiration</span><span class="p">.</span><span class="nx">ExpirationPlugin</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">        <span class="nx">maxEntries</span><span class="p">,</span> <span class="c1">// 最大保存项目
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nx">maxAgeSeconds</span><span class="o">:</span> <span class="mi">30</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="c1">// 缓存 30 天
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="p">}),</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// 使用 cacheableResponse 插件缓存状态码为 0 的请求
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="k">new</span> <span class="nx">workbox</span><span class="p">.</span><span class="nx">cacheableResponse</span><span class="p">.</span><span class="nx">CacheableResponsePlugin</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">        <span class="nx">statuses</span><span class="o">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">200</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="p">}),</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="links">Links</h3>
<p>These files are only updated occasionally, use <code>StaleWhileRevalidate</code> to balance speed and version updates.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">workbox</span><span class="p">.</span><span class="nx">routing</span><span class="p">.</span><span class="nx">registerRoute</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s1">&#39;^https://friends\\.baoshuo\\.ren(.*)(png|jpg|jpeg|svg|gif)&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">  <span class="k">new</span> <span class="nx">workbox</span><span class="p">.</span><span class="nx">strategies</span><span class="p">.</span><span class="nx">StaleWhileRevalidate</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">    <span class="nx">cacheName</span><span class="o">:</span> <span class="s1">&#39;img-cache&#39;</span> <span class="o">+</span> <span class="nx">cacheSuffixVersion</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">fetchOptions</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">mode</span><span class="o">:</span> <span class="s1">&#39;cors&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">credentials</span><span class="o">:</span> <span class="s1">&#39;omit&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">workbox</span><span class="p">.</span><span class="nx">routing</span><span class="p">.</span><span class="nx">registerRoute</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s1">&#39;https://friends\\.baoshuo\\.ren/links.json&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">  <span class="k">new</span> <span class="nx">workbox</span><span class="p">.</span><span class="nx">strategies</span><span class="p">.</span><span class="nx">StaleWhileRevalidate</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="disqus-comments">Disqus Comments</h3>
<p>DisqusJS determines the availability of Disqus for visitors by checking <code>shortname.disqus.com/favicon.</code> and <code>disqus.com/favicon.</code>, which obviously cannot be cached.
The API can use <code>NetworkFirst</code> when there is no network to achieve the effect of viewing comments even when there is no network.
Also, Disqus itself does not need to cache, so using <code>NetworkOnly</code> for <code>*.disqus.com</code> is fine.
However, the avatars, JS and CSS under <code>*.disquscdn.com</code> can be cached for some time, so use <code>CacheFirst</code> to cache them for 10 days.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// API
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">workbox</span><span class="p">.</span><span class="nx">routing</span><span class="p">.</span><span class="nx">registerRoute</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s1">&#39;^https://api\\.baoshuo\\.ren/disqus/(.*)&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">  <span class="k">new</span> <span class="nx">workbox</span><span class="p">.</span><span class="nx">strategies</span><span class="p">.</span><span class="nx">NetworkFirst</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">    <span class="nx">cacheName</span><span class="o">:</span> <span class="s1">&#39;dsqjs-api&#39;</span> <span class="o">+</span> <span class="nx">cacheSuffixVersion</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">fetchOptions</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">mode</span><span class="o">:</span> <span class="s1">&#39;cors&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">credentials</span><span class="o">:</span> <span class="s1">&#39;omit&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nx">networkTimeoutSeconds</span><span class="o">:</span> <span class="mi">3</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">// Disqus
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">workbox</span><span class="p">.</span><span class="nx">routing</span><span class="p">.</span><span class="nx">registerRoute</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s1">&#39;^https://(.*)disqus\\.com&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">  <span class="k">new</span> <span class="nx">workbox</span><span class="p">.</span><span class="nx">strategies</span><span class="p">.</span><span class="nx">NetworkOnly</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">workbox</span><span class="p">.</span><span class="nx">routing</span><span class="p">.</span><span class="nx">registerRoute</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s1">&#39;^https://(.*)disquscdn\\.com(.*)&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">  <span class="k">new</span> <span class="nx">workbox</span><span class="p">.</span><span class="nx">strategies</span><span class="p">.</span><span class="nx">CacheFirst</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">    <span class="nx">cacheName</span><span class="o">:</span> <span class="s1">&#39;disqus-cdn-cache&#39;</span> <span class="o">+</span> <span class="nx">cacheSuffixVersion</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="k">new</span> <span class="nx">workbox</span><span class="p">.</span><span class="nx">expiration</span><span class="p">.</span><span class="nx">ExpirationPlugin</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">        <span class="nx">maxAgeSeconds</span><span class="o">:</span> <span class="mi">10</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">}),</span>
</span></span><span class="line"><span class="cl">      <span class="k">new</span> <span class="nx">workbox</span><span class="p">.</span><span class="nx">cacheableResponse</span><span class="p">.</span><span class="nx">CacheableResponsePlugin</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">        <span class="nx">statuses</span><span class="o">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">200</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="p">}),</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="suffix-matching">Suffix Matching</h3>
<p>For the rest of the static files that are not matched by the domain name, match by file suffix and use <code>StaleWhileRevalidate</code> to balance speed and version updates.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">workbox</span><span class="p">.</span><span class="nx">routing</span><span class="p">.</span><span class="nx">registerRoute</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s1">&#39;.*.(?:png|jpg|jpeg|svg|gif|webp)&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">  <span class="k">new</span> <span class="nx">workbox</span><span class="p">.</span><span class="nx">strategies</span><span class="p">.</span><span class="nx">StaleWhileRevalidate</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">workbox</span><span class="p">.</span><span class="nx">routing</span><span class="p">.</span><span class="nx">registerRoute</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s1">&#39;.*.(css|js)&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">  <span class="k">new</span> <span class="nx">workbox</span><span class="p">.</span><span class="nx">strategies</span><span class="p">.</span><span class="nx">StaleWhileRevalidate</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="default-behavior">Default behavior</h3>
<p>Use Workbox&rsquo;s defaultHandler to match the rest of the requests (including the page itself), always using <code>NetworkFirst</code> to speed up and take offline with Workbox&rsquo;s <code>runtimeCache</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">workbox</span><span class="p">.</span><span class="nx">routing</span><span class="p">.</span><span class="nx">setDefaultHandler</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="k">new</span> <span class="nx">workbox</span><span class="p">.</span><span class="nx">strategies</span><span class="p">.</span><span class="nx">NetworkFirst</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">    <span class="nx">networkTimeoutSeconds</span><span class="o">:</span> <span class="mi">3</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Article cover image from: <a href="https://developers.google.com/web/tools/workbox">https://developers.google.com/web/tools/workbox</a></p>
<p>The image in the Workbox Strategies section is from: <a href="https://web.dev/offline-cookbook/">https://web.dev/offline-cookbook/</a>
s</p>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/javascript/">javascript</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2022-08/stimulus-js/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Getting started with stimulus.js</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2022-08/py-coroutine/">
            <span class="next-text nav-default">Python 3.10 native coroutine asyncio in practice</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  <script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox-3.1.20.min.js"></script>



<script type="text/javascript" src="/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
