<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>2022 Go Ecosystem rpc Framework Benchmark - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="This paper documents the Benchmark of each rpc framework in the Go ecosystem in 2022, and its comparison." /><meta name="keywords" content="Go Rpc Frameworks, Benchmark" />






<meta name="generator" content="Hugo 0.101.0 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2022-08/go-rpc-frameworks/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link href="/lib/fancybox/jquery.fancybox-3.1.20.min.css" rel="stylesheet">


<meta property="og:title" content="2022 Go Ecosystem rpc Framework Benchmark" />
<meta property="og:description" content="This paper documents the Benchmark of each rpc framework in the Go ecosystem in 2022, and its comparison." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2022-08/go-rpc-frameworks/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-08-01T10:36:12+08:00" />
<meta property="article:modified_time" content="2022-08-01T10:36:12+08:00" />

<meta itemprop="name" content="2022 Go Ecosystem rpc Framework Benchmark">
<meta itemprop="description" content="This paper documents the Benchmark of each rpc framework in the Go ecosystem in 2022, and its comparison."><meta itemprop="datePublished" content="2022-08-01T10:36:12+08:00" />
<meta itemprop="dateModified" content="2022-08-01T10:36:12+08:00" />
<meta itemprop="wordCount" content="981">
<meta itemprop="keywords" content="golang," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="2022 Go Ecosystem rpc Framework Benchmark"/>
<meta name="twitter:description" content="This paper documents the Benchmark of each rpc framework in the Go ecosystem in 2022, and its comparison."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SOBYTE</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SOBYTE</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">2022 Go Ecosystem rpc Framework Benchmark</h1>

      <div class="post-meta">
        <span class="post-time"> 2022-08-01 10:36:12 </span>
        <div class="post-category">
            <a href="/categories/tutorials/"> tutorials </a>
            </div>
          <span class="more-meta"> 981 words </span>
          <span class="more-meta"> 5 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#scenario-1">Scenario 1</a>
          <ul>
            <li><a href="#throughput">Throughput</a></li>
            <li><a href="#average-delay">Average delay</a></li>
            <li><a href="#p999-delay">P99.9 Delay</a></li>
          </ul>
        </li>
        <li><a href="#scenario-2">Scenario 2</a>
          <ul>
            <li><a href="#average-delay-1">Average delay</a></li>
            <li><a href="#p999-delay-1">P99.9 Delay</a></li>
          </ul>
        </li>
        <li><a href="#scenario-3">Scenario 3</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>This test was conducted for five common rpc frameworks:</p>
<ul>
<li><a href="https://github.com/smallnest/rpcx">rpcx</a>, one of the earliest Go ecosystem microservices frameworks, used by Sina, Good Future, etc.</li>
<li><a href="https://github.com/cloudwego/kitex">kitex</a>, bytedance&rsquo;s microservices framework</li>
<li><a href="https://github.com/lesismal/arpc">arpc</a>: a performance rpc framework by lesismal</li>
<li><a href="https://grpc.io/">grpc</a>: a Google-initiated open source rpc framework that supports cross-language and is widely used. The system is based on HTTP/2 protocol transport and uses Protocol Buffers as the interface description language.</li>
<li><a href="https://pkg.go.dev/net/rpc">standard library of rpc/std_rpc</a>: Go standard library comes with the rpc framework, currently in a maintenance state</li>
</ul>
<p>The latest version of each framework is used for testing:</p>
<ul>
<li><strong>rpcx</strong>: v1.7.8</li>
<li><strong>kitex</strong>: v0.3.4</li>
<li><strong>arpc</strong>: v1.2.9</li>
<li><strong>grpc</strong>: v1.48.0</li>
<li><strong>std_rpc</strong>: v1.8.4</li>
</ul>
<p>In order to maintain as much consistency as possible in testing, all tests are conducted in the same test environment, the same test logic, the same test message:</p>
<ul>
<li>Test environment (6 years old machine, two machines, one for server, one for client)
<ul>
<li>CPU model: Intel(R) Xeon(R) CPU E5-2620 v2 @ 2.10GHz / 2pcs</li>
<li>Physical cores: 6; Logical cores: 12</li>
<li>Memory: 64G</li>
<li>Enable NIC multi-queue</li>
</ul>
</li>
<li>Both use protobuf as the encoding method for the message body, and the encoded message body size is 581 bytes</li>
<li>In the client-side statistics, statistics throughputs and latency (lantency, including the maximum value, average, median value, and p99.9 value, the minimum value is less than 1 millisecond, so not counted)
<ul>
<li>For latency, we also need to pay attention to its long tail, so we need to pay attention to the median and p99.9. p99.9 means that 999 parts per thousand requests have latency less than a certain time.</li>
</ul>
</li>
</ul>
<p>The test is divided into three main scenarios.</p>
<ul>
<li>TCP connection number is 10, persistent connection. Concurrent number of 100, 200, 500, 1000, 2000, 5000 cases
The main test is the maximum capacity of each framework in the case of high concurrency, including throughput and latency.</li>
<li>TCP connections of 10, concurrency of 200, and persistent connections. Latency in the case of 100,000/sec, 150,000/sec, 180,000/sec throughput
The main measurement is the latency and long tail of each framework while the throughput remains consistent. Too much latency or long tail means that using this throughput rate is not appropriate.</li>
<li>TCP connections of 1000, concurrency of 1000, persistent connections.
The main test is the performance of each framework in the case of a relatively high number of large connections. Mainly for the bytes of kitex such self-developed netpoll, to see if it is more suitable for this large number of connections.</li>
</ul>
<p>Here the number of concurrency refers to the number of goroutines started by the client, multiple goroutines may share the same client (connection).</p>
<p>All the test code for each framework is placed in <a href="https://github.com/rpcxio/rpcx-benchmark">rpcx-benchmark</a>. The test commands are very simple, as shown in the introduction below, so you can download them to test and verify yourself, and you are welcome to provide optimization patches, add more rpc frameworks, etc.</p>
<h2 id="scenario-1">Scenario 1</h2>
<p>TCP connection count is 10, persistent connections. The number of concurrent connections is 100, 200, 500, 1000, 2000, 5000.</p>
<ul>
<li>Server side start: <code>. /server -s xxx.xxx.xxx.xxx:8972</code> // xxx.xxx.xxx.xxx is the IP address that the server listens to</li>
<li>Client test: <code>. /client -c 2000 -n 1000000 -s xxx.xxx.xxx.xxx:8972</code> // Here the concurrency is 2000, testing a total of 1 million requests sent</li>
</ul>
<p>Test raw data:</p>
<iframe width="700" height="300" frameborder="0" scrolling="no" src="https://onedrive.live.com/embed?resid=CD09EE1AE0AE8966%211237&authkey=%21ALkUD_tZUvdczJ8&em=2&wdAllowInteractivity=False&wdDownloadButton=True&wdInConfigurator=True&wdInConfigurator=True&edesNext=false&ejss=false"></iframe>
<h3 id="throughput">Throughput</h3>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/08/01/505af0cdfc2f4311942f75869cfd9dbe.png" alt="Throughput"></p>
<p>Y-axis is throughput/sec, the higher the better. You can see that arpc framework throughput is very good, and last year&rsquo;s test was also arpc performance is better, followed by rpcx, standard rpc, kitex, grpc.</p>
<p>You can see that in the case of high concurrency, except for grpc, all other can reach 180,000 requests/sec throughput.</p>
<h3 id="average-delay">Average delay</h3>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/08/01/8ef29487bb1f4876a0dfc3ba27610b3e.png" alt="Average delay"></p>
<p>The Y-axis is the average latency, the lower the better, as you can see the higher latency of grpc. The latency is exactly the opposite of the throughput above.</p>
<h3 id="p999-delay">P99.9 Delay</h3>
<p>Another case where we may be more concerned about the long tail can be observed by picking the median or p99.9. Here is the case of p99.9.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/08/01/c56ba9b8710d404eb24bf6e3879a315f.png" alt="P99.9 Delay"></p>
<p>Of course, it is meaningless to compare with a concurrency of 5000 because the throughput of each framework is different at a concurrency of 5000, and the latency will be large at a high throughput.
So in order to observe the long tail in a fair situation, I designed the following test.</p>
<h2 id="scenario-2">Scenario 2</h2>
<p>TCP connections of 10,concurrency of 200,persistent connections. Latency in case of throughput of 100,000/sec, 150,000/sec, 180,000/sec.</p>
<p>In order to observe the latency, we need to ensure that the throughputs are all as same as possible, and it is more scientific to observe the latency and the long tail case at the same throughput.</p>
<p>So scenario 2 is to observe the latency and P99.9 latency of the framework for three scenarios with throughputs of 100,000/sec, 150,000/sec, and 180,000/sec at a concurrency of 200.</p>
<p>Test raw data:</p>
<iframe width="700" height="346" frameborder="0" scrolling="no" src="https://onedrive.live.com/embed?resid=CD09EE1AE0AE8966%211240&authkey=%21AH7IxJNptuzNIRI&em=2&wdAllowInteractivity=False&wdDownloadButton=True&wdInConfigurator=True&wdInConfigurator=True&edesNext=false&ejss=false"></iframe>
<h3 id="average-delay-1">Average delay</h3>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/08/01/77cf05cff63345f59d11b368464945f6.png" alt="Average delay"></p>
<p>The average latency looks higher for grpc because it doesn&rsquo;t reach 180,000/sec throughput, so its last value is not available. kitex is relatively high, this also depends on whether there is some specific tuning for kitex. Basically, it is negatively correlated with throughput.</p>
<h3 id="p999-delay-1">P99.9 Delay</h3>
<p>For the long tail, here is the case of p99.9</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/08/01/c4a988a7ca8a45aa9d150aa452fd5615.png" alt="P99.9 Delay"></p>
<p>The P99.9 latency of arpc, rpcx and standard rpc is still better.</p>
<h2 id="scenario-3">Scenario 3</h2>
<p>TCP connections with 1000 concurrent and persistent connections.</p>
<p>Observe the performance (throughput and latency) of each framework in the presence of a large number of connections. Instead of choosing a huge number of connections, this scenario chooses a more common number of 1000 connections for the test, with connections that are persistent.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/08/01/b0708d6f65f84e54bd61d3ff5690fe76.png" alt="Scenario 3"></p>
<p>arpc is significantly better than other frameworks in the case of more connections, followed by rpcx and the standard rpc framework.</p>
<p>Average time consumption and P99.9 time consumption is also in line with this situation, the specific raw data reference.</p>
<iframe width="700" height="346" frameborder="0" scrolling="no" src="https://onedrive.live.com/embed?resid=CD09EE1AE0AE8966%211242&authkey=%21ADlRyez3xISIKx4&em=2&wdAllowInteractivity=False&wdDownloadButton=True&wdInConfigurator=True&wdInConfigurator=True&edesNext=false&ejss=false"></iframe>
<p>Overall, the performance of rpcx is still good, and I hope that in the future, reference to the brother rpc framework to do further optimization.</p>
<hr>
<p>Reference <a href="https://colobu.com/2022/07/31/2022-rpc-frameworks-benchmarks/">https://colobu.com/2022/07/31/2022-rpc-frameworks-benchmarks/</a></p>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/golang/">golang</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2022-08/k8s-cert-management/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Certificate management tools in Kubernetes - cert-manager</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2022-08/floating-point-inaccurate/">
            <span class="next-text nav-default">Why floating-point arithmetic is inaccurate</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  <script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox-3.1.20.min.js"></script>



<script type="text/javascript" src="/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
