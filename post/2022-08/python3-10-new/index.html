<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>What&#39;s new in Python 3.10 - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="Learn about the new features in Python 3.10." /><meta name="keywords" content="python 3.10, New Features" />






<meta name="generator" content="Hugo 0.102.0 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2022-08/python3-10-new/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link href="/lib/fancybox/jquery.fancybox-3.1.20.min.css" rel="stylesheet">


<meta property="og:title" content="What&#39;s new in Python 3.10" />
<meta property="og:description" content="Learn about the new features in Python 3.10." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2022-08/python3-10-new/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-08-19T12:02:16+08:00" />
<meta property="article:modified_time" content="2022-08-19T12:02:16+08:00" />

<meta itemprop="name" content="What&#39;s new in Python 3.10">
<meta itemprop="description" content="Learn about the new features in Python 3.10."><meta itemprop="datePublished" content="2022-08-19T12:02:16+08:00" />
<meta itemprop="dateModified" content="2022-08-19T12:02:16+08:00" />
<meta itemprop="wordCount" content="4497">
<meta itemprop="keywords" content="python," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="What&#39;s new in Python 3.10"/>
<meta name="twitter:description" content="Learn about the new features in Python 3.10."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SOBYTE</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SOBYTE</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">What&#39;s new in Python 3.10</h1>

      <div class="post-meta">
        <span class="post-time"> 2022-08-19 12:02:16 </span>
        <div class="post-category">
            <a href="/categories/tutorials/"> tutorials </a>
            </div>
          <span class="more-meta"> 4497 words </span>
          <span class="more-meta"> 22 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#1-pep-604">1. PEP 604</a></li>
        <li><a href="#2-pep-613">2. PEP 613</a></li>
        <li><a href="#3-pep-647">3. PEP 647</a></li>
        <li><a href="#4-pep-612">4. PEP 612</a></li>
        <li><a href="#5-pep-618">5. PEP 618</a></li>
        <li><a href="#6-pep-626">6. PEP 626</a></li>
        <li><a href="#7-pep-634-636">7. PEP 634-636</a></li>
        <li><a href="#8-bpo-12782">8. BPO 12782</a></li>
        <li><a href="#9-note">9. Note</a></li>
        <li><a href="#10-reference">10. Reference</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>The Python language is designed to make complex tasks simple, so updates iterate relatively quickly and require us to keep up with them!</p>
<p>The release of a new version is always accompanied by new features and functions, and the first thing we need to understand and attribute these points before upgrading the version, so that we may use them flexibly in our programming later. Can&rsquo;t wait, ready to go, so let&rsquo;s start now!</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/08/19/a70ec3a31e874db3b4cb4346b29fc574.png" alt="pyton 3.10"></p>
<h2 id="1-pep-604">1. PEP 604</h2>
<blockquote>
<p>New Type Union Operator</p>
</blockquote>
<p>In previous versions when you wanted to declare a type to contain multiple types, you needed to use <code>Union[]</code> to contain multiple types, now you can just use the <code>|</code> symbol to do it.</p>
<ul>
<li>
<p>Old Version</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Union</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">square</span><span class="p">(</span><span class="n">number</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">number</span> <span class="o">**</span> <span class="mi">2</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>New Version</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">square</span><span class="p">(</span><span class="n">number</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">number</span> <span class="o">**</span> <span class="mi">2</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>can be used in <code>isinstance</code> and <code>issubclass</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">:</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">:</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">:</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">:</span> <span class="kc">True</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h2 id="2-pep-613">2. PEP 613</h2>
<blockquote>
<p>TypeAlias</p>
</blockquote>
<p>Sometimes we want to customize a type, so we can create an alias (<code>Alias</code>) to do so. However, for the type checker (<code>Type Checker</code>), it can&rsquo;t tell if it&rsquo;s a type alias or a normal assignment, and now we can easily tell by introducing <code>TypeAlias</code>.</p>
<ul>
<li>
<p>The previous writing style</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">Board</span> <span class="o">=</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>The new version of the writing style</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TypeAlias</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Board</span><span class="p">:</span><span class="n">TypeAlias</span> <span class="o">=</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span>  <span class="c1"># This is a type alias</span>
</span></span><span class="line"><span class="cl"><span class="n">Board</span> <span class="o">=</span> <span class="mi">2</span>                                <span class="c1"># This is a module constant</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h2 id="3-pep-647">3. PEP 647</h2>
<blockquote>
<p>User-Defined Type Guards</p>
</blockquote>
<p>In contemporary static checking tools (such as <code>typescript</code>, <code>mypy</code>, etc.) there is a feature called <strong><code>Type narrowing</code></strong>. This is when a parameter type could have matched more than one type, but under certain conditions the type range can be narrowed down to a smaller range of type(s).</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="k">def</span> <span class="nf">show_type</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span><span class="p">):</span>  <span class="c1"># The argument obj is either int or str</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>     <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>    <span class="c1"># Implementing Type narrowing, mypy confirms that obj is int</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>         <span class="k">return</span> <span class="s1">&#39;int&#39;</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>     <span class="k">return</span> <span class="s1">&#39;str&#39;</span>  <span class="c1"># Since the previous qualification is int, here mypy will confirm that obj is str</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="n">show_type</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">:</span> <span class="s1">&#39;int&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="n">show_type</span><span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">:</span> <span class="s1">&#39;str&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>Problems identified - Deficiencies exist</p>
<p>A more accurate knowledge of the object&rsquo;s type is very friendly to <code>mypy</code>, and the conclusions of the check will be more accurate; type narrowing can be problematic in some scenarios.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="k">def</span> <span class="nf">is_str</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>     <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span> <span class="k">def</span> <span class="nf">to_list</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>     <span class="k">if</span> <span class="n">is_str</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>         <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>     <span class="k">return</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="k">def</span> <span class="nf">is_str</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>     <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span> <span class="k">def</span> <span class="nf">to_list</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>     <span class="k">if</span> <span class="n">is_str</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>         <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>     <span class="k">return</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="n">to_list</span><span class="p">(</span><span class="s1">&#39;aaa&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="n">to_list</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">:</span> <span class="p">[]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>This code is simpler than the one mentioned in <code>PEP</code>, they are both correct codes and the type comments are problematic. But running <code>mypy</code> prompts an error message. In the <code>2</code> functions <code>obj</code> is used because it is not sure of the object type, so <code>object</code> is used, and in fact <code>to_list</code> will only handle <code>obj</code> as type <code>str</code>. Originally <code>if is_str(obj)</code> would have narrowed the type, but <strong>because it was split into functions, <code>isinstance</code> didn&rsquo;t succeed in narrowing it here</strong>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="err">➜</span> <span class="n">mypy</span> <span class="n">wrong_to_list</span><span class="o">.</span><span class="n">py</span>
</span></span><span class="line"><span class="cl"><span class="n">wrong_to_list</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">7</span><span class="p">:</span> <span class="n">error</span><span class="p">:</span> <span class="n">No</span> <span class="n">overload</span> <span class="n">variant</span> <span class="n">of</span> <span class="s2">&#34;list&#34;</span> <span class="n">matches</span> <span class="n">argument</span> <span class="nb">type</span> <span class="s2">&#34;object&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">wrong_to_list</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">7</span><span class="p">:</span> <span class="n">note</span><span class="p">:</span> <span class="n">Possible</span> <span class="n">overload</span> <span class="n">variants</span><span class="p">:</span>
</span></span><span class="line"><span class="cl"><span class="n">wrong_to_list</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">7</span><span class="p">:</span> <span class="n">note</span><span class="p">:</span>     <span class="k">def</span> <span class="p">[</span><span class="n">_T</span><span class="p">]</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">_T</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">wrong_to_list</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">7</span><span class="p">:</span> <span class="n">note</span><span class="p">:</span>     <span class="k">def</span> <span class="p">[</span><span class="n">_T</span><span class="p">]</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">_T</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">_T</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">Found</span> <span class="mi">1</span> <span class="n">error</span> <span class="ow">in</span> <span class="mi">1</span> <span class="n">file</span> <span class="p">(</span><span class="n">checked</span> <span class="mi">1</span> <span class="n">source</span> <span class="n">file</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>User-defined <code>Type Guards</code> are provided in the new version to resolve</p>
<p>Originally the type of the return value was <code>bool</code>, now we specify it as <code>TypeGuard[str]</code> so that <code>mypy</code> can understand its type. Actually, to put it another way, you can read <code>TypeGuard[str]</code> as an alias for <code>bool</code> with a type declaration, so please understand this carefully.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TypeGuard</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">is_str</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TypeGuard</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="err">➜</span> <span class="n">mypy</span> <span class="n">right_to_list</span><span class="o">.</span><span class="n">py</span>
</span></span><span class="line"><span class="cl"><span class="n">Success</span><span class="p">:</span> <span class="n">no</span> <span class="n">issues</span> <span class="n">found</span> <span class="ow">in</span> <span class="mi">1</span> <span class="n">source</span> <span class="n">file</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h2 id="4-pep-612">4. PEP 612</h2>
<blockquote>
<p>Parameter Specification Variables</p>
</blockquote>
<p>The type system in <code>Python</code> has limited support for types of <code>Callable</code> (such as functions), it can only specify the type of the <code>Callable</code>, but it cannot be propagated for arguments to function calls.</p>
<ul>
<li>
<p>This problem exists mainly in the usage of decorators</p>
<p>The argument value received by <code>join</code> is supposed to be a list of strings, but <code>mypy</code> does not validate this last <code>print(join([1, 2]))</code> correctly. Because the type of <code>args</code> and <code>kwargs</code> in the <code>inner</code> function in the <code>log</code> decorator is <code>Any</code>, this causes the type of the arguments chosen for the call to be unverified, and frankly, it can be written any way.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">Callable</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">TypeVar</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">R</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;R&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">log</span><span class="p">(</span><span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">R</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">R</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">inner</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">R</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;In&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">inner</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@log</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">join</span><span class="p">(</span><span class="n">items</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">]))</span>  <span class="c1"># Correct usage</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">join</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]))</span>      <span class="c1"># Wrong usage, mypy should prompt type error</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>Newer versions can use <code>ParamSpec</code> to resolve</p>
<p>By using <code>typing.ParamSpec</code>, the argument type of <code>inner</code> is passed directly through <code>P.args</code> and <code>P.kwargs</code> for validation purposes.</p>
<p><code>typing.ParamSpec</code> helps us to facilitate [referencing] positional and keyword arguments, and this <code>PEP</code> addition of `typing. is to provide an ability to add, remove or convert parameters of another callable object.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TypeVar</span><span class="p">,</span> <span class="n">ParamSpec</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">R</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;R&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">P</span> <span class="o">=</span> <span class="n">ParamSpec</span><span class="p">(</span><span class="s1">&#39;P&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">log</span><span class="p">(</span><span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="n">P</span><span class="p">,</span> <span class="n">R</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[</span><span class="n">P</span><span class="p">,</span> <span class="n">R</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">inner</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">P</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">P</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">R</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;In&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">inner</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="err">➜</span> <span class="n">mypy</span> <span class="n">right_join</span><span class="o">.</span><span class="n">py</span>
</span></span><span class="line"><span class="cl"><span class="n">right_join</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">22</span><span class="p">:</span> <span class="n">error</span><span class="p">:</span> <span class="n">List</span> <span class="n">item</span> <span class="mi">0</span> <span class="n">has</span> <span class="n">incompatible</span> <span class="nb">type</span> <span class="s2">&#34;int&#34;</span><span class="p">;</span> <span class="n">expected</span> <span class="s2">&#34;str&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">right_join</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">22</span><span class="p">:</span> <span class="n">error</span><span class="p">:</span> <span class="n">List</span> <span class="n">item</span> <span class="mi">1</span> <span class="n">has</span> <span class="n">incompatible</span> <span class="nb">type</span> <span class="s2">&#34;int&#34;</span><span class="p">;</span> <span class="n">expected</span> <span class="s2">&#34;str&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">Found</span> <span class="mi">2</span> <span class="n">errors</span> <span class="ow">in</span> <span class="mi">1</span> <span class="n">file</span> <span class="p">(</span><span class="n">checked</span> <span class="mi">1</span> <span class="n">source</span> <span class="n">file</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The more common added arguments I can think of are the [injected] type of decorators. The <code>join</code> function has <code>2</code> arguments, but since the first argument <code>logger</code> is [injected] in the <code>with_logger</code> decorator, you only need to pass the value of the <code>items</code> argument when you use it.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">logging</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">Callable</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TypeVar</span><span class="p">,</span> <span class="n">ParamSpec</span><span class="p">,</span> <span class="n">Concatenate</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">NOTSET</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">R</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;R&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">P</span> <span class="o">=</span> <span class="n">ParamSpec</span><span class="p">(</span><span class="s1">&#39;P&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">with_logger</span><span class="p">(</span><span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="n">Concatenate</span><span class="p">[</span><span class="n">logging</span><span class="o">.</span><span class="n">Logger</span><span class="p">,</span> <span class="n">P</span><span class="p">],</span> <span class="n">R</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[</span><span class="n">P</span><span class="p">,</span> <span class="n">R</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">inner</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">P</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">P</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">R</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="n">logger</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">inner</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@with_logger</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">join</span><span class="p">(</span><span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span><span class="p">,</span> <span class="n">items</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
</span></span><span class="line"><span class="cl">    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Info&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">]))</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">join</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In addition to adding, removing and converting parameters can also be done with <code>Concatenate</code>, see another example of removing parameters. With the <code>remove_first</code> decorator, the first argument passed in is ignored, so <code>add(1, 2, 3)</code> is actually computing <code>add(2, 3)</code>. Be careful to understand where this <code>Concatenate</code> is, if it is added, then <code>Concatenate</code> is added to the type declaration of the <code>Callable</code> of the decorator argument, if it is removed, it is added to the type declaration of the returned <code>Callable</code>.</p>
</li>
</ul>
<h2 id="5-pep-618">5. PEP 618</h2>
<blockquote>
<p>Parameters of the zip function</p>
</blockquote>
<p>I believe that every <code>Python</code> developer with much working experience has experienced this trap, when the elements within the argument are of different lengths, the part with the longer length is ignored, without any hint, when in fact it was originally mentioned in the documentation.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">([</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]))</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">:</span> <span class="p">[(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>But for most developers no one really pays attention to this documentation, the problem is very implicit and requires developers to understand the <code>zip</code> problem. The newer versions of <code>strict=True</code> will report an error when the length of the elements within the argument is different.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">In : list<span class="o">(</span>zip<span class="o">([</span><span class="s1">&#39;a&#39;</span>, <span class="s1">&#39;b&#39;</span>, <span class="s1">&#39;c&#39;</span><span class="o">]</span>, <span class="o">[</span>1, 2<span class="o">]</span>, <span class="nv">strict</span><span class="o">=</span>True<span class="o">))</span>
</span></span><span class="line"><span class="cl">---------------------------------------------------------------------------
</span></span><span class="line"><span class="cl">ValueError                                Traceback <span class="o">(</span>most recent call last<span class="o">)</span>
</span></span><span class="line"><span class="cl">Input In , in &lt;cell line: 1&gt;<span class="o">()</span>
</span></span><span class="line"><span class="cl">----&gt; <span class="m">1</span> list<span class="o">(</span>zip<span class="o">([</span><span class="s1">&#39;a&#39;</span>, <span class="s1">&#39;b&#39;</span>, <span class="s1">&#39;c&#39;</span><span class="o">]</span>, <span class="o">[</span>1, 2<span class="o">]</span>, <span class="nv">strict</span><span class="o">=</span>True<span class="o">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ValueError: zip<span class="o">()</span> argument <span class="m">2</span> is shorter than argument <span class="m">1</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="6-pep-626">6. PEP 626</h2>
<blockquote>
<p>Better error messages</p>
</blockquote>
<p>There are some examples of error messages listed in the official that were not obvious and friendly enough in the previous version, this version deals with them centrally. Here they are: Same <code>SyntaxError</code> Isn&rsquo;t the hint in the new version easier to understand? Not only does it suggest the type of error, it also gives hints.</p>
<ul>
<li>
<p>The old way of writing</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Hello, World!)</span>
</span></span><span class="line"><span class="cl">    <span class="n">File</span> <span class="s2">&#34;&lt;ipython-input-7-bc0808c61f64&gt;&#34;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Hello, World!)</span>
</span></span><span class="line"><span class="cl">                            <span class="o">^</span>
</span></span><span class="line"><span class="cl"><span class="ne">SyntaxError</span><span class="p">:</span> <span class="n">EOL</span> <span class="k">while</span> <span class="n">scanning</span> <span class="n">string</span> <span class="n">literal</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>New writing style</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Hello, World!)</span>
</span></span><span class="line"><span class="cl">    <span class="n">Input</span> <span class="n">In</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Hello, World!)</span>
</span></span><span class="line"><span class="cl">            <span class="o">^</span>
</span></span><span class="line"><span class="cl"><span class="ne">SyntaxError</span><span class="p">:</span> <span class="n">unterminated</span> <span class="n">string</span> <span class="n">literal</span> <span class="p">(</span><span class="n">detected</span> <span class="n">at</span> <span class="n">line</span> <span class="mi">1</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>The old way of writing</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="k">if</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">1</span><span class="p">:</span> <span class="k">pass</span>
</span></span><span class="line"><span class="cl"><span class="n">File</span> <span class="s2">&#34;&lt;ipython-input-8-e4cfea4b3624&gt;&#34;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">1</span><span class="p">:</span> <span class="k">pass</span>
</span></span><span class="line"><span class="cl">        <span class="o">^</span>
</span></span><span class="line"><span class="cl"><span class="ne">SyntaxError</span><span class="p">:</span> <span class="n">invalid</span> <span class="n">syntax</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>New writing style</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="k">if</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">1</span><span class="p">:</span> <span class="k">pass</span>
</span></span><span class="line"><span class="cl"><span class="n">Input</span> <span class="n">In</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">1</span><span class="p">:</span> <span class="k">pass</span>
</span></span><span class="line"><span class="cl">    <span class="o">^</span>
</span></span><span class="line"><span class="cl"><span class="ne">SyntaxError</span><span class="p">:</span> <span class="n">invalid</span> <span class="n">syntax</span><span class="o">.</span> <span class="n">Maybe</span> <span class="n">you</span> <span class="n">meant</span> <span class="s1">&#39;==&#39;</span> <span class="ow">or</span> <span class="s1">&#39;:=&#39;</span> <span class="n">instead</span> <span class="n">of</span> <span class="s1">&#39;=&#39;</span><span class="err">?</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h2 id="7-pep-634-636">7. PEP 634-636</h2>
<blockquote>
<p>Match-Case</p>
</blockquote>
<p>Many <code>Python</code> core developers believe that <code>Python</code> does not need to add <code>switch-case</code> syntax, because the same effect can be achieved with <code>if/elif/else</code>. This new syntax is called <code>Structural Pattern Matching</code> in Chinese, and there are three <code>PEP</code>s to introduce it because there are a lot of new features</p>
<ul>
<li><strong>PEP 634</strong>: Introduces the <code>match</code> syntax and supported patterns.</li>
<li><strong>PEP 635</strong>: Explains the reason for the syntax being designed this way</li>
<li><strong>PEP 636</strong>: a tutorial introducing the concepts, syntax and semantics</li>
</ul>
<p><code>match</code> is followed by the variable to be matched, <code>case</code> is followed by a different condition, and then the statement to be executed if the condition is met. The last <code>case</code> is underlined to indicate a default match, so if the previous condition does not match, it will be executed in this <code>case</code>, which is equivalent to the previous <code>else</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">http_error</span><span class="p">(</span><span class="n">status</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">match</span> <span class="n">status</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">case</span> <span class="mi">400</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="s1">&#39;Bad request&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="n">case</span> <span class="mi">401</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="s1">&#39;Unauthorized&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="n">case</span> <span class="mi">403</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="s1">&#39;Forbidden&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="n">case</span> <span class="mi">404</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="s1">&#39;Not found&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="n">case</span> <span class="n">_</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="s1">&#39;Unknown status code&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>But the <code>match-case</code> syntax can do much more than the <code>switch-case</code> syntax in <code>C</code> / <code>Go</code> languages, it is actually the <code>match-case</code> syntax in <code>Scala</code> / <code>Erlang</code> languages, which supports complex pattern matching, and I will demonstrate the flexibility of this new syntax and <code>pythonic</code> in detail with several pattern examples.</p>
<ul>
<li>
<p>[1] Literal mode</p>
<p>The above example is a literal pattern that uses the basic data structures that come with <code>Python</code>, such as strings, numbers, booleans, and <code>None</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl">    <span class="n">case</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;zero&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">case</span> <span class="mi">1</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;one&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">case</span> <span class="mi">2</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;two&#39;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>[2] Capture mode</p>
<p>Can match the assignment target of a <strong>single</strong> expression. If <code>greeting</code> is not null, it will be assigned to <code>name</code>, but note that if <code>greeting</code> is null a <code>NameError</code> or <code>UnboundLocalError</code> error will be thrown, since <code>name</code> has not been defined before.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">capture</span><span class="p">(</span><span class="n">greeting</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">match</span> <span class="n">greeting</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">case</span> <span class="s2">&#34;&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Hello!&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">case</span> <span class="n">name</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Hi </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">!&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&#34;Santa&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Match&#39;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="n">capture</span><span class="p">(</span><span class="s1">&#39;Alex&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Hi</span> <span class="n">Alex</span><span class="err">!</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="n">capture</span><span class="p">(</span><span class="s1">&#39;Santa&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Hi</span> <span class="n">Santa</span><span class="err">!</span>
</span></span><span class="line"><span class="cl"><span class="n">Match</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="n">capture</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Hello</span><span class="err">!</span>
</span></span><span class="line"><span class="cl"><span class="o">---------------------------------------------------------------------------</span>
</span></span><span class="line"><span class="cl"><span class="ne">UnboundLocalError</span>                         <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Input</span> <span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">cell</span> <span class="n">line</span><span class="p">:</span> <span class="mi">1</span><span class="o">&gt;</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="o">----&gt;</span> <span class="mi">1</span> <span class="n">capture</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Input</span> <span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="ow">in</span> <span class="n">capture</span><span class="p">(</span><span class="n">greeting</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="mi">1</span> <span class="k">def</span> <span class="nf">capture</span><span class="p">(</span><span class="n">greeting</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="mi">2</span>     <span class="n">match</span> <span class="n">greeting</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="mi">3</span>         <span class="n">case</span> <span class="s2">&#34;&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="mi">4</span>             <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Hello!&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="mi">5</span>         <span class="n">case</span> <span class="n">name</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="mi">6</span>             <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Hi </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">!&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">----&gt;</span> <span class="mi">7</span>     <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&#34;Santa&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="mi">8</span>         <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Match&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="ne">UnboundLocalError</span><span class="p">:</span> <span class="n">local</span> <span class="n">variable</span> <span class="s1">&#39;name&#39;</span> <span class="n">referenced</span> <span class="n">before</span> <span class="n">assignment</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>[3] Sequence mode</p>
<p>The results can be used in <code>match</code> in either list or tuple format. You can also use the <code>first, *rest = seq</code> pattern to unpack as described in <a href="https://peps.python.org/pep-3132/">PEP 3132 - Extended Iterable Unpacking</a>.</p>
<p>The first element of this <code>match</code> condition needs to be <code>1</code>, otherwise the match fails. The first <code>case</code> uses a list and unpacking, the second <code>case</code> uses a tuple, which is actually the same semantics as a list, and the third is still a list.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="k">def</span> <span class="nf">sequence</span><span class="p">(</span><span class="n">collection</span><span class="p">):</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>     <span class="n">match</span> <span class="n">collection</span><span class="p">:</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>         <span class="n">case</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">others</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>             <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Got 1 and a nested sequence: </span><span class="si">{</span><span class="n">x</span><span class="si">=}</span><span class="s2">, </span><span class="si">{</span><span class="n">others</span><span class="si">=}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>         <span class="n">case</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>             <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Got 1 and </span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>         <span class="n">case</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>             <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">x</span><span class="si">=}</span><span class="s2">, </span><span class="si">{</span><span class="n">y</span><span class="si">=}</span><span class="s2">, </span><span class="si">{</span><span class="n">z</span><span class="si">=}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="n">sequence</span><span class="p">([</span><span class="mi">1</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="n">sequence</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">Got</span> <span class="mi">1</span> <span class="ow">and</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="n">sequence</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mi">3</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="n">sequence</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]])</span>
</span></span><span class="line"><span class="cl"><span class="n">Got</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">a</span> <span class="n">nested</span> <span class="n">sequence</span><span class="p">:</span> <span class="n">x</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">others</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="n">sequence</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]])</span>
</span></span><span class="line"><span class="cl"><span class="n">Got</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">a</span> <span class="n">nested</span> <span class="n">sequence</span><span class="p">:</span> <span class="n">x</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">others</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="n">sequence</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="n">sequence</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">Got</span> <span class="mi">1</span> <span class="ow">and</span> <span class="mi">2</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>If the pattern after <code>case</code> is a single item, you can remove the parentheses and write it that way. However, note that <code>case 1, [x, *others]</code> cannot be written without the parentheses, and the logic of the decomposition will change if the parentheses are removed.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">sequence2</span><span class="p">(</span><span class="n">collection</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">match</span> <span class="n">collection</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">case</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">others</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Got 1 and a nested sequence: </span><span class="si">{</span><span class="n">x</span><span class="si">=}</span><span class="s2">, </span><span class="si">{</span><span class="n">others</span><span class="si">=}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">case</span> <span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Got 1 and </span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">case</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">x</span><span class="si">=}</span><span class="s2">, </span><span class="si">{</span><span class="n">y</span><span class="si">=}</span><span class="s2">, </span><span class="si">{</span><span class="n">z</span><span class="si">=}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>[4] Wildcard pattern</p>
<p>Use the single underscore <code>_</code> to match any result, <strong>but not bound (not assigned to a variable or variables)</strong>, the final <code>case _</code> is the wildcard pattern, but of course there can be multiple matches, and the sequence pattern mentioned earlier also supports <code>_</code>. The use of wildcards requires attention to the logical order, putting the small range in front and the large range in the back to prevent it from not meeting expectations.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">http_error</span><span class="p">(</span><span class="n">status</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">match</span> <span class="n">status</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="o">...</span>
</span></span><span class="line"><span class="cl">        <span class="n">case</span> <span class="n">_</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="s1">&#39;Unknown status code&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="k">def</span> <span class="nf">wildcard</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>     <span class="n">match</span> <span class="n">data</span><span class="p">:</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>         <span class="n">case</span> <span class="p">[</span><span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>             <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Some pair&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="n">wildcard</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="n">wildcard</span><span class="p">([</span><span class="mi">1</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="n">wildcard</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">Some</span> <span class="n">pair</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="k">def</span> <span class="nf">sequence2</span><span class="p">(</span><span class="n">collection</span><span class="p">):</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>     <span class="n">match</span> <span class="n">collection</span><span class="p">:</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>         <span class="n">case</span> <span class="p">[</span><span class="s2">&#34;a&#34;</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span><span class="p">,</span> <span class="s2">&#34;z&#34;</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>             <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;matches any sequence of length two or more that starts with &#34;a&#34; and ends with &#34;z&#34;.&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>         <span class="n">case</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span><span class="p">):</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>             <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;matches any sequence of length two or more.&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>         <span class="n">case</span> <span class="p">[</span><span class="o">*</span><span class="n">_</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>             <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;matches a sequence of any length.&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="n">sequence2</span><span class="p">([</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">matches</span> <span class="nb">any</span> <span class="n">sequence</span> <span class="n">of</span> <span class="n">length</span> <span class="n">two</span> <span class="ow">or</span> <span class="n">more</span> <span class="n">that</span> <span class="n">starts</span> <span class="k">with</span> <span class="s2">&#34;a&#34;</span> <span class="ow">and</span> <span class="n">ends</span> <span class="k">with</span> <span class="s2">&#34;z&#34;</span><span class="o">.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="n">sequence2</span><span class="p">([</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">matches</span> <span class="nb">any</span> <span class="n">sequence</span> <span class="n">of</span> <span class="n">length</span> <span class="n">two</span> <span class="ow">or</span> <span class="n">more</span><span class="o">.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="n">sequence2</span><span class="p">([</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">matches</span> <span class="nb">any</span> <span class="n">sequence</span> <span class="n">of</span> <span class="n">length</span> <span class="n">two</span> <span class="ow">or</span> <span class="n">more</span><span class="o">.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="n">sequence2</span><span class="p">([</span><span class="s1">&#39;a&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">matches</span> <span class="n">a</span> <span class="n">sequence</span> <span class="n">of</span> <span class="nb">any</span> <span class="n">length</span><span class="o">.</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>[5] Constant value mode</p>
<p>This pattern, mainly matches constants or enumeration values of the <code>enum</code> module.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="k">class</span> <span class="nc">Color</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>     <span class="n">RED</span> <span class="o">=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>     <span class="n">GREEN</span> <span class="o">=</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>     <span class="n">BLUE</span> <span class="o">=</span> <span class="mi">3</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="k">class</span> <span class="nc">NewColor</span><span class="p">:</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>     <span class="n">YELLOW</span> <span class="o">=</span> <span class="mi">4</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="k">def</span> <span class="nf">constant_value</span><span class="p">(</span><span class="n">color</span><span class="p">):</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>     <span class="n">match</span> <span class="n">color</span><span class="p">:</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>         <span class="n">case</span> <span class="n">Color</span><span class="o">.</span><span class="n">RED</span><span class="p">:</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>             <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Red&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>         <span class="n">case</span> <span class="n">NewColor</span><span class="o">.</span><span class="n">YELLOW</span><span class="p">:</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>             <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Yellow&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>         <span class="n">case</span> <span class="n">new_color</span><span class="p">:</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>             <span class="nb">print</span><span class="p">(</span><span class="n">new_color</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="n">constant_value</span><span class="p">(</span><span class="n">Color</span><span class="o">.</span><span class="n">RED</span><span class="p">)</span>  <span class="c1"># Match the first case</span>
</span></span><span class="line"><span class="cl"><span class="n">Red</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="n">constant_value</span><span class="p">(</span><span class="n">NewColor</span><span class="o">.</span><span class="n">YELLOW</span><span class="p">)</span>  <span class="c1"># Match the second case</span>
</span></span><span class="line"><span class="cl"><span class="n">Yellow</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="n">constant_value</span><span class="p">(</span><span class="n">Color</span><span class="o">.</span><span class="n">GREEN</span><span class="p">)</span>  <span class="c1"># Match the third case</span>
</span></span><span class="line"><span class="cl"><span class="n">Color</span><span class="o">.</span><span class="n">GREEN</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="n">constant_value</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>  <span class="c1"># The constant values match the second case as well</span>
</span></span><span class="line"><span class="cl"><span class="n">Yellow</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="n">constant_value</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>  <span class="c1"># Other constants</span>
</span></span><span class="line"><span class="cl"><span class="mi">10</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Note here that since <code>case</code> has a binding effect, you cannot use constants like <code>YELLOW</code> directly, which is wrong.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">YELLOW</span> <span class="o">=</span> <span class="mi">4</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">constant_value</span><span class="p">(</span><span class="n">color</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">match</span> <span class="n">color</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">case</span> <span class="n">YELLOW</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Yellow&#39;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>[6] Mapping mode</p>
<p>It&rsquo;s actually <code>case</code> followed by support for using a dictionary to do the matching.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="k">def</span> <span class="nf">mapping</span><span class="p">(</span><span class="n">config</span><span class="p">):</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>     <span class="n">match</span> <span class="n">config</span><span class="p">:</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>         <span class="n">case</span> <span class="p">{</span><span class="s1">&#39;sub&#39;</span><span class="p">:</span> <span class="n">sub_config</span><span class="p">,</span> <span class="o">**</span><span class="n">rest</span><span class="p">}:</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>             <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Sub: </span><span class="si">{</span><span class="n">sub_config</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>             <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;OTHERS: </span><span class="si">{</span><span class="n">rest</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>         <span class="n">case</span> <span class="p">{</span><span class="s1">&#39;route&#39;</span><span class="p">:</span> <span class="n">route</span><span class="p">}:</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>             <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;ROUTE: </span><span class="si">{</span><span class="n">route</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="n">mapping</span><span class="p">({})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="n">mapping</span><span class="p">({</span><span class="s1">&#39;route&#39;</span><span class="p">:</span> <span class="s1">&#39;/auth/login&#39;</span><span class="p">})</span>  <span class="c1"># Match the first case</span>
</span></span><span class="line"><span class="cl"><span class="n">ROUTE</span><span class="p">:</span> <span class="o">/</span><span class="n">auth</span><span class="o">/</span><span class="n">login</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Match dictionaries with sub keys, values are bound to sub_config and the rest of the dictionary is bound to rest</span>
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="n">mapping</span><span class="p">({</span><span class="s1">&#39;route&#39;</span><span class="p">:</span> <span class="s1">&#39;/auth/login&#39;</span><span class="p">,</span> <span class="s1">&#39;sub&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}})</span>  <span class="c1"># Match the second case</span>
</span></span><span class="line"><span class="cl"><span class="n">Sub</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">OTHERS</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;route&#39;</span><span class="p">:</span> <span class="s1">&#39;/auth/login&#39;</span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>[7] Class mode</p>
<p>After <code>case</code> supports any object to do matching, this is because for matching the <strong>position needs to be determined</strong> , so the position parameter needs to be used to identify it.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="k">def</span> <span class="nf">class_pattern</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>     <span class="n">match</span> <span class="n">obj</span><span class="p">:</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>         <span class="n">case</span> <span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>             <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;match&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="n">class_pattern</span><span class="p">(</span><span class="n">Point</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">match</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Another solution to this custom class that doesn&rsquo;t use positional arguments for matching is to use <code>__match_args__</code> to return an array of positional arguments, like this. Here <code>Point2</code> uses the standard library&rsquo;s <code>dataclasses.dataclass</code> decorator, which will provide the <code>__match_args__</code> property, so it can be used directly.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="k">class</span> <span class="nc">Point</span><span class="p">:</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>     <span class="n">__match_args__</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>         <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>         <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="nd">@dataclass</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span> <span class="k">class</span> <span class="nc">Point2</span><span class="p">:</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>     <span class="n">x</span><span class="p">:</span> <span class="nb">int</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>     <span class="n">y</span><span class="p">:</span> <span class="nb">int</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="k">def</span> <span class="nf">class_pattern</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>     <span class="n">match</span> <span class="n">obj</span><span class="p">:</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>         <span class="n">case</span> <span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>             <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Point(</span><span class="si">{</span><span class="n">x</span><span class="si">=}</span><span class="s1">,</span><span class="si">{</span><span class="n">y</span><span class="si">=}</span><span class="s1">)&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>         <span class="n">case</span> <span class="n">Point2</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>             <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Point2(</span><span class="si">{</span><span class="n">x</span><span class="si">=}</span><span class="s1">,</span><span class="si">{</span><span class="n">y</span><span class="si">=}</span><span class="s1">)&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="n">class_pattern</span><span class="p">(</span><span class="n">Point</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="n">class_pattern</span><span class="p">(</span><span class="n">Point2</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">Point2</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>[8] Combination (OR) mode</p>
<p>Multiple literals can be combined to represent an or relation using <code>|</code>, and <code>|</code> can exist more than one within a <code>case</code> condition to represent multiple or relations.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">or_pattern</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">match</span> <span class="n">obj</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">case</span> <span class="mi">0</span> <span class="o">|</span> <span class="mi">1</span> <span class="o">|</span> <span class="mi">2</span><span class="p">:</span> <span class="c1"># 0,1,2 three numbers match</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;small number&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">case</span> <span class="nb">list</span><span class="p">()</span> <span class="o">|</span> <span class="nb">set</span><span class="p">():</span>  <span class="c1"># List or set matching</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;list or set&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">case</span> <span class="nb">str</span><span class="p">()</span> <span class="o">|</span> <span class="nb">bytes</span><span class="p">():</span>  <span class="c1"># String or bytes match</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;str or bytes&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">case</span> <span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="o">|</span> <span class="n">Point2</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>  <span class="c1"># Borrowing from the previous 2 classes, one of them can match</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">x</span><span class="si">=}</span><span class="s1">,</span><span class="si">{</span><span class="n">y</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">case</span> <span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">|</span> <span class="n">x</span><span class="p">:</span>  <span class="c1"># list and only one element or single value matches the</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">x</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Note that the <code>[x]</code> in <code>case [x] | x</code> is not triggered because of the matching order, and <code>x</code> cannot be a set, string, <code>byte</code>, etc., because it will not be matched in the previous condition. Also, there is no <code>case</code> syntax in <code>Python</code> for the <code>AND</code> relationship.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="n">or_pattern</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">small</span> <span class="n">number</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="n">or_pattern</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">small</span> <span class="n">number</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="n">or_pattern</span><span class="p">([</span><span class="mi">1</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="nb">list</span> <span class="ow">or</span> <span class="nb">set</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="n">or_pattern</span><span class="p">({</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="nb">list</span> <span class="ow">or</span> <span class="nb">set</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="n">or_pattern</span><span class="p">(</span><span class="s1">&#39;sss&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">str</span> <span class="ow">or</span> <span class="nb">bytes</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="n">or_pattern</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;sd&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">str</span> <span class="ow">or</span> <span class="nb">bytes</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="n">or_pattern</span><span class="p">(</span><span class="n">Point</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="mi">2</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="n">or_pattern</span><span class="p">(</span><span class="n">Point2</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="mi">2</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="n">or_pattern</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span><span class="o">=</span><span class="mi">4</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="n">or_pattern</span><span class="p">({})</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span><span class="o">=</span><span class="p">{}</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>[9] AS mode</p>
<p>The <code>AS</code> pattern was actually a walrus pattern in the early days, but it was later discussed that the use of the <code>as</code> keyword would give the syntax an edge. It should be noted that <code>[0, int() as i]</code> in this case is a subpattern, that is, it contains patterns within patterns: <code>[0, int() as i]</code> is the sequence pattern matched by <code>case</code>, and where <code>int() as i</code> is the subpattern, it is the <code>AS</code> pattern.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="k">def</span> <span class="nf">as_pattern</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>     <span class="n">match</span> <span class="n">obj</span><span class="p">:</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>         <span class="n">case</span> <span class="nb">str</span><span class="p">()</span> <span class="k">as</span> <span class="n">s</span><span class="p">:</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>             <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Got str: </span><span class="si">{</span><span class="n">s</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>         <span class="n">case</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">()</span> <span class="k">as</span> <span class="n">i</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>             <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Got int: </span><span class="si">{</span><span class="n">i</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>         <span class="n">case</span> <span class="p">[</span><span class="nb">tuple</span><span class="p">()</span> <span class="k">as</span> <span class="n">tu</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>             <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Got tuple: </span><span class="si">{</span><span class="n">tu</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>         <span class="n">case</span> <span class="nb">list</span><span class="p">()</span> <span class="o">|</span> <span class="nb">set</span><span class="p">()</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">()</span> <span class="k">as</span> <span class="n">iterable</span><span class="p">:</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>             <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Got iterable: </span><span class="si">{</span><span class="n">iterable</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="n">as_pattern</span><span class="p">(</span><span class="s1">&#39;sss&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Got</span> <span class="nb">str</span><span class="p">:</span> <span class="n">s</span><span class="o">=</span><span class="s1">&#39;sss&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="n">as_pattern</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">Got</span> <span class="nb">int</span><span class="p">:</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="n">as_pattern</span><span class="p">([(</span><span class="mi">1</span><span class="p">,)])</span>
</span></span><span class="line"><span class="cl"><span class="n">Got</span> <span class="nb">tuple</span><span class="p">:</span> <span class="n">tu</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="n">as_pattern</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">Got</span> <span class="n">iterable</span><span class="p">:</span> <span class="n">iterable</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="n">as_pattern</span><span class="p">({</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="n">Got</span> <span class="n">iterable</span><span class="p">:</span> <span class="n">iterable</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>[10] Add conditions to the schema</p>
<p>The pattern also supports adding an <code>if</code> judgment (called <code>guard</code>), which allows the match to be further judged, equivalent to achieving some degree of <code>AND</code> effect.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="k">def</span> <span class="nf">go</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>     <span class="n">match</span> <span class="n">obj</span><span class="p">:</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>         <span class="n">case</span> <span class="p">[</span><span class="s1">&#39;go&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="p">]</span> <span class="k">if</span> <span class="n">direction</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;east&#39;</span><span class="p">,</span> <span class="s1">&#39;north&#39;</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>             <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Right way&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>         <span class="n">case</span> <span class="n">direction</span> <span class="k">if</span> <span class="n">direction</span> <span class="o">==</span> <span class="s1">&#39;west&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>             <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Wrong way&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>         <span class="n">case</span> <span class="p">[</span><span class="s1">&#39;go&#39;</span><span class="p">,</span> <span class="n">_</span><span class="p">]</span> <span class="o">|</span> <span class="n">_</span><span class="p">:</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>             <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Other way&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="n">go</span><span class="p">([</span><span class="s1">&#39;go&#39;</span><span class="p">,</span> <span class="s1">&#39;east&#39;</span><span class="p">])</span>  <span class="c1"># Matching condition 1</span>
</span></span><span class="line"><span class="cl"><span class="n">Right</span> <span class="n">way</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="n">go</span><span class="p">(</span><span class="s1">&#39;west&#39;</span><span class="p">)</span>  <span class="c1"># Matching condition 2</span>
</span></span><span class="line"><span class="cl"><span class="n">Wrong</span> <span class="n">way</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="n">go</span><span class="p">(</span><span class="s1">&#39;north&#39;</span><span class="p">)</span>  <span class="c1"># Match default conditions</span>
</span></span><span class="line"><span class="cl"><span class="n">Other</span> <span class="n">way</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="n">go</span><span class="p">([</span><span class="s1">&#39;go&#39;</span><span class="p">,</span> <span class="s1">&#39;west&#39;</span><span class="p">])</span>  <span class="c1"># Match default conditions</span>
</span></span><span class="line"><span class="cl"><span class="n">Other</span> <span class="n">way</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h2 id="8-bpo-12782">8. BPO 12782</h2>
<blockquote>
<p>New Context Manager syntax</p>
</blockquote>
<p>In previous versions, sometimes we wanted to put multiple contexts inside a <code>with</code> on a long line, and a common way to do this was to use a backslash, which would align <code>open</code>. But writing it this way caused code checking tools like <code>pep8</code> and <code>black</code> to report an error: they all thought that backslashes should not be used to explicitly continue a line.</p>
<ul>
<li>
<p>The previous writing style</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;input&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="nb">input</span><span class="p">,</span> \
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>      <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;output&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output</span><span class="p">:</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>     <span class="o">...</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>New writing style</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="k">with</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>     <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;input&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="nb">input</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>     <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;output&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span> <span class="p">):</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>     <span class="o">...</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Now you can add a bracket to these context managers and it&rsquo;s perfect, in fact you can use <code>with</code> to enclose multiple context managers (<code>Context Manager</code>) in brackets.</p>
</li>
</ul>
<h2 id="9-note">9. Note</h2>
<blockquote>
<p>Introduce the new features of the module and analyze their use and usage.</p>
</blockquote>
<ul>
<li>[1] itertools.pairwise</li>
</ul>
<p>Its a way to return iterators in the form of elements of an iterable object in order, with two elements placed next to each other in a group. The package <a href="https://more-itertools.readthedocs.io/">more-itertools</a> was available in previous versions and has now been added to the standard library.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">pairwise</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]))</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">:</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">pairwise</span><span class="p">(</span><span class="s1">&#39;ABCDE&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">:</span> <span class="p">[(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">)]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>[2] contextlib.aclosing</li>
</ul>
<p>The standard <code>contextlib.closing</code> decorator has been introduced before, and <code>contextlib.closing</code> is actually just a version of <code>async</code>. As officially described, its role is to implement the following logic.</p>
<p>A good habit with <code>Python</code> is to close the file handle when the operation is done, and the built-in <code>open</code> with <code>with</code> is a good practice. It works by calling <code>ff.__exit__</code> to automatically close the file handle when the block is finished.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;new.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>     <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;A</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="n">ff</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;new.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="n">ff</span><span class="o">.</span><span class="n">closed</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">:</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="n">ff</span><span class="o">.</span><span class="fm">__exit__</span><span class="p">()</span>  <span class="c1"># with will call it</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="n">ff</span><span class="o">.</span><span class="n">closed</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">:</span> <span class="kc">True</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>But note that not all <code>open</code> methods natively support <code>with</code> (or provide <code>__exit__</code> and <code>__enter__</code> methods), and of course there are other types of operations that need to be made sure to be closed (even if an exception is thrown). In fact, the <code>with</code> syntax is generally supported by standard libraries or well-known projects, but may not be available when writing your own or corporate projects, for example, I define a class like this.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="k">class</span> <span class="nc">Database</span><span class="p">:</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>         <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Closed&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="k">with</span> <span class="n">Database</span><span class="p">()</span> <span class="k">as</span> <span class="n">d</span><span class="p">:</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>     <span class="o">...</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>
</span></span><span class="line"><span class="cl"><span class="o">---------------------------------------------------------------------------</span>
</span></span><span class="line"><span class="cl"><span class="ne">AttributeError</span>                            <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">23</span><span class="o">-</span><span class="n">f0ea085f7488</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">----&gt;</span> <span class="mi">1</span> <span class="k">with</span> <span class="n">Database</span><span class="p">()</span> <span class="k">as</span> <span class="n">d</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">      <span class="mi">2</span>     <span class="o">...</span>
</span></span><span class="line"><span class="cl">      <span class="mi">3</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="ne">AttributeError</span><span class="p">:</span> <span class="fm">__enter__</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>So, you can wrap it with <code>contextlib.closing</code>. And <code>contextlib.closing</code> is actually a version of <code>asyncio</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="kn">import</span> <span class="nn">contextlib</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="k">with</span> <span class="n">contextlib</span><span class="o">.</span><span class="n">closing</span><span class="p">(</span><span class="n">Database</span><span class="p">())</span> <span class="k">as</span> <span class="n">d</span><span class="p">:</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>     <span class="o">...</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>
</span></span><span class="line"><span class="cl"><span class="n">Closed</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">contextlib</span> <span class="kn">import</span> <span class="n">aclosing</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">async</span> <span class="k">with</span> <span class="n">aclosing</span><span class="p">(</span><span class="n">my_generator</span><span class="p">())</span> <span class="k">as</span> <span class="n">values</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">async</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="mi">42</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">break</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>[3] contextlib.AsyncContextDecorator</p>
<p><code>contextlibContext.Decorator</code> was added in <code>Python 3.2</code>, which is the basis for <code>contextlib.contextmanager</code>, as expressed in the class name, and which serves to allow the context manager to be used as a decorator.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="c1"># The most basic context manager without parameters</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">mycontext</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Starting&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="bp">self</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">exc</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Finishing&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># You can use the with syntax like this</span>
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="k">with</span> <span class="n">mycontext</span><span class="p">():</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Inner&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>
</span></span><span class="line"><span class="cl"><span class="n">Starting</span>
</span></span><span class="line"><span class="cl"><span class="n">Inner</span>
</span></span><span class="line"><span class="cl"><span class="n">Finishing</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>What if you want to change the management of this context to a decorator? Just make <code>mycontext</code> inherit from the base class <code>contextlib.ContextDecorator</code>, isn&rsquo;t that convenient? So <code>contextlib.AsyncContextDecorator</code> is actually the version of <code>asyncio</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="k">class</span> <span class="nc">mycontext</span><span class="p">(</span><span class="n">contextlib</span><span class="o">.</span><span class="n">ContextDecorator</span><span class="p">):</span>  <span class="c1"># Note the inheritance here</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>         <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Starting&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>         <span class="k">return</span> <span class="bp">self</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">exc</span><span class="p">):</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>         <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Finishing&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>         <span class="k">return</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="nd">@mycontext</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span> <span class="k">def</span> <span class="nf">p</span><span class="p">():</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Inner&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">:</span> <span class="n">p</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">Starting</span>
</span></span><span class="line"><span class="cl"><span class="n">Inner</span>
</span></span><span class="line"><span class="cl"><span class="n">Finishing</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">mycontext</span><span class="p">(</span><span class="n">AsyncContextDecorator</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">async</span> <span class="k">def</span> <span class="fm">__aenter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Starting&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="bp">self</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">async</span> <span class="k">def</span> <span class="fm">__aexit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">exc</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Finishing&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">False</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h2 id="10-reference">10. Reference</h2>
<ul>
<li><a href="https://www.escapelife.site/posts/584a5e6a.html">https://www.escapelife.site/posts/584a5e6a.html</a></li>
<li><a href="https://www.escapelife.site/posts/584a5e6a.html"># What&rsquo;s New In Python 3.10</a></li>
<li><a href="https://www.dongwm.com/post/python-3-10-new-typing-feature/">Python 3.10 adds four new features related to the type system</a></li>
<li><a href="https://peps.python.org/pep-0604/">https://peps.python.org/pep-0604/</a></li>
<li><a href="https://peps.python.org/pep-0612/">https://peps.python.org/pep-0612/</a></li>
<li><a href="https://peps.python.org/pep-0647/">https://peps.python.org/pep-0647/</a></li>
<li><a href="https://peps.python.org/pep-0613/">https://peps.python.org/pep-0613/</a></li>
<li><a href="https://www.dongwm.com/post/match-case/">Python 3.10 Match-Case Syntax Explained</a></li>
</ul>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/python/">python</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2022-08/dockerhub-download-rate-limits-in-microk8s/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Solutions when Kubernetes or MicroK8s encounters Docker Hub download limitations</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2022-08/zookeeper-zab/">
            <span class="next-text nav-default">ZooKeeper and Zab Protocol</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  <script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox-3.1.20.min.js"></script>



<script type="text/javascript" src="/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js"></script>








</body>
</html>
