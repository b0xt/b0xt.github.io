<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Property Reflection in C&#43;&#43; - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="This article explores property reflection in c&#43;&#43; based on a case study." /><meta name="keywords" content="c&#43;&#43;, Property Reflection" />






<meta name="generator" content="Hugo 0.102.0 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2022-08/cpp-prop-reflect/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link href="/lib/fancybox/jquery.fancybox-3.1.20.min.css" rel="stylesheet">


<meta property="og:title" content="Property Reflection in C&#43;&#43;" />
<meta property="og:description" content="This article explores property reflection in c&#43;&#43; based on a case study." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2022-08/cpp-prop-reflect/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-08-28T10:52:29+08:00" />
<meta property="article:modified_time" content="2022-08-28T10:52:29+08:00" />

<meta itemprop="name" content="Property Reflection in C&#43;&#43;">
<meta itemprop="description" content="This article explores property reflection in c&#43;&#43; based on a case study."><meta itemprop="datePublished" content="2022-08-28T10:52:29+08:00" />
<meta itemprop="dateModified" content="2022-08-28T10:52:29+08:00" />
<meta itemprop="wordCount" content="1692">
<meta itemprop="keywords" content="c&#43;&#43;," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Property Reflection in C&#43;&#43;"/>
<meta name="twitter:description" content="This article explores property reflection in c&#43;&#43; based on a case study."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SOBYTE</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SOBYTE</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Property Reflection in C&#43;&#43;</h1>

      <div class="post-meta">
        <span class="post-time"> 2022-08-28 10:52:29 </span>
        <div class="post-category">
            <a href="/categories/tutorials/"> tutorials </a>
            </div>
          <span class="more-meta"> 1692 words </span>
          <span class="more-meta"> 4 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#1-preface">1 Preface</a></li>
        <li><a href="#2-case">2 Case</a></li>
        <li><a href="#3-extended-reading">3 Extended reading</a>
          <ul>
            <li><a href="#31-offsets">3.1 Offsets</a></li>
            <li><a href="#32-runtime">3.2 Runtime</a></li>
            <li><a href="#33-compile-time">3.3 Compile-time</a></li>
          </ul>
        </li>
        <li><a href="#4-conclusion">4 Conclusion</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <h2 id="1-preface">1 Preface</h2>
<p>Java/Go languages have built-in reflection mechanism to support getting information about classes/methods/properties at runtime. Reflection mechanism has many application scenarios, such as the most common data serialization, if there is no reflection mechanism, either based on code generation, such as protobuf; or is a line of hand-written code that is pure manual work.</p>
<p>C++ does not have a built-in set of reflection mechanisms, and implementing reflection mechanisms is a frequent topic of discussion in C++. Considering C++ has a strong meta-template coding capability, it is accurate to say that C++ is somewhat introspective during compilation, provides some is_xxx function collections and template extraction capabilities, but does not support dynamic reflection because it does not have a runtime environment like Java/Go languages, and is very weak and difficult to use during compilation.</p>
<p>There are a number of open source third-party reflection libraries for C++, and they are implemented in one of two ways.</p>
<ul>
<li>Compile-time reflection: it traverses the class/property/method at compile time and supports user filtering, provides static additional meta information for the class/property/method, and saves them for the runtime API.</li>
<li>Runtime reflection: provide a set of management framework to register and manage class/property/method information at runtime, and then get the corresponding information from the framework when used</li>
</ul>
<p>Some time ago, I was trying to locate a problem with a C++ product (20 years old), and I found that there was a shadow of runtime reflection in the code, but the code did not refine the concept of reflection, and the code was fragmented.</p>
<h2 id="2-case">2 Case</h2>
<p>Configuration management is the most commonly used capability in each system. The case code is configuration client code where the client interacts with the configuration center and needs to support the following minimum functions.</p>
<ul>
<li>Reading of the configuration</li>
<li>Configuration change refresh</li>
</ul>
<p>Seems like a very simple requirement, but when all business-level configuration items of the product are managed through it, the configuration data is large, plus some quality attributes (real-time change notification, full synchronization within seconds) the requirements are different, or look at the code first. To simplify the problem statement, the code implementation has been heavily streamlined (the original code implementation is too complex) to restore the most original design ideas.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/08/28/c402844dd8ed4971b87c419950db1527.png" alt="design"></p>
<p>Design of the above class diagram.</p>
<ul>
<li>interface IConfig: provides the configuration initialization, update interface</li>
<li>ValueInfo: describe the meta-information of each configuration item, such as name, type, the use of offset later, in addition to the class named ValueInfo is not considered, should be called ConfigItemMeta can be better</li>
<li>abstract class ConfigBase: key method InitValueInfoMap, initialize all the configuration items defined; GetValueInfo returns the configuration object all the configuration items collection</li>
<li>ConfigManager: responsible for interacting with the configuration center, managing all IConfig instances, synchronizing configuration items from the configuration center to IConfig instances at regular intervals (or receiving change events through in then synchronized)</li>
<li>Configuration object: ConfigA, ConfigB are specific configuration class definition, it combines a set of similar configuration items, its member variables are configuration items.</li>
<li>ServiceLogic: To simplify the description, I will use a generic class ServiceLogic business logic, business logic classes will aggregate specific configuration objects, using the above configuration items, a configuration object can be used by multiple business logic within</li>
</ul>
<p>We can still see his original design intent.</p>
<ul>
<li>For the sake of abstraction, configuration synchronization and notification should not be aware of the figurative ConfigA, ConfigB member variable names, otherwise it is necessary to transform IConfig down to the specific ConfigA, one by one configuration item assignment, which has the disadvantage of leading to two-way dependency, the second is that the code is not universal, pure manual work, and maintenance is also troublesome. GetValueInfo method GetValueInfo method plays a key role to get the configuration item definition</li>
<li>For the sake of performance, the business logic sees the figurative ConfigA, ConfigB, and can directly cfgAtr-&gt;m_userName to get the value of the configuration item, rather than a generic configuration table through the configuration ID to query the configuration value, which has the disadvantage of involving a lookup, and the second is that it involves type conversion</li>
</ul>
<p>The question is how to update the configuration value to the corresponding member variable by getting the configuration definition? In reality, there is also the problem of multi-threaded concurrency, assuming that there is only one thread processing the business logic and the configuration update at the same time. If it is a Java language, it is easy to update the values through reflection. The original authors took advantage of the memory layout feature of C++ objects, as seen in the implementation of the InitValueInfoMap method of each class.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">ConfigA</span><span class="o">::</span><span class="n">InitValueInfoMap</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Pseudocode implemented by source code, the code can be optimized and encapsulated as a function, the registration of a member variable requires only one function call
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">ValueInfo</span> <span class="n">valueInfo1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ValueInfo</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">valueInfo1</span><span class="o">-&gt;</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#34;UserName&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">valueInfo1</span><span class="o">-&gt;</span><span class="n">valueType</span> <span class="o">=</span> <span class="n">ValueType</span><span class="p">.</span><span class="n">String</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">valueInfo1</span><span class="o">-&gt;</span><span class="n">offset</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">m_userName</span> <span class="o">-</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="n">IConfig</span><span class="o">*&gt;</span><span class="p">(</span><span class="k">this</span><span class="p">);</span> <span class="c1">// There are alerts, please ignore them first
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">(</span><span class="o">*</span><span class="n">m_valueInfos</span><span class="p">)[</span><span class="n">valueInfo1</span><span class="p">.</span><span class="n">name</span><span class="p">]</span><span class="o">=</span> <span class="n">valueInfo1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Omit the other member variables and add m_valueInfos
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ValueInfo.offset is a record of the offset of each configuration item (member variable) to the IConfig pointer.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">ConfigBase</span><span class="o">::</span><span class="n">Update</span><span class="p">(</span><span class="n">string</span> <span class="n">name</span><span class="p">,</span> <span class="n">string</span> <span class="n">value</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Pseudocode
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">ValueInfo</span> <span class="n">value</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="n">GetValueInfo</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">find</span><span class="p">(</span><span class="n">name</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="o">*</span><span class="p">((</span><span class="n">string</span><span class="o">*</span><span class="p">)((</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="n">IConfig</span><span class="o">*&gt;</span><span class="p">(</span><span class="k">this</span><span class="p">)</span> <span class="o">+</span> <span class="n">value</span><span class="o">-&gt;</span><span class="n">offset</span><span class="p">))</span> <span class="o">=</span> <span class="n">value</span><span class="p">;</span> <span class="c1">// For other types, you must also convert the type
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>At this point we have probably figured out that this is actually dynamic reflection, registering first, and then assigning values to member variable addresses based on the registration information. When ConfigManager receives the configuration change, it calculates the address of the member variable of the subclass by the offset of the variable in the base class, and then assigns the value.</p>
<p>Another question is why not record the member address pointer directly instead of the offset? It should still be for performance, ConfigA class can have multiple object instances, and no matter how many instances, according to the memory layout it is known that the offset of member variables will not change. The actual code of ConfigBase::m_valueInfos is defined as a member variable of the class (not static), but it points to a static global variable in ConfigBase.cpp, which should be designed to record the member address pointer at the earliest, and the performance optimization is to record the offset later. And also note in the code that the InitValueInfoMap method only needs to be called once, and performance is reduced from X seconds to XX milliseconds.</p>
<h2 id="3-extended-reading">3 Extended reading</h2>
<h3 id="31-offsets">3.1 Offsets</h3>
<p>Suppose there is a structure <code>Point { int x; int y; }</code> and the method to get the offset of member variables is as follows.</p>
<p>Method 1</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">Point</span><span class="o">::*</span> <span class="n">offsetX</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">Point</span><span class="o">::</span><span class="n">x</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">Point</span><span class="o">::*</span> <span class="n">offsetY</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">Point</span><span class="o">::</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">long</span> <span class="n">offsetX_</span> <span class="o">=</span> <span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="kt">long</span><span class="o">&gt;</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="kt">void</span><span class="o">**</span><span class="p">)(</span><span class="o">&amp;</span><span class="n">offsetX</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="kt">long</span> <span class="n">offsetY_</span> <span class="o">=</span> <span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="kt">long</span><span class="o">&gt;</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="kt">void</span><span class="o">**</span><span class="p">)(</span><span class="o">&amp;</span><span class="n">offsetY</span><span class="p">));</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Method 2</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="c1">// 即 ((int)&amp;((structure*)0)-&gt;member);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">long</span> <span class="n">offsetX</span> <span class="o">=</span> <span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="kt">long</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="n">Point</span><span class="o">*&gt;</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl"><span class="kt">long</span> <span class="n">offsetY</span> <span class="o">=</span> <span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="kt">long</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="n">Point</span><span class="o">*&gt;</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span><span class="o">-&gt;</span><span class="n">y</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>To further understand the memory layout of C++ objects, it is recommended to read &ldquo;Exploring C++ Object Model in Depth&rdquo;. Especially when it comes to considering functions, considering inheritance, multiple inheritance combination is too complicated. Back to the case above, calculating the offset relative to the base class (interface) with address translation is hard to understand, and bare pointer operations can be risky.</p>
<h3 id="32-runtime">3.2 Runtime</h3>
<p>Some open source implementations of runtime reflection, which are implemented in a similar way, mainly depending on the completeness of its implementation are.</p>
<ul>
<li><a href="https://github.com/rttrorg/rttr">rtr</a></li>
<li><a href="https://github.com/skypjack/meta">meta</a></li>
<li><a href="https://github.com/Ubpa/UDRefl">UDRefl</a></li>
<li><a href="https://github.com/billyquith/ponder">ponder</a></li>
</ul>
<p>Let&rsquo;s look at the first open source, using the sample example below. See the code is not feeling with the case of the type of code ideas, but the case of the management of properties rubbed in the code of the configuration class, without extracting a simple class property management framework.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;rttr/registration&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">rttr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">MyStruct</span> <span class="p">{</span> <span class="n">MyStruct</span><span class="p">()</span> <span class="p">{};</span> <span class="kt">void</span> <span class="nf">func</span><span class="p">(</span><span class="kt">double</span><span class="p">)</span> <span class="p">{};</span> <span class="kt">int</span> <span class="n">data</span><span class="p">;</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">RTTR_REGISTRATION</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">registration</span><span class="o">::</span><span class="n">class_</span><span class="o">&lt;</span><span class="n">MyStruct</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&#34;MyStruct&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">         <span class="p">.</span><span class="n">constructor</span><span class="o">&lt;&gt;</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">         <span class="p">.</span><span class="n">property</span><span class="p">(</span><span class="s">&#34;data&#34;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">MyStruct</span><span class="o">::</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">         <span class="p">.</span><span class="n">method</span><span class="p">(</span><span class="s">&#34;func&#34;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">MyStruct</span><span class="o">::</span><span class="n">func</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>These open source libraries they have a common feature: there is a container or registration manager for the registration and storage of various information about the type.</p>
<h3 id="33-compile-time">3.3 Compile-time</h3>
<p>Starting from C++11, some Attributes are added, which are used to give the compiler some extra information to generate some optimization or specific code, and also to give some hints to other developers. For example.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="na">[[carries_dependency]]</span> <span class="n">C</span><span class="o">++</span><span class="mi">11</span><span class="p">,</span> <span class="n">Let</span> <span class="n">compile</span><span class="o">-</span><span class="n">time</span> <span class="n">skip</span> <span class="n">unnecessary</span> <span class="n">memory</span> <span class="n">fence</span> <span class="n">instructions</span>
</span></span><span class="line"><span class="cl"><span class="na">[[noreturn]]</span> <span class="n">C</span><span class="o">++</span><span class="mi">11</span><span class="p">,</span> <span class="n">function</span> <span class="n">will</span> <span class="n">not</span> <span class="k">return</span>
</span></span><span class="line"><span class="cl"><span class="na">[[deprecated]]</span> <span class="n">C</span><span class="o">++</span><span class="mi">11</span><span class="p">,</span> <span class="n">Warning</span> <span class="n">that</span> <span class="n">the</span> <span class="n">function</span> <span class="n">will</span> <span class="n">be</span> <span class="n">deprecated</span>
</span></span><span class="line"><span class="cl"><span class="na">[[fallthrough]]</span> <span class="n">C</span><span class="o">++</span><span class="mi">17</span><span class="p">,</span> <span class="n">The</span> <span class="n">hints</span> <span class="n">used</span> <span class="n">in</span> <span class="k">switch</span> <span class="n">can</span> <span class="n">be</span> <span class="n">dropped</span> <span class="n">directly</span><span class="p">,</span> <span class="n">without</span> <span class="k">break</span>
</span></span><span class="line"><span class="cl"><span class="na">[[nodiscard]]</span> <span class="n">C</span><span class="o">++</span><span class="mi">17</span><span class="p">,</span> <span class="n">indicates</span> <span class="n">that</span> <span class="n">the</span> <span class="n">modifier</span> <span class="n">cannot</span> <span class="n">be</span> <span class="n">ignored</span> <span class="n">and</span> <span class="n">can</span> <span class="n">be</span> <span class="n">used</span> <span class="n">to</span> <span class="n">modify</span> <span class="n">a</span> <span class="n">function</span> <span class="n">to</span> <span class="n">indicate</span> <span class="n">that</span> <span class="n">the</span> <span class="k">return</span> <span class="n">value</span> <span class="n">must</span> <span class="n">be</span> <span class="n">processed</span>
</span></span><span class="line"><span class="cl"><span class="na">[[maybe_unused]]</span> <span class="n">C</span><span class="o">++</span><span class="mi">17</span><span class="p">,</span> <span class="n">Hint</span> <span class="n">that</span> <span class="n">compiler</span> <span class="n">modifications</span> <span class="n">may</span> <span class="n">not</span> <span class="n">be</span> <span class="n">used</span> <span class="n">at</span> <span class="n">the</span> <span class="n">moment</span> <span class="n">to</span> <span class="n">avoid</span> <span class="n">warnings</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Unfortunately, these are only for compiler use, C++ does not have a runtime environment, and it is not possible to use them at runtime, like Java&rsquo;s Annotion and Go&rsquo;s Tag. But the takeaway for us is that it is also possible to define Attribute for some methods or member variables, and let the compiler generate code with the corresponding metadata information that can be used at runtime.</p>
<p>The custom Attribute needs to be interpreted by the compiler based on it, and after a search, Github does have an interpreted wrapper library for C++ ASTs <a href="https://github.com/foonathan/cppast">cppast</a> and can be used with Clang.</p>
<p>Static reflection was also proposed to the C++ standards organization in 2014 <a href="https://open-std.org/jtc1/sc22/wg21/docs/papers/2014/n3996.pdf">Static reflection</a>, and after a preliminary review of the documentation, the technical specifications are defined in Chapter 4 :</p>
<ul>
<li>Conceptual types of metadata objects</li>
<li>Conceptual conversion C++ specific code</li>
<li>Reflection functions and operators</li>
</ul>
<h2 id="4-conclusion">4 Conclusion</h2>
<p>In this paper, we have understood the author&rsquo;s design intent by reducing the original design of configuration management, which makes use of C++ member variable offsets to facilitate uniform update operations on configuration items. This leads to a walk-through of the C++ reflection mechanism, taking a look at runtime and compile-time reflection. If you are thinking about a reflection framework, you can take a look.</p>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/c&#43;&#43;/">c&#43;&#43;</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2022-08/linkerd-timeout-retry/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Linkerd implements timeouts and retries via ServiceProfile</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2022-08/k8s-resource-quotas/">
            <span class="next-text nav-default">Kubernetes Resource Quotas</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  <script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox-3.1.20.min.js"></script>



<script type="text/javascript" src="/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js"></script>








</body>
</html>
