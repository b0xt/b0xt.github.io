<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Quickly build new clusters on Kubernetes with Crossplane and VCluster - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="Learn how to quickly build new clusters on Kubernetes using Crossplane and VCluster." /><meta name="keywords" content="Kubernetes clusters, Crossplane, VCluster" />






<meta name="generator" content="Hugo 0.101.0 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2022-08/k8s-crossplane-vcluster/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link href="/lib/fancybox/jquery.fancybox-3.1.20.min.css" rel="stylesheet">


<meta property="og:title" content="Quickly build new clusters on Kubernetes with Crossplane and VCluster" />
<meta property="og:description" content="Learn how to quickly build new clusters on Kubernetes using Crossplane and VCluster." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2022-08/k8s-crossplane-vcluster/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-08-10T09:48:06+08:00" />
<meta property="article:modified_time" content="2022-08-10T09:48:06+08:00" />

<meta itemprop="name" content="Quickly build new clusters on Kubernetes with Crossplane and VCluster">
<meta itemprop="description" content="Learn how to quickly build new clusters on Kubernetes using Crossplane and VCluster."><meta itemprop="datePublished" content="2022-08-10T09:48:06+08:00" />
<meta itemprop="dateModified" content="2022-08-10T09:48:06+08:00" />
<meta itemprop="wordCount" content="2639">
<meta itemprop="keywords" content="kubernetes," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Quickly build new clusters on Kubernetes with Crossplane and VCluster"/>
<meta name="twitter:description" content="Learn how to quickly build new clusters on Kubernetes using Crossplane and VCluster."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SOBYTE</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SOBYTE</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Quickly build new clusters on Kubernetes with Crossplane and VCluster</h1>

      <div class="post-meta">
        <span class="post-time"> 2022-08-10 09:48:06 </span>
        <div class="post-category">
            <a href="/categories/tutorials/"> tutorials </a>
            </div>
          <span class="more-meta"> 2639 words </span>
          <span class="more-meta"> 13 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#example">Example</a>
          <ul>
            <li><a href="#installing-crossplane">Installing Crossplane</a></li>
            <li><a href="#creating-vclusters-with-crossplane-composition">Creating VClusters with Crossplane Composition</a></li>
          </ul>
        </li>
        <li><a href="#summary">Summary</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p><a href="https://github.com/crossplane/crossplane">Crossplane</a> is an open source Kubernetes plugin that solves the problem of provisioning cloud resources by extending the Kubernetes API. When using Crossplane, you can define declaratively what cloud resources need to be created for your application to work properly, without writing any code. The definition of these cloud resources can be done directly by creating the associated CRD objects, which can be thought of as a cloud-native version of <code>Terraform</code>.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/08/10/b9e864b1ef1741eb9637ffd7cf4c7b58.png" alt="Crossplane"></p>
<p><a href="https://www.vcluster.com/">VCluster</a> is a tool that provides flexibility and cost savings through lightweight virtual Kubernetes clusters. Using VCluster, you can create an isolated virtual Kubernetes cluster within a Kubernetes cluster. This greatly reduces the complexity of creating and maintaining a Kubernetes cluster control plane.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/08/10/8eaacef53ed64fe49e485cf2b366e642.png" alt="VCluster"></p>
<p>The following table compares the isolation levels and management complexity of using namespaces, vcluster, and Kubernetes clusters.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/08/10/1067c743840b4937a330f216273d67d7.png" alt="table"></p>
<p>So what happens when we combine the two tools <code>Crossplane</code> and <code>VCluster</code> together? We will use an example to illustrate the use of these two tools together.</p>
<h2 id="example">Example</h2>
<p>In this example we want to implement some functionality as shown below.</p>
<ul>
<li>Have a cluster that can receive requests to start a new cluster environment</li>
<li>These environments will be able to use Helm to install applications</li>
<li>The team requesting the new environment doesn&rsquo;t care where the cluster was created, so using VCluster or creating a Kubernetes cluster in a cloud provider should provide a similar experience for end users.</li>
</ul>
<p>Here I&rsquo;m using KinD in my local environment for this demonstration, and a list of relevant resources can be found here <a href="https://github.com/salaboy/from-monolith-to-k8s/tree/main/platform/crossplane-vcluster">https://github.com/salaboy/from-monolith-to-k8s/tree/main/platform/crossplane-vcluster</a> (you need to install them yourself in advance) kubectl, helm, kind).</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/08/10/adf69ccabe064c94a42663581fe76185.png" alt="Example"></p>
<p>As shown above, we just need to create a KinD cluster (or of course any other Kuberentes cluster) and install <code>Crossplane</code> and <code>Crossplane Helm Provider</code> on the cluster, since we are not creating any cloud resources here, we don&rsquo;t need to configure any other <code>Crossplane Provider</code> (e.g. GCP, AWS, Azure, etc.).</p>
<h3 id="installing-crossplane">Installing Crossplane</h3>
<p>Next we can start by creating a Kubernetes cluster using KinD.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ kind create cluster
</span></span><span class="line"><span class="cl">Creating cluster <span class="s2">&#34;kind&#34;</span> ...
</span></span><span class="line"><span class="cl"> ✓ Ensuring node image <span class="o">(</span>kindest/node:v1.23.4<span class="o">)</span> 🖼
</span></span><span class="line"><span class="cl"> ✓ Preparing nodes 📦
</span></span><span class="line"><span class="cl"> ✓ Writing configuration 📜
</span></span><span class="line"><span class="cl"> ✓ Starting control-plane 🕹️
</span></span><span class="line"><span class="cl"> ✓ Installing CNI 🔌
</span></span><span class="line"><span class="cl"> ✓ Installing StorageClass 💾
</span></span><span class="line"><span class="cl">Set kubectl context to <span class="s2">&#34;kind-kind&#34;</span>
</span></span><span class="line"><span class="cl">You can now use your cluster with:
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">kubectl cluster-info --context kind-kind
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Have a question, bug, or feature request? Let us know! https://kind.sigs.k8s.io/#community 🙂
</span></span><span class="line"><span class="cl">$ kubectl get nodes
</span></span><span class="line"><span class="cl">NAME                 STATUS   ROLES                  AGE   VERSION
</span></span><span class="line"><span class="cl">kind-control-plane   Ready    control-plane,master   56s   v1.23.4
</span></span></code></pre></td></tr></table>
</div>
</div><p>Once the cluster is ready we can then install <code>Crossplane</code> and <code>Crossplane Helm Provider</code> into our KinD cluster as follows.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ kubectl create ns crossplane-system
</span></span><span class="line"><span class="cl">namespace/crossplane-system created
</span></span><span class="line"><span class="cl">$ helm install crossplane --namespace crossplane-system crossplane-stable/crossplane
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">NAME: crossplane
</span></span><span class="line"><span class="cl">LAST DEPLOYED: Tue Aug  <span class="m">9</span> 15:20:22 <span class="m">2022</span>
</span></span><span class="line"><span class="cl">NAMESPACE: crossplane-system
</span></span><span class="line"><span class="cl">STATUS: deployed
</span></span><span class="line"><span class="cl">REVISION: <span class="m">1</span>
</span></span><span class="line"><span class="cl">TEST SUITE: None
</span></span><span class="line"><span class="cl">NOTES:
</span></span><span class="line"><span class="cl">Release: crossplane
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Chart Name: crossplane
</span></span><span class="line"><span class="cl">Chart Description: Crossplane is an open <span class="nb">source</span> Kubernetes add-on that enables platform teams to assemble infrastructure from multiple vendors, and expose higher level self-service APIs <span class="k">for</span> application teams to consume.
</span></span><span class="line"><span class="cl">Chart Version: 1.9.0
</span></span><span class="line"><span class="cl">Chart Application Version: 1.9.0
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Kube Version: v1.23.4
</span></span></code></pre></td></tr></table>
</div>
</div><p>After installation, two Pods will be run under the <code>crossplane-system</code> namespace as follows.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ kubectl get pods -n crossplane-system
</span></span><span class="line"><span class="cl">NAME                                       READY   STATUS    RESTARTS   AGE
</span></span><span class="line"><span class="cl">crossplane-c9b9fc9f9-4hn47                 1/1     Running   <span class="m">0</span>          11m
</span></span><span class="line"><span class="cl">crossplane-rbac-manager-56c8ff5b65-8lgrp   1/1     Running   <span class="m">0</span>          11m
</span></span></code></pre></td></tr></table>
</div>
</div><p>Then you need to install <code>Crossplane Helm Provider</code>, which can be done directly using the kubectl plugin for <code>crossplane</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ kubectl crossplane install provider crossplane/provider-helm:v0.10.0
</span></span><span class="line"><span class="cl">provider.pkg.crossplane.io/crossplane-provider-helm created
</span></span></code></pre></td></tr></table>
</div>
</div><p>Also note that when installing the <code>Crossplane Helm Provider</code>, we need to provide an appropriate ServiceAccount for the Provider to create a new <code>ClusterRoleBinding</code> so that the Provider can install Helm Charts.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ <span class="nv">SA</span><span class="o">=</span><span class="k">$(</span>kubectl -n crossplane-system get sa -o name <span class="p">|</span> grep provider-helm <span class="p">|</span> sed -e <span class="s1">&#39;s|serviceaccount\/|crossplane-system:|g&#39;</span><span class="k">)</span>
</span></span><span class="line"><span class="cl">$ <span class="nb">echo</span> <span class="nv">$SA</span>
</span></span><span class="line"><span class="cl">crossplane-system:crossplane-provider-helm-3d2f09bcd965
</span></span><span class="line"><span class="cl">$ kubectl create clusterrolebinding provider-helm-admin-binding --clusterrole cluster-admin --serviceaccount<span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">SA</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">clusterrolebinding.rbac.authorization.k8s.io/provider-helm-admin-binding created
</span></span></code></pre></td></tr></table>
</div>
</div><p>Then create a <code>ProviderConfig</code> object, as shown below, to declare the installation of the Helm Provider.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yml" data-lang="yml"><span class="line"><span class="cl"><span class="c"># helm-provider-config.yaml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">helm.crossplane.io/v1beta1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ProviderConfig</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">default</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">credentials</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="l">InjectedIdentity</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># SA=$(kubectl -n crossplane-system get sa -o name | grep provider-helm | sed -e &#39;s|serviceaccount\/|crossplane-system:|g&#39;)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># kubectl create clusterrolebinding provider-helm-admin-binding --clusterrole cluster-admin --serviceaccount=&#34;${SA}&#34;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Just apply the list of resources above directly.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ kubectl apply -f helm-provider-config.yaml
</span></span><span class="line"><span class="cl">providerconfig.helm.crossplane.io/default created
</span></span></code></pre></td></tr></table>
</div>
</div><p>At this point we have completed the installation of <code>Crossplane</code>. Finally, we also recommend installing the <code>vcluster</code> command line tool to connect to the Kubernetes cluster, which can be installed by referring to the documentation at <a href="https://www.vcluster.com/docs/getting-started/setup">https://www.vcluster.com/docs/getting-started/setup</a>.</p>
<h3 id="creating-vclusters-with-crossplane-composition">Creating VClusters with Crossplane Composition</h3>
<p>Now that <code>Crossplane</code> and <code>Crossplane Helm Provider</code> are ready, let&rsquo;s take a look at <code>Crossplane Composition</code>. <code>Crossplane</code> provides a mechanism for composing managed resources in which users can create their own abstractions in a declarative way.</p>
<ul>
<li><strong>Composite Resource</strong>: A Composite Resource (XR) is a custom resource that consists of managed resources that allow you to abstract infrastructure details. The <code>CompositeResourceDefinition</code> (XRD) defines a new type of combined resource, XRDs are cluster-wide, and in order to create a namespace XR, the corresponding XRD can provide a combined resource declaration (XRC).</li>
<li><strong>Composition</strong>: A composition specifies what resources an XR will consist of, that is, what happens when you create an XR, and an XR can have multiple compositions. For example, for CompositeDatabase XR, you could use a combination to create an AWS RDS instance, a security group, and a MySQL database. Another combination can define a GCP CloudSQL instance and a PostgreSQL database.</li>
<li><strong>Configuration</strong>: A configuration is a package of XRDs and combinations that can then be published to the OCI image registry using the Crossplane CLI and installed into a Crossplane cluster by creating declarative configuration resources.</li>
</ul>
<p>Our <code>Crossplane Composition(XR)</code> here defines the related operations that need to be performed when creating a new environment resource, this object will perform some of the following operations.</p>
<ul>
<li>Install the VCluster Helm Chart using the Helm Provider Config we configured when we installed the Helm Provider, and when we install this Chart, we can create a new VCluster, isn&rsquo;t it very simple.</li>
<li>The VCluster installation creates a Kubernetes Secret object containing tokens connected to the VCluster APIServer, which we can use to configure a second Helm Provider Config, which allows us to install Helm Charts into the newly created cluster in the newly created cluster.</li>
<li>We can use the second Helm Provider Config to install the application into the created VCluster.</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/08/10/d18d628ca0654a14aa11499e0771f66b.png" alt="VCluster "></p>
<p>Let&rsquo;s look at how this is done. First we need to apply <code>Crossplane Composition</code> and <code>Environment CRD</code> to our cluster so that we can create new <code>Environment</code> resources.</p>
<p>First define an <code>Environment</code> composition resource, corresponding to the list of resources shown below, which is the equivalent of a CRD in a Kubernetes cluster.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yml" data-lang="yml"><span class="line"><span class="cl"><span class="c"># environment-resource-definition.yaml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">apiextensions.crossplane.io/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">CompositeResourceDefinition</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">environments.fmtok8s.salaboy.com</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="l">fmtok8s.salaboy.com</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">names</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Environment</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">plural</span><span class="p">:</span><span class="w"> </span><span class="l">environments</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">claimNames</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Cluster</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">plural</span><span class="p">:</span><span class="w"> </span><span class="l">clusters</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">versions</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">v1alpha1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">served</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">referenceable</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">schema</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">openAPIV3Schema</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">object</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">properties</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">object</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">properties</span><span class="p">:</span><span class="w"> </span>{}<span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>With the XRD composition resource declaration in place, the next step is to define a composition object, as shown in the resource manifest file below, in which multiple resources are defined in the <code>Composition</code> composition object, which is associated with the <code>Environment</code> object declared in the XRD object above.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yml" data-lang="yml"><span class="line"><span class="cl"><span class="c"># composition.yaml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">apiextensions.crossplane.io/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Composition</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">environment.fmtok8s.salaboy.com</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">writeConnectionSecretsToNamespace</span><span class="p">:</span><span class="w"> </span><span class="l">crossplane-system</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">compositeTypeRef</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">fmtok8s.salaboy.com/v1alpha1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Environment</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">resources</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">vcluster-helm-release</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">base</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">helm.crossplane.io/v1beta1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Release</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">annotations</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">crossplane.io/external-name</span><span class="p">:</span><span class="w"> </span><span class="c"># patched</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">rollbackLimit</span><span class="p">:</span><span class="w"> </span><span class="m">3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">forProvider</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="c"># patched</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">chart</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">vcluster</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">repository</span><span class="p">:</span><span class="w"> </span><span class="l">https://charts.loft.sh</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;0.10.2&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">values</span><span class="p">:</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">syncer</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="nt">extraArgs</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w"> </span><span class="c"># patched</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="c">#     - --out-kube-config-server=https://cluster-1.cluster-1.svc</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">providerConfigRef</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">default</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">patches</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">fromFieldPath</span><span class="p">:</span><span class="w"> </span><span class="l">metadata.name</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">toFieldPath</span><span class="p">:</span><span class="w"> </span><span class="l">spec.forProvider.namespace</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">policy</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">fromFieldPath</span><span class="p">:</span><span class="w"> </span><span class="l">Required</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">fromFieldPath</span><span class="p">:</span><span class="w"> </span><span class="l">metadata.name</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">toFieldPath</span><span class="p">:</span><span class="w"> </span><span class="l">metadata.annotations[crossplane.io/external-name]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">policy</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">fromFieldPath</span><span class="p">:</span><span class="w"> </span><span class="l">Required</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">fromFieldPath</span><span class="p">:</span><span class="w"> </span><span class="l">metadata.name</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">toFieldPath</span><span class="p">:</span><span class="w"> </span><span class="l">metadata.name</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">transforms</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">string</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">string</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="nt">fmt</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;%s-vcluster&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">CombineFromComposite</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">combine</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">variables</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">fromFieldPath</span><span class="p">:</span><span class="w"> </span><span class="l">metadata.name</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">strategy</span><span class="p">:</span><span class="w"> </span><span class="l">string</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">string</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">fmt</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;--out-kube-config-secret=%s-secret&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">toFieldPath</span><span class="p">:</span><span class="w"> </span><span class="l">spec.forProvider.values.syncer.extraArgs[0]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">CombineFromComposite</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">combine</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">variables</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">fromFieldPath</span><span class="p">:</span><span class="w"> </span><span class="l">metadata.name</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">fromFieldPath</span><span class="p">:</span><span class="w"> </span><span class="l">metadata.name</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">strategy</span><span class="p">:</span><span class="w"> </span><span class="l">string</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">string</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">fmt</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;--out-kube-config-server=https://%s.%s.svc&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">toFieldPath</span><span class="p">:</span><span class="w"> </span><span class="l">spec.forProvider.values.syncer.extraArgs[1]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">CombineFromComposite</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">combine</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">variables</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">fromFieldPath</span><span class="p">:</span><span class="w"> </span><span class="l">metadata.name</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">fromFieldPath</span><span class="p">:</span><span class="w"> </span><span class="l">metadata.name</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">strategy</span><span class="p">:</span><span class="w"> </span><span class="l">string</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">string</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">fmt</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;--tls-san=%s.%s.svc&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">toFieldPath</span><span class="p">:</span><span class="w"> </span><span class="l">spec.forProvider.values.syncer.extraArgs[2]    </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">helm-providerconfig</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">base</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">helm.crossplane.io/v1alpha1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ProviderConfig</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">credentials</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="l">Secret</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">secretRef</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="c"># patched</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="c"># patched</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l">config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">patches</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">fromFieldPath</span><span class="p">:</span><span class="w"> </span><span class="l">metadata.name</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">toFieldPath</span><span class="p">:</span><span class="w"> </span><span class="l">spec.credentials.secretRef.name</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">transforms</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">string</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">string</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="nt">fmt</span><span class="p">:</span><span class="w"> </span><span class="l">vc-%s</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">fromFieldPath</span><span class="p">:</span><span class="w"> </span><span class="l">metadata.name</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">toFieldPath</span><span class="p">:</span><span class="w"> </span><span class="l">spec.credentials.secretRef.namespace</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">fromFieldPath</span><span class="p">:</span><span class="w"> </span><span class="l">metadata.uid</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">toFieldPath</span><span class="p">:</span><span class="w"> </span><span class="l">metadata.name     </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">helm-provider-vcluster</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">base</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">helm.crossplane.io/v1beta1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ProviderConfig</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">credentials</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="l">Secret</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">secretRef</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="c">#patched</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l">config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">patches</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">fromFieldPath</span><span class="p">:</span><span class="w"> </span><span class="l">metadata.name</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">toFieldPath</span><span class="p">:</span><span class="w"> </span><span class="l">metadata.name</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">fromFieldPath</span><span class="p">:</span><span class="w"> </span><span class="l">metadata.name</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">toFieldPath</span><span class="p">:</span><span class="w"> </span><span class="l">spec.credentials.secretRef.namespace</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">policy</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">fromFieldPath</span><span class="p">:</span><span class="w"> </span><span class="l">Required  </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c"># This ProviderConfig uses the above VCluster&#39;s connection secret as</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c"># its credentials secret.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">fromFieldPath</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;metadata.name&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">toFieldPath</span><span class="p">:</span><span class="w"> </span><span class="l">spec.credentials.secretRef.name</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">transforms</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">string</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">string</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="nt">fmt</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;%s-secret&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">readinessChecks</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">None      </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">conference-chart-vcluster</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">base</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">helm.crossplane.io/v1beta1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Release</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">annotations</span><span class="p">:</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">crossplane.io/external-name</span><span class="p">:</span><span class="w"> </span><span class="l">conference</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">forProvider</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">chart</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">fmtok8s-conference-chart</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">repository</span><span class="p">:</span><span class="w"> </span><span class="l">https://salaboy.github.io/helm/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;v0.1.1&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">conference</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">providerConfigRef</span><span class="p">:</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="c">#patched</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">patches</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">fromFieldPath</span><span class="p">:</span><span class="w"> </span><span class="l">metadata.name</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">toFieldPath</span><span class="p">:</span><span class="w"> </span><span class="l">spec.providerConfigRef.name</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>We set 3 parameters for VCluster&rsquo;s Chart package to be used with Crossplane.</p>
<ul>
<li>Configured <code>fmt:&quot;--out-kube-config-secret=%s-secret&quot;</code> on line 53, because we need VCluster to create a Secret object to host <code>kubeconfig</code> in so we can get it to connect with the newly created APIServer.</li>
<li>Configure <code>fmt:&quot;--out-kube-config-server=https://%s.%s.svc&quot;</code> on line 62, because we need <code>kubeconfig</code> to point to the new APIServer URL from within the cluster, and by default, the generated <code>kubeconfig</code> points to <code>https:/ /localhost:8443</code>.</li>
<li>The <code>fmt:&quot;--tls-san=%s.%s.svc&quot;</code> is configured on line 71, indicating that the new service address needs to be added to the list of hosts to which the APIServer accepts connections.</li>
</ul>
<p>Then just apply the two objects above directly.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ kubectl apply -f composition.yaml
</span></span><span class="line"><span class="cl">composition.apiextensions.crossplane.io/environment.fmtok8s.salaboy.com created
</span></span><span class="line"><span class="cl">$ kubectl apply -f environment-resource-definition.yaml
</span></span><span class="line"><span class="cl">compositeresourcedefinition.apiextensions.crossplane.io/environments.fmtok8s.salaboy.com created
</span></span></code></pre></td></tr></table>
</div>
</div><p>Once the portfolio and CRD are available within the cluster, we can start creating new environment resources and check which VClusters are currently available before running them.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ vcluster list
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> NAME   NAMESPACE   STATUS   CONNECTED   CREATED   AGE
</span></span><span class="line"><span class="cl"> No entries found
</span></span></code></pre></td></tr></table>
</div>
</div><p>There shouldn&rsquo;t be any VClusters yet, now we can create a new environment, for example now we define a dev environment by simply declaring an <code>Environment</code> object as shown below.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yml" data-lang="yml"><span class="line"><span class="cl"><span class="c"># environment-resource.yaml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">fmtok8s.salaboy.com/v1alpha1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Environment</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">dev-environment</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w"> </span>{}<span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Apply the object directly.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ kubectl apply -f environment-resource.yaml
</span></span><span class="line"><span class="cl">environment.fmtok8s.salaboy.com/dev-environment created
</span></span><span class="line"><span class="cl">$ kubectl get environments
</span></span><span class="line"><span class="cl">NAME              READY   COMPOSITION                       AGE
</span></span><span class="line"><span class="cl">dev-environment   False   environment.fmtok8s.salaboy.com   57s
</span></span><span class="line"><span class="cl">$ kubectl describe environments dev-environment
</span></span><span class="line"><span class="cl">Name:         dev-environment
</span></span><span class="line"><span class="cl">Namespace:
</span></span><span class="line"><span class="cl">Labels:       crossplane.io/composite<span class="o">=</span>dev-environment
</span></span><span class="line"><span class="cl">Annotations:  &lt;none&gt;
</span></span><span class="line"><span class="cl">API Version:  fmtok8s.salaboy.com/v1alpha1
</span></span><span class="line"><span class="cl">Kind:         Environment
</span></span><span class="line"><span class="cl">......
</span></span><span class="line"><span class="cl">Events:
</span></span><span class="line"><span class="cl">  Type    Reason                   Age                From                                                             Message
</span></span><span class="line"><span class="cl">  ----    ------                   ----               ----                                                             -------
</span></span><span class="line"><span class="cl">  Normal  PublishConnectionSecret  76s                defined/compositeresourcedefinition.apiextensions.crossplane.io  Successfully published connection details
</span></span><span class="line"><span class="cl">  Normal  SelectComposition        19s <span class="o">(</span>x7 over 76s<span class="o">)</span>  defined/compositeresourcedefinition.apiextensions.crossplane.io  Successfully selected composition
</span></span><span class="line"><span class="cl">  Normal  ComposeResources         18s <span class="o">(</span>x7 over 76s<span class="o">)</span>  defined/compositeresourcedefinition.apiextensions.crossplane.io  Successfully composed resources
</span></span></code></pre></td></tr></table>
</div>
</div><p>Now we can treat the environment resources you created like any other Kubernetes resource, you can list them directly using <code>kubectl get environments</code> and even describe them to see more details.</p>
<p>Now let&rsquo;s go back and check the VCluster normal and we&rsquo;ll find a new resource.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"> vcluster list
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> NAME              NAMESPACE         STATUS    CONNECTED   CREATED                         AGE
</span></span><span class="line"><span class="cl"> dev-environment   dev-environment   Running               2022-08-09 17:44:07 +0800 CST   56m38s
</span></span></code></pre></td></tr></table>
</div>
</div><p>VCluster will install an APIServer (using K3s by default), CoreDNS instances, and a Syncer in a new namespace, <code>dev-environment</code>, allowing users to interact with the VCluster API Server via kubectl, just as they would with a regular cluster. VCluster will synchronize these resources with the cluster of hosts responsible for scheduling the workload, thus enabling the functionality of a namespace as a Kubernetes cluster.</p>
<p>Once we have configured Crossplane and the Crossplane Helm Provider, we can create a new VCluster by creating a new Helm Release and installing a Helm Chart, which is very simple.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/08/10/61723ca592944df28b5970d2eda559a4.png" alt="VCluster"></p>
<p>Once we have created the VCluster using the correct kubeconfig created in secret, we can configure a second Helm Provider to install our application into the newly created VCluster, as defined in line 95 of the composition object above, <code>helm-provider- vcluster</code> defined in line 95 of the composition object above is that description.</p>
<p>Then inside the composition, we configure the Helm Chart package that uses one of our meeting applications.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/08/10/d2ab5b85222a411a99656e2470cc01e0.png" alt="VCluster"></p>
<p>After configuring everything and creating a new environment, we can connect to VCluster and check if the application is installed.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ vcluster connect dev-environment --server https://localhost:8443 -- bash
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">The default interactive shell is now zsh.
</span></span><span class="line"><span class="cl">To update your account to use zsh, please run <span class="sb">`</span>chsh -s /bin/zsh<span class="sb">`</span>.
</span></span><span class="line"><span class="cl">For more details, please visit https://support.apple.com/kb/HT208050.
</span></span><span class="line"><span class="cl">bash-3.2$ kubectl get ns
</span></span><span class="line"><span class="cl">NAME              STATUS   AGE
</span></span><span class="line"><span class="cl">default           Active   32m
</span></span><span class="line"><span class="cl">kube-system       Active   32m
</span></span><span class="line"><span class="cl">kube-public       Active   32m
</span></span><span class="line"><span class="cl">kube-node-lease   Active   32m
</span></span><span class="line"><span class="cl">conference        Active   23m
</span></span><span class="line"><span class="cl">bash-3.2$ kubectl get pods -n conference
</span></span><span class="line"><span class="cl">NAME                                                 READY   STATUS    RESTARTS      AGE
</span></span><span class="line"><span class="cl">conference-fmtok8s-frontend-7cd5db8669-pv944         1/1     Running   <span class="m">0</span>             23m
</span></span><span class="line"><span class="cl">conference-fmtok8s-email-service-768bc88cbb-sklrg    1/1     Running   <span class="m">0</span>             23m
</span></span><span class="line"><span class="cl">conference-postgresql-0                              1/1     Running   <span class="m">0</span>             23m
</span></span><span class="line"><span class="cl">conference-fmtok8s-c4p-service-7f56d7bd9d-2vjtx      1/1     Running   <span class="m">2</span> <span class="o">(</span>19m ago<span class="o">)</span>   23m
</span></span><span class="line"><span class="cl">conference-redis-master-0                            1/1     Running   <span class="m">0</span>             23m
</span></span><span class="line"><span class="cl">conference-redis-replicas-0                          1/1     Running   <span class="m">0</span>             23m
</span></span><span class="line"><span class="cl">conference-fmtok8s-agenda-service-7db66c9568-xsh5m   1/1     Running   <span class="m">2</span> <span class="o">(</span>16m ago<span class="o">)</span>   23m
</span></span></code></pre></td></tr></table>
</div>
</div><p>You can see that our applications have been successfully installed in that cluster, and they are actually deployed under the <code>dev-environment</code> namespace of the original KinD cluster.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ kubectl get pods -n dev-environment
</span></span><span class="line"><span class="cl">NAME                                                              READY   STATUS    RESTARTS      AGE
</span></span><span class="line"><span class="cl">conference-fmtok8s-agenda-service-7db66c9568-xsh5m-x-08f9332627   1/1     Running   <span class="m">2</span> <span class="o">(</span>18m ago<span class="o">)</span>   25m
</span></span><span class="line"><span class="cl">conference-fmtok8s-c4p-service-7f56d7bd9d-2vjtx-x-co-fc2c58eaec   1/1     Running   <span class="m">2</span> <span class="o">(</span>21m ago<span class="o">)</span>   25m
</span></span><span class="line"><span class="cl">conference-fmtok8s-email-service-768bc88cbb-sklrg-x--c5d9594434   1/1     Running   <span class="m">0</span>             25m
</span></span><span class="line"><span class="cl">conference-fmtok8s-frontend-7cd5db8669-pv944-x-confe-2832ac1bef   1/1     Running   <span class="m">0</span>             25m
</span></span><span class="line"><span class="cl">conference-postgresql-0-x-conference-x-dev-environment            1/1     Running   <span class="m">0</span>             25m
</span></span><span class="line"><span class="cl">conference-redis-master-0-x-conference-x-dev-environment          1/1     Running   <span class="m">0</span>             25m
</span></span><span class="line"><span class="cl">conference-redis-replicas-0-x-conference-x-dev-environment        1/1     Running   <span class="m">0</span>             25m
</span></span><span class="line"><span class="cl">coredns-76dd5485df-6cbl7-x-kube-system-x-dev-environment          1/1     Running   <span class="m">0</span>             34m
</span></span><span class="line"><span class="cl">dev-environment-0                                                 2/2     Running   <span class="m">0</span>             63m
</span></span></code></pre></td></tr></table>
</div>
</div><p>It&rsquo;s just that VCluster isolates a namespace and is essentially the same experience as a Kubernetes cluster.</p>
<h2 id="summary">Summary</h2>
<p>This is just a simple example of how to use <code>Crossplane</code> in combination with <code>VCluster</code> to quickly configure a Kubernetes clustered environment and install applications in it to make developers more productive. Of course there are many areas that can be optimized, such as.</p>
<ul>
<li>Installing ArgoCD in VCluster and using the GitHub URL provided as an environment parameter to implement GitOps, which will avoid using kubectl for VCluster. using composition can be used to create ArgoCD resources to configure the repository and cluster without user intervention.</li>
<li>Install Knative in VCluster so that developers can rely on Knative Functions, Knative Serving, and Eventing features to design their applications.</li>
<li>Environment parameters to determine which cloud resources VCluster uses, such as GCP, AKS and EKS implementations, etc.</li>
<li>The same way Crossplane is used for testing in local KinD clusters, we can also interface to real cloud resources such as GCP, AWS, Azure, etc.</li>
</ul>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/kubernetes/">kubernetes</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2022-08/caddy/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Caddy, an out-of-the-box web server</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2022-08/grpc-trailers/">
            <span class="next-text nav-default">Talking about gRPC&#39;s Trailers design</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  <script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox-3.1.20.min.js"></script>



<script type="text/javascript" src="/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
