<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Linkerd Service Mesh Quick Start - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="This article is a Linkerd Service Mesh Getting Started tutorial." /><meta name="keywords" content="Linkerd, Service Mesh" />






<meta name="generator" content="Hugo 0.102.0 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2022-08/linkerd-service-mesh/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link href="/lib/fancybox/jquery.fancybox-3.1.20.min.css" rel="stylesheet">


<meta property="og:title" content="Linkerd Service Mesh Quick Start" />
<meta property="og:description" content="This article is a Linkerd Service Mesh Getting Started tutorial." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2022-08/linkerd-service-mesh/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-08-21T11:13:17+08:00" />
<meta property="article:modified_time" content="2022-08-21T11:13:17+08:00" />

<meta itemprop="name" content="Linkerd Service Mesh Quick Start">
<meta itemprop="description" content="This article is a Linkerd Service Mesh Getting Started tutorial."><meta itemprop="datePublished" content="2022-08-21T11:13:17+08:00" />
<meta itemprop="dateModified" content="2022-08-21T11:13:17+08:00" />
<meta itemprop="wordCount" content="2919">
<meta itemprop="keywords" content="Kubernetes," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Linkerd Service Mesh Quick Start"/>
<meta name="twitter:description" content="This article is a Linkerd Service Mesh Getting Started tutorial."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SOBYTE</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SOBYTE</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Linkerd Service Mesh Quick Start</h1>

      <div class="post-meta">
        <span class="post-time"> 2022-08-21 11:13:17 </span>
        <div class="post-category">
            <a href="/categories/tutorials/"> tutorials </a>
            </div>
          <span class="more-meta"> 2919 words </span>
          <span class="more-meta"> 14 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#feature-overview">Feature Overview</a></li>
        <li><a href="#installation">Installation</a></li>
        <li><a href="#example">Example</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p><a href="https://linkerd.io/">Linkerd</a> is a fully open source Service Grid implementation of Kubernetes. It makes running services easier and safer by providing you with runtime debugging, observability, reliability, and security, all without requiring any changes to your code.</p>
<p><code>Linkerd</code> works by installing a set of ultra-light, transparent agents next to each service instance. These agents automatically handle all traffic to and from the service. Because they are transparent, these agents act as highly instrumented out-of-process network stacks, sending telemetry data to and receiving control signals from the control plane. This design allows <code>Linkerd</code> to measure and manipulate the traffic to and from your service without introducing excessive latency. To be as small, light, and secure as possible, <code>Linkerd</code>&rsquo;s agents are written in Rust.</p>
<h2 id="feature-overview">Feature Overview</h2>
<ul>
<li><code>Automatic mTLS</code>: Linkerd automatically enables mutual transport layer security (TLS) for all communication between Grid applications.</li>
<li><code>Automatic proxy injection</code>: Linkerd automatically injects data plane proxies into annotations-based pods.</li>
<li><code>Container Network Interface Plugin</code>: Linkerd can be configured to run a CNI plug-in that automatically rewrites the iptables rules for each pod.</li>
<li><code>Dashboard and Grafana</code>: Linkerd provides a web dashboard, as well as pre-configured Grafana dashboards.</li>
<li><code>Distributed tracing</code>: You can enable distributed tracing support in Linkerd.</li>
<li><code>Fault Injection</code>: Linkerd provides a mechanism for programmatically injecting faults into the service.</li>
<li><code>High Availability</code>: The Linkerd control plane can operate in High Availability (HA) mode.</li>
<li><code>HTTP, HTTP/2 and gRPC Proxy</code>: Linkerd will automatically enable advanced features (including metrics, load balancing, retries, etc.) for HTTP, HTTP/2 and gRPC connections.</li>
<li><code>Ingress</code>: Linkerd can work with the ingress controller of your choice.</li>
<li><code>Load balancing</code>: Linkerd automatically load balances requests from all target endpoints on HTTP, HTTP/2 and gRPC connections.</li>
<li><code>Multi-cluster communication</code>: Linkerd can transparently and securely connect services running in different clusters.</li>
<li><code>Retries and timeouts</code>: Linkerd can perform service-specific retries and timeouts.</li>
<li><code>Service Profile</code>: Linkerd&rsquo;s service profile supports per-route metrics as well as retries and timeouts.</li>
<li><code>TCP Proxy and Protocol Inspection</code>: Linkerd can proxy all TCP traffic, including TLS connections, WebSockets and HTTP tunnels.</li>
<li><code>Telemetry and Monitoring</code>: Linkerd automatically collects metrics from all services that send traffic through it.</li>
<li><code>Traffic splitting (canary, blue/green deployment)</code>: Linkerd can dynamically send a portion of traffic to a different service.</li>
</ul>
<h2 id="installation">Installation</h2>
<p>We can install Linkerd&rsquo;s control plane to a Kubernetes cluster by installing a CLI command line tool for Linkerd locally.</p>
<p>So first you need to run the kubectl command locally to make sure you have access to an available Kubernetes cluster, or if there is no cluster, you can quickly create one locally using KinD.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ kubectl version --short
</span></span><span class="line"><span class="cl">Client Version: v1.23.5
</span></span><span class="line"><span class="cl">Server Version: v1.22.8
</span></span></code></pre></td></tr></table>
</div>
</div><p>You can use the following command to install Linkerd&rsquo;s CLI tools locally.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ curl --proto <span class="s1">&#39;=https&#39;</span> --tlsv1.2 -sSfL https://run.linkerd.io/install <span class="p">|</span> sh
</span></span></code></pre></td></tr></table>
</div>
</div><p>If you have a Mac system, you can also use the Homebrew tool to install it with one click.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ brew install linkerd
</span></span></code></pre></td></tr></table>
</div>
</div><p>Again, go directly to the Linkerd Release page at <a href="https://github.com/linkerd/linkerd2/releases/">https://github.com/linkerd/linkerd2/releases/</a> to download and install.</p>
<p>After installation, use the following command to verify that the CLI tools are installed successfully.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ linkerd  version
</span></span><span class="line"><span class="cl">Client version: stable-2.11.1
</span></span><span class="line"><span class="cl">Server version: unavailable
</span></span></code></pre></td></tr></table>
</div>
</div><p>Normally we can see the CLI version information, but the <code>Server version: unavailable</code> message appears, which is caused by the fact that we haven&rsquo;t installed the control plane on the Kubernetes cluster, so next we&rsquo;ll install the Server side.</p>
<p>Kubernetes clusters can be configured in many different ways, before installing the Linkerd control plane we need to check and verify that all configurations are correct, to check if the cluster is ready to install Linkerd, you can execute the following command.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ linkerd check --pre
</span></span><span class="line"><span class="cl">Linkerd core <span class="nv">checks</span>
</span></span><span class="line"><span class="cl"><span class="o">===================</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">kubernetes-api
</span></span><span class="line"><span class="cl">--------------
</span></span><span class="line"><span class="cl">√ can initialize the client
</span></span><span class="line"><span class="cl">√ can query the Kubernetes API
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">kubernetes-version
</span></span><span class="line"><span class="cl">------------------
</span></span><span class="line"><span class="cl">√ is running the minimum Kubernetes API version
</span></span><span class="line"><span class="cl">√ is running the minimum kubectl version
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">pre-kubernetes-setup
</span></span><span class="line"><span class="cl">--------------------
</span></span><span class="line"><span class="cl">√ control plane namespace does not already exist
</span></span><span class="line"><span class="cl">√ can create non-namespaced resources
</span></span><span class="line"><span class="cl">√ can create ServiceAccounts
</span></span><span class="line"><span class="cl">√ can create Services
</span></span><span class="line"><span class="cl">√ can create Deployments
</span></span><span class="line"><span class="cl">√ can create CronJobs
</span></span><span class="line"><span class="cl">√ can create ConfigMaps
</span></span><span class="line"><span class="cl">√ can create Secrets
</span></span><span class="line"><span class="cl">√ can <span class="nb">read</span> Secrets
</span></span><span class="line"><span class="cl">√ can <span class="nb">read</span> extension-apiserver-authentication configmap
</span></span><span class="line"><span class="cl">√ no clock skew detected
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">linkerd-version
</span></span><span class="line"><span class="cl">---------------
</span></span><span class="line"><span class="cl">√ can determine the latest version
</span></span><span class="line"><span class="cl">‼ cli is up-to-date
</span></span><span class="line"><span class="cl">    is running version 2.11.1 but the latest stable version is 2.11.4
</span></span><span class="line"><span class="cl">    see https://linkerd.io/2.11/checks/#l5d-version-cli <span class="k">for</span> hints
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Status check results are √
</span></span></code></pre></td></tr></table>
</div>
</div><p>If everything checks out OK, you can start installing Linkerd&rsquo;s control plane by executing the following command directly in one click.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ linkerd install <span class="p">|</span> kubectl apply -f -
</span></span></code></pre></td></tr></table>
</div>
</div><p>In this command, <code>linkerd install</code> generates a Kubernetes resource manifest file containing all the necessary control plane resources, which can then be installed into the Kubernetes cluster using the <code>kubectl apply</code> command.</p>
<p>You can see that the Linkerd control plane will be installed under a namespace named <code>linkerd</code>, and the following Pods will be running after the installation is complete.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ kubectl get pods -n linkerd
</span></span><span class="line"><span class="cl">NAME                                      READY   STATUS    RESTARTS       AGE
</span></span><span class="line"><span class="cl">linkerd-destination-79d6fc496f-dcgfx      4/4     Running   <span class="m">0</span>              166m
</span></span><span class="line"><span class="cl">linkerd-identity-6b78ff444f-jwp47         2/2     Running   <span class="m">0</span>              166m
</span></span><span class="line"><span class="cl">linkerd-proxy-injector-86f7f649dc-v576m   2/2     Running   <span class="m">0</span>              166m
</span></span></code></pre></td></tr></table>
</div>
</div><p>After the installation is complete wait for the control plane to be ready by running the following command and you can verify that the installation results are correct.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ linkerd check
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Linkerd core <span class="nv">checks</span>
</span></span><span class="line"><span class="cl"><span class="o">===================</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">kubernetes-api
</span></span><span class="line"><span class="cl">--------------
</span></span><span class="line"><span class="cl">√ can initialize the client
</span></span><span class="line"><span class="cl">√ can query the Kubernetes API
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">kubernetes-version
</span></span><span class="line"><span class="cl">------------------
</span></span><span class="line"><span class="cl">√ is running the minimum Kubernetes API version
</span></span><span class="line"><span class="cl">√ is running the minimum kubectl version
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">linkerd-existence
</span></span><span class="line"><span class="cl">-----------------
</span></span><span class="line"><span class="cl">√ <span class="s1">&#39;linkerd-config&#39;</span> config map exists
</span></span><span class="line"><span class="cl">√ heartbeat ServiceAccount exist
</span></span><span class="line"><span class="cl">√ control plane replica sets are ready
</span></span><span class="line"><span class="cl">√ no unschedulable pods
</span></span><span class="line"><span class="cl">√ control plane pods are ready
</span></span><span class="line"><span class="cl">√ cluster networks contains all node podCIDRs
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">linkerd-config
</span></span><span class="line"><span class="cl">--------------
</span></span><span class="line"><span class="cl">√ control plane Namespace exists
</span></span><span class="line"><span class="cl">√ control plane ClusterRoles exist
</span></span><span class="line"><span class="cl">√ control plane ClusterRoleBindings exist
</span></span><span class="line"><span class="cl">√ control plane ServiceAccounts exist
</span></span><span class="line"><span class="cl">√ control plane CustomResourceDefinitions exist
</span></span><span class="line"><span class="cl">√ control plane MutatingWebhookConfigurations exist
</span></span><span class="line"><span class="cl">√ control plane ValidatingWebhookConfigurations exist
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">linkerd-identity
</span></span><span class="line"><span class="cl">----------------
</span></span><span class="line"><span class="cl">√ certificate config is valid
</span></span><span class="line"><span class="cl">√ trust anchors are using supported crypto algorithm
</span></span><span class="line"><span class="cl">√ trust anchors are within their validity period
</span></span><span class="line"><span class="cl">√ trust anchors are valid <span class="k">for</span> at least <span class="m">60</span> days
</span></span><span class="line"><span class="cl">√ issuer cert is using supported crypto algorithm
</span></span><span class="line"><span class="cl">√ issuer cert is within its validity period
</span></span><span class="line"><span class="cl">√ issuer cert is valid <span class="k">for</span> at least <span class="m">60</span> days
</span></span><span class="line"><span class="cl">√ issuer cert is issued by the trust anchor
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">linkerd-webhooks-and-apisvc-tls
</span></span><span class="line"><span class="cl">-------------------------------
</span></span><span class="line"><span class="cl">√ proxy-injector webhook has valid cert
</span></span><span class="line"><span class="cl">√ proxy-injector cert is valid <span class="k">for</span> at least <span class="m">60</span> days
</span></span><span class="line"><span class="cl">√ sp-validator webhook has valid cert
</span></span><span class="line"><span class="cl">√ sp-validator cert is valid <span class="k">for</span> at least <span class="m">60</span> days
</span></span><span class="line"><span class="cl">√ policy-validator webhook has valid cert
</span></span><span class="line"><span class="cl">√ policy-validator cert is valid <span class="k">for</span> at least <span class="m">60</span> days
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">linkerd-version
</span></span><span class="line"><span class="cl">---------------
</span></span><span class="line"><span class="cl">√ can determine the latest version
</span></span><span class="line"><span class="cl">‼ cli is up-to-date
</span></span><span class="line"><span class="cl">    is running version 2.11.1 but the latest stable version is 2.11.4
</span></span><span class="line"><span class="cl">    see https://linkerd.io/2.11/checks/#l5d-version-cli <span class="k">for</span> hints
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">control-plane-version
</span></span><span class="line"><span class="cl">---------------------
</span></span><span class="line"><span class="cl">√ can retrieve the control plane version
</span></span><span class="line"><span class="cl">‼ control plane is up-to-date
</span></span><span class="line"><span class="cl">    is running version 2.11.1 but the latest stable version is 2.11.4
</span></span><span class="line"><span class="cl">    see https://linkerd.io/2.11/checks/#l5d-version-control <span class="k">for</span> hints
</span></span><span class="line"><span class="cl">√ control plane and cli versions match
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">linkerd-control-plane-proxy
</span></span><span class="line"><span class="cl">---------------------------
</span></span><span class="line"><span class="cl">√ control plane proxies are healthy
</span></span><span class="line"><span class="cl">‼ control plane proxies are up-to-date
</span></span><span class="line"><span class="cl">    some proxies are not running the current version:
</span></span><span class="line"><span class="cl">        * linkerd-destination-79d6fc496f-dcgfx <span class="o">(</span>stable-2.11.1<span class="o">)</span>
</span></span><span class="line"><span class="cl">        * linkerd-identity-6b78ff444f-jwp47 <span class="o">(</span>stable-2.11.1<span class="o">)</span>
</span></span><span class="line"><span class="cl">        * linkerd-proxy-injector-86f7f649dc-v576m <span class="o">(</span>stable-2.11.1<span class="o">)</span>
</span></span><span class="line"><span class="cl">    see https://linkerd.io/2.11/checks/#l5d-cp-proxy-version <span class="k">for</span> hints
</span></span><span class="line"><span class="cl">√ control plane proxies and cli versions match
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Status check results are √
</span></span></code></pre></td></tr></table>
</div>
</div><p>When the above <code>Status check results are √</code> message appears, it means that the Linkerd control plane is successfully installed. In addition to installing the control plane using the CLI tool, we can also install it using the Helm Chart method as follows.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ helm repo add linkerd https://helm.linkerd.io/stable
</span></span><span class="line"><span class="cl"><span class="c1"># set expiry date one year from now, in Mac:</span>
</span></span><span class="line"><span class="cl">$ <span class="nv">exp</span><span class="o">=</span><span class="k">$(</span>date -v+8760H +<span class="s2">&#34;%Y-%m-%dT%H:%M:%SZ&#34;</span><span class="k">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># in Linux:</span>
</span></span><span class="line"><span class="cl">$ <span class="nv">exp</span><span class="o">=</span><span class="k">$(</span>date -d <span class="s1">&#39;+8760 hour&#39;</span> +<span class="s2">&#34;%Y-%m-%dT%H:%M:%SZ&#34;</span><span class="k">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ helm install linkerd2 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --set-file <span class="nv">identityTrustAnchorsPEM</span><span class="o">=</span>ca.crt <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --set-file identity.issuer.tls.crtPEM<span class="o">=</span>issuer.crt <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --set-file identity.issuer.tls.keyPEM<span class="o">=</span>issuer.key <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --set identity.issuer.crtExpiry<span class="o">=</span><span class="nv">$exp</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  linkerd/linkerd2
</span></span></code></pre></td></tr></table>
</div>
</div><p>In addition the chart contains a <code>values-ha.yaml</code> file which overrides some default values for setting in high availability scenarios, similar to the <code>-ha</code> option in <code>linkerd install</code>. We can get <code>values-ha.yaml</code> by getting the chart file.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ helm fetch --untar linkerd/linkerd2
</span></span></code></pre></td></tr></table>
</div>
</div><p>Then use <code>-f flag</code> to overwrite the file, e.g.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1">## see above on how to set $exp</span>
</span></span><span class="line"><span class="cl">helm install linkerd2 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --set-file <span class="nv">identityTrustAnchorsPEM</span><span class="o">=</span>ca.crt <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --set-file identity.issuer.tls.crtPEM<span class="o">=</span>issuer.crt <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --set-file identity.issuer.tls.keyPEM<span class="o">=</span>issuer.key <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --set identity.issuer.crtExpiry<span class="o">=</span><span class="nv">$exp</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  -f linkerd2/values-ha.yaml <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  linkerd/linkerd2
</span></span></code></pre></td></tr></table>
</div>
</div><p>Either way is fine for installation. Now that we have completed the installation of Linkerd, re-execute the <code>linkerd version</code> command to see the Server side version information.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ linkerd version
</span></span><span class="line"><span class="cl">Client version: stable-2.11.1
</span></span><span class="line"><span class="cl">Server version: stable-2.11.1
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="example">Example</h2>
<p>Next we install a simple example application, <code>Emojivoto</code>, which is a simple standalone Kubernetes application that uses a mix of gRPC and HTTP calls to allow users to vote on their favorite emoji.</p>
<p><code>Emojivoto</code> can be installed into the <code>emojivoto</code> namespace by running the following command.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ curl -fsL https://run.linkerd.io/emojivoto.yml <span class="p">|</span> kubectl apply -f -
</span></span><span class="line"><span class="cl">namespace/emojivoto created
</span></span><span class="line"><span class="cl">serviceaccount/emoji created
</span></span><span class="line"><span class="cl">serviceaccount/voting created
</span></span><span class="line"><span class="cl">serviceaccount/web created
</span></span><span class="line"><span class="cl">service/emoji-svc created
</span></span><span class="line"><span class="cl">service/voting-svc created
</span></span><span class="line"><span class="cl">service/web-svc created
</span></span><span class="line"><span class="cl">deployment.apps/emoji created
</span></span><span class="line"><span class="cl">deployment.apps/vote-bot created
</span></span><span class="line"><span class="cl">deployment.apps/voting created
</span></span><span class="line"><span class="cl">deployment.apps/web created
</span></span></code></pre></td></tr></table>
</div>
</div><p>Under this application, you can see that there are 4 Pod services.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ kubectl get pods -n emojivoto
</span></span><span class="line"><span class="cl">NAME                        READY   STATUS    RESTARTS   AGE
</span></span><span class="line"><span class="cl">emoji-66ccdb4d86-6vqvt      1/1     Running   <span class="m">0</span>          91s
</span></span><span class="line"><span class="cl">vote-bot-69754c864f-k26fb   1/1     Running   <span class="m">0</span>          91s
</span></span><span class="line"><span class="cl">voting-f999bd4d7-k44nb      1/1     Running   <span class="m">0</span>          91s
</span></span><span class="line"><span class="cl">web-79469b946f-bz295        1/1     Running   <span class="m">0</span>          91s
</span></span><span class="line"><span class="cl">$ kubectl get svc -n emojivoto
</span></span><span class="line"><span class="cl">NAME         TYPE        CLUSTER-IP       EXTERNAL-IP   PORT<span class="o">(</span>S<span class="o">)</span>             AGE
</span></span><span class="line"><span class="cl">emoji-svc    ClusterIP   10.111.7.125     &lt;none&gt;        8080/TCP,8801/TCP   2m49s
</span></span><span class="line"><span class="cl">voting-svc   ClusterIP   10.105.192.118   &lt;none&gt;        8080/TCP,8801/TCP   2m48s
</span></span><span class="line"><span class="cl">web-svc      ClusterIP   10.111.236.171   &lt;none&gt;        80/TCP              2m48s
</span></span></code></pre></td></tr></table>
</div>
</div><p>We can expose the <code>web-svc</code> service via <code>port-forward</code> and then access the application in the browser.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ kubectl -n emojivoto port-forward svc/web-svc 8080:80
</span></span></code></pre></td></tr></table>
</div>
</div><p>Now we can access the <code>Emojivoto</code> application from our browser via <code>http://localhost:8080</code>.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/08/21/2bb66672f9e0447ab6ad729306676383.png" alt="Emojivoto"></p>
<p>We can select the emoji we like on the page to vote, but some errors will appear after selecting some emoji, for example, when we click on the donut emoji we will get a 404 page.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/08/21/f1ebd0b6a85f42fd8156db71f6a78ffc.png" alt="Emojivoto"></p>
<p>But don&rsquo;t worry, this is a deliberate error left in the application to identify the issue later using Linkerd.</p>
<p>Next, we can add the above example application to Service Mesh, add Linkerd&rsquo;s data plane proxy to it, and run the following command directly to mesh the <code>Emojivoto</code> application.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ kubectl get -n emojivoto deploy -o yaml <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span> <span class="p">|</span> linkerd inject - <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span> <span class="p">|</span> kubectl apply -f -
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">deployment <span class="s2">&#34;emoji&#34;</span> injected
</span></span><span class="line"><span class="cl">deployment <span class="s2">&#34;vote-bot&#34;</span> injected
</span></span><span class="line"><span class="cl">deployment <span class="s2">&#34;voting&#34;</span> injected
</span></span><span class="line"><span class="cl">deployment <span class="s2">&#34;web&#34;</span> injected
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">deployment.apps/emoji configured
</span></span><span class="line"><span class="cl">deployment.apps/vote-bot configured
</span></span><span class="line"><span class="cl">deployment.apps/voting configured
</span></span><span class="line"><span class="cl">deployment.apps/web configured
</span></span></code></pre></td></tr></table>
</div>
</div><p>The above command first fetches all Deployments running in the <code>emojivoto</code> namespace, then runs their manifests through <code>linkerd inject</code> and reapplies them to the cluster.</p>
<p>Note that the <code>linkerd inject</code> command only adds a <code>linkerd.io/inject: enabled</code> annotation to the Pod specification and does not directly inject a Sidecar container, which instructs Linkerd to inject the agent into the Pod when it is created, so the application Pod will So after executing the above command, a sidecar proxy container will be added to the application Pod.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ kubectl get pods -n emojivoto
</span></span><span class="line"><span class="cl">NAME                        READY   STATUS    RESTARTS   AGE
</span></span><span class="line"><span class="cl">emoji-696d9d8f95-8wrmg      2/2     Running   <span class="m">0</span>          34m
</span></span><span class="line"><span class="cl">vote-bot-6d7677bb68-c98kb   2/2     Running   <span class="m">0</span>          34m
</span></span><span class="line"><span class="cl">voting-ff4c54b8d-rdtmk      2/2     Running   <span class="m">0</span>          34m
</span></span><span class="line"><span class="cl">web-5f86686c4d-qh5bz        2/2     Running   <span class="m">0</span>          34m
</span></span></code></pre></td></tr></table>
</div>
</div><p>You can see that each Pod now has 2 containers, with one more sidecar proxy container for Linkerd compared to the previous one.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/08/21/d6e5f1e1c8d34d8faa06d4e1dceb66e3.png" alt="sidecar proxy container"></p>
<p>Once the application update is complete, we have successfully introduced the application into Linkerd&rsquo;s Grid service. The new proxy containers make up the data plane, and we can also check the data plane status with the following command.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span><span class="lnt">92
</span><span class="lnt">93
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ linkerd -n emojivoto check --proxy
</span></span><span class="line"><span class="cl">Linkerd core <span class="nv">checks</span>
</span></span><span class="line"><span class="cl"><span class="o">===================</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">kubernetes-api
</span></span><span class="line"><span class="cl">--------------
</span></span><span class="line"><span class="cl">√ can initialize the client
</span></span><span class="line"><span class="cl">√ can query the Kubernetes API
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">kubernetes-version
</span></span><span class="line"><span class="cl">------------------
</span></span><span class="line"><span class="cl">√ is running the minimum Kubernetes API version
</span></span><span class="line"><span class="cl">√ is running the minimum kubectl version
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">linkerd-existence
</span></span><span class="line"><span class="cl">-----------------
</span></span><span class="line"><span class="cl">√ <span class="s1">&#39;linkerd-config&#39;</span> config map exists
</span></span><span class="line"><span class="cl">√ heartbeat ServiceAccount exist
</span></span><span class="line"><span class="cl">√ control plane replica sets are ready
</span></span><span class="line"><span class="cl">√ no unschedulable pods
</span></span><span class="line"><span class="cl">√ control plane pods are ready
</span></span><span class="line"><span class="cl">√ cluster networks contains all node podCIDRs
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">linkerd-config
</span></span><span class="line"><span class="cl">--------------
</span></span><span class="line"><span class="cl">√ control plane Namespace exists
</span></span><span class="line"><span class="cl">√ control plane ClusterRoles exist
</span></span><span class="line"><span class="cl">√ control plane ClusterRoleBindings exist
</span></span><span class="line"><span class="cl">√ control plane ServiceAccounts exist
</span></span><span class="line"><span class="cl">√ control plane CustomResourceDefinitions exist
</span></span><span class="line"><span class="cl">√ control plane MutatingWebhookConfigurations exist
</span></span><span class="line"><span class="cl">√ control plane ValidatingWebhookConfigurations exist
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">linkerd-identity
</span></span><span class="line"><span class="cl">----------------
</span></span><span class="line"><span class="cl">√ certificate config is valid
</span></span><span class="line"><span class="cl">√ trust anchors are using supported crypto algorithm
</span></span><span class="line"><span class="cl">√ trust anchors are within their validity period
</span></span><span class="line"><span class="cl">√ trust anchors are valid <span class="k">for</span> at least <span class="m">60</span> days
</span></span><span class="line"><span class="cl">√ issuer cert is using supported crypto algorithm
</span></span><span class="line"><span class="cl">√ issuer cert is within its validity period
</span></span><span class="line"><span class="cl">√ issuer cert is valid <span class="k">for</span> at least <span class="m">60</span> days
</span></span><span class="line"><span class="cl">√ issuer cert is issued by the trust anchor
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">linkerd-webhooks-and-apisvc-tls
</span></span><span class="line"><span class="cl">-------------------------------
</span></span><span class="line"><span class="cl">√ proxy-injector webhook has valid cert
</span></span><span class="line"><span class="cl">√ proxy-injector cert is valid <span class="k">for</span> at least <span class="m">60</span> days
</span></span><span class="line"><span class="cl">√ sp-validator webhook has valid cert
</span></span><span class="line"><span class="cl">√ sp-validator cert is valid <span class="k">for</span> at least <span class="m">60</span> days
</span></span><span class="line"><span class="cl">√ policy-validator webhook has valid cert
</span></span><span class="line"><span class="cl">√ policy-validator cert is valid <span class="k">for</span> at least <span class="m">60</span> days
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">linkerd-identity-data-plane
</span></span><span class="line"><span class="cl">---------------------------
</span></span><span class="line"><span class="cl">√ data plane proxies certificate match CA
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">linkerd-version
</span></span><span class="line"><span class="cl">---------------
</span></span><span class="line"><span class="cl">√ can determine the latest version
</span></span><span class="line"><span class="cl">‼ cli is up-to-date
</span></span><span class="line"><span class="cl">    is running version 2.11.1 but the latest stable version is 2.11.4
</span></span><span class="line"><span class="cl">    see https://linkerd.io/2.11/checks/#l5d-version-cli <span class="k">for</span> hints
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">linkerd-control-plane-proxy
</span></span><span class="line"><span class="cl">---------------------------
</span></span><span class="line"><span class="cl">√ control plane proxies are healthy
</span></span><span class="line"><span class="cl">‼ control plane proxies are up-to-date
</span></span><span class="line"><span class="cl">    some proxies are not running the current version:
</span></span><span class="line"><span class="cl">        * linkerd-destination-79d6fc496f-dcgfx <span class="o">(</span>stable-2.11.1<span class="o">)</span>
</span></span><span class="line"><span class="cl">        * linkerd-identity-6b78ff444f-jwp47 <span class="o">(</span>stable-2.11.1<span class="o">)</span>
</span></span><span class="line"><span class="cl">        * linkerd-proxy-injector-86f7f649dc-v576m <span class="o">(</span>stable-2.11.1<span class="o">)</span>
</span></span><span class="line"><span class="cl">    see https://linkerd.io/2.11/checks/#l5d-cp-proxy-version <span class="k">for</span> hints
</span></span><span class="line"><span class="cl">√ control plane proxies and cli versions match
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">linkerd-data-plane
</span></span><span class="line"><span class="cl">------------------
</span></span><span class="line"><span class="cl">√ data plane namespace exists
</span></span><span class="line"><span class="cl">√ data plane proxies are ready
</span></span><span class="line"><span class="cl">‼ data plane is up-to-date
</span></span><span class="line"><span class="cl">    some proxies are not running the current version:
</span></span><span class="line"><span class="cl">        * emoji-696d9d8f95-8wrmg <span class="o">(</span>stable-2.11.1<span class="o">)</span>
</span></span><span class="line"><span class="cl">        * vote-bot-6d7677bb68-c98kb <span class="o">(</span>stable-2.11.1<span class="o">)</span>
</span></span><span class="line"><span class="cl">        * voting-ff4c54b8d-rdtmk <span class="o">(</span>stable-2.11.1<span class="o">)</span>
</span></span><span class="line"><span class="cl">        * web-5f86686c4d-qh5bz <span class="o">(</span>stable-2.11.1<span class="o">)</span>
</span></span><span class="line"><span class="cl">    see https://linkerd.io/2.11/checks/#l5d-data-plane-version <span class="k">for</span> hints
</span></span><span class="line"><span class="cl">√ data plane and cli versions match
</span></span><span class="line"><span class="cl">√ data plane pod labels are configured correctly
</span></span><span class="line"><span class="cl">√ data plane service labels are configured correctly
</span></span><span class="line"><span class="cl">√ data plane service annotations are configured correctly
</span></span><span class="line"><span class="cl">√ opaque ports are properly annotated
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Status check results are √
</span></span></code></pre></td></tr></table>
</div>
</div><p>Of course, we can still access the application via <code>http://localhost:8080</code>, but of course there&rsquo;s no difference in use from before, we can use Linkerd to see what the application is actually doing, but we need to go and install a separate plugin, because Linkerd&rsquo;s core control plane is very lightweight, so Linkerd These plugins add some non-critical but often useful functionality to Linkerd, including various dashboards, for example we can install a <code>viz</code> plugin, the <code>Linkerd-Viz</code> plugin contains Linkerd&rsquo;s observability and visualization components.</p>
<p>The installation command is shown below.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ linkerd viz install <span class="p">|</span> kubectl apply -f -
</span></span></code></pre></td></tr></table>
</div>
</div><p>The above command creates a namespace named <code>linkerd-viz</code> where monitoring-related applications such as Prometheus, Grafana, etc. will be installed.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ kubectl get pods -n linkerd-viz
</span></span><span class="line"><span class="cl">NAME                            READY   STATUS    RESTARTS   AGE
</span></span><span class="line"><span class="cl">grafana-8d54d5f6d-wwtdz         2/2     Running   <span class="m">0</span>          3h1m
</span></span><span class="line"><span class="cl">metrics-api-6c59967bf4-pjwdq    2/2     Running   <span class="m">0</span>          4h22m
</span></span><span class="line"><span class="cl">prometheus-7bbc4d8c5b-5rc8r     2/2     Running   <span class="m">0</span>          4h22m
</span></span><span class="line"><span class="cl">tap-599c774dfb-m2kqz            2/2     Running   <span class="m">0</span>          4h22m
</span></span><span class="line"><span class="cl">tap-injector-748d54b7bc-jvshs   2/2     Running   <span class="m">0</span>          4h22m
</span></span><span class="line"><span class="cl">web-db97ff489-5599v             2/2     Running   <span class="m">0</span>          4h22m
</span></span></code></pre></td></tr></table>
</div>
</div><p>Once the installation is complete, we can use the following command to open a dashboard page.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ linkerd viz dashboard <span class="p">&amp;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>When the <code>viz</code> plug-in is deployed, executing the above command will automatically open a Linkerd observable Dashboard in the browser.</p>
<p>Alternatively, we can expose the viz service via Ingress, creating the resource object shown below.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yml" data-lang="yml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">networking.k8s.io/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Ingress</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">web-ingress</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">linkerd-viz</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">annotations</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">nginx.ingress.kubernetes.io/upstream-vhost</span><span class="p">:</span><span class="w"> </span><span class="l">$service_name.$namespace.svc.cluster.local:8084</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">nginx.ingress.kubernetes.io/configuration-snippet</span><span class="p">:</span><span class="w"> </span><span class="p">|</span><span class="sd">
</span></span></span><span class="line"><span class="cl"><span class="sd">      proxy_set_header Origin &#34;&#34;;
</span></span></span><span class="line"><span class="cl"><span class="sd">      proxy_hide_header l5d-remote-ip;
</span></span></span><span class="line"><span class="cl"><span class="sd">      proxy_hide_header l5d-server-id;</span><span class="w">      
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">ingressClassName</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">rules</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l">linkerd.k8s.local</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">http</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">paths</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">pathType</span><span class="p">:</span><span class="w"> </span><span class="l">Prefix</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">backend</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">service</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">web</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="nt">port</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                  </span><span class="nt">number</span><span class="p">:</span><span class="w"> </span><span class="m">8084</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Once applied, you can access viz through <code>linkerd.k8s.local</code>.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/08/21/ba89bdb352664dddae5bad9a4e7388c1.png" alt="linkerd.k8s.local"></p>
<p>An automatically generated topology diagram can also be displayed.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/08/21/b50d92a74bd941e4a9cdd6bc91e02b0a.png" alt="topology diagram"></p>
<p>On the page, we can find real-time metrics for each <code>Emojivoto</code> component, so we can determine which component is partially malfunctioning, and then target the problem.</p>
<p>The corresponding resource contains a Grafana icon that you can click to automatically jump to Grafana&rsquo;s monitoring page.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/08/21/59c0d5715f2c4a06a206104f41bb34ad.png" alt="Grafana&amp;rsquo;s monitoring page"></p>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/kubernetes/">Kubernetes</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2022-08/promql-sli-slo/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Calculating SLI and SLO with PromQL</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2022-08/react-use-effect/">
            <span class="next-text nav-default">Why shouldn&#39;t you use useEffect in React to get data from the API directly?</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  <script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox-3.1.20.min.js"></script>



<script type="text/javascript" src="/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js"></script>








</body>
</html>
