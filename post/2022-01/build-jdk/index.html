<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Build and debug openjdk 11 on win10 - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="A long time ago, I wanted to compile the source code of java on windows, and recently I have been trying, and I have tried many methods and encountered many problems.
Finally, I compile the process of difficulties and solutions encountered in the record, I hope to help those who come later.
Download source code The source code of Openjdk 11 is stored on the URL https://hg.openjdk.java.net/jdk-updates/jdk11u/ and can be downloaded by clicking on the zip button on the left to download the source code zip file at the following address: https://hg." /><meta name="keywords" content="openjdk, windows, build" />






<meta name="generator" content="Hugo 0.96.0 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2022-01/build-jdk/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link href="/lib/fancybox/jquery.fancybox-3.1.20.min.css" rel="stylesheet">


<meta property="og:title" content="Build and debug openjdk 11 on win10" />
<meta property="og:description" content="A long time ago, I wanted to compile the source code of java on windows, and recently I have been trying, and I have tried many methods and encountered many problems.
Finally, I compile the process of difficulties and solutions encountered in the record, I hope to help those who come later.
Download source code The source code of Openjdk 11 is stored on the URL https://hg.openjdk.java.net/jdk-updates/jdk11u/ and can be downloaded by clicking on the zip button on the left to download the source code zip file at the following address: https://hg." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2022-01/build-jdk/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-01-11T10:31:03+08:00" />
<meta property="article:modified_time" content="2022-01-11T10:31:03+08:00" />

<meta itemprop="name" content="Build and debug openjdk 11 on win10">
<meta itemprop="description" content="A long time ago, I wanted to compile the source code of java on windows, and recently I have been trying, and I have tried many methods and encountered many problems.
Finally, I compile the process of difficulties and solutions encountered in the record, I hope to help those who come later.
Download source code The source code of Openjdk 11 is stored on the URL https://hg.openjdk.java.net/jdk-updates/jdk11u/ and can be downloaded by clicking on the zip button on the left to download the source code zip file at the following address: https://hg."><meta itemprop="datePublished" content="2022-01-11T10:31:03+08:00" />
<meta itemprop="dateModified" content="2022-01-11T10:31:03+08:00" />
<meta itemprop="wordCount" content="2455">
<meta itemprop="keywords" content="openjdk,windows," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Build and debug openjdk 11 on win10"/>
<meta name="twitter:description" content="A long time ago, I wanted to compile the source code of java on windows, and recently I have been trying, and I have tried many methods and encountered many problems.
Finally, I compile the process of difficulties and solutions encountered in the record, I hope to help those who come later.
Download source code The source code of Openjdk 11 is stored on the URL https://hg.openjdk.java.net/jdk-updates/jdk11u/ and can be downloaded by clicking on the zip button on the left to download the source code zip file at the following address: https://hg."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SOBYTE</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SOBYTE</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Build and debug openjdk 11 on win10</h1>

      <div class="post-meta">
        <span class="post-time"> 2022-01-11 10:31:03 </span>
        <div class="post-category">
            <a href="/categories/tutorials/"> tutorials </a>
            </div>
          <span class="more-meta"> 2455 words </span>
          <span class="more-meta"> 12 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#download-source-code">Download source code</a></li>
        <li><a href="#compiling-and-running">Compiling and running</a>
          <ul>
            <li><a href="#compiling-with-wsl">Compiling with WSL</a></li>
            <li><a href="#using-cygwin-with-visual-studio-for-compilation">Using Cygwin with Visual Studio for compilation</a></li>
          </ul>
        </li>
        <li><a href="#debugging-java">Debugging Java</a></li>
        <li><a href="#postscript">Postscript</a></li>
        <li><a href="#error-resolution">Error resolution</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>A long time ago, I wanted to compile the source code of java on windows, and recently I have been trying, and I have tried many methods and encountered many problems.</p>
<p>Finally, I compile the process of difficulties and solutions encountered in the record, I hope to help those who come later.</p>
<h2 id="download-source-code">Download source code</h2>
<p>The source code of Openjdk 11 is stored on the URL <code>https://hg.openjdk.java.net/jdk-updates/jdk11u/</code> and can be downloaded by clicking on the <code>zip</code> button on the left to download the source code zip file at the following address: <code>https://hg.openjdk.java.net /jdk-updates/jdk11u/archive/tip.zip</code></p>
<p>After downloading, the size is 189M, after unzipping, the size is 600M.</p>
<h2 id="compiling-and-running">Compiling and running</h2>
<p>There are 2 optional tools for compiling openJdk source code, one using <code>Cygwin</code> and the other using <code>WSL</code>.</p>
<p>I recommend using <code>WSL</code>, but using <code>Cygwin</code> is also described in the article, if anyone needs it.</p>
<p><strong>Note: Only one of WSL and Cygwin needs to be installed</strong></p>
<h3 id="compiling-with-wsl">Compiling with WSL</h3>
<h4 id="installing-wsl">Installing WSL</h4>
<p>First install <code>WSL</code>, see the official Microsoft documentation: <a href="https://docs.microsoft.com/zh-cn/windows/wsl/install-win10">Installing WSL on Windows 10 | Microsoft Docs</a> for a detailed installation tutorial.</p>
<p>It is recommended to install <code>Ubuntu 20.04 LTS</code> for this version.</p>
<p>Software needed for installation</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">sudo su
</span></span><span class="line"><span class="cl">apt update <span class="o">&amp;&amp;</span> apt upgrade
</span></span><span class="line"><span class="cl">sudo apt install mercurial zip unzip make gcc g++ build-essential ccache libx11-dev libxext-dev libxrender-dev  libxrandr-dev libxtst-dev libxt-dev libcups2-dev libfreetype6-dev libasound2-dev libfontconfig1-dev ccache cmake gdb autoconf
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="installing-java">Installing Java</h4>
<p>To compile Java, you need N-1 version of Java. e.g. to compile Java 11 you need at least Java 10 and later installed on your computer.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">sudo apt install openjdk-11-jdk
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="compiling-openjdk">Compiling OpenJdk</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">chmod +x configure
</span></span><span class="line"><span class="cl">./configure --with-debug-level<span class="o">=</span>slowdebug --with-native-debug-symbols<span class="o">=</span>internal --disable-warnings-as-errors --enable-ccache
</span></span></code></pre></td></tr></table>
</div>
</div><p>To compile after the configuration is complete.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">make all
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="testing-java">Testing Java</h4>
<p>To test that the compiled result works properly.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">ubuntu@zhang:~/jdk11u-113c646a33d2$ ./build/linux-x86_64-normal-server-slowdebug/jdk/bin/java -version
</span></span><span class="line"><span class="cl">openjdk version <span class="s2">&#34;11.0.12-internal&#34;</span> 2021-07-20
</span></span><span class="line"><span class="cl">OpenJDK Runtime Environment <span class="o">(</span>slowdebug build 11.0.12-internal+0-adhoc.ubuntu.jdk11u-113c646a33d2<span class="o">)</span>
</span></span><span class="line"><span class="cl">OpenJDK 64-Bit Server VM <span class="o">(</span>slowdebug build 11.0.12-internal+0-adhoc.ubuntu.jdk11u-113c646a33d2, mixed mode<span class="o">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Create a new Java file named <code>hello.java</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.concurrent.ThreadLocalRandom</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">hello</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">REPETITIONS</span> <span class="o">=</span> <span class="n">100_000_000</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">InterruptedException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Hello World&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="o">(</span><span class="n">var</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">REPETITIONS</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">1000</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;i is:&#34;</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="s">&#34;, current time is:&#34;</span> <span class="o">+</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()</span> <span class="o">+</span> <span class="s">&#34;, random is:&#34;</span> <span class="o">+</span> <span class="n">ThreadLocalRandom</span><span class="o">.</span><span class="na">current</span><span class="o">().</span><span class="na">nextLong</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Run the Java file.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">ubuntu@zhang:~/jdk11u-113c646a33d2$ ./build/linux-x86_64-normal-server-slowdebug/jdk/bin/java hello.java
</span></span><span class="line"><span class="cl">Hello World
</span></span></code></pre></td></tr></table>
</div>
</div><p>Debugging Java is in the next section.</p>
<h3 id="using-cygwin-with-visual-studio-for-compilation">Using Cygwin with Visual Studio for compilation</h3>
<h4 id="installing-cygwin">Installing Cygwin</h4>
<p>The compilation of openJdk requires the installation of <code>Cygwin</code> as the GNU environment, <code>MSYS2</code> is not recommended.</p>
<p>Download: <a href="https://www.cygwin.com/setup-x86_64.exe">setup-x86_64.exe</a></p>
<p>Run the command to install the required components.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">.<span class="se">\s</span>etup-x86_64.exe  -q -P autoconf -P make -P unzip -P zip -P gdb
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="installing-visual-studio">Installing Visual Studio</h4>
<p>The gcc version on windows requires the c++ compiler in vs to be selected.</p>
<p>To install <code>Visual Studio 2019 Community</code> version, select the component <code>Desktop Development with C++</code> for the tools component.</p>
<p>Caution.</p>
<ol>
<li>installation directory, do not have spaces, otherwise you have to use fsutil for short path conversion, see error resolution for details.</li>
<li>For the old version of openJdk source code, choose English for the language package, not Chinese, otherwise the compilation will fail. Now the new version of OpenJdk source code has solved this problem.</li>
<li>When installing, in the right column of <code>Desktop Development with C++</code>, check the box to install <code>MSVC v141-VS 2017 C++</code>. openJdk 11 only supports VS 2017 version of c++, OpenJdk 15 source code is compiled to support <code>VS 2019</code>.</li>
</ol>
<h4 id="installing-java-1">Installing Java</h4>
<p>To compile Java, you need N-1 version of Java. e.g. to compile Java 11 you need to have at least Java 10 and later installed on your computer.</p>
<p>Download link: <a href="https://adoptopenjdk.net/">AdoptOpenJDK - Open source, prebuilt OpenJDK binaries</a></p>
<p>Select <code>OpenJdk 11</code> version and JVM <code>HotSpot</code>.</p>
<p>Download and install, make sure the installation is successful.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ java.exe -version
</span></span><span class="line"><span class="cl">openjdk version <span class="s2">&#34;11.0.9.1&#34;</span> 2020-11-04
</span></span><span class="line"><span class="cl">OpenJDK Runtime Environment AdoptOpenJDK <span class="o">(</span>build 11.0.9.1+1<span class="o">)</span>
</span></span><span class="line"><span class="cl">OpenJDK 64-Bit Server VM AdoptOpenJDK <span class="o">(</span>build 11.0.9.1+1, mixed mode<span class="o">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="compile-openjdk">Compile OpenJdk</h4>
<p>Use <code>Cygwin64 Terminal</code> to switch to the source directory and execute the configure script, if it goes well no error will be reported.</p>
<p>You need to specify the installation directory of VS.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="nb">cd</span> /cygdrive/d/jdk11u-113c646a33d2
</span></span><span class="line"><span class="cl">./configure --with-debug-level<span class="o">=</span>slowdebug --with-native-debug-symbols<span class="o">=</span>external --disable-warnings-as-errors --with-tools-dir<span class="o">=</span>/cygdrive/c/VS/VC/Auxiliary
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Warning: If the VS/Windows Kits directory has spaces, then you need to use fsutil for short path conversion, see error resolution for details</strong></p>
<p>To compile.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">make all
</span></span></code></pre></td></tr></table>
</div>
</div><p>When compiling, if you encounter errors, you can look at the problems in the error resolution at the bottom of the article.</p>
<p>If it goes smoothly, the compilation will be finished in about one hour. The folder size is 4G after completion.</p>
<h4 id="testing-java-1">Testing Java</h4>
<p>To test if the compiled result works properly.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ ./build/windows-x86_64-normal-server-slowdebug/images/jdk/bin/java -version
</span></span><span class="line"><span class="cl">openjdk version <span class="s2">&#34;11.0.12-internal&#34;</span> 2021-07-20
</span></span><span class="line"><span class="cl">OpenJDK Runtime Environment <span class="o">(</span>slowdebug build 11.0.12-internal+0-adhoc.zhang.jdk11u-113c646a33d2<span class="o">)</span>
</span></span><span class="line"><span class="cl">OpenJDK 64-Bit Server VM <span class="o">(</span>slowdebug build 11.0.12-internal+0-adhoc.zhang.jdk11u-113c646a33d2, mixed mode<span class="o">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Create a new Java file named <code>hello.java</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.concurrent.ThreadLocalRandom</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">hello</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">REPETITIONS</span> <span class="o">=</span> <span class="n">100_000_000</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">InterruptedException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Hello World&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="o">(</span><span class="n">var</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">REPETITIONS</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">1000</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;i is:&#34;</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="s">&#34;, current time is:&#34;</span> <span class="o">+</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()</span> <span class="o">+</span> <span class="s">&#34;, random is:&#34;</span> <span class="o">+</span> <span class="n">ThreadLocalRandom</span><span class="o">.</span><span class="na">current</span><span class="o">().</span><span class="na">nextLong</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Run the Java file.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ ./build/windows-x86_64-normal-server-slowdebug/images/jdk/bin/java hello.java
</span></span><span class="line"><span class="cl">Hello World
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="debugging-java">Debugging Java</h2>
<p>The following is an example of debugging the <code>WSL</code> version of Java.</p>
<ol>
<li>
<p>Run the Java program.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">ubuntu@zhang:~/jdk11u-113c646a33d2$ ./build/linux-x86_64-normal-server-slowdebug/jdk/bin/java hello.java
</span></span><span class="line"><span class="cl">Hello World
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>Find the PID of the Java program.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">ubuntu@zhang:~$ jps
</span></span><span class="line"><span class="cl"><span class="m">12257</span> Main
</span></span><span class="line"><span class="cl"><span class="m">12302</span> Jps
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>Use gdb to connect to the program.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">ubuntu@zhang:~$ gdb -p <span class="m">12257</span>
</span></span><span class="line"><span class="cl">GNU gdb <span class="o">(</span>Ubuntu 9.2-0ubuntu1~20.04<span class="o">)</span> 9.2
</span></span><span class="line"><span class="cl">Copyright <span class="o">(</span>C<span class="o">)</span> <span class="m">2020</span> Free Software Foundation, Inc.
</span></span><span class="line"><span class="cl">License GPLv3+: GNU GPL version <span class="m">3</span> or later &lt;http://gnu.org/licenses/gpl.html&gt;
</span></span><span class="line"><span class="cl">This is free software: you are free to change and redistribute it.
</span></span><span class="line"><span class="cl">There is NO WARRANTY, to the extent permitted by law.
</span></span><span class="line"><span class="cl">Type <span class="s2">&#34;show copying&#34;</span> and <span class="s2">&#34;show warranty&#34;</span> <span class="k">for</span> details.
</span></span><span class="line"><span class="cl">This GDB was configured as <span class="s2">&#34;x86_64-linux-gnu&#34;</span>.
</span></span><span class="line"><span class="cl">Type <span class="s2">&#34;show configuration&#34;</span> <span class="k">for</span> configuration details.
</span></span><span class="line"><span class="cl">For bug reporting instructions, please see:
</span></span><span class="line"><span class="cl">&lt;http://www.gnu.org/software/gdb/bugs/&gt;.
</span></span><span class="line"><span class="cl">Find the GDB manual and other documentation resources online at:
</span></span><span class="line"><span class="cl">    &lt;http://www.gnu.org/software/gdb/documentation/&gt;.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">For help, <span class="nb">type</span> <span class="s2">&#34;help&#34;</span>.
</span></span><span class="line"><span class="cl">Type <span class="s2">&#34;apropos word&#34;</span> to search <span class="k">for</span> commands related to <span class="s2">&#34;word&#34;</span>.
</span></span><span class="line"><span class="cl">Attaching to process <span class="m">12339</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>New LWP 12340<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>New LWP 12341<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>New LWP 12342<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>New LWP 12343<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>New LWP 12344<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>New LWP 12345<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>New LWP 12346<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>New LWP 12347<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>New LWP 12348<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>New LWP 12349<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>New LWP 12350<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>New LWP 12351<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>New LWP 12352<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>New LWP 12353<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>New LWP 12354<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>New LWP 12357<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>New LWP 12360<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>New LWP 12361<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>New LWP 12362<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>New LWP 12363<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>New LWP 12364<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>New LWP 12365<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>New LWP 12366<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>New LWP 12367<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>Thread debugging using libthread_db enabled<span class="o">]</span>
</span></span><span class="line"><span class="cl">Using host libthread_db library <span class="s2">&#34;/lib/x86_64-linux-gnu/libthread_db.so.1&#34;</span>.
</span></span><span class="line"><span class="cl">__pthread_clockjoin_ex <span class="o">(</span><span class="nv">threadid</span><span class="o">=</span>140260516488960, <span class="nv">thread_return</span><span class="o">=</span>0x7ffcefea4328, <span class="nv">clockid</span><span class="o">=</span>&lt;optimized out&gt;,
</span></span><span class="line"><span class="cl">    <span class="nv">abstime</span><span class="o">=</span>&lt;optimized out&gt;, <span class="nv">block</span><span class="o">=</span>&lt;optimized out&gt;<span class="o">)</span> at pthread_join_common.c:145
</span></span><span class="line"><span class="cl"><span class="m">145</span>     pthread_join_common.c: No such file or directory.
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ol>
<p>Add a breakpoint, here I choose the source code implementation of <code>main</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> list JavaMain
</span></span><span class="line"><span class="cl"><span class="m">388</span>         <span class="o">}</span> <span class="k">while</span> <span class="o">(</span>JNI_FALSE<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="m">389</span>
</span></span><span class="line"><span class="cl"><span class="m">390</span>
</span></span><span class="line"><span class="cl"><span class="m">391</span>     int
</span></span><span class="line"><span class="cl"><span class="m">392</span>     JavaMain<span class="o">(</span>void* _args<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="m">393</span>     <span class="o">{</span>
</span></span><span class="line"><span class="cl"><span class="m">394</span>         JavaMainArgs *args <span class="o">=</span> <span class="o">(</span>JavaMainArgs *<span class="o">)</span>_args<span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="m">395</span>         int <span class="nv">argc</span> <span class="o">=</span> args-&gt;argc<span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="m">396</span>         char **argv <span class="o">=</span> args-&gt;argv<span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="m">397</span>         int <span class="nv">mode</span> <span class="o">=</span> args-&gt;mode<span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> <span class="nb">break</span> JavaMain
</span></span><span class="line"><span class="cl">Breakpoint <span class="m">1</span> at 0x7f845ebe341d: file ../src/java.base/share/native/libjli/java.c, line 393.
</span></span></code></pre></td></tr></table>
</div>
</div><p>Run the program.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> run
</span></span><span class="line"><span class="cl">The program being debugged has been started already.
</span></span><span class="line"><span class="cl">Start it from the beginning? <span class="o">(</span>y or n<span class="o">)</span> y
</span></span><span class="line"><span class="cl">Starting program: /home/ubuntu/jdk11u-113c646a33d2/build/linux-x86_64-normal-server-slowdebug/jdk/bin/java
</span></span><span class="line"><span class="cl"><span class="o">[</span>Thread debugging using libthread_db enabled<span class="o">]</span>
</span></span><span class="line"><span class="cl">Using host libthread_db library <span class="s2">&#34;/lib/x86_64-linux-gnu/libthread_db.so.1&#34;</span>.
</span></span><span class="line"><span class="cl"><span class="o">[</span>New Thread 0x7ffff5c27700 <span class="o">(</span>LWP 249<span class="o">)]</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>Switching to Thread 0x7ffff5c27700 <span class="o">(</span>LWP 249<span class="o">)]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Thread <span class="m">2</span> <span class="s2">&#34;java&#34;</span> hit Breakpoint 1, JavaMain <span class="o">(</span><span class="nv">_args</span><span class="o">=</span>0x0<span class="o">)</span> at ../src/java.base/share/native/libjli/java.c:393
</span></span><span class="line"><span class="cl"><span class="m">393</span>     <span class="o">{</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> n
</span></span><span class="line"><span class="cl"><span class="m">394</span>         JavaMainArgs *args <span class="o">=</span> <span class="o">(</span>JavaMainArgs *<span class="o">)</span>_args<span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> n
</span></span><span class="line"><span class="cl"><span class="m">395</span>         int <span class="nv">argc</span> <span class="o">=</span> args-&gt;argc<span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> n
</span></span><span class="line"><span class="cl"><span class="m">396</span>         char **argv <span class="o">=</span> args-&gt;argv<span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> print *args
</span></span><span class="line"><span class="cl"><span class="nv">$1</span> <span class="o">=</span> <span class="o">{</span><span class="nv">argc</span> <span class="o">=</span> 0, <span class="nv">argv</span> <span class="o">=</span> 0x5555555595a8, <span class="nv">mode</span> <span class="o">=</span> 0, <span class="nv">what</span> <span class="o">=</span> 0x0, <span class="nv">ifn</span> <span class="o">=</span> <span class="o">{</span><span class="nv">CreateJavaVM</span> <span class="o">=</span> 0x7ffff6a5a36b &lt;JNI_CreateJavaVM<span class="o">(</span>JavaVM**, void**, void*<span class="o">)</span>&gt;,
</span></span><span class="line"><span class="cl">    <span class="nv">GetDefaultJavaVMInitArgs</span> <span class="o">=</span> 0x7ffff6a59e91 &lt;JNI_GetDefaultJavaVMInitArgs<span class="o">(</span>void*<span class="o">)</span>&gt;, <span class="nv">GetCreatedJavaVMs</span> <span class="o">=</span> 0x7ffff6a5a3a9 &lt;JNI_GetCreatedJavaVMs<span class="o">(</span>JavaVM**, jsize, jsize*<span class="o">)</span>&gt;<span class="o">}}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>As you can see, the breakpoint was successfully hit on the Java initialization code.</p>
<p>The desired method can be debugged later.</p>
<h2 id="postscript">Postscript</h2>
<p>It took quite a lot of time to write this, mainly in exploring how to solve the various error reports, and ultimately which method is more convenient to debug.</p>
<p>Finally compile debugging is completed, although not directly learned a lot of knowledge, the process of problem solving, but also learned a lot.</p>
<h2 id="error-resolution">Error resolution</h2>
<p><strong>ls: cannot access ‘/cygdrive/d/VS2/VC/Redist/MSVC/*/x64/Microsoft.VC141.CRT/msvcp140.dll’: No such file or directory</strong></p>
<p>The following errors were encountered.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">configure: Rewriting CYGWIN_VC_INSTALL_DIR to &#34;/cygdrive/d/VS2/VC&#34;
</span></span><span class="line"><span class="cl">ls: cannot access &#39;/cygdrive/d/VS2/VC/Redist/MSVC/*/x64/Microsoft.VC141.CRT/vcruntime140.dll&#39;: No such file or directory
</span></span><span class="line"><span class="cl">configure: Found vcruntime140.dll at /cygdrive/c/progra~1/adopto~1/jdk-11~1.101/bin/vcruntime140.dll using well-known location in Boot JDK
</span></span><span class="line"><span class="cl">checking found vcruntime140.dll architecture... ok
</span></span><span class="line"><span class="cl">checking for vcruntime140.dll... /cygdrive/c/progra~1/adopto~1/jdk-11~1.101/bin/vcruntime140.dll
</span></span><span class="line"><span class="cl">configure: Rewriting CYGWIN_VC_INSTALL_DIR to &#34;/cygdrive/d/VS2/VC&#34;
</span></span><span class="line"><span class="cl">ls: cannot access &#39;/cygdrive/d/VS2/VC/Redist/MSVC/*/x64/Microsoft.VC141.CRT/msvcp140.dll&#39;: No such file or directory
</span></span><span class="line"><span class="cl">configure: Found msvcp140.dll at /cygdrive/c/progra~1/adopto~1/jdk-11~1.101/bin/msvcp140.dll using well-known location in Boot JDK
</span></span><span class="line"><span class="cl">checking found msvcp140.dll architecture... ok
</span></span><span class="line"><span class="cl">checking for msvcp140.dll... /cygdrive/c/progra~1/adopto~1/jdk-11~1.101/bin/msvcp140.dll
</span></span><span class="line"><span class="cl">checking for UCRT DLL dir... configure: Rewriting CYGWIN_WINDOWSSDKDIR to &#34;/cygdrive/d/windows kits/10&#34;
</span></span><span class="line"><span class="cl">no
</span></span><span class="line"><span class="cl">configure: error: Could not find any dlls in
</span></span><span class="line"><span class="cl">configure exiting with result code 1
</span></span></code></pre></td></tr></table>
</div>
</div><p>Solution.</p>
<p>The reason for this problem is that Java 11 compilation does not support VS 2019, this problem is officially fixed in Java 15 compilation: <a href="https://bugs.openjdk.java.net/browse/JDK-8242468">[JDK-8242468] VS2019 build missing vcruntime140_1.dll - Java Bug System</a></p>
<p>The solution is to use <code>visual studio installer</code> and check the box to install <code>MSVC v141-VS 2017 C++</code> in the <code>Desktop Development with C++</code> column on the right.</p>
<p>Once the installation is complete, this error will be gone</p>
<p><strong>configure: error: Could not find any dlls in</strong></p>
<p>The following error was encountered</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">configure: Rewriting CYGWIN_VC_INSTALL_DIR to &#34;/cygdrive/c/VS/VC&#34;
</span></span><span class="line"><span class="cl">POSSIBLE_MSVC_DLL /cygdrive/c/VS/VC/Redist/MSVC/14.16.27012/x64/Microsoft.VC141.CRT/vcruntime140.dll
</span></span><span class="line"><span class="cl">configure: Found vcruntime140.dll at /cygdrive/c/VS/VC/Redist/MSVC/14.16.27012/x64/Microsoft.VC141.CRT/vcruntime140.dll using well-known location in VCINSTALLDIR
</span></span><span class="line"><span class="cl">checking found vcruntime140.dll architecture... ok
</span></span><span class="line"><span class="cl">checking for vcruntime140.dll... /cygdrive/c/VS/VC/Redist/MSVC/14.16.27012/x64/Microsoft.VC141.CRT/vcruntime140.dll
</span></span><span class="line"><span class="cl">configure: Rewriting CYGWIN_VC_INSTALL_DIR to &#34;/cygdrive/c/VS/VC&#34;
</span></span><span class="line"><span class="cl">POSSIBLE_MSVC_DLL /cygdrive/c/VS/VC/Redist/MSVC/14.16.27012/x64/Microsoft.VC141.CRT/msvcp140.dll
</span></span><span class="line"><span class="cl">configure: Found msvcp140.dll at /cygdrive/c/VS/VC/Redist/MSVC/14.16.27012/x64/Microsoft.VC141.CRT/msvcp140.dll using well-known location in VCINSTALLDIR
</span></span><span class="line"><span class="cl">checking found msvcp140.dll architecture... ok
</span></span><span class="line"><span class="cl">checking for msvcp140.dll... /cygdrive/c/VS/VC/Redist/MSVC/14.16.27012/x64/Microsoft.VC141.CRT/msvcp140.dll
</span></span><span class="line"><span class="cl">checking for UCRT DLL dir... configure: Rewriting CYGWIN_WINDOWSSDKDIR to &#34;/cygdrive/d/windows kits/10&#34;
</span></span><span class="line"><span class="cl">no
</span></span><span class="line"><span class="cl">configure: error: Could not find any dlls in
</span></span><span class="line"><span class="cl">configure exiting with result code 1
</span></span></code></pre></td></tr></table>
</div>
</div><p>The reason for this error is that the win10 sdk directory has spaces in it, the solution is to modify the file <code>make/autoconf/toolchain_windows.m4</code></p>
<p>Put</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">UCRT_DLL_DIR=&#34;`ls -d $CYGWIN_WINDOWSSDKDIR/Redist/*/ucrt/DLLs/$dll_subdir \
</span></span></code></pre></td></tr></table>
</div>
</div><p>Modify to</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">UCRT_DLL_DIR=&#34;``ls -d &#34;$CYGWIN_WINDOWSSDKDIR&#34;/Redist/*/ucrt/DLLs/$dll_subdir \
</span></span></code></pre></td></tr></table>
</div>
</div><p>The error is solved after modification.</p>
<p><strong>Using fsutil for short path conversion</strong></p>
<p><code>Cygwin</code> does not support paths with spaces, so you need to convert paths with spaces to paths without spaces.</p>
<p>For example, the installation path of <code>Windows Kits</code> is <code>D:\Windows Kits</code>, alias <code>Kits2</code>.</p>
<p>Open <code>cmd</code> as administrator, or <code>powershell</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">fsutil file setshortname <span class="s2">&#34;D:\Windows Kits&#34;</span> Kits2
</span></span></code></pre></td></tr></table>
</div>
</div><p>After conversion <code>D:\Kits2</code> is equivalent to <code>D:\Windows Kits</code></p>
<p><strong>fatal error C1083: Cannot open include file: ‘crtdbg.h’: No such file or directory</strong></p>
<p>The following error was encountered.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">formssel.cpp
</span></span><span class="line"><span class="cl">c:\VS\VC\Tools\MSVC\14.29.30037\include\yvals.h(12): fatal error C1083: Cannot open include file: &#39;crtdbg.h&#39;: No such file or directory
</span></span><span class="line"><span class="cl">   ... (rest of output omitted)
</span></span><span class="line"><span class="cl">* For target hotspot_variant-server_tools_adlc_objs_main.obj:
</span></span><span class="line"><span class="cl">cl : Command line warning D9024 : unrecognized source file type &#39;kits/10/include/10.0.19041.0/ucrt&#39;, object file assumed
</span></span><span class="line"><span class="cl">cl : Command line warning D9027 : source file &#39;kits/10/include/10.0.19041.0/ucrt&#39; ignored
</span></span><span class="line"><span class="cl">cl : Command line warning D9024 : unrecognized source file type &#39;kits/10/include/10.0.19041.0/shared&#39;, object file assumed
</span></span><span class="line"><span class="cl">cl : Command line warning D9027 : source file &#39;kits/10/include/10.0.19041.0/shared&#39; ignored
</span></span><span class="line"><span class="cl">cl : Command line warning D9024 : unrecognized source file type &#39;kits/10/include/10.0.19041.0/um&#39;, object file assumed
</span></span><span class="line"><span class="cl">cl : Command line warning D9027 : source file &#39;kits/10/include/10.0.19041.0/um&#39; ignored
</span></span><span class="line"><span class="cl">cl : Command line warning D9024 : unrecognized source file type &#39;kits/10/include/10.0.19041.0/winrt&#39;, object file assumed
</span></span><span class="line"><span class="cl">cl : Command line warning D9027 : source file &#39;kits/10/include/10.0.19041.0/winrt&#39; ignored
</span></span><span class="line"><span class="cl">cl : Command line warning D9024 : unrecognized source file type &#39;kits/10/include/10.0.19041.0/cppwinrt&#39;, object file assumed
</span></span><span class="line"><span class="cl">cl : Command line warning D9027 : source file &#39;kits/10/include/10.0.19041.0/cppwinrt&#39; ignored
</span></span><span class="line"><span class="cl">main.cpp
</span></span><span class="line"><span class="cl">c:\VS\VC\Tools\MSVC\14.29.30037\include\yvals.h(12): fatal error C1083: Cannot open include file: &#39;crtdbg.h&#39;: No such file or directory
</span></span><span class="line"><span class="cl">   ... (rest of output omitted)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">* All command lines available in /cygdrive/d/jdk11u-113c646a33d2/build/windows-x86_64-normal-server-slowdebug/make-support/failure-logs.
</span></span><span class="line"><span class="cl">=== End of repeated output ===
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">No indication of failed target found.
</span></span><span class="line"><span class="cl">Hint: Try searching the build log for &#39;] Error&#39;.
</span></span><span class="line"><span class="cl">Hint: See doc/building.html#troubleshooting for assistance.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">make[1]: *** [/cygdrive/d/jdk11u-113c646a33d2/make/Init.gmk:305: main] Error 2
</span></span><span class="line"><span class="cl">make: *** [/cygdrive/d/jdk11u-113c646a33d2/make/Init.gmk:186: all] Error 2
</span></span></code></pre></td></tr></table>
</div>
</div><p>This is because the <code>Windows Kits</code> directory has spaces in it, use <code>fsutil</code> :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">fsutil file setshortname &#34;D:\Windows Kits&#34; Kits
</span></span></code></pre></td></tr></table>
</div>
</div><p>Reconfiguration.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">./configure --with-debug-level=slowdebug --with-native-debug-symbols=external --disable-warnings-as-errors --with-tools-dir=/cygdrive/c/VS/VC/Auxiliary
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>test_json.cpp(357): error C2143: syntax error: missing</strong></p>
<p>Error encountered reporting.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">d:/jdk11u-113c646a33d2/test/hotspot/gtest/utilities/test_json.cpp(371): note: see previous definition of &#39;TestBody&#39;
</span></span><span class="line"><span class="cl">make[3]: *** [lib/CompileGtest.gmk:61: /cygdrive/d/jdk11u-113c646a33d2/build/windows-x86_64-normal-server-slowdebug/hotspot/variant-server/libjvm/gtest/objs/test_json.obj] Error 1
</span></span><span class="line"><span class="cl">make[3]: *** Waiting for unfinished jobs....
</span></span><span class="line"><span class="cl">make[2]: *** [make/Main.gmk:272: hotspot-server-libs] Error 2
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ERROR: Build failed for target &#39;hotspot&#39; in configuration &#39;windows-x86_64-normal-server-slowdebug&#39; (exit code 2)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">=== Output from failing command(s) repeated here ===
</span></span><span class="line"><span class="cl">* For target hotspot_variant-server_libjvm_gtest_objs_test_json.obj:
</span></span><span class="line"><span class="cl">test_json.cpp
</span></span><span class="line"><span class="cl">d:/jdk11u-113c646a33d2/test/hotspot/gtest/utilities/test_json.cpp(357): error C2143: syntax error: missing &#39;)&#39; before &#39;]&#39;
</span></span><span class="line"><span class="cl">d:/jdk11u-113c646a33d2/test/hotspot/gtest/utilities/test_json.cpp(355): error C2660: &#39;JSON_GTest::test&#39;: function does not take 1 arguments
</span></span><span class="line"><span class="cl">d:/jdk11u-113c646a33d2/test/hotspot/gtest/utilities/test_json.cpp(49): note: see declaration of &#39;JSON_GTest::test&#39;
</span></span><span class="line"><span class="cl">d:/jdk11u-113c646a33d2/test/hotspot/gtest/utilities/test_json.cpp(357): error C2143: syntax error: missing &#39;;&#39; before &#39;]&#39;
</span></span><span class="line"><span class="cl">d:/jdk11u-113c646a33d2/test/hotspot/gtest/utilities/test_json.cpp(357): error C2059: syntax error: &#39;]&#39;
</span></span><span class="line"><span class="cl">d:/jdk11u-113c646a33d2/test/hotspot/gtest/utilities/test_json.cpp(357): error C2017: illegal escape sequence
</span></span><span class="line"><span class="cl">d:/jdk11u-113c646a33d2/test/hotspot/gtest/utilities/test_json.cpp(357): error C2059: syntax error: &#39;)&#39;
</span></span><span class="line"><span class="cl">d:/jdk11u-113c646a33d2/test/hotspot/gtest/utilities/test_json.cpp(363): error C2143: syntax error: missing &#39;)&#39; before &#39;]&#39;
</span></span><span class="line"><span class="cl">d:/jdk11u-113c646a33d2/test/hotspot/gtest/utilities/test_json.cpp(361): error C2660: &#39;JSON_GTest::test&#39;: function does not take 1 arguments
</span></span><span class="line"><span class="cl">d:/jdk11u-113c646a33d2/test/hotspot/gtest/utilities/test_json.cpp(49): note: see declaration of &#39;JSON_GTest::test&#39;
</span></span><span class="line"><span class="cl">d:/jdk11u-113c646a33d2/test/hotspot/gtest/utilities/test_json.cpp(363): error C2143: syntax error: missing &#39;;&#39; before &#39;]&#39;
</span></span><span class="line"><span class="cl">d:/jdk11u-113c646a33d2/test/hotspot/gtest/utilities/test_json.cpp(363): error C2059: syntax error: &#39;]&#39;
</span></span><span class="line"><span class="cl">d:/jdk11u-113c646a33d2/test/hotspot/gtest/utilities/test_json.cpp(363): error C2017: illegal escape sequence
</span></span><span class="line"><span class="cl">d:/jdk11u-113c646a33d2/test/hotspot/gtest/utilities/test_json.cpp(363): error C2059: syntax error: &#39;)&#39;
</span></span><span class="line"><span class="cl">   ... (rest of output omitted)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">* All command lines available in /cygdrive/d/jdk11u-113c646a33d2/build/windows-x86_64-normal-server-slowdebug/make-support/failure-logs.
</span></span><span class="line"><span class="cl">=== End of repeated output ===
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">No indication of failed target found.
</span></span><span class="line"><span class="cl">Hint: Try searching the build log for &#39;] Error&#39;.
</span></span><span class="line"><span class="cl">Hint: See doc/building.html#troubleshooting for assistance.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">make[1]: *** [/cygdrive/d/jdk11u-113c646a33d2/make/Init.gmk:305: main] Error 2
</span></span><span class="line"><span class="cl">make: *** [/cygdrive/d/jdk11u-113c646a33d2/make/Init.gmk:186: hotspot] Error 2
</span></span></code></pre></td></tr></table>
</div>
</div><p>You can see that this error is a single test in the error, the solution: delete this file or delete this function that reports the error.</p>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/openjdk/">openjdk</a>
          <a href="/tags/windows/">windows</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2022-01/golang-patterns/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Golang Common Design Patterns - Option Pattern</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2022-01/node-download/">
            <span class="next-text nav-default">Node.js dynamic table large file download practice</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  <script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox-3.1.20.min.js"></script>



<script type="text/javascript" src="/js/main.min.64437849d125a2d603b3e71d6de5225d641a32d17168a58106e0b61852079683.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
