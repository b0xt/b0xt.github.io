<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Golang Dynamic Script Research - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="Explore how to implement dynamic scripting in Golang." /><meta name="keywords" content="Golang" />






<meta name="generator" content="Hugo 0.102.0 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2022-09/go-script/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link href="/lib/fancybox/jquery.fancybox-3.1.20.min.css" rel="stylesheet">


<meta property="og:title" content="Golang Dynamic Script Research" />
<meta property="og:description" content="Explore how to implement dynamic scripting in Golang." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2022-09/go-script/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-09-02T14:40:01+08:00" />
<meta property="article:modified_time" content="2022-09-02T14:40:01+08:00" />

<meta itemprop="name" content="Golang Dynamic Script Research">
<meta itemprop="description" content="Explore how to implement dynamic scripting in Golang."><meta itemprop="datePublished" content="2022-09-02T14:40:01+08:00" />
<meta itemprop="dateModified" content="2022-09-02T14:40:01+08:00" />
<meta itemprop="wordCount" content="2646">
<meta itemprop="keywords" content="golang," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Golang Dynamic Script Research"/>
<meta name="twitter:description" content="Explore how to implement dynamic scripting in Golang."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SOBYTE</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SOBYTE</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Golang Dynamic Script Research</h1>

      <div class="post-meta">
        <span class="post-time"> 2022-09-02 14:40:01 </span>
        <div class="post-category">
            <a href="/categories/tutorials/"> tutorials </a>
            </div>
          <span class="more-meta"> 2646 words </span>
          <span class="more-meta"> 13 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#1-technical-background">1. Technical background</a>
          <ul>
            <li><a href="#11-dynamic-linking-technology-for-programs">1.1 Dynamic linking technology for programs</a></li>
            <li><a href="#12-golangs-dynamic-techniques">1.2 Golang&rsquo;s Dynamic Techniques</a></li>
          </ul>
        </li>
        <li><a href="#2-third-party-interpreter-for-golang-yaegi">2. Third-party interpreter for Golang (Yaegi)</a>
          <ul>
            <li><a href="#features">Features</a></li>
            <li><a href="#21-usage-scenarios">2.1 Usage scenarios</a></li>
            <li><a href="#22-data-interaction">2.2 Data Interaction</a></li>
          </ul>
        </li>
        <li><a href="#3-principles-of-implementation">3. Principles of Implementation</a>
          <ul>
            <li><a href="#31-ast---abstract-syntax-tree">3.1 AST - Abstract Syntax Tree</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <h2 id="1-technical-background">1. Technical background</h2>
<h3 id="11-dynamic-linking-technology-for-programs">1.1 Dynamic linking technology for programs</h3>
<p>In the actual development process, we often need to dynamically update the functions of the program, or add or update the program modules without changing the main program files.</p>
<h4 id="111-dynamic-link-library">1.1.1 Dynamic Link Library</h4>
<p>The first and most common is the Dynamic Link Library (DLL) supported by the Windows platform, usually with the suffix <code>.dll</code>. Its advantages are very obvious:</p>
<ol>
<li>multiple programs can share code and data. That is, multiple programs load the same DLL file.</li>
<li>It is natural to divide the program into several modules. Each module is output as a separate DLL file, which is loaded and executed by the main program.</li>
<li>Cross-language calling. Since DLL files are language-independent, a DLL file can be loaded and executed by multiple programming languages.</li>
<li>Easy to update. In the process of program update, only the DLL file of the corresponding module can be updated without redeploying the whole program.</li>
<li>Provide technical possibility for hot update. Dynamic link libraries can be programmatically loaded and unloaded, thus supporting the update of modules without restarting the program.</li>
<li>Provide programming interfaces for programs. It is possible to encapsulate the calling interface of your program as a DLL file for other programs to call.</li>
</ol>
<h4 id="112-dynamic-shared-objects">1.1.2 Dynamic shared objects</h4>
<p>In Linux, this technology is called dynamic shared objects (<strong>dynamic shared objects</strong>) and is commonly suffixed with <code>.so</code>.</p>
<p>In addition to the above-mentioned advantages of &ldquo;dynamically linked libraries&rdquo;, dynamic shared objects can also solve the underlying interface compatibility problems caused by the openness of Linux. That is, the dynamic shared object encapsulates the underlying interface of the operating system and provides a unified call interface for upper-level applications to call. It is equivalent to providing a compatibility layer.</p>
<h4 id="113-dynamic-techniques-for-non-compiled-languages">1.1.3 Dynamic techniques for non-compiled languages</h4>
<p>Non-compiled languages, since they are distributed through source code, implement dynamic loading of program modules or updating modules by directly modifying the source code. The idea is simple and easy to implement.</p>
<h3 id="12-golangs-dynamic-techniques">1.2 Golang&rsquo;s Dynamic Techniques</h3>
<p>Golang, as a compiled development language, does not inherently support dynamic loading and updating via source code. However, Golang officially provides the Plugin technology to achieve dynamic loading.</p>
<p>Compile a Go program into a Plugin by adding the following parameters at compile time.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">go build -buildmode<span class="o">=</span>plugin
</span></span></code></pre></td></tr></table>
</div>
</div><p>However, this technique is very limited in the current version (1.19). As you can see from its documentation <a href="https://pkg.go.dev/plugin">https://pkg.go.dev/plugin</a></p>
<ol>
<li>platform limitations, currently only supported: Linux, FreeBSD and macOS</li>
<li>uninstallation limitation, only dynamic loading is supported, not dynamic uninstallation.</li>
<li>does not provide a unified interface, can only handle the internal properties and functions of Plugin through reflection.</li>
</ol>
<p>And the above problems, Golang official does not intend to solve &hellip;&hellip;</p>
<h2 id="2-third-party-interpreter-for-golang-yaegi">2. Third-party interpreter for Golang (Yaegi)</h2>
<p>Interpreters are generally found only in scripting languages, but Traefik has developed an interpreter for Golang in order to implement dynamically loaded plug-in functionality. It provides the ability to execute Golang source code directly at runtime.</p>
<p>Reference project: <a href="https://github.com/traefik/yaegi">https://github.com/traefik/yaegi</a></p>
<blockquote>
<h3 id="features">Features</h3>
<ul>
<li>Complete support of <a href="https://golang.org/ref/spec">Go specification</a></li>
<li>Written in pure Go, using only the standard library</li>
<li>Simple interpreter API: <code>New()</code>, <code>Eval()</code>, <code>Use()</code></li>
<li>Works everywhere Go works</li>
<li>All Go &amp; runtime resources accessible from script (with control)</li>
<li>Security: <code>unsafe</code> and <code>syscall</code> packages neither used nor exported by default</li>
<li>Support Go 1.18 and Go 1.19 (the latest 2 major releases)</li>
</ul>
</blockquote>
<h3 id="21-usage-scenarios">2.1 Usage scenarios</h3>
<p>There are three usage scenarios recommended by yaegi.</p>
<ol>
<li>inline interpreter</li>
<li>dynamic extension framework</li>
<li>command-line interpreter</li>
</ol>
<p>And the official scenarios for the above three scenarios, the corresponding examples are given.</p>
<h4 id="211-embedded-interpreters">2.1.1 Embedded interpreters</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">main</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;github.com/traefik/yaegi/interp&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;github.com/traefik/yaegi/stdlib&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">i</span> <span class="o">:=</span> <span class="nx">interp</span><span class="p">.</span><span class="nf">New</span><span class="p">(</span><span class="nx">interp</span><span class="p">.</span><span class="nx">Options</span><span class="p">{})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">i</span><span class="p">.</span><span class="nf">Use</span><span class="p">(</span><span class="nx">stdlib</span><span class="p">.</span><span class="nx">Symbols</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">_</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">i</span><span class="p">.</span><span class="nf">Eval</span><span class="p">(</span><span class="s">`import &#34;fmt&#34;`</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">_</span><span class="p">,</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">i</span><span class="p">.</span><span class="nf">Eval</span><span class="p">(</span><span class="s">`fmt.Println(&#34;Hello Yaegi&#34;)`</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="212-dynamic-extension-framework">2.1.2 dynamic extension framework</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">main</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="s">&#34;github.com/traefik/yaegi/interp&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">const</span> <span class="nx">src</span> <span class="p">=</span> <span class="s">`package foo
</span></span></span><span class="line"><span class="cl"><span class="s">func Bar(s string) string { return s + &#34;-Foo&#34; }`</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">i</span> <span class="o">:=</span> <span class="nx">interp</span><span class="p">.</span><span class="nf">New</span><span class="p">(</span><span class="nx">interp</span><span class="p">.</span><span class="nx">Options</span><span class="p">{})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">_</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">i</span><span class="p">.</span><span class="nf">Eval</span><span class="p">(</span><span class="nx">src</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">v</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">i</span><span class="p">.</span><span class="nf">Eval</span><span class="p">(</span><span class="s">&#34;foo.Bar&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">bar</span> <span class="o">:=</span> <span class="nx">v</span><span class="p">.</span><span class="nf">Interface</span><span class="p">().(</span><span class="kd">func</span><span class="p">(</span><span class="kt">string</span><span class="p">)</span> <span class="kt">string</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">r</span> <span class="o">:=</span> <span class="nf">bar</span><span class="p">(</span><span class="s">&#34;Kung&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">println</span><span class="p">(</span><span class="nx">r</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="213-command-line-interpreter">2.1.3 Command Line Interpreter</h4>
<p>Yaegi provides a command line tool that implements a read-execute-display loop.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ yaegi
</span></span><span class="line"><span class="cl">&gt; <span class="m">1</span> + <span class="m">2</span>
</span></span><span class="line"><span class="cl"><span class="m">3</span>
</span></span><span class="line"><span class="cl">&gt; import <span class="s2">&#34;fmt&#34;</span>
</span></span><span class="line"><span class="cl">&gt; fmt.Println<span class="o">(</span><span class="s2">&#34;Hello World&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">Hello World
</span></span><span class="line"><span class="cl">&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="22-data-interaction">2.2 Data Interaction</h3>
<p>There are many ways to interact with data, but it should be noted that the data returned from inside the interpreter is of type <code>reflect.Value</code> and type conversion is required to get its actual value.</p>
<h4 id="221-data-input">2.2.1 Data input</h4>
<p>There are (but not limited to) the following four methods.</p>
<ol>
<li>importing data via os.Args</li>
<li>data input via environment variables</li>
<li>via assignment statements</li>
<li>via function calls</li>
</ol>
<p>Here is a code example I wrote myself.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">main</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;fmt&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="s">&#34;github.com/traefik/yaegi/interp&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;github.com/traefik/yaegi/stdlib&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span> <span class="c1">// Pass in data via os.Args
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nx">i</span> <span class="o">:=</span> <span class="nx">interp</span><span class="p">.</span><span class="nf">New</span><span class="p">(</span><span class="nx">interp</span><span class="p">.</span><span class="nx">Options</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">Args</span><span class="p">:</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&#34;666&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">})</span>
</span></span><span class="line"><span class="cl">        <span class="nx">i</span><span class="p">.</span><span class="nf">Use</span><span class="p">(</span><span class="nx">stdlib</span><span class="p">.</span><span class="nx">Symbols</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nx">i</span><span class="p">.</span><span class="nf">Eval</span><span class="p">(</span><span class="s">`import &#34;fmt&#34;`</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nx">i</span><span class="p">.</span><span class="nf">Eval</span><span class="p">(</span><span class="s">`import &#34;os&#34;`</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nx">i</span><span class="p">.</span><span class="nf">Eval</span><span class="p">(</span><span class="s">`fmt.Printf(&#34;os.Args[0] --- %s\n&#34;, os.Args[0])`</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">                <span class="c1">// os.Args[0] --- 666
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span> <span class="c1">// Importing data via environment variables
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nx">i</span> <span class="o">:=</span> <span class="nx">interp</span><span class="p">.</span><span class="nf">New</span><span class="p">(</span><span class="nx">interp</span><span class="p">.</span><span class="nx">Options</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">Env</span><span class="p">:</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&#34;inputEnv=666&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">})</span>
</span></span><span class="line"><span class="cl">        <span class="nx">i</span><span class="p">.</span><span class="nf">Use</span><span class="p">(</span><span class="nx">stdlib</span><span class="p">.</span><span class="nx">Symbols</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nx">i</span><span class="p">.</span><span class="nf">Eval</span><span class="p">(</span><span class="s">`import &#34;fmt&#34;`</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nx">i</span><span class="p">.</span><span class="nf">Eval</span><span class="p">(</span><span class="s">`import &#34;os&#34;`</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nx">i</span><span class="p">.</span><span class="nf">Eval</span><span class="p">(</span><span class="s">`fmt.Printf(&#34;os.Getenv(\&#34;inputEnv\&#34;) --- %s\n&#34;, os.Getenv(&#34;inputEnv&#34;))`</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="c1">// os.Getenv(&#34;inputEnv&#34;) --- 666
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span> <span class="c1">// Execute assignment statements to pass in data
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nx">i</span> <span class="o">:=</span> <span class="nx">interp</span><span class="p">.</span><span class="nf">New</span><span class="p">(</span><span class="nx">interp</span><span class="p">.</span><span class="nx">Options</span><span class="p">{})</span>
</span></span><span class="line"><span class="cl">        <span class="nx">i</span><span class="p">.</span><span class="nf">Use</span><span class="p">(</span><span class="nx">stdlib</span><span class="p">.</span><span class="nx">Symbols</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nx">i</span><span class="p">.</span><span class="nf">Eval</span><span class="p">(</span><span class="s">`import &#34;fmt&#34;`</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nx">i</span><span class="p">.</span><span class="nf">Eval</span><span class="p">(</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprintf</span><span class="p">(</span><span class="s">&#34;inputVar:=\&#34;%s\&#34;&#34;</span><span class="p">,</span> <span class="s">&#34;666&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="nx">i</span><span class="p">.</span><span class="nf">Eval</span><span class="p">(</span><span class="s">`fmt.Printf(&#34;inputVar --- %s\n&#34;, inputVar)`</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="c1">// inputVar --- 666
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span> <span class="c1">// Passing through function calls
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nx">i</span> <span class="o">:=</span> <span class="nx">interp</span><span class="p">.</span><span class="nf">New</span><span class="p">(</span><span class="nx">interp</span><span class="p">.</span><span class="nx">Options</span><span class="p">{})</span>
</span></span><span class="line"><span class="cl">        <span class="nx">i</span><span class="p">.</span><span class="nf">Use</span><span class="p">(</span><span class="nx">stdlib</span><span class="p">.</span><span class="nx">Symbols</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nx">i</span><span class="p">.</span><span class="nf">Eval</span><span class="p">(</span><span class="s">`import &#34;fmt&#34;`</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nx">i</span><span class="p">.</span><span class="nf">Eval</span><span class="p">(</span><span class="s">`var data map[string]interface{}`</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nx">i</span><span class="p">.</span><span class="nf">Eval</span><span class="p">(</span><span class="s">`func SetData(d map[string]interface{}){ data = d }`</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nx">f</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">i</span><span class="p">.</span><span class="nf">Eval</span><span class="p">(</span><span class="s">&#34;SetData&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nx">fun</span> <span class="o">:=</span> <span class="nx">f</span><span class="p">.</span><span class="nf">Interface</span><span class="p">().(</span><span class="kd">func</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}))</span>
</span></span><span class="line"><span class="cl">        <span class="nf">fun</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
</span></span><span class="line"><span class="cl">            <span class="s">&#34;data01&#34;</span><span class="p">:</span> <span class="mi">666</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">})</span>
</span></span><span class="line"><span class="cl">        <span class="nx">i</span><span class="p">.</span><span class="nf">Eval</span><span class="p">(</span><span class="s">`fmt.Printf(&#34;SetData --- %d\n&#34;, data[&#34;data01&#34;])`</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="c1">// SetData --- 666
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="212-data-output">2.1.2 Data output</h4>
<p>Getting data from the interpreter, which is actually getting the value of a global variable, can be done by the following methods.</p>
<ol>
<li>directly by the Eval method</li>
<li>through function calls</li>
<li>the Global method to get all global variables</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">main</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;fmt&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="s">&#34;github.com/traefik/yaegi/interp&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;github.com/traefik/yaegi/stdlib&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span> <span class="c1">// Get directly through Eval
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nx">i</span> <span class="o">:=</span> <span class="nx">interp</span><span class="p">.</span><span class="nf">New</span><span class="p">(</span><span class="nx">interp</span><span class="p">.</span><span class="nx">Options</span><span class="p">{})</span>
</span></span><span class="line"><span class="cl">        <span class="nx">i</span><span class="p">.</span><span class="nf">Use</span><span class="p">(</span><span class="nx">stdlib</span><span class="p">.</span><span class="nx">Symbols</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nx">i</span><span class="p">.</span><span class="nf">Eval</span><span class="p">(</span><span class="s">`data := 666`</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nx">v</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">i</span><span class="p">.</span><span class="nf">Eval</span><span class="p">(</span><span class="s">&#34;data&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nx">value</span> <span class="o">:=</span> <span class="nx">v</span><span class="p">.</span><span class="nf">Interface</span><span class="p">().(</span><span class="kt">int</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;data = %d\n&#34;</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="c1">// data = 666
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span> <span class="c1">// Get by function return value
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nx">i</span> <span class="o">:=</span> <span class="nx">interp</span><span class="p">.</span><span class="nf">New</span><span class="p">(</span><span class="nx">interp</span><span class="p">.</span><span class="nx">Options</span><span class="p">{})</span>
</span></span><span class="line"><span class="cl">        <span class="nx">i</span><span class="p">.</span><span class="nf">Use</span><span class="p">(</span><span class="nx">stdlib</span><span class="p">.</span><span class="nx">Symbols</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nx">i</span><span class="p">.</span><span class="nf">Eval</span><span class="p">(</span><span class="s">`data := 666`</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nx">i</span><span class="p">.</span><span class="nf">Eval</span><span class="p">(</span><span class="s">`func GetData() int {return data}`</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nx">f</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">i</span><span class="p">.</span><span class="nf">Eval</span><span class="p">(</span><span class="s">&#34;GetData&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nx">fun</span> <span class="o">:=</span> <span class="nx">f</span><span class="p">.</span><span class="nf">Interface</span><span class="p">().(</span><span class="kd">func</span><span class="p">()</span> <span class="kt">int</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;data = %d\n&#34;</span><span class="p">,</span> <span class="nf">fun</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">                <span class="c1">// data = 666
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span> <span class="c1">// Get directly through Eval
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nx">i</span> <span class="o">:=</span> <span class="nx">interp</span><span class="p">.</span><span class="nf">New</span><span class="p">(</span><span class="nx">interp</span><span class="p">.</span><span class="nx">Options</span><span class="p">{})</span>
</span></span><span class="line"><span class="cl">        <span class="nx">i</span><span class="p">.</span><span class="nf">Use</span><span class="p">(</span><span class="nx">stdlib</span><span class="p">.</span><span class="nx">Symbols</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nx">i</span><span class="p">.</span><span class="nf">Eval</span><span class="p">(</span><span class="s">`dataInt := 666`</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nx">i</span><span class="p">.</span><span class="nf">Eval</span><span class="p">(</span><span class="s">`dataStr := &#34;666&#34;`</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">v</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">i</span><span class="p">.</span><span class="nf">Globals</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">value</span> <span class="o">:=</span> <span class="nx">v</span><span class="p">.</span><span class="nf">Interface</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="k">switch</span> <span class="nx">value</span><span class="p">.(</span><span class="kd">type</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">case</span> <span class="kt">int</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;%s = %d\n&#34;</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                                <span class="c1">// dataInt = 666
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="k">case</span> <span class="kt">string</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;%s = %s\n&#34;</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                                <span class="c1">// dataStr = 666
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="3-principles-of-implementation">3. Principles of Implementation</h2>
<p>The implementation principles of the interpreter are similar across languages.</p>
<p>Golang provides the ability to build an abstract syntax tree directly due to its powerful base library. It is much easier to implement a script interpreter based on an abstract syntax tree.</p>
<h3 id="31-ast---abstract-syntax-tree">3.1 AST - Abstract Syntax Tree</h3>
<p>In computer science, an Abstract Syntax Tree (AST), or Syntax tree for short, is an abstract representation of the syntactic structure of a source code. It represents the syntactic structure of a programming language in a tree-like form, with each node in the tree representing a structure in the source code.</p>
<p>Golang provides abstract syntax tree related capabilities through the <code>go/ast</code> package (<a href="https://pkg.go.dev/go/ast">https://pkg.go.dev/go/ast</a>).</p>
<h4 id="311-abstract-syntax-tree-example">3.1.1 Abstract syntax tree example</h4>
<p>We take a subset of Golang grammar for our example: a simple conditional expression.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="sb">`</span>A!<span class="o">=</span><span class="m">1</span> <span class="o">&amp;&amp;</span> <span class="o">(</span>B&gt;1 <span class="o">||</span> <span class="o">(</span>C&lt;<span class="m">1</span> <span class="o">&amp;&amp;</span> A&gt;2<span class="o">))</span><span class="sb">`</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The abstract syntax tree looks like this.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">     0  *ast.BinaryExpr {
</span></span><span class="line"><span class="cl">     1  .  X: *ast.BinaryExpr {
</span></span><span class="line"><span class="cl">     2  .  .  X: *ast.Ident {
</span></span><span class="line"><span class="cl">     3  .  .  .  NamePos: -
</span></span><span class="line"><span class="cl">     4  .  .  .  Name: &#34;A&#34;
</span></span><span class="line"><span class="cl">     5  .  .  }
</span></span><span class="line"><span class="cl">     6  .  .  OpPos: -
</span></span><span class="line"><span class="cl">     7  .  .  Op: !=
</span></span><span class="line"><span class="cl">     8  .  .  Y: *ast.BasicLit {
</span></span><span class="line"><span class="cl">     9  .  .  .  ValuePos: -
</span></span><span class="line"><span class="cl">    10  .  .  .  Kind: INT
</span></span><span class="line"><span class="cl">    11  .  .  .  Value: &#34;1&#34;
</span></span><span class="line"><span class="cl">    12  .  .  }
</span></span><span class="line"><span class="cl">    13  .  }
</span></span><span class="line"><span class="cl">    14  .  OpPos: -
</span></span><span class="line"><span class="cl">    15  .  Op: &amp;&amp;
</span></span><span class="line"><span class="cl">    16  .  Y: *ast.ParenExpr {
</span></span><span class="line"><span class="cl">    17  .  .  Lparen: -
</span></span><span class="line"><span class="cl">    18  .  .  X: *ast.BinaryExpr {
</span></span><span class="line"><span class="cl">    19  .  .  .  X: *ast.BinaryExpr {
</span></span><span class="line"><span class="cl">    20  .  .  .  .  X: *ast.Ident {
</span></span><span class="line"><span class="cl">    21  .  .  .  .  .  NamePos: -
</span></span><span class="line"><span class="cl">    22  .  .  .  .  .  Name: &#34;B&#34;
</span></span><span class="line"><span class="cl">    23  .  .  .  .  }
</span></span><span class="line"><span class="cl">    24  .  .  .  .  OpPos: -
</span></span><span class="line"><span class="cl">    25  .  .  .  .  Op: &gt;
</span></span><span class="line"><span class="cl">    26  .  .  .  .  Y: *ast.BasicLit {
</span></span><span class="line"><span class="cl">    27  .  .  .  .  .  ValuePos: -
</span></span><span class="line"><span class="cl">    28  .  .  .  .  .  Kind: INT
</span></span><span class="line"><span class="cl">    29  .  .  .  .  .  Value: &#34;1&#34;
</span></span><span class="line"><span class="cl">    30  .  .  .  .  }
</span></span><span class="line"><span class="cl">    31  .  .  .  }
</span></span><span class="line"><span class="cl">    32  .  .  .  OpPos: -
</span></span><span class="line"><span class="cl">    33  .  .  .  Op: ||
</span></span><span class="line"><span class="cl">    34  .  .  .  Y: *ast.ParenExpr {
</span></span><span class="line"><span class="cl">    35  .  .  .  .  Lparen: -
</span></span><span class="line"><span class="cl">    36  .  .  .  .  X: *ast.BinaryExpr {
</span></span><span class="line"><span class="cl">    37  .  .  .  .  .  X: *ast.BinaryExpr {
</span></span><span class="line"><span class="cl">    38  .  .  .  .  .  .  X: *ast.Ident {
</span></span><span class="line"><span class="cl">    39  .  .  .  .  .  .  .  NamePos: -
</span></span><span class="line"><span class="cl">    40  .  .  .  .  .  .  .  Name: &#34;C&#34;
</span></span><span class="line"><span class="cl">    41  .  .  .  .  .  .  }
</span></span><span class="line"><span class="cl">    42  .  .  .  .  .  .  OpPos: -
</span></span><span class="line"><span class="cl">    43  .  .  .  .  .  .  Op: &lt;
</span></span><span class="line"><span class="cl">    44  .  .  .  .  .  .  Y: *ast.BasicLit {
</span></span><span class="line"><span class="cl">    45  .  .  .  .  .  .  .  ValuePos: -
</span></span><span class="line"><span class="cl">    46  .  .  .  .  .  .  .  Kind: INT
</span></span><span class="line"><span class="cl">    47  .  .  .  .  .  .  .  Value: &#34;1&#34;
</span></span><span class="line"><span class="cl">    48  .  .  .  .  .  .  }
</span></span><span class="line"><span class="cl">    49  .  .  .  .  .  }
</span></span><span class="line"><span class="cl">    50  .  .  .  .  .  OpPos: -
</span></span><span class="line"><span class="cl">    51  .  .  .  .  .  Op: &amp;&amp;
</span></span><span class="line"><span class="cl">    52  .  .  .  .  .  Y: *ast.BinaryExpr {
</span></span><span class="line"><span class="cl">    53  .  .  .  .  .  .  X: *ast.Ident {
</span></span><span class="line"><span class="cl">    54  .  .  .  .  .  .  .  NamePos: -
</span></span><span class="line"><span class="cl">    55  .  .  .  .  .  .  .  Name: &#34;A&#34;
</span></span><span class="line"><span class="cl">    56  .  .  .  .  .  .  }
</span></span><span class="line"><span class="cl">    57  .  .  .  .  .  .  OpPos: -
</span></span><span class="line"><span class="cl">    58  .  .  .  .  .  .  Op: &gt;
</span></span><span class="line"><span class="cl">    59  .  .  .  .  .  .  Y: *ast.BasicLit {
</span></span><span class="line"><span class="cl">    60  .  .  .  .  .  .  .  ValuePos: -
</span></span><span class="line"><span class="cl">    61  .  .  .  .  .  .  .  Kind: INT
</span></span><span class="line"><span class="cl">    62  .  .  .  .  .  .  .  Value: &#34;2&#34;
</span></span><span class="line"><span class="cl">    63  .  .  .  .  .  .  }
</span></span><span class="line"><span class="cl">    64  .  .  .  .  .  }
</span></span><span class="line"><span class="cl">    65  .  .  .  .  }
</span></span><span class="line"><span class="cl">    66  .  .  .  .  Rparen: -
</span></span><span class="line"><span class="cl">    67  .  .  .  }
</span></span><span class="line"><span class="cl">    68  .  .  }
</span></span><span class="line"><span class="cl">    69  .  .  Rparen: -
</span></span><span class="line"><span class="cl">    70  .  }
</span></span><span class="line"><span class="cl">    71  }
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="312-executing-an-abstract-syntax-tree">3.1.2 Executing an abstract syntax tree</h4>
<p>Briefly explain what should be done if you want to execute the abstract syntax tree.</p>
<p>The execution process is similar to the program execution process. First traverse the list of declarations and initialize the declared contents to heap memory (a dictionary can be used instead). Deep-first traversal of the abstract syntax tree, handling abstract objects encountered during the traversal, for example (just an example, there may be discrepancies in practice)</p>
<ol>
<li>initializing the heap memory and execution stack.</li>
<li>traverse the declaration section, write to the heap, and wait for the call.</li>
<li>find the main function declaration, the main function on the stack, traverse its function body statements, and execute a depth-first traversal statement by statement.
<ol>
<li>Write to the top-of-stack cache if a variable definition is encountered.</li>
<li>If a function call is encountered, the function is put on the stack. Find the function definition from the heap, traverse its function body statement, and execute the statement recursively.</li>
<li>When a variable is encountered, the value is fetched from the following locations in order: top-of-stack cache -&gt; heap memory</li>
<li>When an expression is encountered, the expression is executed recursively.</li>
<li>After the function body is executed, it will exit the stack and write the return value to the top-of-stack cache.</li>
</ol>
</li>
<li>The above recursive process is completed and the program ends.</li>
</ol>
<p>The above is a simple implementation process that does not deal with special syntax and syntactic sugar, which are defined differently for each language and need to be handled separately. For example, the syntax supported by Golang can be found at: <a href="https://pkg.go.dev/go/ast">https://pkg.go.dev/go/ast</a></p>
<p>If all the syntax defined there can be handled, a golang script interpreter can be implemented.</p>
<p>For the simple example above (3.1.1), it can be executed directly by the following code.</p>
<p>(No functions are handled, only parentheses and a limited number of operators. The execution stack is also not defined, and the heap memory is replaced by the global variable Args)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">main</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;fmt&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;go/ast&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;go/parser&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;go/token&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;strconv&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">Args</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">int</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">Args</span> <span class="p">=</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">int</span><span class="p">{</span><span class="s">&#34;A&#34;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&#34;B&#34;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s">&#34;C&#34;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="nx">code</span> <span class="o">:=</span> <span class="s">`A==1 &amp;&amp; (B&gt;1 || C&lt;1)`</span>
</span></span><span class="line"><span class="cl">        <span class="nx">expr</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">parser</span><span class="p">.</span><span class="nf">ParseExpr</span><span class="p">(</span><span class="nx">code</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nx">result</span> <span class="o">:=</span> <span class="nf">runExpr</span><span class="p">(</span><span class="nx">expr</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">Args</span><span class="p">[</span><span class="s">&#34;A&#34;</span><span class="p">]</span> <span class="p">=</span> <span class="mi">3</span>
</span></span><span class="line"><span class="cl">        <span class="nx">Args</span> <span class="p">=</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">int</span><span class="p">{</span><span class="s">&#34;A&#34;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&#34;B&#34;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s">&#34;C&#34;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="nx">code</span> <span class="o">:=</span> <span class="s">`A!=1 &amp;&amp; (B&gt;1 || (C&lt;1 &amp;&amp; A&gt;2))`</span>
</span></span><span class="line"><span class="cl">        <span class="nx">expr</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">parser</span><span class="p">.</span><span class="nf">ParseExpr</span><span class="p">(</span><span class="nx">code</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nx">result</span> <span class="o">:=</span> <span class="nf">runExpr</span><span class="p">(</span><span class="nx">expr</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Execution of expressions
</span></span></span><span class="line"><span class="cl"><span class="c1">// Supported operations: &gt;, &lt;, ==, ! =, &amp;&amp;, ||
</span></span></span><span class="line"><span class="cl"><span class="c1">// Supports parenthesis nesting
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">runExpr</span><span class="p">(</span><span class="nx">expr</span> <span class="nx">ast</span><span class="p">.</span><span class="nx">Expr</span><span class="p">)</span> <span class="kd">interface</span><span class="p">{}</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">result</span> <span class="kd">interface</span><span class="p">{}</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Binary expressions
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="nx">binaryExpr</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">expr</span><span class="p">.(</span><span class="o">*</span><span class="nx">ast</span><span class="p">.</span><span class="nx">BinaryExpr</span><span class="p">);</span> <span class="nx">ok</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">switch</span> <span class="nx">binaryExpr</span><span class="p">.</span><span class="nx">Op</span><span class="p">.</span><span class="nf">String</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">case</span> <span class="s">&#34;&amp;&amp;&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nx">x</span> <span class="o">:=</span> <span class="nf">runExpr</span><span class="p">(</span><span class="nx">binaryExpr</span><span class="p">.</span><span class="nx">X</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="nx">y</span> <span class="o">:=</span> <span class="nf">runExpr</span><span class="p">(</span><span class="nx">binaryExpr</span><span class="p">.</span><span class="nx">Y</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="nx">x</span><span class="p">.(</span><span class="kt">bool</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">y</span><span class="p">.(</span><span class="kt">bool</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">case</span> <span class="s">&#34;||&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nx">x</span> <span class="o">:=</span> <span class="nf">runExpr</span><span class="p">(</span><span class="nx">binaryExpr</span><span class="p">.</span><span class="nx">X</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="nx">y</span> <span class="o">:=</span> <span class="nf">runExpr</span><span class="p">(</span><span class="nx">binaryExpr</span><span class="p">.</span><span class="nx">Y</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="nx">x</span><span class="p">.(</span><span class="kt">bool</span><span class="p">)</span> <span class="o">||</span> <span class="nx">y</span><span class="p">.(</span><span class="kt">bool</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">case</span> <span class="s">&#34;&gt;&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nx">x</span> <span class="o">:=</span> <span class="nf">runExpr</span><span class="p">(</span><span class="nx">binaryExpr</span><span class="p">.</span><span class="nx">X</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="nx">y</span> <span class="o">:=</span> <span class="nf">runExpr</span><span class="p">(</span><span class="nx">binaryExpr</span><span class="p">.</span><span class="nx">Y</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="nx">x</span><span class="p">.(</span><span class="kt">int</span><span class="p">)</span> <span class="p">&gt;</span> <span class="nx">y</span><span class="p">.(</span><span class="kt">int</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">case</span> <span class="s">&#34;&lt;&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nx">x</span> <span class="o">:=</span> <span class="nf">runExpr</span><span class="p">(</span><span class="nx">binaryExpr</span><span class="p">.</span><span class="nx">X</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="nx">y</span> <span class="o">:=</span> <span class="nf">runExpr</span><span class="p">(</span><span class="nx">binaryExpr</span><span class="p">.</span><span class="nx">Y</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="nx">x</span><span class="p">.(</span><span class="kt">int</span><span class="p">)</span> <span class="p">&lt;</span> <span class="nx">y</span><span class="p">.(</span><span class="kt">int</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">case</span> <span class="s">&#34;==&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nx">x</span> <span class="o">:=</span> <span class="nf">runExpr</span><span class="p">(</span><span class="nx">binaryExpr</span><span class="p">.</span><span class="nx">X</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="nx">y</span> <span class="o">:=</span> <span class="nf">runExpr</span><span class="p">(</span><span class="nx">binaryExpr</span><span class="p">.</span><span class="nx">Y</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="nx">x</span><span class="p">.(</span><span class="kt">int</span><span class="p">)</span> <span class="o">==</span> <span class="nx">y</span><span class="p">.(</span><span class="kt">int</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">case</span> <span class="s">&#34;!=&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nx">x</span> <span class="o">:=</span> <span class="nf">runExpr</span><span class="p">(</span><span class="nx">binaryExpr</span><span class="p">.</span><span class="nx">X</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="nx">y</span> <span class="o">:=</span> <span class="nf">runExpr</span><span class="p">(</span><span class="nx">binaryExpr</span><span class="p">.</span><span class="nx">Y</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="nx">x</span><span class="p">.(</span><span class="kt">int</span><span class="p">)</span> <span class="o">!=</span> <span class="nx">y</span><span class="p">.(</span><span class="kt">int</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Basic type values
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="nx">basicLit</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">expr</span><span class="p">.(</span><span class="o">*</span><span class="nx">ast</span><span class="p">.</span><span class="nx">BasicLit</span><span class="p">);</span> <span class="nx">ok</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">switch</span> <span class="nx">basicLit</span><span class="p">.</span><span class="nx">Kind</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">case</span> <span class="nx">token</span><span class="p">.</span><span class="nx">INT</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nx">v</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">strconv</span><span class="p">.</span><span class="nf">Atoi</span><span class="p">(</span><span class="nx">basicLit</span><span class="p">.</span><span class="nx">Value</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="nx">v</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Identifiers
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="nx">ident</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">expr</span><span class="p">.(</span><span class="o">*</span><span class="nx">ast</span><span class="p">.</span><span class="nx">Ident</span><span class="p">);</span> <span class="nx">ok</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nx">Args</span><span class="p">[</span><span class="nx">ident</span><span class="p">.</span><span class="nx">Name</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Parenthesis expressions
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="nx">parenExpr</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">expr</span><span class="p">.(</span><span class="o">*</span><span class="nx">ast</span><span class="p">.</span><span class="nx">ParenExpr</span><span class="p">);</span> <span class="nx">ok</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nf">runExpr</span><span class="p">(</span><span class="nx">parenExpr</span><span class="p">.</span><span class="nx">X</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">result</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The execution results are as follows.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">A==1 &amp;&amp; (B&gt;1 || C&lt;1) =&gt; true
</span></span><span class="line"><span class="cl">A!=1 &amp;&amp; (B&gt;1 || (C&lt;1 &amp;&amp; A&gt;2)) =&gt; false
</span></span></code></pre></td></tr></table>
</div>
</div>
    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/golang/">golang</a>
          </div>
      <nav class="post-nav">
        
        <a class="next" href="/post/2022-09/cpp-di/">
            <span class="next-text nav-default">C&#43;&#43; Simple Dependency Injection</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  <script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox-3.1.20.min.js"></script>



<script type="text/javascript" src="/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js"></script>








</body>
</html>
