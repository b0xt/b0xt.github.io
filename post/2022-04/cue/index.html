<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Data Constraint Language CUE - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="" /><meta name="description" content="Learning to use the data constraint language CUE." /><meta name="keywords" content="cue" />






<meta name="generator" content="Hugo 0.96.0 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2022-04/cue/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="Data Constraint Language CUE" />
<meta property="og:description" content="Learning to use the data constraint language CUE." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2022-04/cue/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-04-07T08:47:50+08:00" />
<meta property="article:modified_time" content="2022-04-07T08:47:50+08:00" />

<meta itemprop="name" content="Data Constraint Language CUE">
<meta itemprop="description" content="Learning to use the data constraint language CUE."><meta itemprop="datePublished" content="2022-04-07T08:47:50+08:00" />
<meta itemprop="dateModified" content="2022-04-07T08:47:50+08:00" />
<meta itemprop="wordCount" content="2213">
<meta itemprop="keywords" content="cue," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Data Constraint Language CUE"/>
<meta name="twitter:description" content="Learning to use the data constraint language CUE."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SOBYTE</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a><a href="/ukraine/">
        <li class="mobile-menu-item">UKRAINE</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SOBYTE</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/ukraine/">UKRAINE</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Data Constraint Language CUE</h1>

      <div class="post-meta">
        <span class="post-time"> 2022-04-07 08:47:50 </span>
        <div class="post-category">
            <a href="/categories/tutorials/"> tutorials </a>
            </div>
          <span class="more-meta"> 2213 words </span>
          <span class="more-meta"> 11 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#installation">Installation</a>
          <ul>
            <li><a href="#install-cue-via-official-binary">Install CUE via official binary</a></li>
            <li><a href="#install-using-homebrew">Install using homebrew</a></li>
            <li><a href="#installation-via-source-code">Installation via source code</a></li>
          </ul>
        </li>
        <li><a href="#cue-command-line">CUE Command Line</a></li>
        <li><a href="#data-types">Data Types</a></li>
        <li><a href="#cue-templates">CUE Templates</a></li>
        <li><a href="#other-uses">Other Uses</a></li>
        <li><a href="#importing-packages">Importing packages</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>CUE is an open source data constraint language designed to handle configurations, structures, data and execute them. Most people start using CUE because they want to do data validation and generate configurations. Then they go on to use CUE for data templates, runtime input validation, code generation, scripting, pipline, and more. First you need to understand that CUE is not a programming language in the usual sense, it is a Turing non-complete programming language.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/04/07/dbe469f1549c42ef9fb264164145a2a4.png" alt="cue"></p>
<p>Unlike JSONNET, CUE does not support custom functions, but supports external schema based on typed feature structure, and supports type and data fusion through explicit unification and separation operations. CUE does not support custom functions, supports external schema based on typed feature structure, and supports type and data fusion through explicit unification and separation operations, but such settings and external type derivation also increase the difficulty of understanding and writing complexity.</p>
<p>The CUE project is written entirely in Golang, and relies on Golang to allow &ldquo;import&rdquo; of the necessary capabilities provided by CUE to help users write common functions such as encoding, strings, math, and other configurations. We can say that CUE is both a JSON-based template language, but also comes with a lot of Configuration Language thinking, providing a good sample of both its language design ideas, and the engineering approach based on the ability to introduce mature high-level programming languages are worth studying in depth.</p>
<h2 id="installation">Installation</h2>
<h3 id="install-cue-via-official-binary">Install CUE via official binary</h3>
<p>The installer supports multiple operating systems, including Linux, Window, and macOS, and can be downloaded from the official CUE website <a href="https://cuelang.org/releases">https://cuelang.org/releases</a>.</p>
<h3 id="install-using-homebrew">Install using homebrew</h3>
<p>Alternatively, CUE is installed on MacOS and Linux via brew.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">brew install cue-lang/tap/cue
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="installation-via-source-code">Installation via source code</h3>
<p>First you need to ensure that Go 1.16 or higher is installed, then execute the following command to install it.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">go install cuelang.org/go/cmd/cue@latest
</span></span></code></pre></td></tr></table>
</div>
</div><p>Once the installation is complete, you can execute the <code>cue</code> command.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">cue version
</span></span><span class="line"><span class="cl">cue version v0.4.3-beta.1 darwin/amd64
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="cue-command-line">CUE Command Line</h2>
<p>CUE is a superset of JSON, and we can use CUE as JSON with the following features.</p>
<ul>
<li>C-style comments.</li>
<li>field names can be enclosed in double quotes, but no special characters are allowed in field names.</li>
<li>Optional field endings with or without commas.</li>
<li>Comma at the end of the last element in an array is allowed.</li>
<li>Outer curly brackets optional.</li>
</ul>
<p>Please first copy the following information and save it as a <code>first.cue</code> file.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">a: 1.5
</span></span><span class="line"><span class="cl">a: float
</span></span><span class="line"><span class="cl">b: <span class="m">1</span>
</span></span><span class="line"><span class="cl">b: int
</span></span><span class="line"><span class="cl">d: <span class="o">[</span>1, 2, 3<span class="o">]</span>
</span></span><span class="line"><span class="cl">g: <span class="o">{</span>
</span></span><span class="line"><span class="cl"> h: <span class="s2">&#34;abc&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">e: string
</span></span></code></pre></td></tr></table>
</div>
</div><p>Next, let&rsquo;s use the above file as an example to learn the commands on the CUE command line.</p>
<ul>
<li>
<p>How to format a CUE file. The following command not only formats the CUE file, but also prompts for the wrong model, quite a good command to use.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">cue fmt first.cue
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>How do I calibrate the model? In addition to <code>cue fmt</code>, you can also use <code>cue vet</code> to verify the model.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ cue vet first.cue
</span></span><span class="line"><span class="cl">some instances are incomplete<span class="p">;</span> use the -c flag to show errors or suppress this message
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ cue vet first.cue -c
</span></span><span class="line"><span class="cl">e: incomplete value string
</span></span></code></pre></td></tr></table>
</div>
</div><p>Hint: The variable e in this file has the data type <code>string</code> but is not assigned a value.</p>
</li>
<li>
<p>How to calculate/render the result. <code>cue eval</code> computes the CUE file and renders the final result. We see that the final result does not contain <code>a: float</code> and <code>b: int</code>, because these two variables are already computationally populated. The <code>e: string</code> is not explicitly assigned, so it remains unchanged.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ cue <span class="nb">eval</span> first.cue
</span></span><span class="line"><span class="cl">a: 1.5
</span></span><span class="line"><span class="cl">b: <span class="m">1</span>
</span></span><span class="line"><span class="cl">d: <span class="o">[</span>1, 2, 3<span class="o">]</span>
</span></span><span class="line"><span class="cl">g: <span class="o">{</span>
</span></span><span class="line"><span class="cl">h: <span class="s2">&#34;abc&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">e: string
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>How to specify the result of the rendering. For example, if we only want to know the rendering result of <code>b</code> in the file, we can use this parameter <code>-e</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ cue <span class="nb">eval</span> -e b first.cue
</span></span><span class="line"><span class="cl"><span class="m">1</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>How to export the rendering result. <code>cue export</code> exports the final rendering results. If some variables are not defined executing this command will give an error.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ cue <span class="nb">export</span> first.cue
</span></span><span class="line"><span class="cl">e: incomplete value string  
</span></span></code></pre></td></tr></table>
</div>
</div><p>Let&rsquo;s update the <code>first.cue</code> file and assign a value to <code>e</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">a: 1.5
</span></span><span class="line"><span class="cl">a: float
</span></span><span class="line"><span class="cl">b: 1
</span></span><span class="line"><span class="cl">b: int
</span></span><span class="line"><span class="cl">d: [1, 2, 3]
</span></span><span class="line"><span class="cl">g: {
</span></span><span class="line"><span class="cl">h: &#34;abc&#34;
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">e: string
</span></span><span class="line"><span class="cl">e: &#34;abc&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><p>Then, the command works properly. By default, the rendered results are formatted as JSON.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ cue <span class="nb">export</span> first.cue
</span></span><span class="line"><span class="cl"><span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;a&#34;</span>: 1.5,
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;b&#34;</span>: 1,
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;d&#34;</span>: <span class="o">[</span>
</span></span><span class="line"><span class="cl">        1,
</span></span><span class="line"><span class="cl">        2,
</span></span><span class="line"><span class="cl">        <span class="m">3</span>
</span></span><span class="line"><span class="cl">    <span class="o">]</span>,
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;g&#34;</span>: <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;h&#34;</span>: <span class="s2">&#34;abc&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>,
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;e&#34;</span>: <span class="s2">&#34;abc&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>How to export rendered results in YAML format.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ cue <span class="nb">export</span> first.cue --out yaml
</span></span><span class="line"><span class="cl">a: 1.5
</span></span><span class="line"><span class="cl">b: <span class="m">1</span>
</span></span><span class="line"><span class="cl">d:
</span></span><span class="line"><span class="cl">- <span class="m">1</span>
</span></span><span class="line"><span class="cl">- <span class="m">2</span>
</span></span><span class="line"><span class="cl">- <span class="m">3</span>
</span></span><span class="line"><span class="cl">g:
</span></span><span class="line"><span class="cl">h: abc
</span></span><span class="line"><span class="cl">e: abc
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>How to export the result of the specified variable.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ cue <span class="nb">export</span> -e g first.cue
</span></span><span class="line"><span class="cl"><span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;h&#34;</span>: <span class="s2">&#34;abc&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<p>Above, you have learned all the common CUE command line commands.</p>
<h2 id="data-types">Data Types</h2>
<p>After familiarizing yourself with the common CUE command line instructions, let&rsquo;s learn more about the CUE language.</p>
<p>Let&rsquo;s start by understanding the data types of CUE. The following are its basic data types.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">// float
</span></span><span class="line"><span class="cl">a: 1.5
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">// int
</span></span><span class="line"><span class="cl">b: 1
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">// string
</span></span><span class="line"><span class="cl">c: &#34;blahblahblah&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">// array
</span></span><span class="line"><span class="cl">d: [1, 2, 3, 1, 2, 3, 1, 2, 3]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">// bool
</span></span><span class="line"><span class="cl">e: true
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">// struct
</span></span><span class="line"><span class="cl">f: {
</span></span><span class="line"><span class="cl"> a: 1.5
</span></span><span class="line"><span class="cl"> b: 1
</span></span><span class="line"><span class="cl"> d: [1, 2, 3, 1, 2, 3, 1, 2, 3]
</span></span><span class="line"><span class="cl"> g: {
</span></span><span class="line"><span class="cl">  h: &#34;abc&#34;
</span></span><span class="line"><span class="cl"> }
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">// null
</span></span><span class="line"><span class="cl">j: null
</span></span></code></pre></td></tr></table>
</div>
</div><p>How do I customize the CUE type? Use the <code>#</code> symbol to specify some variables that indicate the CUE type.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">#abc: string
</span></span></code></pre></td></tr></table>
</div>
</div><p>We save the above to a <code>second.cue</code> file. Executing <code>cue export</code> does not throw an exception: <code>#abc</code> is an incomplete type value.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">$ cue export second.cue
</span></span><span class="line"><span class="cl">{}
</span></span></code></pre></td></tr></table>
</div>
</div><p>You can also define more complex custom structures, such as:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">#abc: {
</span></span><span class="line"><span class="cl">  x: int
</span></span><span class="line"><span class="cl">  y: string
</span></span><span class="line"><span class="cl">  z: {
</span></span><span class="line"><span class="cl">    a: float
</span></span><span class="line"><span class="cl">    b: bool
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="cue-templates">CUE Templates</h2>
<p>Next, let&rsquo;s start trying to define the CUE template using what we just learned.</p>
<ol>
<li>
<p>Define the structure variable <code>parameter</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">parameter: {
</span></span><span class="line"><span class="cl">name: string
</span></span><span class="line"><span class="cl">image: string
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>Save the above variables to the file <code>deployment.cue</code>.</p>
</li>
<li>
<p>Define more complex structural variables <code>template</code> while referencing the variable <code>parameter</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">template: {
</span></span><span class="line"><span class="cl">apiVersion: &#34;apps/v1&#34;
</span></span><span class="line"><span class="cl">kind:       &#34;Deployment&#34;
</span></span><span class="line"><span class="cl">spec: {
</span></span><span class="line"><span class="cl">selector: matchLabels: {
</span></span><span class="line"><span class="cl">&#34;app.oam.dev/component&#34;: parameter.name
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">template: {
</span></span><span class="line"><span class="cl">metadata: labels: {
</span></span><span class="line"><span class="cl">    &#34;app.oam.dev/component&#34;: parameter.name
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">spec: {
</span></span><span class="line"><span class="cl">    containers: [{
</span></span><span class="line"><span class="cl">    name:  parameter.name
</span></span><span class="line"><span class="cl">    image: parameter.image
</span></span><span class="line"><span class="cl">    }]
</span></span><span class="line"><span class="cl">}}}
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>As you may already know if you are familiar with Kubernetes, this is the template for Kubernetes Deployment. <code>parameter</code> is the parameters section of the template.</p>
<p>Add the above to the file <code>deployment.cue</code> .</p>
</li>
<li>
<p>Then, we complete the variable assignment by updating the following.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">parameter:{
</span></span><span class="line"><span class="cl">name: &#34;mytest&#34;
</span></span><span class="line"><span class="cl">image: &#34;nginx:v1&#34;
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>Finally, the rendered results are exported in YAML format.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yml" data-lang="yml"><span class="line"><span class="cl"><span class="l">$ cue export deployment.cue -e template --out yaml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">apps/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Deployment</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app.oam.dev/component</span><span class="p">:</span><span class="w"> </span><span class="l">mytest</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">template</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">app.oam.dev/component</span><span class="p">:</span><span class="w"> </span><span class="l">mytest</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">mytest</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">nginx:v1</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div></li>
</ol>
<p>Above, you get a template of the Kubernetes Deployment type.</p>
<h2 id="other-uses">Other Uses</h2>
<ul>
<li>
<p>Design open structures and arrays. If <code>...</code> is used in an array or structure, the object is open. ` , then the object is open.</p>
<ul>
<li>
<p>An array object <code>[... .string]</code>, indicates that the object can hold multiple string elements. If you do not add <code>...</code> , the object <code>[string]</code> indicates that the array can hold only one element of type <code>string</code>.</p>
</li>
<li>
<p>The structure shown below illustrates that it can contain unknown fields.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">abc: string   
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
</li>
<li>
<p>Use the operator <code>|</code> to represent two types of values. As shown below, the variable <code>a</code> indicates that the type can be either a string or an integer type.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">a: string | int
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>Use the symbol <code>*</code> to define the default value of a variable. It is usually used in conjunction with the symbol <code>|</code> to represent the default value of a certain type. As shown below, the variable <code>a</code> is of type <code>int</code> and has a default value of <code>1</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">a: *1 | int
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>Make some variables optional. In some cases, variables that are not necessarily used are optional variables, and we can use <code>? :</code> to define such variables. As shown below, <code>a</code> is an optional variable, <code>x</code> and <code>z</code> are optional in the custom <code>#my</code> object, and <code>y</code> is a required field.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">a ?: int
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">#my: {
</span></span><span class="line"><span class="cl">x ?: string
</span></span><span class="line"><span class="cl">y : int
</span></span><span class="line"><span class="cl">z ?:float
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>Optional variables can be skipped, which is often used in conjunction with conditional judgment logic. Specifically, if some field does not exist, the CUE syntax is <code>if _variable_! = _ | _</code>, as follows.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">parameter: {
</span></span><span class="line"><span class="cl">    name: string
</span></span><span class="line"><span class="cl">    image: string
</span></span><span class="line"><span class="cl">    config?: [...#Config]
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">output: {
</span></span><span class="line"><span class="cl">    ...
</span></span><span class="line"><span class="cl">    spec: {
</span></span><span class="line"><span class="cl">        containers: [{
</span></span><span class="line"><span class="cl">            name:  parameter.name
</span></span><span class="line"><span class="cl">            image: parameter.image
</span></span><span class="line"><span class="cl">            if parameter.config != _|_ {
</span></span><span class="line"><span class="cl">                config: parameter.config
</span></span><span class="line"><span class="cl">            }
</span></span><span class="line"><span class="cl">        }]
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">    ...
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>Use the operator <code>&amp;</code> to operate on two variables.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">a: *1 | int
</span></span><span class="line"><span class="cl">b: 3
</span></span><span class="line"><span class="cl">c: a &amp; b
</span></span></code></pre></td></tr></table>
</div>
</div><p>Save the above to the <code>third.cue</code> file.</p>
<p>You can use <code>cue eval</code> to verify the results.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ cue <span class="nb">eval</span> third.cue
</span></span><span class="line"><span class="cl">a: <span class="m">1</span>
</span></span><span class="line"><span class="cl">b: <span class="m">3</span>
</span></span><span class="line"><span class="cl">c: <span class="m">3</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>Need to perform conditional judgments. Conditional judgments are very useful when you perform some cascading operations where different values affect different results. Therefore, you can execute <code>if..else</code> logic in your templates.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">price: number
</span></span><span class="line"><span class="cl">feel: *&#34;good&#34; | string
</span></span><span class="line"><span class="cl">// Feel bad if price is too high
</span></span><span class="line"><span class="cl">if price &gt; 100 {
</span></span><span class="line"><span class="cl">    feel: &#34;bad&#34;
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">price: 200
</span></span></code></pre></td></tr></table>
</div>
</div><p>Save the above to a <code>fourth.cue</code> file.</p>
<p>You can use <code>cue eval</code> to verify the results.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ cue eval fourth.cue
</span></span><span class="line"><span class="cl">price: 200
</span></span><span class="line"><span class="cl">feel:  &#34;bad&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><p>Another example is to include a boolean type as a parameter.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">parameter: {
</span></span><span class="line"><span class="cl">    name:   string
</span></span><span class="line"><span class="cl">    image:  string
</span></span><span class="line"><span class="cl">    useENV: bool
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">output: {
</span></span><span class="line"><span class="cl">    ...
</span></span><span class="line"><span class="cl">    spec: {
</span></span><span class="line"><span class="cl">        containers: [{
</span></span><span class="line"><span class="cl">            name:  parameter.name
</span></span><span class="line"><span class="cl">            image: parameter.image
</span></span><span class="line"><span class="cl">            if parameter.useENV == true {
</span></span><span class="line"><span class="cl">                env: [{name: &#34;my-env&#34;, value: &#34;my-value&#34;}]
</span></span><span class="line"><span class="cl">            }
</span></span><span class="line"><span class="cl">        }]
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">    ...
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>Use a For loop. We often use For loops to avoid duplicating code.</p>
<ul>
<li>
<p>Mapping traversal.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">parameter: {
</span></span><span class="line"><span class="cl">    name:  string
</span></span><span class="line"><span class="cl">    image: string
</span></span><span class="line"><span class="cl">    env: [string]: string
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">output: {
</span></span><span class="line"><span class="cl">    spec: {
</span></span><span class="line"><span class="cl">        containers: [{
</span></span><span class="line"><span class="cl">            name:  parameter.name
</span></span><span class="line"><span class="cl">            image: parameter.image
</span></span><span class="line"><span class="cl">            env: [
</span></span><span class="line"><span class="cl">                for k, v in parameter.env {
</span></span><span class="line"><span class="cl">                    name:  k
</span></span><span class="line"><span class="cl">                    value: v
</span></span><span class="line"><span class="cl">                },
</span></span><span class="line"><span class="cl">            ]
</span></span><span class="line"><span class="cl">        }]
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>Type traversal.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">#a: {
</span></span><span class="line"><span class="cl">    &#34;hello&#34;: &#34;Barcelona&#34;
</span></span><span class="line"><span class="cl">    &#34;nihao&#34;: &#34;Shanghai&#34;
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">for k, v in #a {
</span></span><span class="line"><span class="cl">    &#34;\(k)&#34;: {
</span></span><span class="line"><span class="cl">        nameLen: len(v)
</span></span><span class="line"><span class="cl">        value:   v
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>Slicing traversal.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">parameter: {
</span></span><span class="line"><span class="cl">    name:  string
</span></span><span class="line"><span class="cl">    image: string
</span></span><span class="line"><span class="cl">    env: [...{name:string,value:string}]
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">output: {
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">    spec: {
</span></span><span class="line"><span class="cl">        containers: [{
</span></span><span class="line"><span class="cl">            name:  parameter.name
</span></span><span class="line"><span class="cl">            image: parameter.image
</span></span><span class="line"><span class="cl">            env: [
</span></span><span class="line"><span class="cl">                for _, v in parameter.env {
</span></span><span class="line"><span class="cl">                    name:  v.name
</span></span><span class="line"><span class="cl">                    value: v.value
</span></span><span class="line"><span class="cl">                },
</span></span><span class="line"><span class="cl">            ]
</span></span><span class="line"><span class="cl">        }]
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
</li>
</ul>
<p>Alternatively, you can use <code>&quot;\( _my-statement_ )&quot;</code> to perform internal string calculations, such as getting the length of a value in the type loop example above, and so on.</p>
<h2 id="importing-packages">Importing packages</h2>
<p>For example, use the <code>strings.Join</code> method to stitch an array of strings into a string.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">import (&#34;strings&#34;)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">parameter: {
</span></span><span class="line"><span class="cl">    outputs: [{ip: &#34;1.1.1.1&#34;, hostname: &#34;xxx.com&#34;}, {ip: &#34;2.2.2.2&#34;, hostname: &#34;yyy.com&#34;}]
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">output: {
</span></span><span class="line"><span class="cl">    spec: {
</span></span><span class="line"><span class="cl">        if len(parameter.outputs) &gt; 0 {
</span></span><span class="line"><span class="cl">            _x: [ for _, v in parameter.outputs {
</span></span><span class="line"><span class="cl">                &#34;\(v.ip) \(v.hostname)&#34;
</span></span><span class="line"><span class="cl">            }]
</span></span><span class="line"><span class="cl">            message: &#34;Visiting URL: &#34; + strings.Join(_x, &#34;&#34;)
</span></span><span class="line"><span class="cl">        }
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>You can import kubernetes packages in the CUE template via <code>kube/&lt;apiVersion&gt;</code>, just as you would with CUE internal packages.</p>
<p>For example, <code>Deployment</code> can be used like this.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">import (
</span></span><span class="line"><span class="cl">   apps &#34;kube/apps/v1&#34;
</span></span><span class="line"><span class="cl">)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">parameter: {
</span></span><span class="line"><span class="cl">    name:  string
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">output: apps.#Deployment
</span></span><span class="line"><span class="cl">output: {
</span></span><span class="line"><span class="cl">    metadata: name: parameter.name
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>Service</code> can be used like this (without importing packages using aliases).</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">import (&#34;kube/v1&#34;)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">output: v1.#Service
</span></span><span class="line"><span class="cl">output: {
</span></span><span class="line"><span class="cl">    metadata: {
</span></span><span class="line"><span class="cl">        &#34;name&#34;: parameter.name
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">    spec: type: &#34;ClusterIP&#34;,
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">parameter: {
</span></span><span class="line"><span class="cl">    name:  &#34;myapp&#34;
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>Even installed CRD&rsquo;s can be imported and used.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">import (
</span></span><span class="line"><span class="cl">  oam  &#34;kube/core.oam.dev/v1alpha2&#34;
</span></span><span class="line"><span class="cl">)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">output: oam.#Application
</span></span><span class="line"><span class="cl">output: {
</span></span><span class="line"><span class="cl"> metadata: {
</span></span><span class="line"><span class="cl">  &#34;name&#34;: parameter.name
</span></span><span class="line"><span class="cl"> }
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">parameter: {
</span></span><span class="line"><span class="cl"> name:  &#34;myapp&#34;
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div>
    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/cue/">cue</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2022-04/mount-and-unmount-disk-in-linux/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Mounting/unmounting a disk on Linux</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2022-04/deepl-api/">
            <span class="next-text nav-default">DeepL Deception Tactics in Api Design</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.64437849d125a2d603b3e71d6de5225d641a32d17168a58106e0b61852079683.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
