<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>TypeScript - The Elegant Way of Never and Unknown - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="Explore the elegant ways of never and unknown in TypeScript." /><meta name="keywords" content="TypeScript, Unknown, Never" />






<meta name="generator" content="Hugo 0.96.0 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2022-04/ts-never-unknown/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link href="/lib/fancybox/jquery.fancybox-3.1.20.min.css" rel="stylesheet">


<meta property="og:title" content="TypeScript - The Elegant Way of Never and Unknown" />
<meta property="og:description" content="Explore the elegant ways of never and unknown in TypeScript." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2022-04/ts-never-unknown/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-04-11T20:33:40+08:00" />
<meta property="article:modified_time" content="2022-04-11T20:33:40+08:00" />

<meta itemprop="name" content="TypeScript - The Elegant Way of Never and Unknown">
<meta itemprop="description" content="Explore the elegant ways of never and unknown in TypeScript."><meta itemprop="datePublished" content="2022-04-11T20:33:40+08:00" />
<meta itemprop="dateModified" content="2022-04-11T20:33:40+08:00" />
<meta itemprop="wordCount" content="2811">
<meta itemprop="keywords" content="TypeScript," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="TypeScript - The Elegant Way of Never and Unknown"/>
<meta name="twitter:description" content="Explore the elegant ways of never and unknown in TypeScript."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SOBYTE</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a><a href="/ukraine/">
        <li class="mobile-menu-item">UKRAINE</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SOBYTE</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/ukraine/">UKRAINE</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">TypeScript - The Elegant Way of Never and Unknown</h1>

      <div class="post-meta">
        <span class="post-time"> 2022-04-11 20:33:40 </span>
        <div class="post-category">
            <a href="/categories/tutorials/"> tutorials </a>
            </div>
          <span class="more-meta"> 2811 words </span>
          <span class="more-meta"> 6 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#1-preface">1. Preface</a></li>
        <li><a href="#2-top-type-bottom-type-in-typescript">2. top type, bottom type in TypeScript</a></li>
        <li><a href="#3-unknown-and-any">3. unknown and any</a>
          <ul>
            <li><a href="#31-unknown----for-anything">3.1 unknown &ndash; for anything</a></li>
            <li><a href="#32-any">3.2 any</a></li>
            <li><a href="#33-reviewing-previous-type-designs">3.3 Reviewing previous type designs</a></li>
          </ul>
        </li>
        <li><a href="#4-never">4, never</a>
          <ul>
            <li><a href="#41-the-only-bottom-type">4.1 The only bottom type</a></li>
            <li><a href="#42-the-beauty-of-never">4.2 The beauty of never</a></li>
          </ul>
        </li>
        <li><a href="#5-conclusion">5. Conclusion</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <h2 id="1-preface">1. Preface</h2>
<p>TypeScript introduced two basic types, &ldquo;never&rdquo; and &ldquo;unknown&rdquo;, in version 2.0 and 3.0 respectively. The type system of TypeScript has been greatly improved.</p>
<p>However, when I take over the code, I find that many people are still stuck in the era of 1.0, the era of using <code>any</code> everywhere. After all, JavaScript is a weakly typed dynamic language, and we used to not spend much time on type design. After the introduction of TypeScript, we even complained, &ldquo;Why is this code getting more and more complicated?&rdquo;.</p>
<p>In fact, we should think the other way around: an OOP programming paradigm is what code should look like after ES6.</p>
<h2 id="2-top-type-bottom-type-in-typescript">2. top type, bottom type in TypeScript</h2>
<p>In the type system design, there are two special types.</p>
<ul>
<li>Top type: known as the generic parent type, which is the type that can contain all values.</li>
<li>Bottom type: represents a type that has no values, it is also called <strong>zero</strong> or <strong>empty</strong> type and is a subtype of all types.</li>
</ul>
<p>In TypeScript 3.0, there are two top types (any and unknown) and one bottom type (never), as explained in the type system.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/04/11/c87ddb577ccf457c935517f491e8a6e4.png" alt="top type, bottom type in TypeScript"></p>
<p>But some people think that any is also a bottom type, because any can also be a subtype of many types. But this argument is not strict, we can take a deeper look at unknown, any and never types.</p>
<h2 id="3-unknown-and-any">3. unknown and any</h2>
<h3 id="31-unknown----for-anything">3.1 unknown &ndash; for anything</h3>
<p>When I read my colleagues&rsquo; code, I rarely see the unknown type appear. This does not mean that it is unimportant; on the contrary, it is a safe version of any type.</p>
<p>The difference between it and any is simple, see the following example.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">format1</span><span class="p">(</span><span class="nx">value</span><span class="o">:</span> <span class="nx">any</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">value</span><span class="p">.</span><span class="nx">toFixed</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span> <span class="c1">// 不飘红，想干什么干什么，very dangerous
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">format2</span><span class="p">(</span><span class="nx">value</span><span class="o">:</span> <span class="nx">unknown</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">value</span><span class="p">.</span><span class="nx">toFixed</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span> <span class="c1">// 代码会飘红，阻止你这么做
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 你需要收窄类型范围，例如：
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 1、类型断言 —— 不飘红，但执行时可能错误
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">(</span><span class="nx">value</span> <span class="nx">as</span> <span class="nb">Number</span><span class="p">).</span><span class="nx">toFixed</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 2、类型守卫 —— 不飘红，且确保正常执行
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">value</span> <span class="o">===</span> <span class="s1">&#39;number&#39;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// 推断出类型: number
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nx">value</span><span class="p">.</span><span class="nx">toFixed</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 3、类型断言函数，抛出错误 —— 不飘红，且确保正常执行
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">assertIsNumber</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">value</span><span class="p">.</span><span class="nx">toFixed</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/** 类型断言函数，抛出错误 */</span>
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">assertIsNumber</span><span class="p">(</span><span class="nx">arg</span><span class="o">:</span> <span class="nx">unknown</span><span class="p">)</span><span class="o">:</span> <span class="nx">asserts</span> <span class="nx">arg</span> <span class="nx">is</span> <span class="nb">Number</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">arg</span> <span class="k">instanceof</span> <span class="nb">Number</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">thrownewTypeError</span><span class="p">(</span><span class="s1">&#39;Not a Number: &#39;</span> <span class="o">+</span> <span class="nx">arg</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Using any is like exploring a haunted house, the code is executed with ghosts everywhere. The combination of unknown with type guards, for example, ensures that code executes properly even when the upstream data structure is uncertain.</p>
<h3 id="32-any">3.2 any</h3>
<p>By using any, we&rsquo;re giving up type checking, because it&rsquo;s not used to describe specific types.</p>
<p>Before using it, we need to think of two things.</p>
<ol>
<li>whether it is possible to use a more specific type</li>
<li>whether unknown can be used instead</li>
</ol>
<p>If neither is possible, then any is the last option.</p>
<h3 id="33-reviewing-previous-type-designs">3.3 Reviewing previous type designs</h3>
<p>Some existing type designs use any, which is not accurate enough. Here are two examples.</p>
<h4 id="331-string">3.3.1 String()</h4>
<p><code>String()</code> can take any argument and convert it to a string.</p>
<p>Combined with the unknown type introduced above, the arguments here can actually be designed as unknown, but the internal implementation will need more type guards. But the unknown type came later, so the initial design still uses any, which is what we see now.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * typescript/lib/lib.es5.d.ts
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="kr">interface</span> <span class="nx">StringConstructor</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">new</span><span class="p">(</span><span class="nx">value</span><span class="o">?:</span> <span class="nx">any</span><span class="p">)</span><span class="o">:</span> <span class="nb">String</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nx">value</span><span class="o">?:</span> <span class="nx">any</span><span class="p">)</span><span class="o">:</span> <span class="nx">string</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">readonly</span> <span class="nx">prototype</span><span class="o">:</span> <span class="nb">String</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">fromCharCode</span><span class="p">(...</span><span class="nx">codes</span><span class="o">:</span> <span class="nx">number</span><span class="p">[])</span><span class="o">:</span> <span class="nx">string</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="332-jsonparse">3.3.2 JSON.parse()</h4>
<p>I recently wrote a piece of code that involves deep copy.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">exportfunction</span> <span class="nx">deleteCommentFromComments</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">comments</span><span class="o">:</span> <span class="nx">GenericsComment</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">[],</span> <span class="nx">comment</span><span class="o">:</span> <span class="nx">GenericsComment</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 深拷贝
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">const</span> <span class="nx">list</span><span class="o">:</span> <span class="nx">GenericsComment</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">[]</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">comments</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// 找到对应的评论下标
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">const</span> <span class="nx">targetIndex</span> <span class="o">=</span> <span class="nx">list</span><span class="p">.</span><span class="nx">findIndex</span><span class="p">((</span><span class="nx">item</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">comment_id</span> <span class="o">===</span> <span class="nx">comment</span><span class="p">.</span><span class="nx">comment_id</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">returntrue</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nx">returnfalse</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nx">targetIndex</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 剔除对应的评论
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">list</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">targetIndex</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">list</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Obviously, the output of JSON.parse() changes dynamically with the input (and may even throw an Error), and its function signature is designed as follows.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">interface</span> <span class="nx">JSON</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">parse</span><span class="p">(</span><span class="nx">text</span><span class="o">:</span> <span class="nx">string</span><span class="p">,</span> <span class="nx">reviver</span><span class="o">?:</span> <span class="p">(</span><span class="k">this</span><span class="o">:</span> <span class="nx">any</span><span class="p">,</span> <span class="nx">key</span><span class="o">:</span> <span class="nx">string</span><span class="p">,</span> <span class="nx">value</span><span class="o">:</span> <span class="nx">any</span><span class="p">)</span> <span class="p">=&gt;</span><span class="nx">any</span><span class="p">)</span><span class="o">:</span> <span class="nx">any</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Can I use unknown here? Yes, but for the same reason as above, the function signature of <code>JSON.parse()</code> was added to the TypeScript system before the unknown type appeared, otherwise its return type should be unknown.</p>
<h2 id="4-never">4, never</h2>
<p>mentioned above, the <code>never</code> type is the empty type, that is, the value never exists type.</p>
<p>Value will never exist in two cases.</p>
<ol>
<li>if a function is executed when the <strong>exception</strong> is thrown, then the function will never exist return value (because the exception will be thrown to directly interrupt the program, which makes the program does not run to return the value of that step, that is, with the end of the unreachable, there will never be a return).</li>
<li>the function executes an infinite loop of code (<strong>dead loop</strong>), so that the program can never run to the return value of the function, there is never a return.</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// 异常
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">function</span> <span class="nx">err</span><span class="p">(</span><span class="nx">msg</span><span class="o">:</span> <span class="nx">string</span><span class="p">)</span><span class="o">:</span> <span class="nx">never</span> <span class="p">{</span> <span class="c1">// OK
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="nx">msg</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 死循环
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">function</span> <span class="nx">loopForever</span><span class="p">()</span><span class="o">:</span> <span class="nx">never</span> <span class="p">{</span> <span class="c1">// OK
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">while</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{};</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="41-the-only-bottom-type">4.1 The only bottom type</h3>
<p>Since never is the only bottom type of typescript, it can represent a subtype of any type, so it can be assigned to any type.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">err</span><span class="o">:</span> <span class="nx">never</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">num</span><span class="o">:</span> <span class="nx">number</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">num</span> <span class="o">=</span> <span class="nx">err</span><span class="p">;</span> <span class="c1">// OK
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/04/11/0105b3a3b48243bbb315d91b44b2c1a6.png" alt="only bottom type"></p>
<p>We can use the set to understand never, unknown is the full set, never is the smallest unit (empty set), and any type contains never.</p>
<h4 id="411-nullundefined-and-never">4.1.1 null/undefined and never</h4>
<p>Here you may ask, null and undefined seem to be subtypes of any type, so why not bottom type. never is special in that no type is a subtype of it or can be assigned to it except itself. We can use the following example to compare.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// null 和 undefined，可以被 never 赋值
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">declare</span> <span class="kr">const</span> <span class="nx">n</span><span class="o">:</span> <span class="nx">never</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">a</span><span class="o">:</span> <span class="kc">null</span> <span class="o">=</span> <span class="nx">n</span><span class="p">;</span> <span class="c1">// 正确
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">let</span> <span class="nx">b</span><span class="o">:</span> <span class="kc">undefined</span> <span class="o">=</span> <span class="nx">n</span><span class="p">;</span> <span class="c1">// 正确
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// never 是 bottom type，除了自己以外没有任何类型可以赋值给它
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">let</span> <span class="nx">ne</span><span class="o">:</span> <span class="nx">never</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">ne</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span> <span class="c1">// 错误
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">ne</span> <span class="o">=</span> <span class="kc">undefined</span><span class="p">;</span> <span class="c1">// 错误
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="nx">declare</span> <span class="kr">const</span> <span class="nx">an</span><span class="o">:</span> <span class="nx">any</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nx">ne</span> <span class="o">=</span> <span class="nx">an</span><span class="p">;</span> <span class="c1">// 错误，any 也不可以
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="nx">declareconst</span> <span class="nx">nev</span><span class="o">:</span> <span class="nx">never</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nx">ne</span> <span class="o">=</span> <span class="nx">nev</span><span class="p">;</span> <span class="c1">// 正确，只有 never 可以赋值给 never
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>The above example basically illustrates the difference between null/undefined and never, with never being the bottom one.</p>
<h4 id="412-why-any-is-not-a-strict-bottom-type">4.1.2 Why any is not a strict bottom type</h4>
<p>When I read some articles, I found that people often say that any is both a top type and a bottom type, but this is not a strict statement.</p>
<p>We know from the above that no type can be assigned to never except never itself. does any satisfy this property? Obviously not, for a very simple example.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">a</span> <span class="o">=</span> <span class="s1">&#39;anything&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">b</span><span class="o">:</span> <span class="nx">any</span> <span class="o">=</span> <span class="nx">a</span><span class="p">;</span> <span class="c1">// 能够赋值
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">c</span><span class="o">:</span> <span class="nx">never</span> <span class="o">=</span> <span class="nx">a</span><span class="p">;</span> <span class="c1">// 报错，不能赋值
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>And why do we say never is the bottom type? Wikipedia explains it this way.</p>
<blockquote>
<p>A function whose return type is bottom (presumably) cannot return any value, not even the zero size unit type. Therefore a function whose return type is the bottom type cannot return.</p>
</blockquote>
<p>It is also easy to see from this that in a type system, bottom type is unique in that it uniquely describes the case of a function that returns nothing. So, with never, any heresy that is not type-checked is definitely not a bottom type.</p>
<h3 id="42-the-beauty-of-never">4.2 The beauty of never</h3>
<p>Never has the following usage scenarios.</p>
<ul>
<li>Unreachable code checking: mark unreachable code and get compilation hints.</li>
<li>Type operation: as a minimal factor in type operations.</li>
<li>Exhaustive Check: Create compilation hints for compound types.</li>
<li>&hellip;&hellip;</li>
</ul>
<p>There is no denying that never is a wonderful thing. From a set theory perspective, it is an empty set, so it can bring a lot of convenience to our type work through some properties of empty sets. Next, let&rsquo;s talk about each usage scenario in detail.</p>
<h4 id="421-unreachable-code-check">4.2.1 Unreachable code check</h4>
<p>A beginner wrote the following line of code.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;hello world&#34;</span><span class="p">)</span> <span class="c1">// Unreachable code detected.ts(7027)
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Don&rsquo;t laugh, it&rsquo;s a real possibility. Of course at this point if you use ts, it will give you a compiler hint.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">Error: Unreachable code detected.ts(7027)
</span></span></code></pre></td></tr></table>
</div>
</div><p>Because the return type of <code>process.exit()</code> is defined as never, what comes after it is naturally the &ldquo;unreachable code&rdquo;.</p>
<p>Other possible scenarios are listening to sockets.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">listen</span><span class="p">()</span><span class="o">:</span> <span class="nx">never</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">while</span><span class="p">(</span><span class="kc">true</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="kd">let</span> <span class="nx">conn</span> <span class="o">=</span> <span class="nx">server</span><span class="p">.</span><span class="nx">accept</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">listen</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;!!!&#34;</span><span class="p">);</span> <span class="c1">// Unreachable code detected.ts(7027)
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>In general, we manually mark the return value of a function as never to help the compiler recognize &ldquo;unreachable code&rdquo; and to help us narrow (narrow) the type. Here is an example of unmarking.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">throwError</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">firstChar</span><span class="p">(</span><span class="nx">msg</span><span class="o">:</span> <span class="nx">string</span> <span class="o">|</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nx">msg</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nx">throwError</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">chr</span> <span class="o">=</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1">// Object is possibly &#39;undefined&#39;.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Since the compiler does not know that throwError is a no-return function, the code after <code>throwError()</code> is assumed to be reachable in any case, leaving the compiler with the misconception that the type of msg is string | undefined.</p>
<p>If the never type is marked, then the type of msg will be narrowed to string after the null check.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">throwError</span><span class="p">()</span><span class="o">:</span> <span class="nx">never</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">firstChar</span><span class="p">(</span><span class="nx">msg</span><span class="o">:</span> <span class="nx">string</span> <span class="o">|</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nx">msg</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">throw</span> <span class="nb">Error</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">chr</span> <span class="o">=</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1">// ✅
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="422-type-operations">4.2.2 Type operations</h4>
<h5 id="4221-minimal-factors">4.2.2.1 Minimal factors</h5>
<p>As mentioned above never can be understood as an empty set, then it will satisfy the following operation rules.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">T | never =&gt; T
</span></span><span class="line"><span class="cl">T &amp; never =&gt;never
</span></span></code></pre></td></tr></table>
</div>
</div><p>That is, never is the smallest factor of a type operation. These rules help us simplify some trivial type operations, for example, multiple <code>Promise</code>s like <code>Promise.race</code> merging, where sometimes it is impossible to know exactly the timing and return result. Now we use a <code>Promise.race</code> to merge a <code>Promise</code> that has a network request return value with another <code>Promise</code> that will be <code>rejected</code> within a given time.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">asyncfunction</span> <span class="nx">fetchNameWithTimeout</span><span class="p">(</span><span class="nx">userId</span><span class="o">:</span> <span class="nx">string</span><span class="p">)</span><span class="o">:</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">string</span><span class="o">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="kr">await</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">race</span><span class="p">([</span>
</span></span><span class="line"><span class="cl">    <span class="nx">fetchData</span><span class="p">(</span><span class="nx">userId</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="nx">timeout</span><span class="p">(</span><span class="mi">3000</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">])</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">data</span><span class="p">.</span><span class="nx">userName</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The following is an implementation of a timeout function that throws an Error if the specified time is exceeded, and since it returns nothing, the result is defined as <code>Promise&lt;never&gt;</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">timeout</span><span class="p">(</span><span class="nx">ms</span><span class="o">:</span> <span class="nx">number</span><span class="p">)</span><span class="o">:</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">never</span><span class="o">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">((</span><span class="nx">_</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">setTimeout</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="nx">reject</span><span class="p">(</span><span class="nx">newError</span><span class="p">(</span><span class="s2">&#34;Timeout!&#34;</span><span class="p">)),</span> <span class="nx">ms</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Good, then the compiler will infer the return value of <code>Promise.race</code>, because race takes the result of the first <code>Promise</code> to complete, so in the example above, it has a function signature like this.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">race</span><span class="o">&lt;</span><span class="nx">A</span><span class="p">,</span> <span class="nx">B</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">inputs</span><span class="o">:</span> <span class="p">[</span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">A</span><span class="o">&gt;</span><span class="p">,</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">B</span><span class="o">&gt;</span><span class="p">])</span><span class="o">:</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">A</span> <span class="o">|</span> <span class="nx">B</span><span class="o">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Substituting in fetchData and timeout, A would be <code>{ userName: string }</code>, while B would be <code>never</code>. Therefore, the function outputs a <code>promise</code> return value of type <code>{ userName: string } | never</code>. And since <code>never</code> is the minimum factor, it can be eliminated. So the return value can be reduced to <code>{ userName: string }</code>, which is exactly what we want.</p>
<p>What happens if we use <code>any</code> or <code>unknown</code> here?</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// 使用 any
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">function</span> <span class="nx">timeout</span><span class="p">(</span><span class="nx">ms</span><span class="o">:</span> <span class="nx">number</span><span class="p">)</span><span class="o">:</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">any</span><span class="o">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="p">......</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">// { userName: string } | any =&gt; any，失去了类型检查
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">asyncfunction</span> <span class="nx">fetchNameWithTimeout</span><span class="p">(</span><span class="nx">userId</span><span class="o">:</span> <span class="nx">string</span><span class="p">)</span><span class="o">:</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">string</span><span class="o">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="p">......</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">data</span><span class="p">.</span><span class="nx">userName</span><span class="p">;</span> <span class="c1">// ❌ data 被推断为 any
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>any is well understood, it passes normally, but it is equivalent to no type checking.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// 使用 unknown
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">function</span> <span class="nx">timeout</span><span class="p">(</span><span class="nx">ms</span><span class="o">:</span> <span class="nx">number</span><span class="p">)</span><span class="o">:</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">unknown</span><span class="o">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="p">......</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">// { userName: string } | unknown =&gt; unknown，类型被模糊
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">asyncfunction</span> <span class="nx">fetchNameWithTimeout</span><span class="p">(</span><span class="nx">userId</span><span class="o">:</span> <span class="nx">string</span><span class="p">)</span><span class="o">:</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">string</span><span class="o">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="p">......</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">data</span><span class="p">.</span><span class="nx">userName</span><span class="p">;</span> <span class="c1">// ❌ data 被推断为 unknown
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>unknown is ambiguous and requires us to narrow the type manually.</p>
<p>When we strictly use never to describe &ldquo;unreachable code&rdquo;, the compiler can help us to narrow the type exactly, so that the code is the document.</p>
<h5 id="4222-use-in-conditional-types">4.2.2.2 Use in conditional types</h5>
<p>We often see never in conditional types, which are used to indicate the else case.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">type</span> <span class="nx">Arguments</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nx">T</span> <span class="kr">extends</span> <span class="p">(...</span><span class="nx">args</span><span class="o">:</span> <span class="nx">infer</span> <span class="nx">A</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">any</span> <span class="o">?</span> <span class="nx">A</span> <span class="o">:</span> <span class="nx">never</span>
</span></span><span class="line"><span class="cl"><span class="nx">type</span> <span class="nx">Return</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nx">T</span> <span class="kr">extends</span> <span class="p">(...</span><span class="nx">args</span><span class="o">:</span> <span class="nx">any</span><span class="p">[])</span> <span class="p">=&gt;</span> <span class="nx">infer</span> <span class="nx">R</span> <span class="o">?</span> <span class="nx">R</span> <span class="o">:</span> <span class="nx">never</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>For the above two conditional types for deriving function arguments and return values, we can get a hint from the compiler even if the T passed in is a non-function type.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// Error: Type &#39;3&#39; is not assignable to type &#39;never&#39;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">x</span><span class="o">:</span> <span class="nx">Return</span><span class="o">&lt;</span><span class="s2">&#34;not a function type&#34;</span><span class="o">&gt;</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Never also cleverly plays its role as a minimal factor when narrowing union types. Take, for example, the following example of excluding <code>null</code> and <code>undefined</code> from <code>T</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">type</span> <span class="nx">NullOrUndefined</span> <span class="o">=</span> <span class="kc">null</span> <span class="o">|</span> <span class="kc">undefined</span>
</span></span><span class="line"><span class="cl"><span class="nx">type</span> <span class="nx">NonNullable</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nx">T</span> <span class="kr">extends</span> <span class="nx">NullOrUndefined</span> <span class="o">?</span> <span class="nx">never</span> <span class="o">:</span> <span class="nx">T</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 运算过程
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">type</span> <span class="nx">NonNullable</span><span class="o">&lt;</span><span class="nx">string</span> <span class="o">|</span> <span class="kc">null</span><span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl">  <span class="c1">// 联合类型被分解成多个分支单独运算
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="p">=&gt;</span> <span class="p">(</span><span class="nx">string</span> <span class="kr">extends</span> <span class="nx">NullOrUndefined</span> <span class="o">?</span> <span class="nx">never</span> <span class="o">:</span> <span class="nx">string</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="nx">nullextends</span>  <span class="nx">NullOrUndefined</span> <span class="o">?</span> <span class="nx">never</span> <span class="o">:</span> <span class="kc">null</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 多个分支得到结果，再次联合
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="p">=&gt;</span> <span class="nx">string</span> <span class="o">|</span> <span class="nx">never</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// never 在联合类型运算中被消解
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="p">=&gt;</span> <span class="nx">string</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="423-exhaustive-check">4.2.3 Exhaustive Check</h4>
<p>Complex types such as union types and algebraic data types can be combined with the switch statement to narrow the types.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">interface</span> <span class="nx">Foo</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;foo&#39;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">interface</span> <span class="nx">Bar</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;bar&#39;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">type</span> <span class="nx">All</span> <span class="o">=</span> <span class="nx">Foo</span> <span class="o">|</span> <span class="nx">Bar</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">handleValue</span><span class="p">(</span><span class="nx">val</span><span class="o">:</span> <span class="nx">All</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">switch</span> <span class="p">(</span><span class="nx">val</span><span class="p">.</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span><span class="s1">&#39;foo&#39;</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// val 此时是 Foo
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span><span class="s1">&#39;bar&#39;</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// val 此时是 Bar
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">default</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// val 此时是 never
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="kr">const</span> <span class="nx">exhaustiveCheck</span><span class="o">:</span> <span class="nx">never</span> <span class="o">=</span> <span class="nx">val</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>If someone later modifies the <code>All</code> type, it will find that a compile error has been generated.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">type</span> <span class="nx">All</span> <span class="o">=</span> <span class="nx">Foo</span> <span class="o">|</span> <span class="nx">Bar</span> <span class="o">|</span> <span class="nx">Baz</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">handleValue</span><span class="p">(</span><span class="nx">val</span><span class="o">:</span> <span class="nx">All</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">switch</span> <span class="p">(</span><span class="nx">val</span><span class="p">.</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span><span class="s1">&#39;foo&#39;</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// val 此时是 Foo
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span><span class="s1">&#39;bar&#39;</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// val 此时是 Bar
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">default</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// val 此时是 Baz
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="c1">// ❌ Type &#39;Baz&#39; is not assignable to type &#39;never&#39;.(2322)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="kr">const</span> <span class="nx">exhaustiveCheck</span><span class="o">:</span> <span class="nx">never</span> <span class="o">=</span> <span class="nx">val</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In the default branch, val is narrowed to <code>Baz</code>, making it impossible to assign a value to never and generating a compile error. Developers can realize that handleValue needs to have Baz-specific processing logic in it. By doing this, you can ensure that handleValue always exhausts all possible types.</p>
<h2 id="5-conclusion">5. Conclusion</h2>
<p>For students who value type specification and code design, TypeScript is not a shackle, but a pragmatic language. By learning more about the use and status of never and unknown in the TypeScript type system, you can learn a lot about type system design and set theory, and organize reliable and safe code by narrowing types in practice.</p>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/typescript/">TypeScript</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2022-04/unable-to-allocate-memory/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Why do I get the error &#34;Unable to allocate memory&#34; when there is still plenty of memory?</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2022-04/golang-new-proposal-ctx/">
            <span class="next-text nav-default">Goalng new proposal: add standard library Context&#39;s cancel API</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  <script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox-3.1.20.min.js"></script>



<script type="text/javascript" src="/js/main.min.64437849d125a2d603b3e71d6de5225d641a32d17168a58106e0b61852079683.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
