<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>How to manually install Nginx binaries - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="Learn how to install a compiled Nginx binary on a Linux system." /><meta name="keywords" content="nginx, Binary, Install, manually" />






<meta name="generator" content="Hugo 0.101.0 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2022-04/nginx-binary-install/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link href="/lib/fancybox/jquery.fancybox-3.1.20.min.css" rel="stylesheet">


<meta property="og:title" content="How to manually install Nginx binaries" />
<meta property="og:description" content="Learn how to install a compiled Nginx binary on a Linux system." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2022-04/nginx-binary-install/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-04-16T11:25:19+08:00" />
<meta property="article:modified_time" content="2022-04-16T11:25:19+08:00" />

<meta itemprop="name" content="How to manually install Nginx binaries">
<meta itemprop="description" content="Learn how to install a compiled Nginx binary on a Linux system."><meta itemprop="datePublished" content="2022-04-16T11:25:19+08:00" />
<meta itemprop="dateModified" content="2022-04-16T11:25:19+08:00" />
<meta itemprop="wordCount" content="895">
<meta itemprop="keywords" content="nginx," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="How to manually install Nginx binaries"/>
<meta name="twitter:description" content="Learn how to install a compiled Nginx binary on a Linux system."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SOBYTE</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SOBYTE</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">How to manually install Nginx binaries</h1>

      <div class="post-meta">
        <span class="post-time"> 2022-04-16 11:25:19 </span>
        <div class="post-category">
            <a href="/categories/tutorials/"> tutorials </a>
            </div>
          <span class="more-meta"> 895 words </span>
          <span class="more-meta"> 5 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#prefix-configuration">prefix configuration</a></li>
        <li><a href="#copy-the-program-to-an-executable-path">Copy the program to an executable path</a></li>
        <li><a href="#adding-systemd-unit-files">Adding Systemd Unit files</a></li>
        <li><a href="#nginxconf-configuration-file"><code>nginx.conf</code> configuration file</a></li>
        <li><a href="#creating-the-directory-you-need-to-run">Creating the directory you need to run</a></li>
        <li><a href="#starting-or-restarting-nginx">Starting or restarting nginx</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>In some special cases, such as offline conditions, we cannot use the package manager and have to install a specific software manually, so it is recommended to compile and install it from the source code itself, usually in two steps <code>configure + make install</code>.</p>
<p>If we can only get a compiled program or do not have a compiled environment, we will have to perform the installation steps manually. This article will document how to install a compiled Nginx binary on a Linux system.</p>
<h2 id="prefix-configuration">prefix configuration</h2>
<p>The most important thing to note about installing nginx is the <code>prefix</code> path configuration, which defaults to <code>/usr/local/nginx</code> and is the base path for the nginx runtime.</p>
<ul>
<li>nginx will look for the configuration file <code>nginx.conf</code> from this path.</li>
<li>The default values for other paths used by nginx are also based on this path, such as <code>{prefix}/logs/error.log</code>.</li>
<li>The relative paths in the configuration files read by nginx are all relative to this base path.</li>
</ul>
<p>Since this configuration is written into the program at compile time, it cannot be changed at this point, but you can still specify the path to the configuration file when running nginx with the <code>-c</code> option. If you are not sure of the value of <code>prefix</code>, you can execute the binary and add the <code>-V</code> option to see it.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">nginx -V
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">nginx version: nginx/1.21.1
</span></span><span class="line"><span class="cl">built by gcc 8.3.0 <span class="o">(</span>Debian 8.3.0-6<span class="o">)</span> 
</span></span><span class="line"><span class="cl">built with OpenSSL 1.1.1d  <span class="m">10</span> Sep <span class="m">2019</span>
</span></span><span class="line"><span class="cl">configure arguments: --prefix<span class="o">=</span>/etc/nginx --sbin-path<span class="o">=</span>/usr/sbin/nginx --modules-path<span class="o">=</span>/usr/lib/nginx/modules --conf-path<span class="o">=</span>/etc/nginx/nginx.conf
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="copy-the-program-to-an-executable-path">Copy the program to an executable path</h2>
<p>We first need to move the binary file to the host, at this point it is recommended to place it under an executable path such as <code>/usr/sbin/</code>, after which you do not need to specify a specific path but directly execute the program via the <code>nginx</code> command.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">chmod <span class="m">0755</span> nginx
</span></span><span class="line"><span class="cl">mv nginx /usr/sbin/nginx
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="adding-systemd-unit-files">Adding Systemd Unit files</h2>
<p>For long-running server programs such as nginx, we need to host them for bootup, automatic restart, and so on. The most recommended way to do this is to use systemd as the hosting application, which is the default initialization system for most Linux distributions today.</p>
<p>Specifically, we need to create a unit file named <code>nginx.service</code> and place it in the <code>/usr/lib/systemd/system</code> directory.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">touch /usr/lib/systemd/system/nginx.service
</span></span></code></pre></td></tr></table>
</div>
</div><p>The contents of <code>nginx.service</code> are as follows.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[Unit]
</span></span><span class="line"><span class="cl">Description=The nginx HTTP and reverse proxy server
</span></span><span class="line"><span class="cl">After=network.target remote-fs.target nss-lookup.target
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">[Service]
</span></span><span class="line"><span class="cl">Type=forking
</span></span><span class="line"><span class="cl">PIDFile=/run/nginx.pid
</span></span><span class="line"><span class="cl"># Nginx will fail to start if /run/nginx.pid already exists but has the wrong
</span></span><span class="line"><span class="cl"># SELinux context. This might happen when running `nginx -t` from the cmdline.
</span></span><span class="line"><span class="cl"># https://bugzilla.redhat.com/show_bug.cgi?id=1268621
</span></span><span class="line"><span class="cl">ExecStartPre=/usr/bin/rm -f /run/nginx.pid
</span></span><span class="line"><span class="cl">ExecStartPre=/usr/sbin/nginx -t -c /etc/nginx/nginx.conf
</span></span><span class="line"><span class="cl">ExecStart=/usr/sbin/nginx -c /etc/nginx/nginx.conf
</span></span><span class="line"><span class="cl">ExecReload=/bin/kill -s HUP $MAINPID
</span></span><span class="line"><span class="cl">KillSignal=SIGQUIT
</span></span><span class="line"><span class="cl">TimeoutStopSec=5
</span></span><span class="line"><span class="cl">KillMode=process
</span></span><span class="line"><span class="cl">PrivateTmp=true
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">[Install]
</span></span><span class="line"><span class="cl">WantedBy=multi-user.target
</span></span></code></pre></td></tr></table>
</div>
</div><p>In the Unit file, we define this <code>service</code> resource for nginx, and set the startup command and the path to the configuration file to use.</p>
<h2 id="nginxconf-configuration-file"><code>nginx.conf</code> configuration file</h2>
<p>We control the specific behavior of nginx through the <code>nginx.conf</code> configuration file. We have defined the configuration file path as <code>/etc/nginx/nginx.conf</code> in the Unit file, so the configuration will be read from that path whenever we start nginx with the <code>systemctl</code> utility. Now create the file.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">mkdir /etc/nginx
</span></span><span class="line"><span class="cl">touch /etc/nginx/nginx.conf
</span></span></code></pre></td></tr></table>
</div>
</div><p>The contents of <code>nginx.conf</code> can be defined according to our needs, but we need to pay attention to the following points.</p>
<ol>
<li>the value of the <code>pid</code> directive must be consistent with the Unit file, i.e. <code>pid /run/nginx.pid;</code> .</li>
<li>All directories for path-type directives must exist in advance, such as <code>error_log</code>, <code>access_log</code> and <code>include</code>. nginx will automatically create log files but not directories for them.</li>
</ol>
<p>It is recommended to keep access and exception logs in the <code>/var/log/nginx</code> directory, and to place sub-configurations of the <code>http</code> configuration section in the <code>/etc/nginx/</code> directory.</p>
<h2 id="creating-the-directory-you-need-to-run">Creating the directory you need to run</h2>
<p>The paths you specify in <code>nginx.conf</code> need to be created in advance, otherwise you will get an error when starting nginx. Suppose we specify the following path-like configuration in <code>nginx.conf</code> (only part of it is shown).</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">error_log</span>  <span class="s">/var/log/nginx/error.log</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">pid</span>        <span class="s">/run/nginx.pid</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">http</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">access_log</span>  <span class="s">/var/log/nginx/access.log</span>  <span class="s">main</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">include</span>             <span class="s">/etc/nginx/mime.types</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">include</span>             <span class="s">/etc/nginx/conf.d/*.conf</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Then you need to prepare the <code>/etc/nginx/mime.types</code> file in advance and create the following directory.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">mkdir -p /var/log/nginx
</span></span><span class="line"><span class="cl">mkdir -p /run
</span></span><span class="line"><span class="cl">mkdir -p /etc/nginx/conf.d
</span></span></code></pre></td></tr></table>
</div>
</div><p>If we use relative paths in <code>nginx.conf</code>, we need to create the corresponding directory based on the <code>prefix</code> path.</p>
<p>That&rsquo;s all we need to do.</p>
<h2 id="starting-or-restarting-nginx">Starting or restarting nginx</h2>
<p>You can now start nginx via systemd.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">systemctl start nginx <span class="o">&amp;&amp;</span> systemctl <span class="nb">enable</span> nginx
</span></span></code></pre></td></tr></table>
</div>
</div><p>Note that in the results of <code>systemctl status nginx</code>, we may see the following warning in the initial startup log.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">[alert]: could not open error log file: open() &#34;/usr/local/nginx/logs/error.log&#34; failed (13: Permission denied)
</span></span></code></pre></td></tr></table>
</div>
</div><p>This is because nginx opens the error log file before it reads <code>nginx.conf</code>, which uses the <code>error-log-path</code> path specified at compile time, which defaults to <code>{prefix}/logs/error.log</code>. After <code>nginx.conf</code> is read, the path specified by <code>error_log</code> in the configuration file is used. Therefore, this error is only a warning and will not affect the start of nginx.</p>
<p>When restarting nginx via <code>reload</code>, you should also be careful to add the <code>-c</code> option to specify the path to the configuration file.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">nginx -s reload -c /etc/nginx/nginx.conf
</span></span></code></pre></td></tr></table>
</div>
</div>
    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/nginx/">nginx</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2022-04/httpie-star-to-zero/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">54,000 Star all to zero, the project author: very regret</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2022-04/docker-buildx/">
            <span class="next-text nav-default">How to use docker buildx to build cross-platform Go images</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  <script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox-3.1.20.min.js"></script>



<script type="text/javascript" src="/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
