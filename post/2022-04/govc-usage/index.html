<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Govc User Guide - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="Learn how to use govc." /><meta name="keywords" content="govc, Usage" />






<meta name="generator" content="Hugo 0.101.0 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2022-04/govc-usage/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link href="/lib/fancybox/jquery.fancybox-3.1.20.min.css" rel="stylesheet">


<meta property="og:title" content="Govc User Guide" />
<meta property="og:description" content="Learn how to use govc." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2022-04/govc-usage/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-04-02T09:59:28+08:00" />
<meta property="article:modified_time" content="2022-04-02T09:59:28+08:00" />

<meta itemprop="name" content="Govc User Guide">
<meta itemprop="description" content="Learn how to use govc."><meta itemprop="datePublished" content="2022-04-02T09:59:28+08:00" />
<meta itemprop="dateModified" content="2022-04-02T09:59:28+08:00" />
<meta itemprop="wordCount" content="1842">
<meta itemprop="keywords" content="govc," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Govc User Guide"/>
<meta name="twitter:description" content="Learn how to use govc."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SOBYTE</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SOBYTE</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Govc User Guide</h1>

      <div class="post-meta">
        <span class="post-time"> 2022-04-02 09:59:28 </span>
        <div class="post-category">
            <a href="/categories/tutorials/"> tutorials </a>
            </div>
          <span class="more-meta"> 1842 words </span>
          <span class="more-meta"> 4 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#govc">govc</a></li>
        <li><a href="#get-host-information">Get host information</a>
          <ul>
            <li><a href="#govc-hostinfo"><code>govc host.info</code></a></li>
          </ul>
        </li>
        <li><a href="#configure-esxi-host-parameters">Configure ESXi host parameters</a></li>
        <li><a href="#enabling-the-ssh-service">Enabling the ssh service</a></li>
        <li><a href="#create-a-virtual-machine">Create a virtual machine</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>I recently needed to do some parameter configuration, virtual switch/net creation, virtual machine creation, VIB installation, PCI direct access, virtual machine creation, etc. on ESXi host for work reasons. So I took the time to sort out some of the pitfalls I encountered while using govc.</p>
<h2 id="govc">govc</h2>
<p><a href="https://github.com/vmware/govmomi/tree/master/govc">govc</a> is a wrapper implementation of the official VMware <a href="https://github.com/vmware/govmom">govmomi</a> library. It can be used to perform a number of operations on ESXi hosts or vCenter. For example, creating virtual machines, managing snapshots, etc. Basically, everything that can be done on ESXi or vCenter has an implementation in govmomi. Currently govc supports ESXi / vCenter versions 7.0, 6.7, 6.5 , 6.0 (5.x is too old, just give up), and also supports some versions of VMware Workstation.</p>
<p>Using govc to connect to an ESXi host or vCenter can be done by setting environment variables or command line arguments. It is recommended to use environment variables, as there is some security risk if the user name and password are output explicitly through the command line flag.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">Options:
</span></span><span class="line"><span class="cl">  -cert<span class="o">=</span>                           Certificate <span class="o">[</span>GOVC_CERTIFICATE<span class="o">]</span>
</span></span><span class="line"><span class="cl">  -dc<span class="o">=</span>                             Datacenter <span class="o">[</span>GOVC_DATACENTER<span class="o">]</span>
</span></span><span class="line"><span class="cl">  -debug<span class="o">=</span><span class="nb">false</span>                     Store debug logs <span class="o">[</span>GOVC_DEBUG<span class="o">]</span>
</span></span><span class="line"><span class="cl">  -dump<span class="o">=</span><span class="nb">false</span>                      Enable Go output
</span></span><span class="line"><span class="cl">  -host<span class="o">=</span>                           Host system <span class="o">[</span>GOVC_HOST<span class="o">]</span>
</span></span><span class="line"><span class="cl">  -host.dns<span class="o">=</span>                       Find host by FQDN
</span></span><span class="line"><span class="cl">  -host.ip<span class="o">=</span>                        Find host by IP address
</span></span><span class="line"><span class="cl">  -host.ipath<span class="o">=</span>                     Find host by inventory path
</span></span><span class="line"><span class="cl">  -host.uuid<span class="o">=</span>                      Find host by UUID
</span></span><span class="line"><span class="cl">  -json<span class="o">=</span><span class="nb">false</span>                      Enable JSON output
</span></span><span class="line"><span class="cl">  -k<span class="o">=</span><span class="nb">false</span>                         Skip verification of server certificate <span class="o">[</span>GOVC_INSECURE<span class="o">]</span>
</span></span><span class="line"><span class="cl">  -key<span class="o">=</span>                            Private key <span class="o">[</span>GOVC_PRIVATE_KEY<span class="o">]</span>
</span></span><span class="line"><span class="cl">  -persist-session<span class="o">=</span><span class="nb">true</span>            Persist session to disk <span class="o">[</span>GOVC_PERSIST_SESSION<span class="o">]</span>
</span></span><span class="line"><span class="cl">  -tls-ca-certs<span class="o">=</span>                   TLS CA certificates file <span class="o">[</span>GOVC_TLS_CA_CERTS<span class="o">]</span>
</span></span><span class="line"><span class="cl">  -tls-known-hosts<span class="o">=</span>                TLS known hosts file <span class="o">[</span>GOVC_TLS_KNOWN_HOSTS<span class="o">]</span>
</span></span><span class="line"><span class="cl">  -trace<span class="o">=</span><span class="nb">false</span>                     Write SOAP/REST traffic to stderr
</span></span><span class="line"><span class="cl">  -u<span class="o">=</span>https://root@esxi.yoi.li/sdk  ESX or vCenter URL <span class="o">[</span>GOVC_URL<span class="o">]</span>
</span></span><span class="line"><span class="cl">  -verbose<span class="o">=</span><span class="nb">false</span>                   Write request/response data to stderr
</span></span><span class="line"><span class="cl">  -vim-namespace<span class="o">=</span>vim25             Vim namespace <span class="o">[</span>GOVC_VIM_NAMESPACE<span class="o">]</span>
</span></span><span class="line"><span class="cl">  -vim-version<span class="o">=</span>7.0                 Vim version <span class="o">[</span>GOVC_VIM_VERSION<span class="o">]</span>
</span></span><span class="line"><span class="cl">  -xml<span class="o">=</span><span class="nb">false</span>                       Enable XML output
</span></span></code></pre></td></tr></table>
</div>
</div><p>Specify the URL of the ESXi host or vCenter with the <code>GOVC_URL</code> environment variable. The login username and password can be set in the GOVC_URL or separately with <code>GOVC_USERNAME</code> and <code>GOVC_PASSWORD</code>. If the https certificate is a self-signed domain or IP, you need to set the <code>GOVC_INSECURE=true</code> parameter to allow unsecured https connections.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ <span class="nb">export</span> <span class="nv">GOVC_URL</span><span class="o">=</span><span class="s2">&#34;https://root:password@esxi.k8s.li&#34;</span>
</span></span><span class="line"><span class="cl">$ <span class="nb">export</span> <span class="nv">GOVC_INSECURE</span><span class="o">=</span><span class="nb">true</span>
</span></span><span class="line"><span class="cl">$ govc about
</span></span><span class="line"><span class="cl">FullName:     VMware ESXi 7.0.2 build-17867351
</span></span><span class="line"><span class="cl">Name:         VMware ESXi
</span></span><span class="line"><span class="cl">Vendor:       VMware, Inc.
</span></span><span class="line"><span class="cl">Version:      7.0.2
</span></span><span class="line"><span class="cl">Build:        <span class="m">17867351</span>
</span></span><span class="line"><span class="cl">OS type:      vmnix-x86
</span></span><span class="line"><span class="cl">API type:     HostAgent
</span></span><span class="line"><span class="cl">API version:  7.0.2.0
</span></span><span class="line"><span class="cl">Product ID:   embeddedEsx
</span></span><span class="line"><span class="cl">UUID:
</span></span></code></pre></td></tr></table>
</div>
</div><p>If the username and password have special characters like <code>\ @ /</code>, it is recommended to set <code>GOVC_URL</code>, <code>GOVC_USERNAME</code> and <code>GOVC_PASSWORD</code> respectively. This will avoid some strange problems with special characters in <code>GOVC_URL</code>.</p>
<h2 id="get-host-information">Get host information</h2>
<h3 id="govc-hostinfo"><code>govc host.info</code></h3>
<p>You can get basic information about an ESXi host by using the host.info self-command</p>
<ul>
<li>Path: The resource path of the current host in the cluster</li>
<li>Manufacturer: Hardware device manufacturer</li>
<li>Logical CPUs: The number of logical CPUs and the base frequency of the CPUs</li>
<li>Processor type: The specific model of the CPU, since I have ES version E-2126G, I can&rsquo;t show the specific model 🤣</li>
<li>CPU usage: the load of CPU usage</li>
<li>Memory: the amount of memory installed in the host</li>
<li>Memory usage: the load of memory usage</li>
<li>Boot time: Boot time</li>
<li>State: Connection status</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ govc host.info
</span></span><span class="line"><span class="cl">Name:              hp-esxi.lan
</span></span><span class="line"><span class="cl">  Path:            /ha-datacenter/host/hp-esxi.lan/hp-esxi.lan
</span></span><span class="line"><span class="cl">  Manufacturer:    HPE
</span></span><span class="line"><span class="cl">  Logical CPUs:    <span class="m">6</span> CPUs @ 3000MHz
</span></span><span class="line"><span class="cl">  Processor type:  Genuine Intel<span class="o">(</span>R<span class="o">)</span> CPU <span class="m">0000</span> @ 3.00GHz
</span></span><span class="line"><span class="cl">  CPU usage:       <span class="m">3444</span> MHz <span class="o">(</span>19.1%<span class="o">)</span>
</span></span><span class="line"><span class="cl">  Memory:          32613MB
</span></span><span class="line"><span class="cl">  Memory usage:    <span class="m">26745</span> MB <span class="o">(</span>82.0%<span class="o">)</span>
</span></span><span class="line"><span class="cl">  Boot time:       2021-12-05 06:11:53.42802 +0000 UTC
</span></span><span class="line"><span class="cl">  State:           connected
</span></span></code></pre></td></tr></table>
</div>
</div><p>If you add the <code>-json</code> parameter you will get a json output of at least 3w lines containing all the information about the ESXi host, and then you can use the jq command to filter out some of the parameters you need.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">╭─root@esxi-debian-devbox ~
</span></span><span class="line"><span class="cl">╰─# govc host.info -json<span class="o">=</span><span class="nb">true</span> &gt; host_info.json
</span></span><span class="line"><span class="cl">╭─root@esxi-debian-devbox ~
</span></span><span class="line"><span class="cl">╰─# wc host_info.json
</span></span><span class="line"><span class="cl">  <span class="m">34522</span>   <span class="m">73430</span> <span class="m">1188718</span> host_info.json
</span></span><span class="line"><span class="cl">╭─root@esxi-debian-devbox ~
</span></span><span class="line"><span class="cl">╰─# govc host.info -json <span class="p">|</span> jq <span class="s1">&#39;.HostSystems[0].Summary.Hardware&#39;</span>
</span></span><span class="line"><span class="cl"><span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;Vendor&#34;</span>: <span class="s2">&#34;HPE&#34;</span>,
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;Model&#34;</span>: <span class="s2">&#34;ProLiant MicroServer Gen10 Plus&#34;</span>,
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;Uuid&#34;</span>: <span class="s2">&#34;30363150&#34;</span>,
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;MemorySize&#34;</span>: 34197471232,
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;CpuModel&#34;</span>: <span class="s2">&#34;Genuine Intel(R) CPU 0000 @ 3.00GHz&#34;</span>,
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;CpuMhz&#34;</span>: 3000,
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;NumCpuPkgs&#34;</span>: 1,
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;NumCpuCores&#34;</span>: 6,
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;NumCpuThreads&#34;</span>: 6,
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;NumNics&#34;</span>: 4,
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;NumHBAs&#34;</span>: <span class="m">3</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>If you add the <code>-dump</code> argument, the output is in the format of a Golang structure, which also contains all the information about the ESXi host, and you can use it to locate the structure of a certain piece of information relatively easily. This is very convenient for developing other functions based on govmomi. In particular, when writing unit tests, you can dump some data from here to mock. Note that not all subcommands support output in json format.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">mo</span><span class="p">.</span><span class="nx">HostSystem</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">ManagedEntity</span><span class="p">:</span> <span class="nx">mo</span><span class="p">.</span><span class="nx">ManagedEntity</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">ExtensibleManagedObject</span><span class="p">:</span> <span class="nx">mo</span><span class="p">.</span><span class="nx">ExtensibleManagedObject</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">Self</span><span class="p">:</span>           <span class="nx">types</span><span class="p">.</span><span class="nx">ManagedObjectReference</span><span class="p">{</span><span class="nx">Type</span><span class="p">:</span><span class="s">&#34;HostSystem&#34;</span><span class="p">,</span> <span class="nx">Value</span><span class="p">:</span><span class="s">&#34;ha-host&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="nx">Value</span><span class="p">:</span>          <span class="kc">nil</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nx">AvailableField</span><span class="p">:</span> <span class="kc">nil</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="nx">Parent</span><span class="p">:</span>        <span class="o">&amp;</span><span class="nx">types</span><span class="p">.</span><span class="nx">ManagedObjectReference</span><span class="p">{</span><span class="nx">Type</span><span class="p">:</span><span class="s">&#34;ComputeResource&#34;</span><span class="p">,</span> <span class="nx">Value</span><span class="p">:</span><span class="s">&#34;ha-compute-res&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="nx">CustomValue</span><span class="p">:</span>   <span class="kc">nil</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">OverallStatus</span><span class="p">:</span> <span class="s">&#34;green&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">ConfigStatus</span><span class="p">:</span>  <span class="s">&#34;yellow&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">ConfigIssue</span><span class="p">:</span>   <span class="p">[]</span><span class="nx">types</span><span class="p">.</span><span class="nx">BaseEvent</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="o">&amp;</span><span class="nx">types</span><span class="p">.</span><span class="nx">RemoteTSMEnabledEvent</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nx">HostEvent</span><span class="p">:</span> <span class="nx">types</span><span class="p">.</span><span class="nx">HostEvent</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="nx">Event</span><span class="p">:</span> <span class="nx">types</span><span class="p">.</span><span class="nx">Event</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">                        <span class="nx">Key</span><span class="p">:</span>             <span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="nx">ChainId</span><span class="p">:</span>         <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="nx">CreatedTime</span><span class="p">:</span>     <span class="nx">time</span><span class="p">.</span><span class="nf">Now</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">                        <span class="nx">UserName</span><span class="p">:</span>        <span class="s">&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="nx">Datacenter</span><span class="p">:</span>      <span class="p">(</span><span class="o">*</span><span class="nx">types</span><span class="p">.</span><span class="nx">DatacenterEventArgument</span><span class="p">)(</span><span class="kc">nil</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                        <span class="nx">ComputeResource</span><span class="p">:</span> <span class="p">(</span><span class="o">*</span><span class="nx">types</span><span class="p">.</span><span class="nx">ComputeResourceEventArgument</span><span class="p">)(</span><span class="kc">nil</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                        <span class="nx">Host</span><span class="p">:</span>            <span class="o">&amp;</span><span class="nx">types</span><span class="p">.</span><span class="nx">HostEventArgument</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">                            <span class="nx">EntityEventArgument</span><span class="p">:</span> <span class="nx">types</span><span class="p">.</span><span class="nx">EntityEventArgument</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">                                <span class="nx">EventArgument</span><span class="p">:</span> <span class="nx">types</span><span class="p">.</span><span class="nx">EventArgument</span><span class="p">{},</span>
</span></span><span class="line"><span class="cl">                                <span class="nx">Name</span><span class="p">:</span>          <span class="s">&#34;hp-esxi.lan&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="p">},</span>
</span></span><span class="line"><span class="cl">                            <span class="nx">Host</span><span class="p">:</span> <span class="nx">types</span><span class="p">.</span><span class="nx">ManagedObjectReference</span><span class="p">{</span><span class="nx">Type</span><span class="p">:</span><span class="s">&#34;HostSystem&#34;</span><span class="p">,</span> <span class="nx">Value</span><span class="p">:</span><span class="s">&#34;ha-host&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">                        <span class="p">},</span>
</span></span><span class="line"><span class="cl">                        <span class="nx">Vm</span><span class="p">:</span>                   <span class="p">(</span><span class="o">*</span><span class="nx">types</span><span class="p">.</span><span class="nx">VmEventArgument</span><span class="p">)(</span><span class="kc">nil</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                        <span class="nx">Ds</span><span class="p">:</span>                   <span class="p">(</span><span class="o">*</span><span class="nx">types</span><span class="p">.</span><span class="nx">DatastoreEventArgument</span><span class="p">)(</span><span class="kc">nil</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                        <span class="nx">Net</span><span class="p">:</span>                  <span class="p">(</span><span class="o">*</span><span class="nx">types</span><span class="p">.</span><span class="nx">NetworkEventArgument</span><span class="p">)(</span><span class="kc">nil</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                        <span class="nx">Dvs</span><span class="p">:</span>                  <span class="p">(</span><span class="o">*</span><span class="nx">types</span><span class="p">.</span><span class="nx">DvsEventArgument</span><span class="p">)(</span><span class="kc">nil</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                        <span class="nx">FullFormattedMessage</span><span class="p">:</span> <span class="s">&#34;SSH for the host hp-esxi.lan has been enabled&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="nx">ChangeTag</span><span class="p">:</span>            <span class="s">&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="p">},</span>
</span></span><span class="line"><span class="cl">                <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>When writing unit tests, I often use it to mock some special hardware device information, which is much easier than writing these structs by hand. For example, a drive named <code>mpx.vmhba&lt;Adapter&gt;:C&lt;Channel&gt;:T&lt;Target&gt;:L&lt;LUN&gt;</code> can be used to get the NAA number of the drive using the <code>PlugStoreTopology</code> structure.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">getDiskIDByHostPlugStoreTopology</span><span class="p">(</span><span class="nx">hpst</span> <span class="o">*</span><span class="nx">types</span><span class="p">.</span><span class="nx">HostPlugStoreTopology</span><span class="p">,</span> <span class="nx">diskName</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">string</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">path</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">hpst</span><span class="p">.</span><span class="nx">Path</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nx">path</span><span class="p">.</span><span class="nx">Name</span> <span class="o">==</span> <span class="nx">diskName</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">s</span> <span class="o">:=</span> <span class="nx">strings</span><span class="p">.</span><span class="nf">Split</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">Target</span><span class="p">,</span> <span class="s">&#34;-sas.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="nx">s</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="s">&#34;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 单元测试代码如下：
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">var</span> <span class="nx">plugStoreTopology</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">types</span><span class="p">.</span><span class="nx">HostPlugStoreTopology</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">Path</span><span class="p">:</span> <span class="p">[]</span><span class="nx">types</span><span class="p">.</span><span class="nx">HostPlugStoreTopologyPath</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">Key</span><span class="p">:</span>           <span class="s">&#34;key-vim.host.PlugStoreTopology.Path-vmhba0:C0:T1:L0&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nx">Name</span><span class="p">:</span>          <span class="s">&#34;vmhba0:C0:T1:L0&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nx">ChannelNumber</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nx">TargetNumber</span><span class="p">:</span>  <span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nx">LunNumber</span><span class="p">:</span>     <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nx">Adapter</span><span class="p">:</span>       <span class="s">&#34;key-vim.host.PlugStoreTopology.Adapter-vmhba0&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nx">Target</span><span class="p">:</span>        <span class="s">&#34;key-vim.host.PlugStoreTopology.Target-sas.500056b3d93828c0&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nx">Device</span><span class="p">:</span>        <span class="s">&#34;key-vim.host.PlugStoreTopology.Device-020000000055cd2e414dc39d4e494e54454c20&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">TestGetDiskIDByHostPlugStoreTopology</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">tests</span> <span class="o">:=</span> <span class="p">[]</span><span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">name</span> <span class="kt">string</span>
</span></span><span class="line"><span class="cl">        <span class="nx">want</span> <span class="kt">string</span>
</span></span><span class="line"><span class="cl">    <span class="p">}{</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">name</span><span class="p">:</span> <span class="s">&#34;vmhba0:C0:T1:L0&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nx">want</span><span class="p">:</span> <span class="s">&#34;500056b3d93828c0&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">name</span><span class="p">:</span> <span class="s">&#34;vmhba0:C0:T2:L0&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nx">want</span><span class="p">:</span> <span class="s">&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">name</span><span class="p">:</span> <span class="s">&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nx">want</span><span class="p">:</span> <span class="s">&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">tt</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">tests</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">t</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="nx">tt</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="nx">got</span> <span class="o">:=</span> <span class="nf">getDiskIDByHostPlugStoreTopology</span><span class="p">(</span><span class="nx">plugStoreTopology</span><span class="p">,</span> <span class="nx">tt</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span> <span class="nx">got</span> <span class="o">!=</span> <span class="nx">tt</span><span class="p">.</span><span class="nx">want</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nx">t</span><span class="p">.</span><span class="nf">Errorf</span><span class="p">(</span><span class="s">&#34;getDiskIDByHostPlugStoreTopology() = %v, want %v&#34;</span><span class="p">,</span> <span class="nx">got</span><span class="p">,</span> <span class="nx">tt</span><span class="p">.</span><span class="nx">want</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>For example, an NVMe drive can get its serial number from the <code>NvmeTopology</code> data object.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">getNVMeIDByHostNvmeTopology</span><span class="p">(</span><span class="nx">hnt</span> <span class="o">*</span><span class="nx">types</span><span class="p">.</span><span class="nx">HostNvmeTopology</span><span class="p">,</span> <span class="nx">diskName</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">string</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">adapter</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">hnt</span><span class="p">.</span><span class="nx">Adapter</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">controller</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">adapter</span><span class="p">.</span><span class="nx">ConnectedController</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">ns</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">controller</span><span class="p">.</span><span class="nx">AttachedNamespace</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="nx">ns</span><span class="p">.</span><span class="nx">Name</span> <span class="o">==</span> <span class="nx">diskName</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="k">return</span> <span class="nx">strings</span><span class="p">.</span><span class="nf">TrimSpace</span><span class="p">(</span><span class="nx">controller</span><span class="p">.</span><span class="nx">SerialNumber</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="s">&#34;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 单元测试代码如下：
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">var</span> <span class="nx">nvmeTopology</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">types</span><span class="p">.</span><span class="nx">HostNvmeTopology</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">Adapter</span><span class="p">:</span> <span class="p">[]</span><span class="nx">types</span><span class="p">.</span><span class="nx">HostNvmeTopologyInterface</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">Key</span><span class="p">:</span>     <span class="s">&#34;key-vim.host.NvmeTopology.Interface-vmhba0&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nx">Adapter</span><span class="p">:</span> <span class="s">&#34;key-vim.host.PcieHba-vmhba0&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nx">ConnectedController</span><span class="p">:</span> <span class="p">[]</span><span class="nx">types</span><span class="p">.</span><span class="nx">HostNvmeController</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="nx">Key</span><span class="p">:</span>                     <span class="s">&#34;key-vim.host.NvmeController-256&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="nx">ControllerNumber</span><span class="p">:</span>        <span class="mi">256</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="nx">Subnqn</span><span class="p">:</span>                  <span class="s">&#34;nqn.2021-06.com.intel:PHAB123502CU1P9SGN  &#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="nx">Name</span><span class="p">:</span>                    <span class="s">&#34;nqn.2021-06.com.intel:PHAB123502CU1P9SGN&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="nx">AssociatedAdapter</span><span class="p">:</span>       <span class="s">&#34;key-vim.host.PcieHba-vmhba0&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="nx">TransportType</span><span class="p">:</span>           <span class="s">&#34;pcie&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="nx">FusedOperationSupported</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="nx">NumberOfQueues</span><span class="p">:</span>          <span class="mi">2</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="nx">QueueSize</span><span class="p">:</span>               <span class="mi">1024</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="nx">AttachedNamespace</span><span class="p">:</span> <span class="p">[]</span><span class="nx">types</span><span class="p">.</span><span class="nx">HostNvmeNamespace</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">                        <span class="p">{</span>
</span></span><span class="line"><span class="cl">                            <span class="nx">Key</span><span class="p">:</span>              <span class="s">&#34;key-vim.host.NvmeNamespace-t10.NVMe____Dell_Ent_NVMe_P5600_MU_U.2_1.6TB________00035CB406E4D25C@256&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="nx">Name</span><span class="p">:</span>             <span class="s">&#34;t10.NVMe____Dell_Ent_NVMe_P5600_MU_U.2_1.6TB________00035CB406E4D25C&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="nx">Id</span><span class="p">:</span>               <span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="nx">BlockSize</span><span class="p">:</span>        <span class="mi">512</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="nx">CapacityInBlocks</span><span class="p">:</span> <span class="mi">3125627568</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="p">},</span>
</span></span><span class="line"><span class="cl">                    <span class="p">},</span>
</span></span><span class="line"><span class="cl">                    <span class="nx">VendorId</span><span class="p">:</span>        <span class="s">&#34;0x8086&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="nx">Model</span><span class="p">:</span>           <span class="s">&#34;Dell Ent NVMe P5600 MU U.2 1.6TB        &#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="nx">SerialNumber</span><span class="p">:</span>    <span class="s">&#34;PHAB123502CU1P9SGN  &#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="nx">FirmwareVersion</span><span class="p">:</span> <span class="s">&#34;1.0.0   PCIe&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">Key</span><span class="p">:</span>     <span class="s">&#34;key-vim.host.NvmeTopology.Interface-vmhba1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nx">Adapter</span><span class="p">:</span> <span class="s">&#34;key-vim.host.PcieHba-vmhba1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nx">ConnectedController</span><span class="p">:</span> <span class="p">[]</span><span class="nx">types</span><span class="p">.</span><span class="nx">HostNvmeController</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="nx">Key</span><span class="p">:</span>                     <span class="s">&#34;key-vim.host.NvmeController-257&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="nx">ControllerNumber</span><span class="p">:</span>        <span class="mi">257</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="nx">Subnqn</span><span class="p">:</span>                  <span class="s">&#34;nqn.2021-06.com.intel:PHAB123602H81P9SGN  &#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="nx">Name</span><span class="p">:</span>                    <span class="s">&#34;nqn.2021-06.com.intel:PHAB123602H81P9SGN&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="nx">AssociatedAdapter</span><span class="p">:</span>       <span class="s">&#34;key-vim.host.PcieHba-vmhba1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="nx">TransportType</span><span class="p">:</span>           <span class="s">&#34;pcie&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="nx">FusedOperationSupported</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="nx">NumberOfQueues</span><span class="p">:</span>          <span class="mi">2</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="nx">QueueSize</span><span class="p">:</span>               <span class="mi">1024</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="nx">AttachedNamespace</span><span class="p">:</span> <span class="p">[]</span><span class="nx">types</span><span class="p">.</span><span class="nx">HostNvmeNamespace</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">                        <span class="p">{</span>
</span></span><span class="line"><span class="cl">                            <span class="nx">Key</span><span class="p">:</span>              <span class="s">&#34;key-vim.host.NvmeNamespace-t10.NVMe____Dell_Ent_NVMe_P5600_MU_U.2_1.6TB________00035CEE23E4D25C@257&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="nx">Name</span><span class="p">:</span>             <span class="s">&#34;t10.NVMe____Dell_Ent_NVMe_P5600_MU_U.2_1.6TB________00035CEE23E4D25C&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="nx">Id</span><span class="p">:</span>               <span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="nx">BlockSize</span><span class="p">:</span>        <span class="mi">512</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="nx">CapacityInBlocks</span><span class="p">:</span> <span class="mi">3125627568</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="p">},</span>
</span></span><span class="line"><span class="cl">                    <span class="p">},</span>
</span></span><span class="line"><span class="cl">                    <span class="nx">VendorId</span><span class="p">:</span>        <span class="s">&#34;0x8086&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="nx">Model</span><span class="p">:</span>           <span class="s">&#34;Dell Ent NVMe P5600 MU U.2 1.6TB        &#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="nx">SerialNumber</span><span class="p">:</span>    <span class="s">&#34;PHAB123602H81P9SGN  &#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="nx">FirmwareVersion</span><span class="p">:</span> <span class="s">&#34;1.0.0   PCIe&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">TestGetNVMeIDByHostNvmeTopology</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">tests</span> <span class="o">:=</span> <span class="p">[]</span><span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">name</span> <span class="kt">string</span>
</span></span><span class="line"><span class="cl">        <span class="nx">want</span> <span class="kt">string</span>
</span></span><span class="line"><span class="cl">    <span class="p">}{</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">name</span><span class="p">:</span> <span class="s">&#34;t10.NVMe____Dell_Ent_NVMe_P5600_MU_U.2_1.6TB________00035CEE23E4D25C&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nx">want</span><span class="p">:</span> <span class="s">&#34;PHAB123602H81P9SGN&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">name</span><span class="p">:</span> <span class="s">&#34;t10.NVMe____Dell_Ent_NVMe_P5600_MU_U.2_1.6TB&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nx">want</span><span class="p">:</span> <span class="s">&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">name</span><span class="p">:</span> <span class="s">&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nx">want</span><span class="p">:</span> <span class="s">&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">tt</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">tests</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">t</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="nx">tt</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="nx">got</span> <span class="o">:=</span> <span class="nf">getNVMeIDByHostNvmeTopology</span><span class="p">(</span><span class="nx">nvmeTopology</span><span class="p">,</span> <span class="nx">tt</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span> <span class="nx">got</span> <span class="o">!=</span> <span class="nx">tt</span><span class="p">.</span><span class="nx">want</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nx">t</span><span class="p">.</span><span class="nf">Errorf</span><span class="p">(</span><span class="s">&#34;getNVMeIDByHostNvmeTopology() = %v, want %v&#34;</span><span class="p">,</span> <span class="nx">got</span><span class="p">,</span> <span class="nx">tt</span><span class="p">.</span><span class="nx">want</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="configure-esxi-host-parameters">Configure ESXi host parameters</h2>
<p>The <code>host.options.ls</code> allows you to list all configuration options for the current ESXi host.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ govc host.option.ls
</span></span><span class="line"><span class="cl">Annotations.WelcomeMessage:
</span></span><span class="line"><span class="cl">BufferCache.FlushInterval:                          <span class="m">30000</span>
</span></span><span class="line"><span class="cl">BufferCache.HardMaxDirty:                           <span class="m">95</span>
</span></span><span class="line"><span class="cl">BufferCache.PerFileHardMaxDirty:                    <span class="m">50</span>
</span></span><span class="line"><span class="cl">BufferCache.SoftMaxDirty:                           <span class="m">15</span>
</span></span><span class="line"><span class="cl">CBRC.DCacheMemReserved:                             <span class="m">400</span>
</span></span><span class="line"><span class="cl">CBRC.Enable:                                        <span class="nb">false</span>
</span></span><span class="line"><span class="cl">COW.COWMaxHeapSizeMB:                               <span class="m">192</span>
</span></span><span class="line"><span class="cl">COW.COWMaxREPageCacheszMB:                          <span class="m">256</span>
</span></span><span class="line"><span class="cl">COW.COWMinREPageCacheszMB:                          <span class="m">0</span>
</span></span><span class="line"><span class="cl">COW.COWREPageCacheEviction:                         <span class="m">1</span>
</span></span><span class="line"><span class="cl">Config.Defaults.host.TAAworkaround:                 <span class="nb">true</span>
</span></span><span class="line"><span class="cl">Config.Defaults.monitor.if_pschange_mc_workaround:  <span class="nb">false</span>
</span></span><span class="line"><span class="cl">Config.Defaults.security.host.ruissl:               <span class="nb">true</span>
</span></span><span class="line"><span class="cl">Config.Defaults.vGPU.consolidation:                 <span class="nb">false</span>
</span></span><span class="line"><span class="cl">Config.Etc.issue:
</span></span><span class="line"><span class="cl">Config.Etc.motd:                                    The <span class="nb">time</span> and date of this login have been sent to the system logs.
</span></span></code></pre></td></tr></table>
</div>
</div><p>ESXi host parameters can be set via <code>host.option.set</code>, for example if you want to configure the NFS storage heartbeat timeout you can do so as follows.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ govc host.option.set NFS.HeartbeatTimeout <span class="m">30</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="enabling-the-ssh-service">Enabling the ssh service</h2>
<p>The <code>host.service</code> allows you to perform related operations on the services on the ESXi host.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ govc host.service
</span></span><span class="line"><span class="cl">Where ACTION is one of: start, stop, restart, status, enable, disable
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 启动 ssh 服务</span>
</span></span><span class="line"><span class="cl">$ govc host.service start TSM-SSH
</span></span><span class="line"><span class="cl"><span class="c1"># 将 ssh 服务设置为开机自启</span>
</span></span><span class="line"><span class="cl">$ govc host.service <span class="nb">enable</span> TSM-SSH
</span></span><span class="line"><span class="cl"><span class="c1"># 查看 ssh 服务的状态</span>
</span></span><span class="line"><span class="cl">$ govc host.service status TSM-SSH
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="create-a-virtual-machine">Create a virtual machine</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ <span class="nv">VM_NAME</span><span class="o">=</span><span class="s2">&#34;centos-test&#34;</span>
</span></span><span class="line"><span class="cl">$ govc vm.create -ds<span class="o">=</span><span class="s1">&#39;datastore*&#39;</span> -net<span class="o">=</span><span class="s1">&#39;VM Network&#39;</span> -net.adapter<span class="o">=</span>vmxnet3 -disk 1G -on<span class="o">=</span><span class="nb">false</span> <span class="si">${</span><span class="nv">VM_NAME</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">$ govc vm.change -cpu.reservation<span class="o">=</span>%d -memory-pin<span class="o">=</span><span class="nb">true</span> -vm <span class="si">${</span><span class="nv">VM_NAME</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">$ govc vm.change -g centos7_64Guest -c %d -m <span class="m">16384</span> -latency high -vm <span class="si">${</span><span class="nv">VM_NAME</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">$ govc device.cdrom.add -vm <span class="si">${</span><span class="nv">VM_NAME</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">$ govc device.cdrom.insert -vm <span class="si">${</span><span class="nv">VM_NAME</span><span class="si">}</span> -device cdrom-3000
</span></span><span class="line"><span class="cl">$ govc device.connect -vm <span class="si">${</span><span class="nv">VM_NAME</span><span class="si">}</span> cdrom-3000
</span></span><span class="line"><span class="cl">$ govc vm.power -on<span class="o">=</span><span class="nb">true</span> <span class="si">${</span><span class="nv">VM_NAME</span><span class="si">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div>
    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/govc/">govc</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2022-04/golang-escape-analysis/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Golang Escape Analysis</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2022-04/golang-string-concatenation/">
            <span class="next-text nav-default">Golang&#39;s efficient string concatenation method</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  <script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox-3.1.20.min.js"></script>



<script type="text/javascript" src="/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
