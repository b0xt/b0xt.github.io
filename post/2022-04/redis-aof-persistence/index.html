<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Redis&#39; AOF persistence principle - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="Learn how Redis&#39; AOF persistence works." /><meta name="keywords" content="redis, aof, Persistence" />






<meta name="generator" content="Hugo 0.96.0 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2022-04/redis-aof-persistence/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link href="/lib/fancybox/jquery.fancybox-3.1.20.min.css" rel="stylesheet">


<meta property="og:title" content="Redis&#39; AOF persistence principle" />
<meta property="og:description" content="Learn how Redis&#39; AOF persistence works." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2022-04/redis-aof-persistence/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-04-19T13:33:17+08:00" />
<meta property="article:modified_time" content="2022-04-19T13:33:17+08:00" />

<meta itemprop="name" content="Redis&#39; AOF persistence principle">
<meta itemprop="description" content="Learn how Redis&#39; AOF persistence works."><meta itemprop="datePublished" content="2022-04-19T13:33:17+08:00" />
<meta itemprop="dateModified" content="2022-04-19T13:33:17+08:00" />
<meta itemprop="wordCount" content="3540">
<meta itemprop="keywords" content="redis," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Redis&#39; AOF persistence principle"/>
<meta name="twitter:description" content="Learn how Redis&#39; AOF persistence works."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SOBYTE</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SOBYTE</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Redis&#39; AOF persistence principle</h1>

      <div class="post-meta">
        <span class="post-time"> 2022-04-19 13:33:17 </span>
        <div class="post-category">
            <a href="/categories/tutorials/"> tutorials </a>
            </div>
          <span class="more-meta"> 3540 words </span>
          <span class="more-meta"> 8 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#basic-introduction">Basic Introduction</a></li>
        <li><a href="#persistence-implementation">Persistence Implementation</a>
          <ul>
            <li><a href="#command-append">Command append</a></li>
            <li><a href="#writing-and-synchronization">Writing and Synchronization</a></li>
            <li><a href="#aof-persistence-and-efficiency">AOF persistence and efficiency</a></li>
            <li><a href="#aof-file-loading-and-data-restoration">AOF file loading and data restoration</a></li>
            <li><a href="#aof-rewriting">AOF rewriting</a></li>
            <li><a href="#implementation-of-aof-file-rewriting">Implementation of AOF file rewriting</a></li>
            <li><a href="#aof-background-rewrites">AOF background rewrites</a></li>
          </ul>
        </li>
        <li><a href="#summary">Summary</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>Redis provides two separate persistence mechanisms, RDB and AOF. This chapter first describes how the AOF feature works, how commands are stored in AOF files, and how different AOF storage modes affect data security and Redis performance. After that, we will introduce the method of restoring the database state from the AOF file and the implementation mechanism behind the method. Some pseudo-code will also be used to facilitate understanding. This article is based on the redis design and implementation book. The knowledge about redis persistence is more important, so I read the book directly to avoid detours, and record it in this article.</p>
<h2 id="basic-introduction">Basic Introduction</h2>
<p><code>AOF</code> persistence is used to record database state by saving the write commands executed by the <code>redis</code> server.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="nb">set</span> key1 value1
</span></span><span class="line"><span class="cl">sadd fruits <span class="s2">&#34;apple&#34;</span> <span class="s2">&#34;banner&#34;</span>
</span></span><span class="line"><span class="cl">rpush numbers <span class="m">128</span> <span class="m">125</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The RDB persistence method is to save the key-value pairs of key1, fruits, and numbers to the RDB file, while the AOF persistence method is to save the set, sadd, and rpush commands executed by the server to the AOF file, and all commands written to the AOF file are saved in the Redis command request protocol format.</p>
<h2 id="persistence-implementation">Persistence Implementation</h2>
<p>The implementation of the <code>AOF</code> persistence function can be divided into three steps (sync): <strong>append</strong>, <strong>write</strong>, and <strong>synchronize</strong>.</p>
<h3 id="command-append">Command append</h3>
<p>When <code>AOF</code> persistence is on, the server appends the executed write command to the end of the <code>aof_buf</code> buffer of the server state in protocol format after executing a write command.</p>
<h3 id="writing-and-synchronization">Writing and Synchronization</h3>
<p>The server process in <code>Redis</code> is an <strong>event loop</strong>, where file events are responsible for receiving command requests from clients and sending command replies to clients, and time events are responsible for executing functions like the <code>serverCron</code> function that need to be run at regular intervals.
Because the server may execute commands while processing file events, causing some content to be appended to the <code>aof_buf</code> buffer, before the server ends an event loop, it calls the <code>flushAppendOnlyFile</code> function to consider whether the contents of the <code>aof_buf</code> buffer need to be written and saved to the <code>AOF</code> file The following is the pseudo-code.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="c1">#事件轮询函数</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">evenloop</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">　　<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">       <span class="c1"># 处理文件事件，接收命令请求以及发送命令回复</span>
</span></span><span class="line"><span class="cl">       <span class="c1"># 处理命令请求时可能会有新的内容被追加到 aof_buf 缓存区中</span>
</span></span><span class="line"><span class="cl">       <span class="n">processFileEvents</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">       <span class="c1"># 处理时间事件</span>
</span></span><span class="line"><span class="cl">       <span class="n">processTimeEvents</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">　　　　<span class="c1"># 是否将 aof_buf 缓冲区中的内容写入并同步到 appendonly.aof 文件中。</span>
</span></span><span class="line"><span class="cl">       <span class="n">flushAppendOnlyFile</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The behavior of the flushAppendOnlyFile function is determined by the value of the appendfsync option configured by the server, and the different values produce the following behavior.</p>
<table>
<thead>
<tr>
<th>Options</th>
<th>Behaviors</th>
</tr>
</thead>
<tbody>
<tr>
<td>always</td>
<td>Write and synchronize all contents of the aof_buf buffer to the AOF file (safest, but poor performance)</td>
</tr>
<tr>
<td>everysec</td>
<td>Writes and synchronizes all the contents of the aof_buf buffer to the AOF file, and then synchronizes the AOF file again if the last time the AOF file was synchronized was more than 1 second ago. (safe, better performance)</td>
</tr>
<tr>
<td>no</td>
<td>Writes and synchronizes all the contents of the aof_buf buffer to the AOF file, but does not synchronize the AOF file; it is generally up to the operating system to decide when to synchronize. (typically 30 seconds, unsafe, best performance)）</td>
</tr>
</tbody>
</table>
<p>If the user does not actively set a value for the appendfsync option, then the appendfsync option defaults to everysec. For more information on the appendfsync option, see the sample configuration file redis.conf that comes with the Redis project.</p>
<blockquote>
<p>To improve the efficiency of writing to files, in modern operating systems, when the user calls the write function to write some data to a file, the operating system usually stores the written data in a memory buffer temporarily and waits until the buffer is full or the specified time limit has passed before actually writing the data in the buffer to disk.
This approach improves efficiency, but also creates a security problem for writing data, because if the computer is down, the write data stored in the memory buffer will be lost.
For this reason, two synchronization functions, fsync and fdatasynce, are provided to force the operating system to write the data in the buffer to the hard disk immediately, thus ensuring the security of the written data.</p>
</blockquote>
<h3 id="aof-persistence-and-efficiency">AOF persistence and efficiency</h3>
<p>The value of the server configuration <code>appendfsync</code> option directly determines the efficiency and security of the <code>AOF</code> persistence feature.</p>
<ul>
<li>When the value of <code>appendfsync</code> is always, the server writes all the contents of the <code>aof_buf</code> buffer to the <code>AOF</code> file in each event loop and synchronizes the <code>AOF</code> file, so always is the slowest of the three values of the <code>appendfsync</code> option, but in terms of security, always is also the safest. always is also the safest in terms of security, because even if there is a crash, <code>AOF</code> persistence will only lose the command data generated in an event loop.</li>
<li>When the value of <code>appendfsync</code> is everysec, the server writes all the contents of the <code>aof_buf</code> buffer to the <code>AOF</code> file in each event loop, and synchronizes the <code>AOF</code> file in a subthread every second. In terms of efficiency, everysec mode is fast enough, and even if there is a downtime, the database will only lose one second of command data.</li>
<li>When the value of <code>appendfsync</code> is <code>no</code>, the server writes all the contents of the <code>aof_buf</code> buffer to the <code>AOF</code> file in each event loop, and it is up to the operating system to control when the <code>AOF</code> file is synchronized. Because the <code>flushAppendonlyFile</code> call in <code>no</code> mode does not require a synchronization operation, the <code>AOF</code> file writes in this mode are always the fastest, but because this mode accumulates write data in the system cache for a period of time, the single synchronization time in this mode is usually the longest of the three modes. From the standpoint of spreading operations, the <code>no</code> mode is similar in efficiency to the <code>everysec</code> mode, in that in the event of a downtime, a server using the <code>no</code> mode will lose all write command data since the last synchronization of the <code>AOF</code> file.</li>
</ul>
<h3 id="aof-file-loading-and-data-restoration">AOF file loading and data restoration</h3>
<p>Since the <code>AOF</code> file contains all the write commands needed to rebuild the database state, the server simply reads and re-executes the write commands stored in the <code>AOF</code> file to restore the database state before the server is shut down. The detailed steps for <code>Redis</code> to read the <code>AOF</code> file and restore the database state are as follows:</p>
<ul>
<li>Create a pseudo-client without a network connection (fakeclient): Because Redis commands can only be executed in the client context, and the commands used to load the AOF file come directly from the AOF file and not from a network connection, the server uses a pseudo-client without a network connection to execute the write commands saved in the AOF file. The effect of a pseudo-client executing a command is exactly the same as a client with a network connection executing a command.</li>
<li>Parses and reads a write command from the <code>AOF</code> file.</li>
<li>Execute the read write command using the pseudo-client.</li>
<li>Keep performing steps 2 and 3 until all write commands in the <code>AOF</code> file have been processed.</li>
</ul>
<p>When the above steps are completed, the database state stored in the <code>AOF</code> file is restored in its entirety.</p>
<h3 id="aof-rewriting">AOF rewriting</h3>
<p>Because <code>AOF</code> persistence records database state by storing executed write commands, as server runtime passes, the contents of the <code>AOF</code> file will become larger and larger, and if left unchecked, an oversized <code>AOF</code> file is likely to have an impact on the Redi server or even the entire host computer. The larger the <code>AOF</code> file, the more time it takes to perform a data restore using the <code>AOF</code> file.</p>
<ul>
<li>As an example</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">redis&gt; RPUSH list <span class="s2">&#34;A&#34;</span> <span class="s2">&#34;B&#34;</span>  // <span class="o">[</span><span class="s2">&#34;A&#34;</span>,<span class="s2">&#34;B&#34;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">2</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">redis&gt; RPUSH list <span class="s2">&#34;C&#34;</span>       // <span class="o">[</span><span class="s2">&#34;A&#34;</span>,<span class="s2">&#34;B&#34;</span>, <span class="s2">&#34;C&#34;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">3</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">redis&gt; RPUSH list <span class="s2">&#34;D&#34;</span> <span class="s2">&#34;E&#34;</span> // <span class="o">[</span><span class="s2">&#34;A&#34;</span>,<span class="s2">&#34;B&#34;</span>, <span class="s2">&#34;C&#34;</span>, <span class="s2">&#34;D&#34;</span>, <span class="s2">&#34;E&#34;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">5</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">redis&gt; LPOP list // <span class="o">[</span><span class="s2">&#34;B&#34;</span>, <span class="s2">&#34;C&#34;</span>, <span class="s2">&#34;D&#34;</span>, <span class="s2">&#34;E&#34;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;A&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">redis&gt; LPOP list // <span class="o">[</span><span class="s2">&#34;C&#34;</span>, <span class="s2">&#34;D&#34;</span>, <span class="s2">&#34;E&#34;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;B&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">redis&gt; RPUSH list <span class="s2">&#34;F&#34;</span> <span class="s2">&#34;G&#34;</span> // <span class="o">[</span><span class="s2">&#34;C&#34;</span>, <span class="s2">&#34;D&#34;</span>, <span class="s2">&#34;E&#34;</span>, <span class="s2">&#34;F&#34;</span> <span class="s2">&#34;G&#34;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">5</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Then the AOF file would need to store six commands just to record the state of the list key. For real-world applications, the number and frequency of write commands will be much higher than the simple example above, and will cause much more serious problems.
To solve the problem of AOF file size expansion, Redis provides the AOF file rewrite feature. With this feature, the Redis server can create a new AOF file to replace the existing AOF file. The old and new AOF files hold the same repository state, but the new AOF file does not contain any redundant commands that waste space, so the size of the new AOF file is usually much smaller than the old AOF file.</p>
<p>In the next section, we will describe how AOF file rewriting is implemented, and how the BGREWRITEAOF command is implemented.</p>
<h3 id="implementation-of-aof-file-rewriting">Implementation of AOF file rewriting</h3>
<p>Although <code>Redis</code> names the ability to generate new <code>AOF</code> files to replace <code>AOF</code> files with <code>AOF file rewrites</code>, in reality, <code>AOF</code> file rewrites do not require any reading, parsing, or writing of existing <code>AOF</code> files; they are implemented by reading the current database state of the server.</p>
<p>Consider a situation where the server executes the following command on the <code>list</code> key.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">redis&gt; RPUSH list <span class="s2">&#34;A&#34;</span> <span class="s2">&#34;B&#34;</span>  // <span class="o">[</span><span class="s2">&#34;A&#34;</span>,<span class="s2">&#34;B&#34;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">2</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">redis&gt; RPUSH list <span class="s2">&#34;C&#34;</span>       // <span class="o">[</span><span class="s2">&#34;A&#34;</span>,<span class="s2">&#34;B&#34;</span>, <span class="s2">&#34;C&#34;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">3</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">redis&gt; RPUSH list <span class="s2">&#34;D&#34;</span> <span class="s2">&#34;E&#34;</span> // <span class="o">[</span><span class="s2">&#34;A&#34;</span>,<span class="s2">&#34;B&#34;</span>, <span class="s2">&#34;C&#34;</span>, <span class="s2">&#34;D&#34;</span>, <span class="s2">&#34;E&#34;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">5</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">redis&gt; LPOP list // <span class="o">[</span><span class="s2">&#34;B&#34;</span>, <span class="s2">&#34;C&#34;</span>, <span class="s2">&#34;D&#34;</span>, <span class="s2">&#34;E&#34;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;A&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">redis&gt; LPOP list // <span class="o">[</span><span class="s2">&#34;C&#34;</span>, <span class="s2">&#34;D&#34;</span>, <span class="s2">&#34;E&#34;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;B&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">redis&gt; RPUSH list <span class="s2">&#34;F&#34;</span> <span class="s2">&#34;G&#34;</span> // <span class="o">[</span><span class="s2">&#34;C&#34;</span>, <span class="s2">&#34;D&#34;</span>, <span class="s2">&#34;E&#34;</span>, <span class="s2">&#34;F&#34;</span> <span class="s2">&#34;G&#34;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">5</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Then the server must write six commands in the AOF file in order to keep the current state of the list keys. If the server wants to use as few commands as possible to record the state of the list key, then the easiest and most efficient way is not to read and analyze the contents of the existing AOF file, but to read the value of the key list directly from the database and then replace the six commands saved in the AOF file with a single RPUSH list &ldquo;C&rdquo; &ldquo;D&rdquo; &ldquo;E&rdquo; &ldquo;E&rdquo; &ldquo;G&rdquo; command, thus reducing the This reduces the number of commands needed to save the list key from six to one.</p>
<p>The pseudo-code of the whole process can be represented as follows.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">aof_rewrite</span><span class="p">(</span><span class="n">new_aof_file_name</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#创建新AOF文件</span>
</span></span><span class="line"><span class="cl">    <span class="n">f</span> <span class="o">=</span> <span class="n">create_file</span><span class="p">(</span><span class="n">new_aof_file_name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">#当遍历疑据库</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">db</span> <span class="ow">in</span> <span class="n">redisserver</span><span class="o">.</span><span class="n">db</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="c1">#忽略空数据库</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">db</span><span class="o">.</span><span class="n">is_empty</span><span class="p">:</span><span class="k">continue</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">#写入 SELECT 命令，指定数据库号码</span>
</span></span><span class="line"><span class="cl">        <span class="n">f</span><span class="o">.</span><span class="n">writecommand</span><span class="p">(</span><span class="s2">&#34;SELECT&#34;</span><span class="err">＋</span> <span class="n">db</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1">#遍历最据库中的所有键</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">db</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="c1">#忽略已过期的健</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">is_expired</span><span class="p">():</span> <span class="k">continue</span>
</span></span><span class="line"><span class="cl">            <span class="c1">#根据键的痰型对键进行重写</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">String</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">rewrite_string</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">elif</span> <span class="n">key</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">List</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">rewrite_list</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">elif</span> <span class="n">key</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">Hash</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">rewrite_hash</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">elif</span> <span class="n">key</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">Set</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">rewrite_set</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">elif</span> <span class="n">key</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">SortedSet</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">rewrite_sorted_set</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="c1"># 如果键带有过翔时闻，那么过期时锏也要敲重写</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">have_expire_time</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">                <span class="n">rewrite_expire_time</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#写入完毕，关闭文件</span>
</span></span><span class="line"><span class="cl">    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">rewrite_string</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#使用Get命令获取字符串键的值</span>
</span></span><span class="line"><span class="cl">    <span class="n">value</span><span class="o">=</span><span class="n">Get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">#使用SET命令重写字符串键</span>
</span></span><span class="line"><span class="cl">    <span class="n">f</span><span class="o">.</span><span class="n">write_command</span><span class="p">(</span><span class="n">SET</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">rewrite_list</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#使用LRANGE命令获取所有元素</span>
</span></span><span class="line"><span class="cl">    <span class="n">item1</span><span class="p">,</span><span class="n">item2</span><span class="p">,</span> <span class="o">...</span> <span class="p">,</span> <span class="n">itemN</span> <span class="o">=</span> <span class="n">LRANGE</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">#使用RPUSH命令重写列表</span>
</span></span><span class="line"><span class="cl">    <span class="n">f</span><span class="o">.</span><span class="n">write_command</span><span class="p">(</span><span class="n">RPUSH</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">item1</span><span class="p">,</span><span class="n">item2</span><span class="o">.....</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">rewrite_hash</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#使用HGETALL命令获取哈希所有键值对</span>
</span></span><span class="line"><span class="cl">    <span class="n">field1</span><span class="p">,</span> <span class="n">value1</span><span class="p">,</span> <span class="n">field2</span><span class="p">,</span> <span class="n">value2</span><span class="p">,</span><span class="o">...</span><span class="p">,</span><span class="n">fieldN</span><span class="p">,</span><span class="n">valueN</span> <span class="o">=</span> <span class="n">HGETALL</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">#使用HMSET命令重写字符串键</span>
</span></span><span class="line"><span class="cl">    <span class="n">f</span><span class="o">.</span><span class="n">write_command</span><span class="p">(</span><span class="n">HMSET</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">field1</span><span class="p">,</span> <span class="n">value1</span><span class="p">,</span> <span class="n">field2</span><span class="p">,</span> <span class="n">value2</span><span class="p">,</span><span class="o">...</span><span class="p">,</span><span class="n">fieldN</span><span class="p">,</span><span class="n">valueN</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">rewrite_set</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#使用 SMEMBERS 命令获取集合键包含的所有元素</span>
</span></span><span class="line"><span class="cl">    <span class="n">elem1</span><span class="p">,</span> <span class="n">elem2</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="n">elemN</span> <span class="o">=</span> <span class="n">SMERBERS</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">#使用 SADD 命令重写集合</span>
</span></span><span class="line"><span class="cl">    <span class="n">f</span><span class="o">.</span><span class="n">write_command</span><span class="p">(</span><span class="n">SADD</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">elem1</span><span class="p">,</span> <span class="n">elem2</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="n">elemN</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">rewrite_sorted_set</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#使用 ZRANGE 命令获取有序集合键包含的所有元素</span>
</span></span><span class="line"><span class="cl">    <span class="n">member1</span><span class="p">,</span> <span class="n">score1</span><span class="p">,</span> <span class="n">member2</span><span class="p">,</span> <span class="n">score2</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="n">memberN</span><span class="p">,</span> <span class="n">scoreN</span> <span class="o">=</span> <span class="n">ZRANGE</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&#34;WITHSCORES&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">#使用 ZADD 命令重写有序集合</span>
</span></span><span class="line"><span class="cl">    <span class="n">f</span><span class="o">.</span><span class="n">write_command</span><span class="p">(</span><span class="n">ZADD</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">member1</span><span class="p">,</span> <span class="n">score1</span><span class="p">,</span> <span class="n">member2</span><span class="p">,</span> <span class="n">score2</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="n">memberN</span><span class="p">,</span> <span class="n">scoreN</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">rewrite_expire_time</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#获取毫秒精度的键过期时间</span>
</span></span><span class="line"><span class="cl">    <span class="n">timestamp</span> <span class="o">=</span> <span class="n">get_expire_time_in_unixstamp</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">#使用 PEXPIREAT 命令重写过期时间</span>
</span></span><span class="line"><span class="cl">    <span class="n">f</span><span class="o">.</span><span class="n">write_command</span><span class="p">(</span><span class="n">PEXPIREAT</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Because the new AOF file generated by the aof_rewrite function contains only the commands necessary to restore the current database state, the new AOF file does not waste any hard disk space.</p>
<blockquote>
<p>Note: In practice, to avoid overflowing the client input buffer when executing commands, the rewriter will first check the number of elements contained in the key if the number of elements exceeds the value of the redis.h/REDIS_AOF_REWRITE_ITEMS_PER_ CMD constants, then the rewriter will use multiple commands to record the value of the key instead of just one command. In version 3.0, the value of the REDIS_AOF_REWRITE_ITEMS_PER_CMD constant is 64, which means that if a collection key contains more than 64 elements, then the rewriter will use multiple SADD commands to record the collection, and each command sets the number of elements to 64 as well.</p>
</blockquote>
<h3 id="aof-background-rewrites">AOF background rewrites</h3>
<p>The AOF rewriter <code>aof_rewrite</code> function described above does a good job of building a new <code>AOF</code> file, but because this function does a lot of writing, the thread calling it will be blocked for a long time. Because the <code>Redis</code> server uses a single thread to handle command requests, if the <code>aof_rewrite</code> function were called directly by the server, the server would not be able to handle command requests from the client during the rewrite of the <code>AOF</code> file.</p>
<p>Obviously, as an auxiliary maintenance tool, <code>Redis</code> does not want <code>AOF</code> rewrites to prevent the server from processing requests, so Redis decided to put the <code>AOF</code> rewrites into a subprocess, which accomplishes two things at once.</p>
<ul>
<li>The server process (the parent process) can continue to process the command request while the child process does the <code>AOF</code> rewrite.</li>
<li>The child process carries a copy of the server process&rsquo; teachings, and using a child process instead of a thread ensures data security while avoiding the use of locks</li>
</ul>
<p>However, there is a problem that needs to be solved by using child processes, because the server process needs to continue processing command requests during the <code>AOF</code> rewrite, and the new commands may modify the existing database state, thus making the current database state of the server and the database state saved in the rewritten <code>AOF</code> file inconsistent.</p>
<h4 id="for-an-example">For an example</h4>
<table>
<thead>
<tr>
<th>time</th>
<th>server process</th>
<th>subprocess</th>
</tr>
</thead>
<tbody>
<tr>
<td>t1</td>
<td>execute command SET k1 v1</td>
<td></td>
</tr>
<tr>
<td>t2</td>
<td>execute command SET k1 v2</td>
<td></td>
</tr>
<tr>
<td>t3</td>
<td>execute command SET k1 v3</td>
<td></td>
</tr>
<tr>
<td>t4</td>
<td>Create subprocess, execute AOF file rewrite</td>
<td>Start AOF file rewrite</td>
</tr>
<tr>
<td>t5</td>
<td>execute the command SET k2 100</td>
<td>execute the rewrite operation</td>
</tr>
<tr>
<td>t6</td>
<td>execute command SET k3 101</td>
<td>execute rewrite operation</td>
</tr>
<tr>
<td>t7</td>
<td>execute command SET k4 102</td>
<td>Complete AOF rewrite</td>
</tr>
</tbody>
</table>
<p>The above shows an example of AOF file rewrite. When the child process starts the file rewrite, there is only one key k1 in the database, but when the child process finishes the AOF file rewrite, there are three new keys k2, k3, and k4 in the database of the server process, so the rewritten AOF file and the current database state of the server are not consistent. The new AOF file only holds data for one key, k1, while the server database now has four keys, k1, k2, k3, and k4.</p>
<p>To solve this data inconsistency problem, the Redis server sets up an AOF rewrite buffer that is used after the server creates a child process, and when the Redis server finishes executing a write command, it sends the write command to both the AOF buffer and the AOF rewrite buffer.
This means that during the execution of the AOF rewrite by the child process, the server process needs to perform the following three tasks.</p>
<ul>
<li>Execute the command from the client.</li>
<li>Append the executed write command to the <code>AOF</code> buffer</li>
<li>Append the executed write command to the <code>AOF</code> rewrite buffer</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/04/19/755d66ae724242b5824b7f9ae7066189.png" alt="redis aof"></p>
<p>This ensures that.</p>
<ul>
<li>The contents of the <code>AOF</code> buffer are written and synchronized to the <code>AOF</code> file on a regular basis, and processing of existing <code>AOF</code> files is performed as usual.</li>
<li>All write commands executed by the server since the creation of the child process are recorded in the <code>AOF</code> rewrite buffer.</li>
</ul>
<p>When the child process finishes the <code>AOF</code> rewrite, it sends a signal to the parent process, and after receiving the signal, the parent process will call a signal handler and do the following:</p>
<ol>
<li>write all the contents of the <code>AOF</code> rewrite buffer to the new <code>AOF</code> file, at which time the database state saved in the new <code>AOF</code> file will be the same as the current database state of the server.</li>
<li>rename the new <code>AOF</code> file, <strong>atomically</strong> overwriting the existing <code>AOF</code> file, completing the replacement of the old and new <code>AOF</code> files.</li>
</ol>
<p>After this signal handler function is executed, the parent process can continue to receive command requests as usual. During the entire AOF background rewrite process, only the signal handler function will block the server process (the parent process). At other times, AOF background rewrites do not block the parent process, which minimizes the impact of AOF rewrites on server performance.</p>
<p>The complete rewriting process is as follows.</p>
<table>
<thead>
<tr>
<th>time</th>
<th>server process</th>
<th>subprocess</th>
</tr>
</thead>
<tbody>
<tr>
<td>t1</td>
<td>execute command SET k1 v1</td>
<td></td>
</tr>
<tr>
<td>t2</td>
<td>execute command SET k1 v2</td>
<td></td>
</tr>
<tr>
<td>t3</td>
<td>execute command SET k1 v3</td>
<td></td>
</tr>
<tr>
<td>t4</td>
<td>Create subprocess, execute AOF file rewrite</td>
<td>Start AOF file rewrite</td>
</tr>
<tr>
<td>t5</td>
<td>execute the command SET k2 100</td>
<td>execute the rewrite operation</td>
</tr>
<tr>
<td>t6</td>
<td>execute command SET k3 101</td>
<td>execute rewrite operation</td>
</tr>
<tr>
<td>t7</td>
<td>execute command SET k4 102</td>
<td>Complete AOF rewrite, send signal to parent process</td>
</tr>
<tr>
<td>t8</td>
<td>Receive the signal from the child process, and append the commands SET k2 100, SET k3 101, SET k4 102 to the end of the new AOF file</td>
<td></td>
</tr>
<tr>
<td>t9</td>
<td>Overwrite the old AOF file with the new AOF file</td>
<td></td>
</tr>
</tbody>
</table>
<p>The above is the principle of the AOF background rewrite, that is, the implementation of the BGREWRITEAOF command.</p>
<h2 id="summary">Summary</h2>
<ul>
<li>The <code>AOF</code> file records the database state of the server by saving all write command requests that modify the database.</li>
<li>All commands in the <code>AOF</code> file are saved in the format of the <code>Redis</code> command request protocol.</li>
<li>The different values of the <code>appendfsync</code> option have a significant impact on the security of the <code>AOF</code> persistence feature and the <code>Redis</code> server</li>
<li>The server can restore the original state of the database by simply loading and re-executing the commands saved in the <code>AOF</code> file.</li>
<li>An <code>AOF</code> rewrite produces a new <code>AOF</code> file that holds the same database state as the original <code>AOF</code> file, but in a smaller size.</li>
<li><code>AOF</code> rewrite is an ambiguous name for a function that is implemented by reading key-value pairs from the database without the program having to perform any read, parse, or write operations on the existing <code>AOF</code> file.</li>
<li>When the <code>BGRERIRTEAOF</code> command is executed, the <code>Redis</code> server maintains an <code>AOF</code> rewrite buffer that records all write commands executed by the server during the creation of a new <code>AOF</code> file by a child process. When the child process finishes creating the new <code>AOF</code> file, the server appends everything in the rewrite buffer to the end of the new <code>AOF</code> file, making the database state stored in the old and new <code>AOF</code> files identical. Finally, the server replaces the old <code>AOF</code> file with the new <code>AOF</code> file, thus completing the <code>AOF</code> file rewrite operation.</li>
</ul>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/redis/">redis</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2022-04/redis-rdb-persistence/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Redis&#39; RDB persistence principle</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2022-04/zero-copy/">
            <span class="next-text nav-default">Efficient IO Technology - Zero Copy</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  <script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox-3.1.20.min.js"></script>



<script type="text/javascript" src="/js/main.min.64437849d125a2d603b3e71d6de5225d641a32d17168a58106e0b61852079683.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
