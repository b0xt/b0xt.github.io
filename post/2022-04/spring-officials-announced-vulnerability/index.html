<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Spring official announcement of the network of large vulnerabilities, with solutions - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="Spring officials announced the web rumors of a major vulnerability, with solutions! The solution spread on the Internet has hidden problems, it is recommended to reinforce!" /><meta name="keywords" content="Spring, Officials, Announced, Vulnerability" />






<meta name="generator" content="Hugo 0.92.2 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2022-04/spring-officials-announced-vulnerability/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="Spring official announcement of the network of large vulnerabilities, with solutions" />
<meta property="og:description" content="Spring officials announced the web rumors of a major vulnerability, with solutions! The solution spread on the Internet has hidden problems, it is recommended to reinforce!" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2022-04/spring-officials-announced-vulnerability/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-04-01T00:11:32+08:00" />
<meta property="article:modified_time" content="2022-04-01T00:11:32+08:00" />

<meta itemprop="name" content="Spring official announcement of the network of large vulnerabilities, with solutions">
<meta itemprop="description" content="Spring officials announced the web rumors of a major vulnerability, with solutions! The solution spread on the Internet has hidden problems, it is recommended to reinforce!"><meta itemprop="datePublished" content="2022-04-01T00:11:32+08:00" />
<meta itemprop="dateModified" content="2022-04-01T00:11:32+08:00" />
<meta itemprop="wordCount" content="675">
<meta itemprop="keywords" content="spring,Vulnerability," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Spring official announcement of the network of large vulnerabilities, with solutions"/>
<meta name="twitter:description" content="Spring officials announced the web rumors of a major vulnerability, with solutions! The solution spread on the Internet has hidden problems, it is recommended to reinforce!"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SoByte</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a><a href="/ukraine/">
        <li class="mobile-menu-item">UKRAINE</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SoByte</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/ukraine/">UKRAINE</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Spring official announcement of the network of large vulnerabilities, with solutions</h1>

      <div class="post-meta">
        <span class="post-time"> 2022-04-01 00:11:32 </span>
        <div class="post-category">
            <a href="/categories/news/"> news </a>
            </div>
          <span class="more-meta"> 675 words </span>
          <span class="more-meta"> 4 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#scope-of-impact">Scope of Impact</a></li>
        <li><a href="#solution">Solution</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>On the evening of March 31, the Spring community released an article called <a href="https://spring.io/blog/2022/03/31/spring-framework-rce-early-announcement">&ldquo;Spring Framework RCE, Early Announcement&rdquo;</a>, which officially announced the recent Spring vulnerability. It confirms that the rumored vulnerabilities do exist and are not the CVEs announced on March 28th and 29th as many recent articles say, so if you are solving the problem according to those articles, please start over with this official announcement.</p>
<p>The identified RCE vulnerability in the Spring Core Framework is CVE number <code>CVE-2022-22965</code>.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/04/01/76f4c385406a45da89ace205d57ec2cb.png" alt="CVE-2022-22965"></p>
<p>The vulnerability was reported to VMware late Tuesday night by AntGroup FG&rsquo;s codePlutos, meizjm3i. On Wednesday, Spring officials investigated the issue, analyzed it and determined a solution, while <strong>an emergency release</strong> was planned for Thursday.</p>
<p>Since the vulnerability was leaked on the web, Spring officials have released an emergency version of the fix in question, which is more extensive because it is a vulnerability in the Spring core framework. So in this blog post is also continuously updated progress, the following progress timeline as of this posting.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/04/01/4ae413abdd4a4bd1bea3887066211127.png" alt="timeline"></p>
<p>Here&rsquo;s a look at the official content and solution of this mysterious vulnerability that has been rumored on the Internet for 2 days.</p>
<h2 id="scope-of-impact">Scope of Impact</h2>
<p>The following conditions need to be met for this vulnerability to be exploited.</p>
<ul>
<li>JDK 9 +</li>
<li>Deployment with Apache Tomcat</li>
<li>Packaged using WAR</li>
<li>Relying on spring-webmvc or spring-webflux</li>
</ul>
<p>Although it is likely that most users are still running with JDK 8, or using the built-in Tomcat, the characteristics of the vulnerability are more common and do not exclude the existence of other exploits. Therefore, it is recommended to upgrade to the latest version as soon as possible to avoid the possible risks.</p>
<h2 id="solution">Solution</h2>
<p>Since this is not a webcast but an official Spring announcement, the solution is already relatively well developed and easy to implement. Affected users can address the risk of this vulnerability by doing the following.</p>
<ul>
<li><strong>Spring 5.3.x users upgrade to 5.3.18+</strong></li>
<li><strong>Spring 5.2.x users upgrade to 5.2.20+</strong></li>
<li><strong>Spring Boot 2.6.x users upgrade to 2.6.6+</strong></li>
<li><strong>Spring Boot 2.5.x users upgrade to 2.5.12+</strong></li>
</ul>
<p>For the recurrence of the vulnerability and more details, I won&rsquo;t go into specifics here because of space limitations.</p>
<p>Then, it needs to be mentioned here again in particular that those who have already received the news and acted on it before, should have used the following solution to deal with it if they guessed correctly, right?</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="nd">@ControllerAdvice</span>
<span class="nd">@Order</span><span class="o">(</span><span class="n">Ordered</span><span class="o">.</span><span class="na">LOWEST_PRECEDENCE</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">BinderControllerAdvice</span> <span class="o">{</span>

    <span class="nd">@InitBinder</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setAllowedFields</span><span class="o">(</span><span class="n">WebDataBinder</span> <span class="n">dataBinder</span><span class="o">)</span> <span class="o">{</span>
         <span class="n">String</span><span class="o">[]</span> <span class="n">denylist</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">[]{</span><span class="s">&#34;class.*&#34;</span><span class="o">,</span> <span class="s">&#34;Class.*&#34;</span><span class="o">,</span> <span class="s">&#34;*.class.*&#34;</span><span class="o">,</span> <span class="s">&#34;*.Class.*&#34;</span><span class="o">};</span>
         <span class="n">dataBinder</span><span class="o">.</span><span class="na">setDisallowedFields</span><span class="o">(</span><span class="n">denylist</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>This official Spring tweet confirms that the method works, but <strong>may leave some other pitfalls</strong>, especially when the <code>Controller</code> sets <code>disalloedFields</code> locally via its own <code>@InitBinder</code> method, which overrides the global setting.</p>
<p>To apply the solution in a more secure way, the application can extend <code>RequestMappingHandlerAdapter</code> to update <code>WebDataBinder</code> after all other initialization is finished. Officially, a better solution is given, such as the following.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="nd">@SpringBootApplication</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyApp</span> <span class="o">{</span>

 <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">SpringApplication</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="n">CarApp</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>
 <span class="o">}</span>


 <span class="nd">@Bean</span>
 <span class="kd">public</span> <span class="n">WebMvcRegistrations</span> <span class="nf">mvcRegistrations</span><span class="o">()</span> <span class="o">{</span>
  <span class="k">return</span> <span class="k">new</span> <span class="n">WebMvcRegistrations</span><span class="o">()</span> <span class="o">{</span>
   <span class="nd">@Override</span>
   <span class="kd">public</span> <span class="n">RequestMappingHandlerAdapter</span> <span class="nf">getRequestMappingHandlerAdapter</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">ExtendedRequestMappingHandlerAdapter</span><span class="o">();</span>
   <span class="o">}</span>
  <span class="o">};</span>
 <span class="o">}</span>


 <span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">ExtendedRequestMappingHandlerAdapter</span> <span class="kd">extends</span> <span class="n">RequestMappingHandlerAdapter</span> <span class="o">{</span>

  <span class="nd">@Override</span>
  <span class="kd">protected</span> <span class="n">InitBinderDataBinderFactory</span> <span class="nf">createDataBinderFactory</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">InvocableHandlerMethod</span><span class="o">&gt;</span> <span class="n">methods</span><span class="o">)</span> <span class="o">{</span>

   <span class="k">return</span> <span class="k">new</span> <span class="n">ServletRequestDataBinderFactory</span><span class="o">(</span><span class="n">methods</span><span class="o">,</span> <span class="n">getWebBindingInitializer</span><span class="o">())</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="n">ServletRequestDataBinder</span> <span class="nf">createBinderInstance</span><span class="o">(</span>
      <span class="n">Object</span> <span class="n">target</span><span class="o">,</span> <span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="n">NativeWebRequest</span> <span class="n">request</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
     
     <span class="n">ServletRequestDataBinder</span> <span class="n">binder</span> <span class="o">=</span> <span class="kd">super</span><span class="o">.</span><span class="na">createBinderInstance</span><span class="o">(</span><span class="n">target</span><span class="o">,</span> <span class="n">name</span><span class="o">,</span> <span class="n">request</span><span class="o">);</span>
     <span class="n">String</span><span class="o">[]</span> <span class="n">fields</span> <span class="o">=</span> <span class="n">binder</span><span class="o">.</span><span class="na">getDisallowedFields</span><span class="o">();</span>
     <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">fieldList</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;(</span><span class="n">fields</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="n">fields</span><span class="o">)</span> <span class="o">:</span> <span class="n">Collections</span><span class="o">.</span><span class="na">emptyList</span><span class="o">());</span>
     <span class="n">fieldList</span><span class="o">.</span><span class="na">addAll</span><span class="o">(</span><span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">&#34;class.*&#34;</span><span class="o">,</span> <span class="s">&#34;Class.*&#34;</span><span class="o">,</span> <span class="s">&#34;*.class.*&#34;</span><span class="o">,</span> <span class="s">&#34;*.Class.*&#34;</span><span class="o">));</span>
     <span class="n">binder</span><span class="o">.</span><span class="na">setDisallowedFields</span><span class="o">(</span><span class="n">fieldList</span><span class="o">.</span><span class="na">toArray</span><span class="o">(</span><span class="k">new</span> <span class="n">String</span><span class="o">[]</span> <span class="o">{}));</span>
     <span class="k">return</span> <span class="n">binder</span><span class="o">;</span>
    <span class="o">}</span>
   <span class="o">};</span>
  <span class="o">}</span>
 <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>For Spring MVC users who are not under a Spring Boot application, you can switch directly from <code>@EnableWebMvc</code> to the extension <code>DelegatingWebMvcConfiguration</code>, as described in the advanced configuration section of the <a href="https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc-config-advanced-java">documentation</a>, and then override the <code>createRequestMappingHandlerAdapter</code> method to do so.</p>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/spring/">spring</a>
          <a href="/tags/vulnerability/">Vulnerability</a>
          </div>
      <nav class="post-nav">
        
        <a class="next" href="/post/2022-03/postgresql-foreign-data-wrappers/">
            <span class="next-text nav-default">PostgreSQL Foreign Data Wrappers Usage Explained</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
