<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Unix domain socket - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="Exploring Unix domain sockets." /><meta name="keywords" content="Unix Domain Socket, udc" />






<meta name="generator" content="Hugo 0.102.0 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2022-04/unix-domain-socket/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link href="/lib/fancybox/jquery.fancybox-3.1.20.min.css" rel="stylesheet">


<meta property="og:title" content="Unix domain socket" />
<meta property="og:description" content="Exploring Unix domain sockets." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2022-04/unix-domain-socket/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-04-06T16:04:41+08:00" />
<meta property="article:modified_time" content="2022-04-06T16:04:41+08:00" />

<meta itemprop="name" content="Unix domain socket">
<meta itemprop="description" content="Exploring Unix domain sockets."><meta itemprop="datePublished" content="2022-04-06T16:04:41+08:00" />
<meta itemprop="dateModified" content="2022-04-06T16:04:41+08:00" />
<meta itemprop="wordCount" content="1165">
<meta itemprop="keywords" content="unix," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Unix domain socket"/>
<meta name="twitter:description" content="Exploring Unix domain sockets."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SOBYTE</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SOBYTE</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Unix domain socket</h1>

      <div class="post-meta">
        <span class="post-time"> 2022-04-06 16:04:41 </span>
        <div class="post-category">
            <a href="/categories/tutorials/"> tutorials </a>
            </div>
          <span class="more-meta"> 1165 words </span>
          <span class="more-meta"> 6 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#introduction">Introduction</a></li>
        <li><a href="#what-is-a-unix-domain-socket">What is a Unix domain socket</a></li>
        <li><a href="#use-socat-to-create-unix-domain-sockets">Use socat to create Unix Domain Sockets</a></li>
        <li><a href="#use-the-ss-command-to-view-unix-domain-sockets">Use the ss command to view Unix domain sockets</a></li>
        <li><a href="#connecting-to-unix-domain-socket-services-using-nc">Connecting to Unix domain socket services using nc</a></li>
        <li><a href="#summary">Summary</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <h2 id="introduction">Introduction</h2>
<p>Stream Socket and Datagram Socket are usually based on tcp and udp protocols for data transfer respectively. Both sockets have one common feature, that is, they require an IP address and a port to establish a connection between the client and the server.</p>
<p>This article explains a special socket that does not require a traditional IP address and port, but uses the file system for data interaction between programs, and can only be used on unix systems. Such a socket is the Unix domain socket that we will be talking about today.</p>
<h2 id="what-is-a-unix-domain-socket">What is a Unix domain socket</h2>
<p>What is a Unix domain socket? We can see from the name that this socket is related to the unix domain, which means that this socket needs to use some special functions under unix.</p>
<p>Let&rsquo;s consider the common windows system and unix system, where is the biggest difference between them?</p>
<p>In fact, the biggest difference is that everything in the unix operating system can be regarded as a file, including some information about the operation of the program.</p>
<p>So can we directly use the files generated by these programs to interact with the data between different programs? The answer is yes. This is the Unix domain socket that we will discuss today.</p>
<p>Unix domain sockets can be abbreviated as UDS, where data between different programs can be exchanged at the operating system level, with the help of the file system.</p>
<p>For the program itself, it only needs to read and write to the shared socket file, which means that different programs interact with each other through the socket file.</p>
<p>Like IP and port-based sockets, Unix domain sockets can be divided into Stream sockets and Datagram sockets.</p>
<p>Probably the place where we see Unix domain sockets the most is docker. As a container technology, docker requires fast data transfer and information exchange with physical machines. In general UDS files end with <code>.socket</code>, we can find these files by using the following command under the <code>/var/run</code> directory.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">find . -name <span class="s2">&#34;*.sock&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>If you have docker running, you will see output similar to the following.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">./docker.sock
</span></span><span class="line"><span class="cl">./docker/libnetwork/6d66a24bfbbfa231a668da4f1ed543844a0514e4db3a1f7d8001a04a817b91fb.sock
</span></span><span class="line"><span class="cl">./docker/libcontainerd/docker-containerd.sock
</span></span></code></pre></td></tr></table>
</div>
</div><p>You can see that docker is communicating through the 3 sock files above.</p>
<h2 id="use-socat-to-create-unix-domain-sockets">Use socat to create Unix Domain Sockets</h2>
<p>socat is a universal tool that can create not only tcp listening servers, but also udp listening servers, and of course for UDS. Let&rsquo;s look at the parameters needed to create a UDS server using socat.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">unix-listen:&lt;filename&gt;    groups=FD,SOCKET,NAMED,LISTEN,CHILD,RETRY,UNIX
</span></span><span class="line"><span class="cl">unix-recvfrom:&lt;filename&gt;  groups=FD,SOCKET,NAMED,CHILD,RETRY,UNIX
</span></span></code></pre></td></tr></table>
</div>
</div><p>Here we have to use the unix-listen and unix-recvfrom parameters. <code>unix-listen</code> indicates the creation of a <code>stream-based UDS</code> service, while <code>unix-recvfrom</code> indicates the creation of a datagram-based UDS.</p>
<p>You can see that both parameters need to be followed by a filename, which indicates the address of the UDS socket.</p>
<p>We can use it like this.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">socat unix-listen:/tmp/stream.sock,fork /dev/null<span class="p">&amp;</span>
</span></span><span class="line"><span class="cl">socat unix-recvfrom:/tmp/datagram.sock,fork /dev/null<span class="p">&amp;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Here we use <code>/tmp/datagram.sock</code> to represent this socket information.</p>
<p>The fork parameter indicates that the program continues to run after receiving the packet, and if fork is not used, then the program will exit automatically.</p>
<p>The socat is supposed to be followed by a <code>bi-address</code>, here we use <code>/dev/null</code> to discard all the incoming information.</p>
<p>After running we may get the following result.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="o">[</span>1<span class="o">]</span> <span class="m">27442</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>2<span class="o">]</span> <span class="m">27450</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Indicates that the program has been successfully executed, and the pid of the program is returned.</p>
<h2 id="use-the-ss-command-to-view-unix-domain-sockets">Use the ss command to view Unix domain sockets</h2>
<p>Before using the ss command, let&rsquo;s look at the two files generated using socat.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">srwxrwxr-x   <span class="m">1</span> flydean flydean    <span class="m">0</span> Mar  <span class="m">2</span> 21:58 stream.sock
</span></span><span class="line"><span class="cl">srwxrwxr-x   <span class="m">1</span> flydean flydean    <span class="m">0</span> Mar  <span class="m">2</span> 21:59 datagram.sock
</span></span></code></pre></td></tr></table>
</div>
</div><p>You can see the permissions of the two files, rwx we all understand, respectively, read, write and execute permissions. So what is the top s?</p>
<p>The top one indicates the file type, and the s indicates the socket file.</p>
<p>To expand a bit, there are several other options for this position: p, d, l, s, c, b and -:</p>
<p>Where p indicates a named pipe file, d indicates a directory file, l indicates a symbolic link file, - indicates a normal file, s indicates a socket file, c indicates a character device file, and b indicates a block device file.</p>
<p>Next, we use the ss command to check the previously created UDS service.</p>
<p>The following parameters are used here.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">   -n, --numeric       don<span class="err">&#39;</span>t resolve service names
</span></span><span class="line"><span class="cl">   -l, --listening     display listening sockets
</span></span><span class="line"><span class="cl">   -x, --unix          display only Unix domain sockets
</span></span></code></pre></td></tr></table>
</div>
</div><p>Here we need to use the above 3 options, x means display UDS, because it is listening, so use the -l parameter, and finally we want to see the specific number instead of being parsed as a service name, so use the -n parameter here.</p>
<p>We can try to execute the following command.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">ss -xln
</span></span></code></pre></td></tr></table>
</div>
</div><p>The output will be a lot, and we can grep the sockets we need. This is shown below.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">ss -xln <span class="p">|</span> grep tmp
</span></span><span class="line"><span class="cl">u_str  LISTEN     <span class="m">0</span>      <span class="m">5</span>      /tmp/stream.sock <span class="m">11881005</span>              * <span class="m">0</span>                  
</span></span><span class="line"><span class="cl">u_dgr  UNCONN     <span class="m">0</span>      <span class="m">0</span>      /tmp/datagram.sock <span class="m">11882190</span>              * <span class="m">0</span>  
</span></span></code></pre></td></tr></table>
</div>
</div><p>u_str represents a UDS stream socket, while u_dg represents a UDS datagram socket.</p>
<p>We can use the stat command to view the specific information of the socket file.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">stat /tmp/stream.sock /tmp/datagram.sock
</span></span><span class="line"><span class="cl">  File: &#39;/tmp/stream.sock&#39;
</span></span><span class="line"><span class="cl">  Size: 0               Blocks: 0          IO Block: 4096   socket
</span></span><span class="line"><span class="cl">Device: fd02h/64770d    Inode: 134386049   Links: 1
</span></span><span class="line"><span class="cl">Access: (0775/srwxrwxr-x)  Uid: ( 1002/    flydean)   Gid: ( 1002/    flydean)
</span></span><span class="line"><span class="cl">Access: 2022-03-01 22:33:21.533000000 +0800
</span></span><span class="line"><span class="cl">Modify: 2022-03-01 22:33:21.533000000 +0800
</span></span><span class="line"><span class="cl">Change: 2022-03-01 22:33:21.533000000 +0800
</span></span><span class="line"><span class="cl"> Birth: -
</span></span><span class="line"><span class="cl">  File: &#39;/tmp/datagram.sock&#39;
</span></span><span class="line"><span class="cl">  Size: 0               Blocks: 0          IO Block: 4096   socket
</span></span><span class="line"><span class="cl">Device: fd02h/64770d    Inode: 134386050   Links: 1
</span></span><span class="line"><span class="cl">Access: (0775/srwxrwxr-x)  Uid: ( 1002/    flydean)   Gid: ( 1002/    flydean)
</span></span><span class="line"><span class="cl">Access: 2022-03-01 22:33:22.306000000 +0800
</span></span><span class="line"><span class="cl">Modify: 2022-03-01 22:33:22.306000000 +0800
</span></span><span class="line"><span class="cl">Change: 2022-03-01 22:33:22.306000000 +0800
</span></span><span class="line"><span class="cl"> Birth: -
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="connecting-to-unix-domain-socket-services-using-nc">Connecting to Unix domain socket services using nc</h2>
<p>nc is a very powerful tool that can connect to UDS in addition to TCP and UDP connections. We need to use to the following parameters.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">  -U, --unixsock             Use Unix domain sockets only
</span></span><span class="line"><span class="cl">  -u, --udp                  Use UDP instead of default TCP
</span></span><span class="line"><span class="cl">  -z                         Zero-I/O mode, report connection status only
</span></span></code></pre></td></tr></table>
</div>
</div><p>-U indicates that the connection is to a unixsocket. -u indicates that it is a UDP connection.</p>
<p>By default nc uses a TCP connection, so no additional arguments are needed.</p>
<p>Also we establish the connection directly and don&rsquo;t send any data, so the -z parameter is used here.</p>
<p>First connect to Stream UDS to see.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">nc -U -z /tmp/stream.sock
</span></span></code></pre></td></tr></table>
</div>
</div><p>If no abnormal data is output, the connection is successful.</p>
<p>Then connect the Datagram UDS again to see.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">nc -uU -z /tmp/datagram.sock
</span></span></code></pre></td></tr></table>
</div>
</div><p>Again, if there is no abnormal data, it means the socket connection is successful.</p>
<h2 id="summary">Summary</h2>
<p>In this chapter we have introduced the meaning of Unix Domain Socket and implemented UDS creation, detection and connection using some tools in unix. Basically the usage of UDS is described.</p>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/unix/">unix</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2022-04/deepl-api/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">DeepL Deception Tactics in Api Design</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2022-04/graceful-shutdown-docker/">
            <span class="next-text nav-default">How to shutdown containers gracefully</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  <script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox-3.1.20.min.js"></script>



<script type="text/javascript" src="/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js"></script>








</body>
</html>
