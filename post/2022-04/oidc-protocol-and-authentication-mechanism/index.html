<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Understand the OIDC protocol and authentication mechanism - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="Learn about the development of OpenId and Oauth2, the difference between OIDC and OpenId, Oauth2. Understand the OIDC abstraction process and several authentication methods, the format of Id token." /><meta name="keywords" content="oidc, Authentication, OAuth, openId" />






<meta name="generator" content="Hugo 0.96.0 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2022-04/oidc-protocol-and-authentication-mechanism/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link href="/lib/fancybox/jquery.fancybox-3.1.20.min.css" rel="stylesheet">


<meta property="og:title" content="Understand the OIDC protocol and authentication mechanism" />
<meta property="og:description" content="Learn about the development of OpenId and Oauth2, the difference between OIDC and OpenId, Oauth2. Understand the OIDC abstraction process and several authentication methods, the format of Id token." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2022-04/oidc-protocol-and-authentication-mechanism/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-04-01T10:13:38+08:00" />
<meta property="article:modified_time" content="2022-04-01T10:13:38+08:00" />

<meta itemprop="name" content="Understand the OIDC protocol and authentication mechanism">
<meta itemprop="description" content="Learn about the development of OpenId and Oauth2, the difference between OIDC and OpenId, Oauth2. Understand the OIDC abstraction process and several authentication methods, the format of Id token."><meta itemprop="datePublished" content="2022-04-01T10:13:38+08:00" />
<meta itemprop="dateModified" content="2022-04-01T10:13:38+08:00" />
<meta itemprop="wordCount" content="3103">
<meta itemprop="keywords" content="oidc," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Understand the OIDC protocol and authentication mechanism"/>
<meta name="twitter:description" content="Learn about the development of OpenId and Oauth2, the difference between OIDC and OpenId, Oauth2. Understand the OIDC abstraction process and several authentication methods, the format of Id token."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SOBYTE</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a><a href="/ukraine/">
        <li class="mobile-menu-item">UKRAINE</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SOBYTE</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/ukraine/">UKRAINE</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Understand the OIDC protocol and authentication mechanism</h1>

      <div class="post-meta">
        <span class="post-time"> 2022-04-01 10:13:38 </span>
        <div class="post-category">
            <a href="/categories/tutorials/"> tutorials </a>
            </div>
          <span class="more-meta"> 3103 words </span>
          <span class="more-meta"> 15 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#openid--oauth-development-history">OpenID &amp; OAuth development history</a></li>
        <li><a href="#openid">OpenID</a></li>
        <li><a href="#oauth">OAuth</a></li>
        <li><a href="#open-id-connect">Open ID Connect</a>
          <ul>
            <li><a href="#oidc-key-terms">OIDC Key Terms</a></li>
            <li><a href="#oidc-protocol-cluster">OIDC Protocol Cluster</a></li>
          </ul>
        </li>
        <li><a href="#oidc--openid-20-differences">OIDC &amp; OpenID 2.0 Differences</a></li>
        <li><a href="#oidc--oauth20-differences">OIDC &amp; OAuth2.0 differences</a></li>
        <li><a href="#oidc-abstraction-process">OIDC abstraction process</a></li>
        <li><a href="#several-authentication-methods-of-oidc">Several authentication methods of OIDC</a>
          <ul>
            <li><a href="#authorization-code-flow">Authorization code flow</a></li>
            <li><a href="#implicit-process">Implicit process</a></li>
            <li><a href="#hybrid-process">Hybrid process</a></li>
          </ul>
        </li>
        <li><a href="#id-token-format">Id token format</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>When there are more and more Internet applications, each application implements its own identity storage, authentication and authorization, users need to register and login repeatedly on the application, which is a bad experience, and user identity information cannot be shared and synchronized among multiple applications. When using enterprise applications, companies provide a series of applications and have to switch between registration and login despite being operated by the same user.</p>
<p>Is there a way that I can register an account with a proxy site, and if I log in to other sites, the other sites can go to the proxy site to get the information. As long as the proxy site is alive enough, then it is always possible to skip a lot of tedious registration and login processes.</p>
<p>These ideas emerged during the evolution of technologies such as WS-Federation, SAML2.0, OpenID, OAuth, OIDC&hellip;</p>
<h2 id="openid--oauth-development-history">OpenID &amp; OAuth development history</h2>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/04/01/7b3eb43463ae400291099a74bab52567.png" alt="OpenID &amp; OAuth development history"></p>
<p>There are also some revisions and extensions that are not reflected here, mainly to focus on the fact that OpenID and OAuth are not the same.</p>
<ul>
<li>OpenID is oriented to authentication, which authenticates the user&rsquo;s identity to determine whether it is valid.</li>
<li>OAuth is oriented to the authorization process, after the current user identity is known to be legitimate, control the resources that the user can access and consider protecting the resources being accessed.</li>
</ul>
<h2 id="openid">OpenID</h2>
<p>OpenID is a decentralized online authentication system. For OpenID-enabled websites, users do not need to remember traditional authentication tokens such as usernames and passwords. Instead, they only need to register in advance with a website that acts as an OpenID identity provider (IdP). OpenID is decentralized, so any website can use OpenID as a way for users to log in, and any website can act as an OpenID identity provider. openID solves the registration problem without relying on a centralized website to confirm a digital identity.</p>
<p>OpenID provides users with a unified network identity that adheres to the OpenID network identity. When an application website(In OpenId terminology it is called Relying Parties, or RP) that adheres to the OpenID protocol requires users to log in, it directs them to a third-party OpenID identity provider((called OpenID identity provider in OpenId terminology, i.e. OP)) for authentication, and if they pass the authentication, they can log in successfully. This saves the trouble and tedium of registering and logging in for each application site. It solves the problem mentioned at the beginning that each application needs to complete the registration and login process independently and needs to implement and maintain an independent user database.</p>
<h2 id="oauth">OAuth</h2>
<p>OAuth is an authorization protocol that addresses the fact that an application can access certain authorized resources of a user on another application, but this application does not need to know the password of the user&rsquo;s account on the other application, i.e., it can access controlled resources on the other application without revealing the user&rsquo;s credentials to the other application.</p>
<ul>
<li>November 2006, when Brian Cook was working on an OpenID implementation of Twitter. At the same time, the social bookmarking site Ma.gnolia needed a solution to allow members using OpenID to grant Dashboard access to their service. Thus Cook, Chris Messina and Larry Halff from Ma.gnolia met with David Recolton to discuss using OpenID for delegated authorization on Twitter and the Ma.gnolia API. However, their discussion concluded that OpenID did not have an open standard for completing API access delegation.</li>
<li>In April 2007, the OAuth Discussion Group was formed and this group of implementers wrote a draft proposal for an open protocol. DeWitt Clinton from Google learned about the OAuth project and expressed his interest in supporting the effort.</li>
<li>In July 2007, the team drafted the initial specification. Eran Hammer-Lahav then joined the team and coordinated many of the OAuth drafts, creating a more formal specification.</li>
<li>In October 2007, the final draft of OAuth Core 1.0 was released.</li>
<li>In November 2008, at the 73rd meeting of the Internet Engineering Task Force in Minneapolis, a BoF discussion of OAuth was held to incorporate the protocol into the IETF for further normalization work. This meeting was well attended, and there was broad support for the topic of formally mandating an OAuth working group in the IETF.</li>
<li>In April 2010, the OAuth 1.0 protocol was published as RFC 5849, an informal RFC.</li>
<li>In October 2012, OAuth 2.0 was released, formally published as RFC 6749. OAuth 2.0 is the next version of the OAuth protocol, but is not backward compatible with OAuth 1.0. OAuth 2.0 focuses on simplicity for client developers, while providing specialized authentication processes for web applications, desktop applications, cell phones, and smart devices.</li>
</ul>
<h2 id="open-id-connect">Open ID Connect</h2>
<p>The OpenID team originally wanted users to use OpenID for authentication, but since the authorization process includes authentication as part of the process, authorization means going through the authentication process. As a result, some users opted for the simplicity of OAuth authentication and the advantages of &ldquo;the task of managing user credentials can be delegated to an external service&rdquo; and &ldquo;because the new user registration process can be omitted, the barriers to using the service become lower&rdquo;. The trend of using OAuth 2.0 as authentication became popular as it quickly took over.</p>
<p>The OpenID team had to admit that users preferred OAuth 2.0, so they defined a new identity specification on top of OAuth <strong>O</strong> pen <strong>ID</strong> <strong>C</strong> onnect (OIDC), which is based on OAuth 2.0 with minor extensions, building the identity layer on top of OAuth 2.0 so that it can be used as an authentication protocol.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/04/01/63204c7b01e046c6aaa9b7120b528d80.png" alt="Open ID"></p>
<p>That is, OpenID Connect (OIDC) is an authentication protocol built on OAuth 2.0.</p>
<blockquote>
<p>OpenID+OAuth 2.0=OpenID Connect</p>
</blockquote>
<h3 id="oidc-key-terms">OIDC Key Terms</h3>
<ul>
<li>Claim: Declaration information, presented in a brief format (such as the format on an ID card).</li>
<li>Claims Provider: Declaration information provider (e.g. Authorization Server in OAuth 2.0 is able to return Id token, which carries the declaration information).</li>
<li><strong>End-User(EU)</strong> : Human participant (the person who completes the authentication activity).</li>
<li>ID Token: A declaration (Claim) containing EU identity information, stored and delivered in JWT (Json Web Token) format. jWT has features such as self-containedness, compactness, and tamper-proof mechanism. JWT is self-contained, compact and tamper-proof, so that ID Token can be securely passed to third-party applications and easily verified.</li>
<li><strong>OpenID Provider (OP)</strong> : The service provider that provides authentication, the Authorization Server (Authorization Server) in OAuth 2.0, used to provide authentication services and return Claim information to third-party applications (Relying Party).</li>
<li><strong>Relying Party (RP)</strong>: trusted third-party application (Client in OAuth2.0) that requires the EU to complete authentication and obtain Claim information from the OP.</li>
<li>UserInfo Endpoint : An interface for user information that can return the identity information of the current user when the RP requests this interface using an Access token.</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/04/01/9fc874d95a7e450b8bbbb45c368b01e3.png" alt="OIDC Key Terms"></p>
<h3 id="oidc-protocol-cluster">OIDC Protocol Cluster</h3>
<p>OIDC consists of a series of specification documents, including a core document and several optional supported documents to provide extended support.</p>
<ul>
<li><a href="http://openid.net/specs/openid-connect-core-1_0.html">Core</a>: mandatory. Defines the functionality of the OIDC core, building authentication on top of OAuth 2.0, and the use of declarations (such as a brief description on an ID card) to convey user information.</li>
<li><a href="http://openid.net/specs/openid-connect-discovery-1_0.html">Discovery</a>: optional. Defines how third-party applications can dynamically discover OIDC service provider metadata documents (e.g., the address of the service provided, the encryption method used, the type of authorization supported, etc.).</li>
<li><a href="http://openid.net/specs/openid-connect-registration-1_0.html">D</a><a href="http://openid.net/specs/openid-connect-registration-1_0.html">ynam</a><a href="http://openid.net/specs/openid-connect-registration-1_0.html">ic</a><a href="http://openid.net/specs/openid-connect-registration-1_0.html">R</a><a href="http://openid.net/specs/openid-connect-registration-1_0.html">e</a><a href="http://openid.net/specs/openid-connect-registration-1_0.html">gist</a><a href="http://openid.net/specs/openid-connect-registration-1_0.html">r</a><a href="http://openid.net/specs/openid-connect-registration-1_0.html">aation</a>: optional. Defines how the third party application registers to the OIDC identity provider.</li>
<li><a href="http://openid.net/specs/oauth-v2-multiple-response-types-1_0.html">OAuth 2.0 Multiple Response Types</a>: defines several new for OAuth 2.0 response methods (the original common authorization code code, implicit authorization token on top of the id_token and a mix of code, token and id_token).</li>
<li><a href="http://openid.net/specs/oauth-v2-form-post-response-mode-1_0.html">OAuth 2.0 Form Post Response Mode</a>: optional. Extends OAuth 2.0 response parameters with those required for OIDC. Provides a mode based on form form response information passed to third-party applications using the post request type, with the response parameters stored in the body in application/x-www-form-urlencoded format.</li>
<li><a href="https://openid.net/specs/openid-connect-rpinitiated-1_0.html">RP-Initiated Logout</a>: Optional. Defines the mechanism for how a third-party application logs out the currently logged-in user.</li>
<li><a href="http://openid.net/specs/openid-connect-session-1_0.html">Session Management</a>: Optional. Defines how to manage the session data of logged-in users on the OIDC so that when a user on the OP logs out, it can also be easily logged out on the RP.</li>
<li><a href="http://openid.net/specs/openid-connect-frontchannel-1_0.html">Front-Channel Logout</a>: optional. Front-Channel Logout based mechanism, so that third-party applications do not need to embed the authentication service provider&rsquo;s iframe to logout.</li>
<li><a href="http://openid.net/specs/openid-connect-backchannel-1_0.html">Back-Channel Logout</a>: optional. Based on the back-end logout mechanism, defines how RP and OP communicate directly to complete logout.</li>
<li><a href="https://openid.net/specs/openid-connect-federation-1_0.html">OpenID Connect Federation</a>: optional. Defines the mechanism how to establish reliable trust between OP and RP.</li>
<li><a href="https://openid.net/specs/openid-connect-prompt-create-1_0.html">Initiating User Registration via OpenID Connect</a>: Optional. Provides a mechanism to allow a way to be able to register users on the OP when instructed to do so by the RP.
As shown in the figure below, the upper part describes the protocol cluster of OIDC and the core specification of the most central part of it. The lower part is used as the other protocol specifications that support OIDC.</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/04/01/081e3cf967a843d480e0816c33a8dfee.png" alt="open id connect"></p>
<p>For these protocols, it may look confusing, just briefly understand the concept, the actual development of these will gradually come to the surface.</p>
<h2 id="oidc--openid-20-differences">OIDC &amp; OpenID 2.0 Differences</h2>
<ul>
<li>OpenID Connect performs many of the same tasks as OpenID 2.0, but the API is more user-friendly and can be used in both native and mobile applications.</li>
<li>OpenID Connect defines optional mechanisms for reliable signatures and encryption.</li>
<li>Integration of OAuth 1.0a and OpenID 2.0 requires extensions, while OIDC itself integrates with OAuth 2.0.</li>
</ul>
<h2 id="oidc--oauth20-differences">OIDC &amp; OAuth2.0 differences</h2>
<p>OIDC still uses the authorization server in OAuth to give the user authentication information to the third-party application in the form of Id token, the third-party application can verify the user ID and get the basic information of the user from it as well as access the user details through the authorization process of OAuth2.0. As shown in the figure below, the authentication protocols such as WS-Fed and OIDC are used for the user authentication part, and the OAuth2.0 protocol is used for the access control of resources.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/04/01/dcefdaa1943c4e06b3e37a79b4a9aaa0.png" alt="oauth2"></p>
<p>The Id token in OIDC and the core Access token in OAuth2.0 each have different validity or focus parts.</p>
<ul>
<li>OAuth2 provides <code>Access Token</code> to address the issue of authorizing third party applications to access protected resources.</li>
<li>OIDC follows the OAuth2.0 protocol flow and provides <code>ID Token</code> on top of that to address the issue of third-party applications identifying users.</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/04/01/17bdfd4501dd4149b8332298a5c5911c.png" alt="OAuth2 OIDC"></p>
<h2 id="oidc-abstraction-process">OIDC abstraction process</h2>
<p>The OIDC process consists of the following 5 main steps.</p>
<ol>
<li>a third party application (RP) sends an authentication request to the authentication service provider (OP).</li>
<li>the user authenticates and selects authorization content on the authentication page.</li>
<li>the authentication service provider (OP) verifies the authentication request and sends Id token and Access token to the third party application (RP).</li>
<li>the third party application can use the Access token to request user information or other resources within the authorization.</li>
<li>the resource service verifies the Access token and returns the user information or resources.</li>
</ol>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/04/01/68cca87ffc3a4cb7b4da00c504360469.png" alt="OIDC process"></p>
<p>Process, in OAuth2.0 in the authorization code mode and implicit authorization mode, OIDC and OAuth2.0 is the same, but there are several authorization modes in some cases, in OIDC does not exist, when the user does not need to go through the authentication process to get Access token, such as the following two modes.</p>
<ul>
<li>Resource Owner Password Credentials Grant (Resource Owner Password Credentials Grant): Third-party applications can obtain the user&rsquo;s login credentials can directly request Access token from the authorization server, so that the process of identifying the user&rsquo;s identity is eliminated.</li>
<li>Client Credentials Grant: This is to identify the client, the direct participants are not added to the process, and there is no identification of who the user is.</li>
</ul>
<h2 id="several-authentication-methods-of-oidc">Several authentication methods of OIDC</h2>
<p>OIDC&rsquo;s authentication flow is mainly extended from several authorization flows of OAuth2, mainly the following 3 types.</p>
<ul>
<li>Authorization Code Flow: Based on OAuth2&rsquo;s authorization code flow, an Id token is added on top of the original code for Access token.</li>
<li>Implicit Flow: Based on OAuth2&rsquo;s Implicit Flow, an Id token is added to the original redirection from the authorization server to the third-party application that returns only the Access token.</li>
<li>Hybrid Flow: Hybrid Flow (Authorization Code Flow) and Implicit Flow (Implici Flow), which can control the return position of Id token and the presence or absence of Access token according to the different parameters configuration.
Note: As above, Refresh token is omitted to focus on Id token and Access token.</li>
</ul>
<h3 id="authorization-code-flow">Authorization code flow</h3>
<ol>
<li>
<p>The third-party application redirects to the authentication page of the authorization server (OP) through the browser to authenticate the user and perform the authorization process. The parameters used in the redirection are based on most of the parameters in OAuth 2.0. The main ones are as follows</p>
<ul>
<li>scope: mandatory. The scope of the selected authorization, when it is an OIDC request, you need to include the openid option, as shown in the following example.</li>
<li>response_type: mandatory. Response type method, when using the authorization code process, for code.</li>
<li>client_id: Required. The id value obtained by the third-party application by registering with the authorization server in advance.</li>
<li>redirect_uri: Mandatory. Redirects to the address of the RP after the OP authentication authorization is completed.</li>
<li>state: Recommended. A string provided by the third-party application (RP) that the authorization server (OP) will return to the third-party application (RP) as is, to block CSRF attacks.
The above parameters are commonly used in the authorization code process, in fact there are many other parameters that can be used according to different scenarios. Additional parameter information <a href="https://openid.net/specs/openid-connect-core-1_0.html#AuthRequest">https://openid.net/specs/openid-connect-core-1_0.html#AuthRequest</a></li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/04/01/60aebc7f3a134f029ffb86cf8b90c963.png" alt="Authorization code flow"></p>
</li>
<li>
<p>When the user finishes filling in the authentication information and executing the authorization operation, the authorization server (OP) reviews the user&rsquo;s authentication information and verifies the authorization scope. After validation, it redirects to the callback address (redirect_uri in step 1) specified by the third party application (RP), and appends the code and state parameters as query parameters to the callback address.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/04/01/9a686adc9f9a4038b9c8032b70b92c3c.png" alt="Authorization code flow"></p>
</li>
<li>
<p>The third-party application (RP) requests the Token EndPoint of the authentication service provider via code in exchange for a Token.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/04/01/5b065d9a12bf48bfa34b867e6236c26c.png" alt="Authorization code flow"></p>
<p>Token EndPoint then returns the response Token, which appends a <strong>id_token</strong> field in addition to some of the data specified by OAuth2.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;access_token&#34;</span><span class="p">:</span> <span class="s2">&#34;SlAV32hkKG&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;token_type&#34;</span><span class="p">:</span> <span class="s2">&#34;Bearer&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;refresh_token&#34;</span><span class="p">:</span> <span class="s2">&#34;8xLOxBtZp8&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;expires_in&#34;</span><span class="p">:</span> <span class="mi">3600</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;id_token&#34;</span><span class="p">:</span> <span class="s2">&#34;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>Request user information or resources within the license.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/04/01/553671cc0a89430db29b9ee599e8ca99.png" alt="Authorization code flow"></p>
</li>
</ol>
<h3 id="implicit-process">Implicit process</h3>
<p>In OAuth 2.0, the response_type used for implicit authorization is token, while in OIDC, it changes to id_token token or only id_token, and when only id_token is used, no Access token is returned. The rest of the parameters are the same as the implicit authorization in OAuth 2.0. However, OIDC adds an additional parameter nonce compared to OAuth2.0 implicit process</p>
<ul>
<li>nonce: required. String value to associate a third-party application session with an Id token and to mitigate replay attacks. The value is passed unmodified from the authentication request into the Id token. To prevent an attacker from guessing the value, sufficient entropy must be present in the random value.</li>
</ul>
<p>Note: The difference between the state of OAuth 2.0 and the nonce of OIDC in the implicit process</p>
<p><a href="https://stackoverflow.com/questions/46844285/difference-between-oauth-2-0-state-and-openid-nonce-parameter-why-state-cou">https://stackoverflow.com/questions/46844285/difference-between-oauth-2-0-state-and-openid-nonce-parameter-why-state-cou</a></p>
<ol>
<li>
<p>The third-party application (RP) carries parameters to jump to the authentication authorization page of the authorization server (OP) and waits for the user to authenticate and execute the authorization.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/04/01/654d2955c61b4f57b41378eb31632060.png" alt="Implicit process"></p>
</li>
<li>
<p>When the authorization server (OP) completes the review of user authentication information and verification of authorization scope, it redirects back to the third-party application (RP) and returns id token, access token according to the response_type at the time of request (not returned when only id_token is set). Note the hash part of the url (after #).</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/04/01/5955a11322ac46799e75dc9818d2e456.png" alt="Implicit process"></p>
</li>
<li>
<p>This is followed by a request for user information or resources within the license.</p>
</li>
</ol>
<h3 id="hybrid-process">Hybrid process</h3>
<p>This is a combination of an authorization code and an implicit flow, where part of the token comes from the authorization server (OP) when it redirects to the third-party application (RP), and part of it comes from the third-party application (RP) when it makes a request to the authorization server (OP). In this process, the response_type can be mixed, such as code id_token, code token or code id_token token.</p>
<ol>
<li>
<p>The third party application (RP) initiates an authentication request to the authorization server (OP). Here the combination of authorization code and implicitly only id_token is used.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/04/01/deb38585de1741b193d7eb13c543cd9a.png" alt="Hybrid process"></p>
</li>
<li>
<p>When the authorization server (OP) finishes reviewing user authentication information and verifying the scope of authorization, it redirects back to the third-party application (RP) and returns id token and access token according to the response_type of the request (not returned when only id_token is set).</p>
<ul>
<li>access_token: When there is a token option in response_type, access_token will be returned.</li>
<li>id_token: When there is an id_token option in response_type, then id_token will be returned.</li>
<li>code: this is mandatory in mixed processes, so code is always returned.</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/04/01/cd26a7a6482a46b3bb80423011923b26.png" alt="Hybrid process"></p>
</li>
<li>
<p>The third-party application (RP) requests the authorization server (OP) to exchange Token via code. this is the same as the authorization code process now.</p>
</li>
</ol>
<h2 id="id-token-format">Id token format</h2>
<p>The ID Token returned by the authentication service needs to strictly adhere to the definition of JWT (JSON Web Token), the following are the details of the definition of JWT (JSON Web Token).</p>
<ul>
<li>
<p><strong>iss=Issuer Identifier</strong> : Required. Unique identifier of the authentication service, a case-sensitive https URL that does not contain query and fragment components.</p>
</li>
<li>
<p><strong>sub=Subject Identifier</strong> : Required. iss provides an identifier for the end user, unique within iss, up to 255 ASCII characters, case-sensitive.</p>
</li>
<li>
<p><strong>aud=Audience(s)</strong> : Required. Identifies the audience of the ID Token, must contain the client_id of OAuth2, case-sensitive string array.</p>
</li>
<li>
<p><strong>exp=Expiration time</strong> : Required. ID Token after this time will be invalidated.</p>
</li>
<li>
<p><strong>iat=Issued At Time</strong> : Required. time of the JWT build.</p>
</li>
<li>
<p><strong>auth_time=AuthenticationTime</strong> : The time when the end user completes authentication.</p>
</li>
<li>
<p><strong>nonce</strong> : Random string provided when sending an authentication request, used to mitigate replay attacks, can also be used to associate client-side Sessions. if nonce exists, third-party applications must verify the nonce.</p>
</li>
<li>
<p><strong>acr=Authentication Context Class Reference</strong> : Optional. Indicates an authentication context reference value that can be used to identify the authentication context class.</p>
</li>
<li>
<p><strong>amr=Authentication Methods References</strong> : Optional. Indicates a set of authentication methods.</p>
</li>
<li>
<p><strong>azpAuthorized party</strong> : Optional. Used in conjunction with aud. This value is used only if the authenticated party and the audience (aud) do not match, and is rarely used in general.
The following is an example of a typical ID Token.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;exp&#34;</span><span class="p">:</span> <span class="mi">1614187991</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;iss&#34;</span><span class="p">:</span> <span class="s2">&#34;https://authorization-server.com/oauth&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;sub&#34;</span><span class="p">:</span> <span class="s2">&#34;a0903223-a120-91e0-c342-10bd237c24c1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;aud&#34;</span><span class="p">:</span> <span class="s2">&#34;client1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;iat&#34;</span><span class="p">:</span> <span class="mi">1614151991</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;auth_time&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;nonce&#34;</span><span class="p">:</span> <span class="s2">&#34;n-0S6_WzA2Mj&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;acr&#34;</span><span class="p">:</span> <span class="s2">&#34;1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;azp&#34;</span><span class="p">:</span> <span class="s2">&#34;client1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;nbf&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;typ&#34;</span><span class="p">:</span> <span class="s2">&#34;ID&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;session_state&#34;</span><span class="p">:</span> <span class="s2">&#34;150df80e-92a1-4b0c-a5c5-8c858eb5a848&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;userId&#34;</span><span class="p">:</span> <span class="s2">&#34;123456&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;preferred_username&#34;</span><span class="p">:</span> <span class="s2">&#34;testera&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;given_name&#34;</span><span class="p">:</span> <span class="s2">&#34;tester&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;family_name&#34;</span><span class="p">:</span> <span class="s2">&#34;a&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;email&#34;</span><span class="p">:</span> <span class="s2">&#34;testera@myweb.com&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<p>See <a href="https://openid.net/specs/openid-connect-core-1_0.html">OpenID Connect Core 1.0</a> for a more detailed definition of ID Token.</p>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/oidc/">oidc</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2022-04/postgresql-mac-startup-failure/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Resolving PostgreSQL service startup failure on macOS</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2022-04/spring-officials-announced-vulnerability/">
            <span class="next-text nav-default">Spring official announcement of the network of large vulnerabilities, with solutions</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  <script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox-3.1.20.min.js"></script>



<script type="text/javascript" src="/js/main.min.64437849d125a2d603b3e71d6de5225d641a32d17168a58106e0b61852079683.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
