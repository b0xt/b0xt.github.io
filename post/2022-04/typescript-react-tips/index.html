<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Some tips on TypeScript combined with React development - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="Explore some tips for TypeScript combined with React development." /><meta name="keywords" content="Typescript, react" />






<meta name="generator" content="Hugo 0.102.0 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2022-04/typescript-react-tips/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link href="/lib/fancybox/jquery.fancybox-3.1.20.min.css" rel="stylesheet">


<meta property="og:title" content="Some tips on TypeScript combined with React development" />
<meta property="og:description" content="Explore some tips for TypeScript combined with React development." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2022-04/typescript-react-tips/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-04-23T13:00:01+08:00" />
<meta property="article:modified_time" content="2022-04-23T13:00:01+08:00" />

<meta itemprop="name" content="Some tips on TypeScript combined with React development">
<meta itemprop="description" content="Explore some tips for TypeScript combined with React development."><meta itemprop="datePublished" content="2022-04-23T13:00:01+08:00" />
<meta itemprop="dateModified" content="2022-04-23T13:00:01+08:00" />
<meta itemprop="wordCount" content="2667">
<meta itemprop="keywords" content="Typescript,react," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Some tips on TypeScript combined with React development"/>
<meta name="twitter:description" content="Explore some tips for TypeScript combined with React development."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SOBYTE</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SOBYTE</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Some tips on TypeScript combined with React development</h1>

      <div class="post-meta">
        <span class="post-time"> 2022-04-23 13:00:01 </span>
        <div class="post-category">
            <a href="/categories/tutorials/"> tutorials </a>
            </div>
          <span class="more-meta"> 2667 words </span>
          <span class="more-meta"> 6 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#using-automatic-inference">Using automatic inference</a></li>
        <li><a href="#tool-types">Tool types</a></li>
        <li><a href="#introduce-some-ambiguity-where-appropriate">Introduce some ambiguity where appropriate</a>
          <ul>
            <li><a href="#declare-global-declarations">declare global declarations</a></li>
            <li><a href="#declaring-merge">Declaring merge</a></li>
          </ul>
        </li>
        <li><a href="#type-of-useref">Type of useRef</a></li>
        <li><a href="#type-narrowing-and-conditional-rendering">Type Narrowing and Conditional Rendering</a></li>
        <li><a href="#how-to-solve-too-much-conditional-rendering">How to solve too much conditional rendering</a>
          <ul>
            <li><a href="#component-factory">Component factory?</a></li>
            <li><a href="#combination">Combination?</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>TypeScript is a superset of JavaScript that brings static type support to JS, which can help us write clearer and more reliable interfaces and bring better IDE hints. It&rsquo;s been a while since I&rsquo;ve used TypeScript with React in a front-end project, and it&rsquo;s time to write a blog summary to share. The following is a list of some points that I personally find helpful in doing projects.</p>
<h2 id="using-automatic-inference">Using automatic inference</h2>
<p><code>TypeScript</code> has some ability to infer types, which in some cases allows programmers to be lazy and write fewer types.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="c1">// 无需标注变量类型
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">foo</span> <span class="o">=</span> <span class="s1">&#39;123&#39;</span> <span class="c1">// string
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">bar</span> <span class="o">=</span> <span class="mi">123</span> <span class="c1">// number
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">baz</span> <span class="o">=</span> <span class="nx">str</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/[A-Z]/</span><span class="p">)</span> <span class="c1">// RefExpMatchArray | null
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>When passing an arrow function to component props, the arrow function does not need to be typed if the props have a type.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kr">type</span> <span class="nx">FieldProps</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">onChange</span><span class="o">:</span> <span class="p">(</span><span class="nx">value</span>: <span class="kt">number</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">void</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">Field</span> <span class="na">onChange</span><span class="o">=</span><span class="p">{</span><span class="nx">value</span> <span class="o">=&gt;</span> <span class="nx">setValue</span><span class="p">(</span><span class="nx">value</span><span class="p">)}</span> <span class="p">/&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Also, don&rsquo;t forget that <strong>functions in TS/JS are first class citizens</strong>, for example, if you need to write a function to separate numbers by three digits, you may find that there is an <code>Intl</code> module that can help.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="c1">// 并不需要这要做
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">function</span> <span class="nx">numberWithDelimiter</span><span class="p">(</span><span class="nx">raw</span>: <span class="kt">number</span><span class="p">)</span><span class="o">:</span> <span class="kt">string</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="k">new</span> <span class="nx">Intl</span><span class="p">.</span><span class="nx">NumberFormat</span><span class="p">(</span><span class="s1">&#39;en-US&#39;</span><span class="p">).</span><span class="nx">format</span><span class="p">(</span><span class="nx">raw</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 只要一个简单的赋值就行，numberWithDelimiter类型与format方法完全一致
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">numberWithDelimiter</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Intl</span><span class="p">.</span><span class="nx">NumberFormat</span><span class="p">(</span><span class="s1">&#39;en-US&#39;</span><span class="p">).</span><span class="nx">format</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="tool-types">Tool types</h2>
<p>If there are some third-party components referenced in the project that have some common attributes across all uses, such as <code>&lt;Input type=&quot;number&quot; ... /&gt;</code>, all <code>type</code>s have to be fixed to number, and we generally have to extract a component out.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kr">type</span> <span class="nx">MyInputProps</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">value</span>: <span class="kt">number</span>
</span></span><span class="line"><span class="cl">  <span class="nx">onChange</span><span class="o">:</span> <span class="p">(</span><span class="nx">value</span>: <span class="kt">number</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">void</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">MyInput</span>: <span class="kt">React.FC</span><span class="p">&lt;</span><span class="nt">MyInputProps</span><span class="p">&gt;</span> <span class="o">=</span> <span class="nx">props</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="p">&lt;</span><span class="nt">Input</span> <span class="na">type</span><span class="o">=</span><span class="err">&#34;</span><span class="na">number</span> <span class="p">{</span><span class="na">...props</span><span class="p">}</span> <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>This is essentially writing a <em>biased function</em>, but if the referenced third-party library has a complete type declaration, writing it this way rewrites the original type of the third-party library and can save code by declaring the component props type this way.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kr">import</span> <span class="kr">type</span> <span class="p">{</span> <span class="nx">InputProps</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;lib&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">type</span> <span class="nx">MyInputProps</span> <span class="o">=</span> <span class="nx">Omit</span><span class="p">&lt;</span><span class="nt">InputProps</span><span class="err">,</span> <span class="err">&#34;</span><span class="na">type</span><span class="err">&#34;</span><span class="p">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>Omit</code> is a TS <strong>tool type</strong> that does exactly what its name suggests, it takes some attributes out of a type. In the above example, the use of Omit avoids duplicate declarations of existing third-party types. TS also has a number of useful <a href="https://www.typescriptlang.org/docs/handbook/utility-types.html">tool types</a>, such as <code>Pick</code> which extracts some properties from existing types to form new types, <code>NonNullable</code> to remove <code>null</code> and <code>undefined</code>, <code>Parameters</code> and <code>ReturnType</code> to get the types of function parameters and return values, etc., which can be used flexibly as needed.</p>
<h2 id="introduce-some-ambiguity-where-appropriate">Introduce some ambiguity where appropriate</h2>
<blockquote>
<p>Explicit is better than implicit.</p>
</blockquote>
<p>The above quote is from <em>The Zen of Python</em>, but what exactly is <code>explicit</code> and what is <code>implicit</code>? Take <code>Ant Design Pro</code> for example, which provides a way to inject global variables.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kr">export</span> <span class="k">default</span> <span class="nx">defineConfig</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">define</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">API_URL</span><span class="o">:</span> <span class="s1">&#39;https://api-test.xxx.com&#39;</span><span class="p">,</span> <span class="c1">// API地址
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">API_SECRET_KEY</span><span class="o">:</span> <span class="s1">&#39;XXXXXXXXXXXXXXXX&#39;</span><span class="p">,</span> <span class="c1">// API调用密钥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>It&rsquo;s fine if all the developers on the team are familiar with this feature, but if a new member of the team joins the team and sees that the code somewhere uses this global variable and the IDE can&rsquo;t jump to the definition, the mind will be full of doubts. I prefer to explicitly declare what I want to introduce where I need it.</p>
<p>However, there are some tolerable ambiguities in <code>TypeScript</code>.</p>
<h3 id="declare-global-declarations">declare global declarations</h3>
<p>In the early days of <code>TypeScript</code>, when many popular libraries used only <code>JavaScript</code> without type declarations, there were type definition files with the &ldquo;d.ts&rdquo; suffix that could add types to JS code.</p>
<p>TS itself comes with some declaration files, such as the declaration of the browser global object <code>window</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="c1">// typescript/lib/lib.dom.d.ts
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">declare</span> <span class="kd">var</span> <span class="nb">window</span><span class="o">:</span> <span class="nx">Window</span> <span class="o">&amp;</span> <span class="k">typeof</span> <span class="nx">globalThis</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>This can also be used to declare types for your own code, and I&rsquo;m used to using it in the following way.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="c1">// API.d.ts
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">declare</span> <span class="kr">namespace</span> <span class="nx">API</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">export</span> <span class="kr">type</span> <span class="nx">Production</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="p">...</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 需要使用的地方无需import
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">function</span> <span class="nx">getProduction</span><span class="p">()</span><span class="o">:</span> <span class="nx">API</span><span class="p">.</span><span class="nx">Production</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Although there is no explicit import, the jump definition of the IDE works fine, and since it is only a type definition, it does not generate unexpected runtime errors, eliminating an import statement I think is more beneficial than harmful. You can encapsulate all the interface response values in a module, and if you use a tool like <code>OpenAPI</code> on the backend, you can also use some plugins like <a href="https://www.npmjs.com/package/openapi-typescript">openapi-typescript</a> to directly export a type file for the interface. exporting a type file.</p>
<h3 id="declaring-merge">Declaring merge</h3>
<p>I&rsquo;m usually more comfortable declaring types with <code>type</code>, but sometimes a more &ldquo;dirty&rdquo; feature of <code>interface</code> can come in handy.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kr">interface</span> <span class="nx">User</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">name</span>: <span class="kt">string</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">interface</span> <span class="nx">User</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">age</span>: <span class="kt">number</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 同名是合法的，同名interface会被合并，等价于
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">interface</span> <span class="nx">User</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">name</span>: <span class="kt">string</span>
</span></span><span class="line"><span class="cl">  <span class="nx">age</span>: <span class="kt">number</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>This feature of <code>interface</code>, together with the <a href="https://www.typescriptlang.org/docs/handbook/declaration-merging.html#module-augmentation">module augmentation</a> feature, can help library developers to provide better extensibility to users. For example <a href="https://mui.com/">MUI</a> to customize the theme configuration.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kr">import</span> <span class="o">*</span> <span class="kr">as</span> <span class="nx">React</span> <span class="kr">from</span> <span class="s1">&#39;react&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">createTheme</span><span class="p">,</span> <span class="nx">ThemeProvider</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;@mui/material/styles&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">Button</span> <span class="kr">from</span> <span class="s1">&#39;@mui/material/Button&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">theme</span> <span class="o">=</span> <span class="nx">createTheme</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">palette</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">neutral</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">main</span><span class="o">:</span> <span class="s1">&#39;#64748B&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">contrastText</span><span class="o">:</span> <span class="s1">&#39;#fff&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">declare</span> <span class="nx">module</span> <span class="s1">&#39;@mui/material/styles&#39;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">interface</span> <span class="nx">Palette</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">neutral</span>: <span class="kt">Palette</span><span class="p">[</span><span class="s1">&#39;primary&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// allow configuration using `createTheme`
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">interface</span> <span class="nx">PaletteOptions</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">neutral?</span>: <span class="kt">PaletteOptions</span><span class="p">[</span><span class="s1">&#39;primary&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Update the Button&#39;s color prop options
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">declare</span> <span class="nx">module</span> <span class="s1">&#39;@mui/material/Button&#39;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">interface</span> <span class="nx">ButtonPropsColorOverrides</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">neutral</span>: <span class="kt">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="nx">CustomColor() {</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">ThemeProvider</span> <span class="na">theme</span><span class="o">=</span><span class="p">{</span><span class="nx">theme</span><span class="p">}&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">Button</span> <span class="na">color</span><span class="o">=</span><span class="s">&#34;neutral&#34;</span> <span class="na">variant</span><span class="o">=</span><span class="s">&#34;contained&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nx">neutral</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;/</span><span class="nt">Button</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">ThemeProvider</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>This expands the original type definition of the MUI, and <code>neutral</code> becomes a legal <code>color</code> value.</p>
<h2 id="type-of-useref">Type of useRef</h2>
<p><code>useRef</code> is described in React&rsquo;s documentation as.</p>
<blockquote>
<p>useRef returns a mutable ref object whose .current property is initialized to the passed in parameter (initialValue). The returned ref object persists throughout the component&rsquo;s lifecycle.</p>
</blockquote>
<p><code>useRef</code> or <code>createRef</code> is often misunderstood as being used to get the DOM node of a child component, but in fact its argument can be any object, and since the ref object returned by <code>useRef</code> still holds a reference to the same object even if the component is re-rendered, it can be used to handle some complex closure scenarios.</p>
<p>When <code>TypeScript</code> is combined with <code>useRef</code>, if you try to assign a value to the current of the object it returns, you sometimes get an incomprehensible type error: <code>Cannot assign to current because it is a read-only.</code> This is strange, why is current immutable?</p>
<p>It is worth mentioning that React itself has type checking in the development environment, but instead of <code>TypeScript</code>, Facebook&rsquo;s own <code>FlowJS</code> is used. Check out <code>useRef</code>&rsquo;s <a href="https://github.com/facebook/react/blob/42f15b324f50d0fd98322c21646ac3013e30344a/packages/react/src/ReactHooks.js#L96">source code</a>, its type is a normal generic function: <code>T =&gt; { current: T }</code>, but we use <code>TypeScript</code> to do static type checking when developing React applications, and actually rely on the <code>@types/react</code> library, and looking at the source code, we can see that here <code>useRef</code> does use the overload.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">useRef</span><span class="p">&lt;</span><span class="nt">T</span><span class="p">&gt;(</span><span class="nx">initialValue</span>: <span class="kt">T</span><span class="p">)</span><span class="o">:</span> <span class="nx">MutableRefObject</span><span class="p">&lt;</span><span class="nt">T</span><span class="p">&gt;;</span>
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">useRef</span><span class="p">&lt;</span><span class="nt">T</span><span class="p">&gt;(</span><span class="nx">initialValue</span>: <span class="kt">T</span><span class="o">|</span><span class="kc">null</span><span class="p">)</span><span class="o">:</span> <span class="nx">RefObject</span><span class="p">&lt;</span><span class="nt">T</span><span class="p">&gt;;</span>
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">useRef</span><span class="p">&lt;</span><span class="nt">T</span> <span class="err">=</span> <span class="na">undefined</span><span class="p">&gt;()</span><span class="o">:</span> <span class="nx">MutableRefObject</span><span class="p">&lt;</span><span class="nt">T</span> <span class="err">|</span> <span class="na">undefined</span><span class="p">&gt;;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>As you can probably tell from the type name, if the return value is <code>MutableRefObject&lt;T&gt;</code> it should not report an error, and it does. The <code>current</code> property inside <code>RefObject</code> is <code>readonly</code>. To avoid this error, you can use <code>useRef</code> like this.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">ref</span> <span class="o">=</span> <span class="nx">useRef</span><span class="p">&lt;</span><span class="nt">number</span> <span class="err">|</span> <span class="na">null</span><span class="p">&gt;(</span><span class="kc">null</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>If you use <code>useRef&lt;sometype&gt;(null)</code>, then <code>sometype</code> matches the generic type <code>T</code>, the argument matches <code>T | null</code>, and the whole call matches <code>useRef&lt;T&gt;(initialValue: T | null): RefObject&lt;T&gt;</code>, while if you use <code>useRef&lt;sometype | null&gt;(null)</code>, then the union type <code>sometype | null</code> matches the generic parameter <code>T</code>, the parameter <code>initialValue</code> is also of type <code>T</code>, and the function call matches <code>useRef&lt;T&gt;(initialValue: T): MutableRefObject&lt;T&gt;</code> . In the <code>Rust</code> community, we sometimes call this <em>&ldquo;type-levelling &ldquo;</em>, and it&rsquo;s a bit like leveling a chemical equation :)</p>
<p><strong>Off-topic</strong> : This <a href="https://github.com/DefinitelyTyped/DefinitelyTyped/issues/31065">issue</a> contains a discussion of why <code>@types/react</code> is labeled <code>useRef</code> types the way it is.</p>
<h2 id="type-narrowing-and-conditional-rendering">Type Narrowing and Conditional Rendering</h2>
<p>The term <code>type narrowing</code> may not be very common, but it is likely that you have used it without realizing it, and the most common would be a non-empty judgment like this.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">Foo() {</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">data</span>: <span class="kt">string</span><span class="p">[]</span> <span class="o">|</span> <span class="kc">undefined</span> <span class="o">=</span> <span class="nx">useRequest</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// data: undefined
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">return</span> <span class="s1">&#39;Not found&#39;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// data: string[]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span><span class="nx">data</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">item</span> <span class="o">=&gt;</span> <span class="p">&lt;</span><span class="nt">li</span> <span class="na">key</span><span class="o">=</span><span class="p">{</span><span class="nx">item</span><span class="p">}&gt;{</span><span class="nx">item</span><span class="p">}&lt;/</span><span class="nt">li</span><span class="p">&gt;)}</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The original type of <code>data</code> is <code>string[] | undefined</code>, which is a union type, but when it enters the <code>if</code> branch, the type of data is just <code>undefined</code>, which becomes &ldquo;narrow&rdquo;, and since <code>return</code> is eventually used in this branch, when it leaves the After leaving this branch, the type of <code>data</code> becomes <code>string[]</code> and you can safely use the <code>map</code> method. Type narrowing is often intuitive, for example, in the above example, if the program is executed in the <code>if (!data)</code> branch, then <code>data</code> must not be of type <code>string[]</code>; similarly, if you enter the <code>if</code> branch and then <code>return</code>, then if <code>data</code> is <code>undefined</code>, no subsequent code will be executed If <code>data</code> is <code>undefined</code>, then if <code>data</code> is <code>string[]</code>, the code must not be executed after <code>if</code>, and vice versa. Operations like <code>instanceof</code>, <code>in</code>, <code>switch</code>, etc. can shrink types from broader to narrower ones. Also, if there is no <code>return</code> in the <code>if</code> branch, then the type of <code>data</code> is only narrowed within the <code>if</code> block, and it is not safe to use <code>map</code> later, where only <code>return</code> returns the function to eliminate the possibility of subsequent <code>data</code> types being <code>null</code>. branch to narrow the type of <code>data</code> after the branch.</p>
<p>Even if you use <code>JavaScript</code> to determine whether it is null or not, the type narrowing of <code>TypeScript</code> still brings some benefits, first of all, it ensures static type checking and cannot use methods that are not available on the current type, while In the example, the last <code>data</code> type is inferred as <code>string[]</code>, the IDE can automatically complete the related <code>map</code> method, and the callback function parameter <code>item</code> of <code>map</code> will be inferred as <code>string</code> type accordingly, so you can use <code>startWith</code> and other prototype methods on it.</p>
<p>Next, let&rsquo;s look at an example that is closer to the real project code. There is a backend application for a rental system, with a fixed page layout as shown in the figure.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/04/23/ded190be4a4449dc9eb713653f7f2a56.png" alt="fixed page layout"></p>
<p>But in the business process, there are three login roles, Admin, Landlord, and Tenant, and it stands to reason that these three roles do not see the same UI details after logging into the backend.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="c1">// 假设这是后端的数据模型
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">type</span> <span class="nx">Admin</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">id</span>: <span class="kt">number</span>
</span></span><span class="line"><span class="cl">  <span class="nx">email</span>: <span class="kt">string</span>
</span></span><span class="line"><span class="cl">  <span class="nx">password</span>: <span class="kt">string</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">type</span> <span class="nx">Landlord</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">id</span>: <span class="kt">number</span>
</span></span><span class="line"><span class="cl">  <span class="nx">name?</span>: <span class="kt">string</span>
</span></span><span class="line"><span class="cl">  <span class="nx">email</span>: <span class="kt">string</span>
</span></span><span class="line"><span class="cl">  <span class="nx">password</span>: <span class="kt">string</span>
</span></span><span class="line"><span class="cl">  <span class="nx">avatar?</span>: <span class="kt">string</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">type</span> <span class="nx">Tenant</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">id</span>: <span class="kt">number</span>
</span></span><span class="line"><span class="cl">  <span class="nx">name?</span>: <span class="kt">string</span>
</span></span><span class="line"><span class="cl">  <span class="nx">email</span>: <span class="kt">string</span>
</span></span><span class="line"><span class="cl">  <span class="nx">password</span>: <span class="kt">string</span>
</span></span><span class="line"><span class="cl">  <span class="nx">avatar?</span>: <span class="kt">string</span>
</span></span><span class="line"><span class="cl">  <span class="nx">phoneNumber</span>: <span class="kt">string</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 获取当前登录用户
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">type</span> <span class="nx">User</span> <span class="o">=</span> <span class="nx">Admin</span> <span class="o">|</span> <span class="nx">Landlord</span> <span class="o">|</span> <span class="nx">Tenant</span>
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">currentUser</span><span class="p">()</span><span class="o">:</span> <span class="nx">User</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>How easy is it to render different content according to different roles in the front-end? You can add a <em>tag</em> for each role type.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kr">type</span> <span class="nx">Admin</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="p">...</span>
</span></span><span class="line"><span class="cl">  <span class="nx">role</span><span class="o">:</span> <span class="s1">&#39;Admin&#39;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">type</span> <span class="nx">Landlord</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="p">...</span>
</span></span><span class="line"><span class="cl">  <span class="nx">role</span><span class="o">:</span> <span class="s1">&#39;Landlord&#39;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">type</span> <span class="nx">Tenant</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="p">...</span>
</span></span><span class="line"><span class="cl">  <span class="nx">role</span><span class="o">:</span> <span class="s1">&#39;Tenant&#39;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">Header</span>: <span class="kt">React.FC</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">user</span> <span class="o">=</span> <span class="nx">useUser</span><span class="p">()</span> <span class="c1">// type: User
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="k">switch</span> <span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">role</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="s1">&#39;Tenant&#39;</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// 合法，此处user类型收窄为Tenant
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="k">return</span> <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;{</span><span class="nx">user</span><span class="p">.</span><span class="nx">phoneNumber</span><span class="p">}&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="s1">&#39;Landlord&#39;</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="p">...</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="s1">&#39;Admin&#39;</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="p">...</span>
</span></span><span class="line"><span class="cl">    <span class="k">default</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">      <span class="kr">const</span> <span class="nx">exhausted</span>: <span class="kt">never</span> <span class="o">=</span> <span class="nx">user</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="kc">null</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Here <code>role</code> is not a string type, but a <em>literal type</em>, and in the <code>switch</code> statement, such an additional field helps us narrow the <code>User</code> type to a more specific type, thus changing the rendering of the component based on the role.</p>
<p>At the end I used a <code>const exhausted: never = user</code>, which is a little trick to implement mutually exclusive parameters with <code>never</code>. <code>never</code> is a <code>bottom type</code> in TS, which to save space means that no value can be assigned to <code>never</code> except for <code>never</code> itself, and since all the previous <code>cases</code> already cover all possible cases of <code>user</code> and all have <code>return</code>, the code inside <code>default</code> will not be where the type of <code>user</code> is narrowed to <code>never</code>, and the assignment is then legal. But if someone adds a new role type <code>CustomerService</code> to the union type <code>User</code>, <code>user</code> cannot be narrowed to type <code>never</code>, and a type error is generated, suggesting that a <code>case</code> needs to be added to the <code>switch</code> statement to include all cases. This achieves <em>exhaustive checking</em>.</p>
<h2 id="how-to-solve-too-much-conditional-rendering">How to solve too much conditional rendering</h2>
<p>If there is a lot of this code in the project</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="nx">user</span><span class="o">?</span><span class="p">.</span><span class="nx">role</span> <span class="o">===</span> <span class="s1">&#39;Admin&#39;</span> <span class="o">?</span> <span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span> <span class="s1">&#39;active&#39;</span> <span class="o">?</span> <span class="p">&lt;</span><span class="nt">Component1</span> <span class="p">/&gt;</span> <span class="o">:</span> <span class="p">&lt;</span><span class="nt">Comp2</span> <span class="p">/&gt;)</span> <span class="o">:</span> <span class="kc">null</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Such code, when maintained by multiple people, is likely to have more and more repeated judgments and nested judgments, which can be a headache to read and an even bigger headache to maintain. If there are a lot of conditional rendering in a project, how to keep the code tidy?</p>
<h3 id="component-factory">Component factory?</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="c1">// 在接口上定义组件类型
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">interface</span> <span class="nx">User</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">Toolbar</span>: <span class="kt">React.FC</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">Page() {</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">user</span> <span class="o">=</span> <span class="nx">userUser</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">Layout</span> <span class="na">toolbar</span><span class="o">=</span><span class="p">{&lt;</span><span class="nt">user.Toolbar</span> <span class="p">/&gt;}&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">Main</span> <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">Layout</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="combination">Combination?</h3>
<p>There may be times when we don&rsquo;t need to determine state everywhere, such as this user role issue, and can bind this state to a route that splits the page component into many widgets.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kr">type</span> <span class="nx">ContainerProps</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">navbar</span>: <span class="kt">React.ReactNode</span>
</span></span><span class="line"><span class="cl">  <span class="nx">extra?</span>: <span class="kt">React.ReactNode</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">Container</span>: <span class="kt">React.FC</span><span class="p">&lt;</span><span class="nt">ContainerProps</span><span class="p">&gt;</span> <span class="o">=</span> <span class="p">({</span> <span class="nx">navbar</span><span class="p">,</span> <span class="nx">extra</span><span class="p">,</span> <span class="nx">children</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">Header</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span><span class="nx">navbar</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span><span class="nx">extra</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;/</span><span class="nt">Header</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">Body</span><span class="p">&gt;{</span><span class="nx">children</span><span class="p">}&lt;/</span><span class="nt">Body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">Footer</span> <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Admin page
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">&lt;</span><span class="nt">Container</span> <span class="na">navbar</span><span class="o">=</span><span class="p">{&lt;</span><span class="nt">AdminNavbar</span> <span class="p">/&gt;}</span> <span class="na">extra</span><span class="o">=</span><span class="p">{&lt;</span><span class="nt">OnlyAdmin</span> <span class="p">/&gt;}&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">Main</span> <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">Container</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Landlord page
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">&lt;</span><span class="nt">Container</span> <span class="na">navbar</span><span class="o">=</span><span class="p">{&lt;</span><span class="nt">LandlordNavbar</span> <span class="p">/&gt;}&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">Landlord</span> <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">Container</span><span class="p">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In the routing component we will render different page components depending on the role, the similarities in these components can be extracted to a common container and the differences passed through <code>props</code>, some elements unique to the page can be defined as optional properties, <code>undefined</code> and <code>null</code> are both legal JSX elements but will not be rendered. I personally prefer this declarative style of writing.</p>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/typescript/">Typescript</a>
          <a href="/tags/react/">react</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2022-04/rust-object-oriented/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Rust Object Oriented</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2022-04/victoriametrics-getting-started/">
            <span class="next-text nav-default">Prometheus Long Term Remote Storage Solution VictoriaMetrics Getting Started</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  <script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox-3.1.20.min.js"></script>



<script type="text/javascript" src="/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js"></script>








</body>
</html>
