<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>RTSP Protocol Explained - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="Explore the RTSP protocol." /><meta name="keywords" content="Rtsp Protocol" />






<meta name="generator" content="Hugo 0.101.0 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2022-07/rtsp-explain/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link href="/lib/fancybox/jquery.fancybox-3.1.20.min.css" rel="stylesheet">


<meta property="og:title" content="RTSP Protocol Explained" />
<meta property="og:description" content="Explore the RTSP protocol." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2022-07/rtsp-explain/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-07-29T13:02:25+08:00" />
<meta property="article:modified_time" content="2022-07-29T13:02:25+08:00" />

<meta itemprop="name" content="RTSP Protocol Explained">
<meta itemprop="description" content="Explore the RTSP protocol."><meta itemprop="datePublished" content="2022-07-29T13:02:25+08:00" />
<meta itemprop="dateModified" content="2022-07-29T13:02:25+08:00" />
<meta itemprop="wordCount" content="1312">
<meta itemprop="keywords" content="Rtsp," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="RTSP Protocol Explained"/>
<meta name="twitter:description" content="Explore the RTSP protocol."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SOBYTE</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SOBYTE</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">RTSP Protocol Explained</h1>

      <div class="post-meta">
        <span class="post-time"> 2022-07-29 13:02:25 </span>
        <div class="post-category">
            <a href="/categories/tutorials/"> tutorials </a>
            </div>
          <span class="more-meta"> 1312 words </span>
          <span class="more-meta"> 7 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#a-detailed-introduction-to-several-protocols">A detailed introduction to several protocols</a></li>
        <li><a href="#overall-communication-process-overview">overall communication process overview</a></li>
        <li><a href="#rtsp-protocol">RTSP protocol</a>
          <ul>
            <li><a href="#options-request">OPTIONS request</a></li>
            <li><a href="#describe-request">DESCRIBE request</a></li>
            <li><a href="#setup-request">SETUP request</a></li>
            <li><a href="#play-request">PLAY request</a></li>
            <li><a href="#teardown-request">TEARDOWN request</a></li>
          </ul>
        </li>
        <li><a href="#rtcp-protocol">RTCP Protocol</a></li>
        <li><a href="#rtp-protocol">RTP Protocol</a></li>
        <li><a href="#summary">Summary</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>When we talk about RTSP, it is actually not only the RTSP protocol itself, but we will actually inevitably talk about the following protocols.</p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Real-time_Transport_Protocol">RTP</a> (Real-time Transport Protocol): the protocol really used to transmit audio-video, generally based on the UDP protocol, with special attention to the fact that it uses an even number of ports.</li>
<li><a href="https://en.wikipedia.org/wiki/RTP_Control_Protocol">RTCP</a> (Real-time Control Protocol): sister protocol to RTP, which provides quality of service (QoS) feedback by periodically sending statistical information, it uses an odd number of ports and is RTP port + 1.</li>
<li><a href="https://en.wikipedia.org/wiki/Session_Description_Protocol">SDP</a> (Session Description Protocol): a protocol of the application layer, which can also be described as a format, the same as HTML, JSON, etc. (briefly mentioned in today&rsquo;s article).</li>
</ul>
<p>Here I believe you can see some of the content, such as the fact that the RTSP protocol itself is not responsible for playback, but only for interactive control, RTP and RTCP is the real video transmission.</p>
<p>Here we will expand the details of the content, and will use practical examples to illustrate.</p>
<h2 id="a-detailed-introduction-to-several-protocols">A detailed introduction to several protocols</h2>
<p>When developing for the Web, we often use various HTTP packet capture tools, but as an aspiring engineer, you should learn to use WireShark, a powerful and free network packet capture analysis tool that allows us to see exactly what kind of protocols we are using every day.</p>
<p>Open WireShark (skip the installation process, I believe you can handle it yourself), select the network port your computer is using, for example, Linux may be eth0, Mac is en0, double-click it and you can enter the packet capture.</p>
<p>Next, in WireShark&rsquo;s filter field, fill in <code>rtsp || rtcp || rtp</code> so that we can filter out some irrelevant protocols.</p>
<p>Before proceeding, you also need to prepare an RTSP server, which I did here with a webcam, and a local RTSP player, like the one I use for VLC. If you don&rsquo;t have one available at the moment, you can also build a temporary one, see <a href="https://github.com/aler9/rtsp-simple-server">rtsp-simple-server</a> for more information.</p>
<p>Of course, there are clients, we can play RTSP video sources directly with various players such as VLC, or you can use the command line, for example <code>ffplay</code> for FFMpeg.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">ffplay rtsp://192.168.1.100/live
</span></span></code></pre></td></tr></table>
</div>
</div><p>If you are using VLC like me: click Open Media -&gt; Network, then fill in the URL with the video source, click Open and it will start playing, after a few seconds click Stop.</p>
<h2 id="overall-communication-process-overview">overall communication process overview</h2>
<p>The following two pictures is my use of VLC play and stop the network communication between the capture packet, which 192.168.2.31 is the webcam, and 192.168.2.115 is my computer, that is, the player is located on the computer.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/07/29/91f3d44140784925923e7099a6faf131.png" alt="Communication packet capture"></p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/07/29/ecfd1fe4f626447ba9e42f8cb560bfe1.png" alt="Communication packet capture"></p>
<p>Parts to note.</p>
<ol>
<li>this time the pause (PAUSE) is ignored, as well as others such as GET_PARAMETER, SET_PARAMETER.</li>
<li>before the reply to the PLAY request, we see an RTCP as well as an RTP request, which indicates that the playback source has already started transmitting playback data before the reply.</li>
<li>some packets in the subsequent ongoing RTP with a Mark character, which is due to packet splitting caused by oversized video data.</li>
</ol>
<h2 id="rtsp-protocol">RTSP protocol</h2>
<p>Next, let&rsquo;s go through the actual packet capture to illustrate it in detail.</p>
<h3 id="options-request">OPTIONS request</h3>
<p>First, the client will send a very similar to the HTTP protocol RTSP protocol to 192.168.1.100 port 554, is an OPTIONS request, that is, a list of requests available for this source, note that CSeq, each RTSP request will take, so that the server response will correspond with the client one by one (which is not HTTP).</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/07/29/0b74580abc4a47859595ae335c228f12.png" alt="OPTIONS request"></p>
<p>Then the server will respond.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/07/29/cf7d450feff2415d860d9d2d1f8717be.png" alt="OPTIONS Response"></p>
<p>As above, the server tells the client that it can use several requests such as DESCRIBE, SETUP, TEARDOWN, PLAY, PAUSE, etc.</p>
<h3 id="describe-request">DESCRIBE request</h3>
<p>Now, the client sends a DESCRIBE request.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/07/29/4c00e2a465844fec9b5cefe514fec36d.png" alt="DESCRIBE request"></p>
<p>The server will respond with content in SDP format.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/07/29/dbfc6ee64b8a4034a0ec8336c8e5243d.png" alt="DESCRIBE Response"></p>
<p>A very friendly part of WireShark is that it will show you the description of the protocol, SDP can not read? It will tell you clearly, and for a detailed explanation of the SDP protocol see <a href="https://en.wikipedia.org/wiki/Session_Description_Protocol">the description on the wiki</a>.</p>
<p>Note the line <code>rtpmap:96 H264/90,000</code>, which indicates that the video source is encoded in H264 and the sampling frequency is 90,000.</p>
<p>As above, the server will show that the actual video content of this source is in MP4 format, with video on channel 0 and audio on channel 1.</p>
<h3 id="setup-request">SETUP request</h3>
<p>Now we get to the SETUP step, which is equivalent to initialization (if the source has both audio and video, then it needs to SETUP twice).</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/07/29/ae25500d222f4516925e3db6ab607602.png" alt="SETUP request"></p>
<p>Here is the explanation of Transport.</p>
<ul>
<li><code>RTP/AVP</code>: indicates RTP A/V Profile, in fact, UDP is omitted after it, if it is RTP/AVP/TCP, it means RTP uses TCP for transmission.</li>
<li><code>unicast</code>: indicates unicast, to differentiate from multicast, which is transmitted one-to-one instead of one-to-many.</li>
<li><code>client_port=57246-57247</code>: indicates that the client has opened ports 57246 and 57247 for RTP and RTSP data transmission respectively.</li>
</ul>
<p>Next is the server side response.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/07/29/a8fd6e855f13442fab0ce36d5637d787.png" alt="SETUP response"></p>
<p>Note here the Session, which is taken with the next playback control requests and is used to distinguish between the different playback requests.</p>
<h3 id="play-request">PLAY request</h3>
<p>Next is the official request.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/07/29/4f51f3c6e1e446f1b4d4e56a32016e38.png" alt="PLAY request"></p>
<p>Where Range indicates the range of playback times, and <code>npt=0.000-</code> in the above figure indicates that this is a live video feed.</p>
<p>The server will respond with a header with <code>RTP-Info</code>, where the <code>seq</code> and <code>rtptime</code> information are used to indicate the RTP packet information.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/07/29/5383848931294c979234621ac89ddcb0.png" alt="PLAY Response"></p>
<p>If you pay attention to the overview above, you&rsquo;ll see that the server is sending RTP and RTCP data for real playback as soon as it receives the PLAY request.</p>
<h3 id="teardown-request">TEARDOWN request</h3>
<p>That is, stop the playback request, which is very simple to do, so I won&rsquo;t go into details here.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/07/29/d078c8a3e7584752a012fd570974bcef.png" alt="TEARDOWN request"></p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/07/29/f53f4c92b1e54fdeb8070d20cc320268.png" alt="TEARDOWN  response"></p>
<h2 id="rtcp-protocol">RTCP Protocol</h2>
<p>In contrast to the text protocol of RTSP, <a href="https://en.wikipedia.org/wiki/RTP_Control_Protocol">RTCP</a> is a binary protocol with the following protocol header.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/07/29/243ed647f05f42ebb54925f1a2d3d3fa.png" alt="RTCP Protocol"></p>
<ol>
<li><code>Version</code>: version number, consistent with the version number in RTP, currently 2.</li>
<li><code>P (Padding)</code>: used to indicate whether the RTP packet contains padding bytes (for example, encrypted RTP packets are used).</li>
<li><code>RC (Reception report count)</code>: statistical information, received</li>
<li><code>PT (Packet type)</code>: the type of the packet, currently there are sender report (SR), receiver report (RR), SDES (source description), BYE (end), APP (application customization).</li>
<li><code>Length</code>: the length of the current packet.</li>
<li><code>SSRC</code>: synchronization source identifier.</li>
</ol>
<p>Taking the actual example, we will see that the server accepts the PLAY request and sends an RTCP Sender Report immediately afterwards.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/07/29/02d6c4f109834442bca8a0130f5caa94.png" alt="RTCP"></p>
<p>The point to note is that it has two timestamps, one is the NTP (Network Time Protocol) timestamp, with 8 bytes to represent the absolute time, and the other is the RTP timestamp, which is the relative time, can be used to calculate the time of the RTP packet, the specific calculation rule is to divide the difference between the two RTP timestamps by the video sampling frequency, and then add The absolute time here is the absolute time of the current RTP packet. (Don&rsquo;t know the sampling frequency? Go back and look at the response to the DESCRIBE request for RTSP above.)</p>
<h2 id="rtp-protocol">RTP Protocol</h2>
<p><a href="https://en.wikipedia.org/wiki/Real-time_Transport_Protocol">RTP</a> is also a binary protocol, and its protocol header is as follows.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/07/29/516197af40104a7eb66c22704f49fb89.png" alt="RTP"></p>
<ol>
<li><code>Version</code>: Version number, same as RTCP; 2.</li>
<li><code>P (Padding)</code>: same as RTCP.</li>
<li><code>X (Extension)</code>: indicates whether there is an extension packet header.</li>
<li><code>CC (CSRC count)</code>: number of CSRCs.</li>
<li><code>M (Marker)</code>: marker bit, e.g. to mark the boundary of a video frame.</li>
<li><code>PT (Payload type)</code>: packet content type, there are many specific types, you can see <a href="https://tools.ietf.org/html/rfc3551">rfc3551</a> if you want to understand.</li>
<li><code>Sequence number</code>: Sequence number, to prevent packet loss and packet disorder.</li>
<li><code>timestamp</code>: timestamp, related to RTCP timestamp above.</li>
<li><code>SSRC</code>: synchronization source identifier.</li>
<li><code>CSRC</code>: Contribution source identifier.</li>
<li><code>header</code> extension: expandable packet header.</li>
</ol>
<p>Let&rsquo;s pick the first RTP packet and look at it. We can see that the content type is 96, which is H264.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/07/29/09ccca49863f4636a911a4bb1d11f95b.png" alt="RTP packet"></p>
<h2 id="summary">Summary</h2>
<p>The RTSP protocol itself is not complicated, so let&rsquo;s talk about the practice of RTSP in the next article.</p>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/rtsp/">Rtsp</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2022-07/rtsp-server/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Implement a simple RTSP server</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2022-07/git-flow/">
            <span class="next-text nav-default">Three git flows and the version release model</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  <script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox-3.1.20.min.js"></script>



<script type="text/javascript" src="/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
