<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Managing Tekton components with Tektoncd Operator - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="Learn how to manage Tekton components using Tektoncd Operator." /><meta name="keywords" content="Tektoncd Operator" />






<meta name="generator" content="Hugo 0.101.0 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2022-07/tektoncd-operator/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link href="/lib/fancybox/jquery.fancybox-3.1.20.min.css" rel="stylesheet">


<meta property="og:title" content="Managing Tekton components with Tektoncd Operator" />
<meta property="og:description" content="Learn how to manage Tekton components using Tektoncd Operator." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2022-07/tektoncd-operator/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-07-26T12:54:43+08:00" />
<meta property="article:modified_time" content="2022-07-26T12:54:43+08:00" />

<meta itemprop="name" content="Managing Tekton components with Tektoncd Operator">
<meta itemprop="description" content="Learn how to manage Tekton components using Tektoncd Operator."><meta itemprop="datePublished" content="2022-07-26T12:54:43+08:00" />
<meta itemprop="dateModified" content="2022-07-26T12:54:43+08:00" />
<meta itemprop="wordCount" content="1243">
<meta itemprop="keywords" content="k8s," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Managing Tekton components with Tektoncd Operator"/>
<meta name="twitter:description" content="Learn how to manage Tekton components using Tektoncd Operator."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SOBYTE</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SOBYTE</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Managing Tekton components with Tektoncd Operator</h1>

      <div class="post-meta">
        <span class="post-time"> 2022-07-26 12:54:43 </span>
        <div class="post-category">
            <a href="/categories/tutorials/"> tutorials </a>
            </div>
          <span class="more-meta"> 1243 words </span>
          <span class="more-meta"> 6 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#installation">Installation</a>
          <ul>
            <li><a href="#installation-from-operator-hub">Installation from Operator Hub</a></li>
            <li><a href="#installation-using-the-resource-manifest-file">Installation using the resource manifest file</a></li>
          </ul>
        </li>
        <li><a href="#testing">Testing</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/07/26/eb9dc3e5b32a4094922b18d90ab5ddbb.png" alt="k8s"></p>
<p><a href="https://github.com/tektoncd/operator">Tektoncd Operator</a> is a Kubernetes extension for installing, upgrading and managing TektonCD Pipelines, Dashboard, Triggers, etc. on a Kubernetes cluster. We just need to write the yaml for each component to manage Tekton components directly.</p>
<table>
<thead>
<tr>
<th>CRD</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>TektonConfig</td>
<td>Configure the Tekton components to be installed and managed.</td>
</tr>
<tr>
<td>TektonPipeline</td>
<td>Configure the installation to manage Tekton Pipeline components.</td>
</tr>
<tr>
<td>TektonTrigger</td>
<td>Configure the installation to manage the Tekton Trigger component.</td>
</tr>
<tr>
<td>TektonDashboard</td>
<td>Configure the installation to manage Tekton Dashboard components.</td>
</tr>
<tr>
<td>TektonResult</td>
<td>Configure the installation to manage Tekton Result components.</td>
</tr>
<tr>
<td>TektonAddon</td>
<td>Configure the installation management plugin, which currently only supports Openshift.</td>
</tr>
</tbody>
</table>
<h2 id="installation">Installation</h2>
<p>There are several ways to install Tektoncd Operator.</p>
<h3 id="installation-from-operator-hub">Installation from Operator Hub</h3>
<p>You can go directly to the Operator Hub page at <a href="https://operatorhub.io/operator/tektoncd-operator">https://operatorhub.io/operator/tektoncd-operator</a>to install it and its lifecycle will be managed by the <code>Operator Lifecycle Manager (OLM)</code>.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/07/26/bc37b47c0a184a15813cc6016db3bfaa.png" alt="Operator Hub"></p>
<h3 id="installation-using-the-resource-manifest-file">Installation using the resource manifest file</h3>
<p>You can get the resource manifest file directly from the Github Release page at <a href="https://github.com/tektoncd/operator/releases">https://github.com/tektoncd/operator/releases</a>. Using this method of installation, you need to manage the Operator lifecycle yourself.</p>
<p>Just use the following command to install directly.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ kubectl apply -f https://storage.googleapis.com/tekton-releases/operator/latest/release.yaml
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>By default Tektoncd Operator creates objects that use the gcr image</strong>, such as the Tekton Pipelines controller image, you can specify the corresponding image via the environment variable <code>IMAGE_PIPELINES_TEKTON_PIPELINES_CONTROLLER</code>, which is shown below to override the default configuration of the gcr image.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yml" data-lang="yml"><span class="line"><span class="cl">- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">IMAGE_PIPELINES_PROXY</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l">cnych/tekton-operator-proxy-webhook:v0.60.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">IMAGE_JOB_PRUNER_TKN</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l">cnych/tekton-operator-pruner-tkn:v0.60.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">IMAGE_PIPELINES_TEKTON_PIPELINES_CONTROLLER</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l">cnych/tekton-controller:v0.37.2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">IMAGE_PIPELINES_WEBHOOK</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l">cnych/tekton-webhook:v0.37.2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">IMAGE_PIPELINES_ARG__ENTRYPOINT_IMAGE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l">cnych/tekton-entrypoint:v0.37.2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">IMAGE_PIPELINES_ARG__GIT_IMAGE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l">cnych/tekton-git-init:v0.37.2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">IMAGE_PIPELINES_ARG__IMAGEDIGEST_EXPORTER_IMAGE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l">cnych/tekton-imagedigestexporter:v0.37.2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">IMAGE_PIPELINES_ARG__KUBECONFIG_WRITER_IMAGE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l">cnych/tekton-kubeconfigwriter:v0.37.2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">IMAGE_PIPELINES_ARG__NOP_IMAGE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l">cnych/tekton-nop:v0.37.2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">IMAGE_TRIGGERS_TEKTON_TRIGGERS_CONTROLLER</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l">cnych/tekton-triggers-controller:v0.20.1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">IMAGE_TRIGGERS_WEBHOOK</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l">cnych/tekton-triggers-webhook:v0.20.1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">IMAGE_TRIGGERS_TEKTON_TRIGGERS_CORE_INTERCEPTORS</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l">cnych/tekton-triggers-interceptors:v0.20.1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">IMAGE_TRIGGERS_ARG__EL_IMAGE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l">cnych/tekton-triggers-eventlistenersink:v0.20.1</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>The above approach creates a namespace named <code>tekton-operator</code> containing an Operator and a Pod of Webhook.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ kubectl get pods -n tekton-operator
</span></span><span class="line"><span class="cl">NAME                                       READY   STATUS    RESTARTS   AGE
</span></span><span class="line"><span class="cl">tekton-operator-9d747548b-67t7m            2/2     Running   <span class="m">0</span>          9m42s
</span></span><span class="line"><span class="cl">tekton-operator-webhook-6cc769b85d-fssq9   1/1     Running   <span class="m">0</span>          9m42s
</span></span></code></pre></td></tr></table>
</div>
</div><p>Once the Operator is installed, you can install the required Tekton components, such as Tekton Pipeline, Tekton Triggers.</p>
<p>Each Tekton component has a custom resource for installing and managing the component.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ kubectl get crd <span class="p">|</span>grep tekton <span class="p">|</span>grep operator
</span></span><span class="line"><span class="cl">tektonchains.operator.tekton.dev                    2022-07-25T00:51:07Z
</span></span><span class="line"><span class="cl">tektonconfigs.operator.tekton.dev                   2022-07-25T00:51:07Z
</span></span><span class="line"><span class="cl">tektondashboards.operator.tekton.dev                2022-07-25T00:51:07Z
</span></span><span class="line"><span class="cl">tektonhubs.operator.tekton.dev                      2022-07-25T00:51:07Z
</span></span><span class="line"><span class="cl">tektoninstallersets.operator.tekton.dev             2022-07-25T00:51:07Z
</span></span><span class="line"><span class="cl">tektonpipelines.operator.tekton.dev                 2022-07-25T00:51:07Z
</span></span><span class="line"><span class="cl">tektonresults.operator.tekton.dev                   2022-07-25T00:51:07Z
</span></span><span class="line"><span class="cl">tektontriggers.operator.tekton.dev                  2022-07-25T00:51:07Z
</span></span></code></pre></td></tr></table>
</div>
</div><p>Where <code>TektonConfig</code> is the top level CRD for creating other components, so we just need to create <code>TektonConfig</code> objects with the required configuration, which will help us install the other components accordingly.</p>
<p><code>TektonConfig</code> will create <code>TektonPipeline</code>, <code>TektonTriggers</code> and other component CR objects based on the configuration file passed to it, with a <code>profile</code> field that can be used to identify all the components to be installed.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/07/26/65f0fd4aa126442282af74611f47007c.png" alt="components"></p>
<p>Tektoncd Operator has 3 built-in <code>profiles</code>: <code>lite</code>, <code>all</code>, <code>basic</code>.</p>
<ul>
<li><code>all</code>: this profile will install all components</li>
<li><code>basic</code>: this profile will install only TektonPipeline and TektonTrigger components</li>
<li><code>lite</code>: this profile will install only the TektonPipeline component</li>
</ul>
<p>For example, if we want to install pipelines, triggers and dashboard, we can use the <code>profile</code> <code>all</code> to install them, as shown in the resource list below.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yml" data-lang="yml"><span class="line"><span class="cl"><span class="c"># tekton-operator-profile-all.yaml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">operator.tekton.dev/v1alpha1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">TektonConfig</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">profile</span><span class="p">:</span><span class="w"> </span><span class="l">all</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">targetNamespace</span><span class="p">:</span><span class="w"> </span><span class="l">tekton-pipelines</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">pruner</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">resources</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">pipelinerun</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">taskrun</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">keep</span><span class="p">:</span><span class="w"> </span><span class="m">100</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">schedule</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;0 8 * * *&#34;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>where <code>targetNamespace</code> is used to specify the namespace where Tekton components are installed, the default is <code>tekton-pipelines</code> and <code>pruner</code> provides automatic cleanup for Tekton resources.</p>
<ul>
<li><code>resources</code>: specifies the resources that can be cleaned automatically.</li>
<li><code>keep</code>: the maximum number of resources to keep when cleaning up.</li>
<li><code>schedule</code>: how often to clean up resources.</li>
</ul>
<p>Just install the above resource object directly.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ kubectl apply -f tekton-operator-profile-all.yaml
</span></span><span class="line"><span class="cl">$ kubectl get tektonconfig
</span></span><span class="line"><span class="cl">NAME     VERSION   READY   REASON
</span></span><span class="line"><span class="cl">config   v0.60.0   True
</span></span></code></pre></td></tr></table>
</div>
</div><p>The <code>TektonConfig</code> object we configured above with a <code>profile</code> of <code>all</code> will automatically create <code>tektonpipelines</code>, <code>tektontriggers</code>, and <code>tektondashboard</code> component objects for us.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ kubectl get tektonpipelines
</span></span><span class="line"><span class="cl">NAME       VERSION   READY   REASON
</span></span><span class="line"><span class="cl">pipeline   v0.37.0   True
</span></span><span class="line"><span class="cl">$ kubectl get tektontriggers
</span></span><span class="line"><span class="cl">NAME      VERSION   READY   REASON
</span></span><span class="line"><span class="cl">trigger   v0.20.1   True
</span></span><span class="line"><span class="cl">$ kubectl get tektondashboard
</span></span><span class="line"><span class="cl">NAME        VERSION   READY   REASON
</span></span><span class="line"><span class="cl">dashboard   v0.27.0   True
</span></span></code></pre></td></tr></table>
</div>
</div><p>These cr objects above will automatically create the corresponding components when they are created, as shown below.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ kubectl get pods -n tekton-pipelines
</span></span><span class="line"><span class="cl">NAME                                                 READY   STATUS             RESTARTS   AGE
</span></span><span class="line"><span class="cl">tekton-dashboard-84dc6f966b-g8flx                    0/1     ImagePullBackOff   <span class="m">0</span>          3m48s
</span></span><span class="line"><span class="cl">tekton-operator-proxy-webhook-7587596c79-ld8vm       1/1     Running            <span class="m">0</span>          30m
</span></span><span class="line"><span class="cl">tekton-pipelines-controller-78bc48896b-sd9fk         1/1     Running            <span class="m">0</span>          30m
</span></span><span class="line"><span class="cl">tekton-pipelines-webhook-5f48c855b4-js54q            1/1     Running            <span class="m">0</span>          30m
</span></span><span class="line"><span class="cl">tekton-triggers-controller-668b94cb5b-ggbk7          1/1     Running            <span class="m">0</span>          27m
</span></span><span class="line"><span class="cl">tekton-triggers-core-interceptors-66b7ddd78c-pq7gb   1/1     Running            <span class="m">0</span>          27m
</span></span><span class="line"><span class="cl">tekton-triggers-webhook-c8fd7755d-rknch              1/1     Running            <span class="m">0</span>          27m
</span></span></code></pre></td></tr></table>
</div>
</div><p>Since the image of the dashboard component does not have a corresponding overriding environment variable, we need to modify it manually.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ kubectl edit deploy tekton-dashboard -n tekton-pipelines
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">......
</span></span><span class="line"><span class="cl">    image: cnych/tekton-dashboard:v0.28.0
</span></span><span class="line"><span class="cl">......
</span></span></code></pre></td></tr></table>
</div>
</div><p>By default, Dashboard services are exposed through ClusterIP. We can manually create an Ingress object or modify the service to NodePort to expose it.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ kubectl get svc -n tekton-pipelines
</span></span><span class="line"><span class="cl">NAME                                TYPE        CLUSTER-IP       EXTERNAL-IP   PORT<span class="o">(</span>S<span class="o">)</span>                              AGE
</span></span><span class="line"><span class="cl">tekton-dashboard                    ClusterIP   10.102.221.101   &lt;none&gt;        9097/TCP                             28m
</span></span><span class="line"><span class="cl">tekton-operator-proxy-webhook       ClusterIP   10.96.175.155    &lt;none&gt;        443/TCP                              33m
</span></span><span class="line"><span class="cl">tekton-pipelines-controller         ClusterIP   10.99.0.85       &lt;none&gt;        9090/TCP,8008/TCP,8080/TCP           33m
</span></span><span class="line"><span class="cl">tekton-pipelines-webhook            ClusterIP   10.106.195.14    &lt;none&gt;        9090/TCP,8008/TCP,443/TCP,8080/TCP   33m
</span></span><span class="line"><span class="cl">tekton-triggers-controller          ClusterIP   10.99.84.154     &lt;none&gt;        9000/TCP                             30m
</span></span><span class="line"><span class="cl">tekton-triggers-core-interceptors   ClusterIP   10.97.83.136     &lt;none&gt;        8443/TCP                             30m
</span></span><span class="line"><span class="cl">tekton-triggers-webhook             ClusterIP   10.108.88.140    &lt;none&gt;        443/TCP                              30m
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/07/26/6f3fc57f15cc4016897d41ae7f234925.png" alt="Tektoncd Dashboard"></p>
<h2 id="testing">Testing</h2>
<p>Once Tekon&rsquo;s components are installed, let&rsquo;s run a simple Pipeline.</p>
<p>First create a Task as shown below, which will execute the <code>echo &quot;Hello, world!&quot;</code> command in the bash container.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yml" data-lang="yml"><span class="line"><span class="cl"><span class="c"># hello-task.yaml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">tekton.dev/v1beta1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Task</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">hello</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">steps</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">hello</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">bash:latest</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">command</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="l">echo</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">args</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="s2">&#34;Hello, world!&#34;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Create another <code>goodbye</code> task in the same way, simply by changing the echo above to <code>goodbye</code>.</p>
<p>Then you can define a Pipeline flow, as shown below.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yml" data-lang="yml"><span class="line"><span class="cl"><span class="c"># hello-goodbye-pipeline.yaml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">tekton.dev/v1beta1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Pipeline</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">hello-goodbye-pipeline</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">hello</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">taskRef</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">hello</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">goodbye</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">runAfter</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="l">hello</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">taskRef</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">goodbye</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>The corresponding Task object is referenced by <code>taskRef</code>.</p>
<p>Just create the above resource object directly.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ kubectl get pipeline
</span></span><span class="line"><span class="cl">NAME                     AGE
</span></span><span class="line"><span class="cl">hello-goodbye-pipeline   24s
</span></span><span class="line"><span class="cl">$ kubectl get task
</span></span><span class="line"><span class="cl">NAME      AGE
</span></span><span class="line"><span class="cl">goodbye   101s
</span></span><span class="line"><span class="cl">hello     107s
</span></span></code></pre></td></tr></table>
</div>
</div><p>To execute the pipeline, we also need to create a <code>PipelineRun</code> object before it will actually execute.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yml" data-lang="yml"><span class="line"><span class="cl"><span class="c"># hello-goodbye-pipeline-run.yaml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">tekton.dev/v1beta1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">PipelineRun</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">generateName</span><span class="p">:</span><span class="w"> </span><span class="l">hello-goodbye-pipeline-</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">pipelineRef</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">hello-goodbye-pipeline</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Just create the above resource, and note that the <code>generateName</code> attribute we used here needs to be created using the <code>kubectl create</code> command. After normal creation, the two tasks will soon be executed as described in the Pipeline above.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/07/26/9e62f1c6d5b24a7fb288a30808555cb6.png" alt="Tektoncd Dashboard"></p>
<p>To uninstall Tekton we just need to delete the defined <code>TektonConfig</code> object.</p>
<p>If we don&rsquo;t want to use the several <code>profiles</code> built into TektonCD Operator, we can also manually configure the CR instances of the different components ourselves. In addition, TektonCD Operator does not provide many configurable methods at this stage, and the only way to globally override the Operator is through environment variables.</p>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/k8s/">k8s</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2022-07/go-scanner-valuer/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Scanner and Valuer interfaces in the Golang database module</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2022-07/schemahero/">
            <span class="next-text nav-default">Cloud Native Declarative Database Structure Migration Tool - SchemaHero</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  <script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox-3.1.20.min.js"></script>



<script type="text/javascript" src="/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js"></script>








</body>
</html>
