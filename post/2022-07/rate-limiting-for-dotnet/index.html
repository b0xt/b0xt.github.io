<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>.NET 7 adds Rate Limiting feature to easily limit the number of requests - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="Explore 4 ways to implement rate limiting in dotNET." /><meta name="keywords" content=".NET, Rate Limiting" />






<meta name="generator" content="Hugo 0.101.0 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2022-07/rate-limiting-for-dotnet/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link href="/lib/fancybox/jquery.fancybox-3.1.20.min.css" rel="stylesheet">


<meta property="og:title" content=".NET 7 adds Rate Limiting feature to easily limit the number of requests" />
<meta property="og:description" content="Explore 4 ways to implement rate limiting in dotNET." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2022-07/rate-limiting-for-dotnet/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-07-15T09:14:39+08:00" />
<meta property="article:modified_time" content="2022-07-15T09:14:39+08:00" />

<meta itemprop="name" content=".NET 7 adds Rate Limiting feature to easily limit the number of requests">
<meta itemprop="description" content="Explore 4 ways to implement rate limiting in dotNET."><meta itemprop="datePublished" content="2022-07-15T09:14:39+08:00" />
<meta itemprop="dateModified" content="2022-07-15T09:14:39+08:00" />
<meta itemprop="wordCount" content="821">
<meta itemprop="keywords" content="dotnet," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content=".NET 7 adds Rate Limiting feature to easily limit the number of requests"/>
<meta name="twitter:description" content="Explore 4 ways to implement rate limiting in dotNET."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SOBYTE</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SOBYTE</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">.NET 7 adds Rate Limiting feature to easily limit the number of requests</h1>

      <div class="post-meta">
        <span class="post-time"> 2022-07-15 09:14:39 </span>
        <div class="post-category">
            <a href="/categories/tutorials/"> tutorials </a>
            </div>
          <span class="more-meta"> 821 words </span>
          <span class="more-meta"> 4 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li>
          <ul>
            <li><a href="#concurrency-limiting">Concurrency Limiting</a></li>
            <li><a href="#token-bucket">Token Bucket</a></li>
            <li><a href="#fixed-window-limit">Fixed Window Limit</a></li>
            <li><a href="#sliding-window-restrictions">Sliding window restrictions</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>.NET 7 has a built-in <a href="https://devblogs.microsoft.com/dotnet/announcing-rate-limiting-for-dotnet/">Rate Limiting feature</a>, which limits the number of requests that can access a resource. For example, a database can safely handle 1000 requests per minute, and it&rsquo;s not sure if more will crash. This is where you can put a rate limiter in your application that only allows 1000 requests per minute and starts rejecting requests after that number is reached. This is a way to protect resources and prevent the application from crashing in case of high browsing.</p>
<p>There are many different algorithms to control the flow of requests, here are 4 methods available in .NET 7</p>
<h3 id="concurrency-limiting">Concurrency Limiting</h3>
<p>As the name implies, a concurrency limiter is a limit on how many concurrent requests can access a resource. If the limit is 10, then only 10 requests can access a resource at the same time, and the 11th request will be denied.</p>
<p>Once the previous request completes, the number of allowed requests increases by 1, when the second request completes, the number increases to 2, and so on. This algorithm is done by <a href="https://devblogs.microsoft.com/dotnet/announcing-rate-limiting-for-dotnet/#ratelimiter-apis">releasing RateLimitLease</a>.</p>
<h3 id="token-bucket">Token Bucket</h3>
<p>A token bucket is another algorithm, like a bucket full of tokens. Every once in a while, a fixed number of tokens are added to the bucket, but the number of tokens cannot exceed the maximum number the bucket can hold. When a request comes in, it fetches and saves a token, and if the bucket is empty, a new request comes in with no token to fetch and is about to be denied access to the resource.</p>
<p>Suppose a single bucket can hold 10 tokens, and 2 tokens are added to it every minute. Now 3 requests have come in, leaving 7 tokens. After a minute, the bucket is automatically replenished to 9 tokens, and then 9 requests take all the tokens instantly. Then all requests are not allowed to access the resource until the next token is added to the bucket. If no requests follow, the bucket is automatically replenished with 10 tokens in 5 minutes and then waits for requests.</p>
<h3 id="fixed-window-limit">Fixed Window Limit</h3>
<p>The fixed-window algorithm uses the concept of &ldquo;windows&rdquo;, which are time-measured to limit the maximum number of requests for a fixed period of time and reset the number of requests when switching to the next window.</p>
<p>Suppose there is a movie theater (window) with a maximum of 100 people (maximum number of requests) and each movie takes 2 hours to play (window duration). After the movie starts, the remaining audience (requests) can only wait in line for the <strong>next window</strong>, and the maximum number of people in line is also 100 , beyond which they are not allowed to continue in line, and can only wait for the next window to start before they can continue in line.</p>
<h3 id="sliding-window-restrictions">Sliding window restrictions</h3>
<p>The sliding window algorithm is similar to the fixed window algorithm, but with the addition of the concept of &ldquo;segments (segments)&rdquo;.</p>
<ul>
<li>A segment is a part of a window, if the previous 2 hours of the window is divided into 4 segments, there will be 4 30 minute segments. There is also a &ldquo;segment index&rdquo; which always points to the latest segment in the window.</li>
<li>Requests within 30 minutes go to the newest segment and the window slides through one segment every 30 minutes. If a new request appears during the window slide through segments, the request is refreshed and the maximum limit of segments is increased. If there are no requests, the segment limit remains the same.</li>
</ul>
<p>Example Now there is a sliding window that contains 3 10 minute segments and can only accept a maximum of 100 requests. It now has an initial state of 3 segments, all with a count of 0, and the current segment index points to the 3rd segment.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/07/15/a2ceeeeb335d40e59d9284d1e8b9093d.png" alt="Sliding window"></p>
<p>In the first 10 minutes, we receive 50 requests, all of which are in segment 3 (where the segment index is located.) After 10 minutes have passed, we slide the window by 1 segment and move the current segment index to segment 4.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/07/15/eff8e9b4713843c2b9f70006a546fcd0.png" alt="Sliding window"></p>
<p>Over the next 10 minutes, we receive another 20 requests, so there are now 50 in segment 3 and 20 in segment 4. Again, after 10 minutes have passed the window starts to slide, so the current segment index points to 5, and since segments 3 and 4 are both inside the window, there are only 20 requests left in the window.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/07/15/7b8b7a259609482d9ffdea9242b51fc6.png" alt="Sliding window"></p>
<p>After another 10 minutes, the window is slid again, this time with segment index 6, but segment 3 (the segment with 50 requests) is outside the window, so the window recovers the 50 request limit. Since segment 4 still has 20 requests, the request limit for the sliding window becomes 80.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/07/15/066045c8de4b4ead8f1aba4bf17e677f.png" alt="Sliding window"></p>
<p>The <a href="https://devblogs.microsoft.com/dotnet/announcing-rate-limiting-for-dotnet/">Microsoft blog</a> has a detailed description of the rate limiting feature and related APIs and middleware, and those interested in this feature can learn more about it in <a href="https://www.nuget.org/packages/System.Threading.RateLimiting">Nuget</a>.</p>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/dotnet/">dotnet</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2022-07/firefox-apple/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Apple&#39;s business site blocks Firefox browser</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2022-07/vim-shortcuts/">
            <span class="next-text nav-default">Vim shortcuts for efficient programming</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  <script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox-3.1.20.min.js"></script>



<script type="text/javascript" src="/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
