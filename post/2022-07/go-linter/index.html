<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>How to customize linter (static checking tool) in Go - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="Learn how to customize linter (static checking tool) in Go language." /><meta name="keywords" content="Go, Linter" />






<meta name="generator" content="Hugo 0.101.0 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2022-07/go-linter/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link href="/lib/fancybox/jquery.fancybox-3.1.20.min.css" rel="stylesheet">


<meta property="og:title" content="How to customize linter (static checking tool) in Go" />
<meta property="og:description" content="Learn how to customize linter (static checking tool) in Go language." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2022-07/go-linter/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-07-08T12:35:25+08:00" />
<meta property="article:modified_time" content="2022-07-08T12:35:25+08:00" />

<meta itemprop="name" content="How to customize linter (static checking tool) in Go">
<meta itemprop="description" content="Learn how to customize linter (static checking tool) in Go language."><meta itemprop="datePublished" content="2022-07-08T12:35:25+08:00" />
<meta itemprop="dateModified" content="2022-07-08T12:35:25+08:00" />
<meta itemprop="wordCount" content="1924">
<meta itemprop="keywords" content="golang," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="How to customize linter (static checking tool) in Go"/>
<meta name="twitter:description" content="Learn how to customize linter (static checking tool) in Go language."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SOBYTE</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SOBYTE</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">How to customize linter (static checking tool) in Go</h1>

      <div class="post-meta">
        <span class="post-time"> 2022-07-08 12:35:25 </span>
        <div class="post-category">
            <a href="/categories/tutorials/"> tutorials </a>
            </div>
          <span class="more-meta"> 1924 words </span>
          <span class="more-meta"> 4 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#how-is-static-checking-implemented-in-go-language">How is static checking implemented in Go language?</a></li>
        <li><a href="#develop-linter-rules">Develop linter rules</a></li>
        <li><a href="#way-one-standard-library-implementation-custom-linter">way one: standard library implementation custom linter</a></li>
        <li><a href="#way-two-goanalysis">way two: go/analysis</a></li>
        <li><a href="#integration-to-golang-cli">Integration to golang-cli</a></li>
        <li><a href="#summary">Summary</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>Usually we use static code checking tools to ensure code quality in our business projects, through static code checking tools we can find some problems in advance, such as undefined variables, type mismatches, variable scope problems, array subscript overruns, memory leaks, etc. The tools will classify the severity of the problem according to their own rules, giving different signs and hints, static code checking The static code checker helps us to find the problem as early as possible, the common static code checker tools in <code>Go</code> language are <code>golang-lint</code>, <code>golint</code>, these tools have developed some rules, although it can meet most of the scenarios, but sometimes we will encounter the need to do some customization rules for special scenarios, so in this article we learn how to custom linter requirements.</p>
<h2 id="how-is-static-checking-implemented-in-go-language">How is static checking implemented in Go language?</h2>
<p>It is well known that <code>Go</code> language is a compiled language, and compiled language cannot be separated from lexical analysis, syntax analysis, semantic analysis, optimization, compilation and linking several stages, those who have learned the compilation principle should be familiar with the following diagram.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/07/08/43012f609730415598fbf8a886e9f5e8.png" alt="Compilation Principle"></p>
<p>The compiler will translate the high-level language into machine language, will first do lexical analysis of the source code, lexical analysis is the process of converting the sequence of characters into a <code>Token</code> sequence, <code>Token</code> is generally divided into these categories: keywords, identifiers, literal (including numbers, strings), special symbols (such as the plus sign, etc.), after generating the Token sequence, the need for syntax analysis, after further processing, to generate A syntax tree with expressions as nodes, this syntax tree is what we often call <code>AST</code>, in the process of generating syntax tree can detect some formal errors, such as the lack of brackets, syntax analysis is completed, it is necessary to carry out semantic analysis, where all the compilation period can check the static semantics, the latter process is the intermediate code generation, target code generation and optimization, linking, here is not Detailed description, here mainly want to introduce the abstract syntax tree (AST), our static code checking tool is through the analysis of the abstract syntax tree (AST) according to the custom rules to do; so what does the abstract syntax tree look like? We can use the <code>go/ast</code>, <code>go/parser</code>, <code>go/token</code> packages provided by the standard library to print out the AST, or we can use the visualization tool: <a href="http://goast.yuroyoro.net/">http://goast.yuroyoro.net/</a> to view the AST, and we can see the following examples of what the AST looks like.</p>
<h2 id="develop-linter-rules">Develop linter rules</h2>
<p>Suppose we now want to develop such a code specification in our team, the first argument type of all functions must be <code>Context</code>, and we have to give a warning if it does not conform to the specification; well, now that the rule has been set, let&rsquo;s now figure out how to implement it; first, a problematic example.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// example.go
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kn">package</span> <span class="nx">main</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">add</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">int</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="k">return</span> <span class="nx">a</span> <span class="o">+</span> <span class="nx">b</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Corresponds to <code>AST</code> as follows.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">*ast.FuncDecl {
</span></span><span class="line"><span class="cl">     8  .  .  .  Name: *ast.Ident {
</span></span><span class="line"><span class="cl">     9  .  .  .  .  NamePos: 3:6
</span></span><span class="line"><span class="cl">    10  .  .  .  .  Name: &#34;add&#34; 
</span></span><span class="line"><span class="cl">    11  .  .  .  .  Obj: *ast.Object {
</span></span><span class="line"><span class="cl">    12  .  .  .  .  .  Kind: func
</span></span><span class="line"><span class="cl">    13  .  .  .  .  .  Name: &#34;add&#34; // 函数名
</span></span><span class="line"><span class="cl">    14  .  .  .  .  .  Decl: *(obj @ 7)
</span></span><span class="line"><span class="cl">    15  .  .  .  .  }
</span></span><span class="line"><span class="cl">    16  .  .  .  }
</span></span><span class="line"><span class="cl">    17  .  .  .  Type: *ast.FuncType {
</span></span><span class="line"><span class="cl">    18  .  .  .  .  Func: 3:1
</span></span><span class="line"><span class="cl">    19  .  .  .  .  Params: *ast.FieldList {
</span></span><span class="line"><span class="cl">    20  .  .  .  .  .  Opening: 3:9
</span></span><span class="line"><span class="cl">    21  .  .  .  .  .  List: []*ast.Field (len = 1) {
</span></span><span class="line"><span class="cl">    22  .  .  .  .  .  .  0: *ast.Field {
</span></span><span class="line"><span class="cl">    23  .  .  .  .  .  .  .  Names: []*ast.Ident (len = 2) {
</span></span><span class="line"><span class="cl">    24  .  .  .  .  .  .  .  .  0: *ast.Ident {
</span></span><span class="line"><span class="cl">    25  .  .  .  .  .  .  .  .  .  NamePos: 3:10
</span></span><span class="line"><span class="cl">    26  .  .  .  .  .  .  .  .  .  Name: &#34;a&#34;
</span></span><span class="line"><span class="cl">    27  .  .  .  .  .  .  .  .  .  Obj: *ast.Object {
</span></span><span class="line"><span class="cl">    28  .  .  .  .  .  .  .  .  .  .  Kind: var
</span></span><span class="line"><span class="cl">    29  .  .  .  .  .  .  .  .  .  .  Name: &#34;a&#34;
</span></span><span class="line"><span class="cl">    30  .  .  .  .  .  .  .  .  .  .  Decl: *(obj @ 22)
</span></span><span class="line"><span class="cl">    31  .  .  .  .  .  .  .  .  .  }
</span></span><span class="line"><span class="cl">    32  .  .  .  .  .  .  .  .  }
</span></span><span class="line"><span class="cl">    33  .  .  .  .  .  .  .  .  1: *ast.Ident {
</span></span><span class="line"><span class="cl">    34  .  .  .  .  .  .  .  .  .  NamePos: 3:13
</span></span><span class="line"><span class="cl">    35  .  .  .  .  .  .  .  .  .  Name: &#34;b&#34;
</span></span><span class="line"><span class="cl">    36  .  .  .  .  .  .  .  .  .  Obj: *ast.Object {
</span></span><span class="line"><span class="cl">    37  .  .  .  .  .  .  .  .  .  .  Kind: var
</span></span><span class="line"><span class="cl">    38  .  .  .  .  .  .  .  .  .  .  Name: &#34;b&#34;
</span></span><span class="line"><span class="cl">    39  .  .  .  .  .  .  .  .  .  .  Decl: *(obj @ 22)
</span></span><span class="line"><span class="cl">    40  .  .  .  .  .  .  .  .  .  }
</span></span><span class="line"><span class="cl">    41  .  .  .  .  .  .  .  .  }
</span></span><span class="line"><span class="cl">    42  .  .  .  .  .  .  .  }
</span></span><span class="line"><span class="cl">    43  .  .  .  .  .  .  .  Type: *ast.Ident {
</span></span><span class="line"><span class="cl">    44  .  .  .  .  .  .  .  .  NamePos: 3:15
</span></span><span class="line"><span class="cl">    45  .  .  .  .  .  .  .  .  Name: &#34;int&#34; // 参数名
</span></span><span class="line"><span class="cl">    46  .  .  .  .  .  .  .  }
</span></span><span class="line"><span class="cl">    47  .  .  .  .  .  .  }
</span></span><span class="line"><span class="cl">    48  .  .  .  .  .  }
</span></span><span class="line"><span class="cl">    49  .  .  .  .  .  Closing: 3:18
</span></span><span class="line"><span class="cl">    50  .  .  .  .  }
</span></span><span class="line"><span class="cl">    51  .  .  .  .  Results: *ast.FieldList {
</span></span><span class="line"><span class="cl">    52  .  .  .  .  .  Opening: -
</span></span><span class="line"><span class="cl">    53  .  .  .  .  .  List: []*ast.Field (len = 1) {
</span></span><span class="line"><span class="cl">    54  .  .  .  .  .  .  0: *ast.Field {
</span></span><span class="line"><span class="cl">    55  .  .  .  .  .  .  .  Type: *ast.Ident {
</span></span><span class="line"><span class="cl">    56  .  .  .  .  .  .  .  .  NamePos: 3:20
</span></span><span class="line"><span class="cl">    57  .  .  .  .  .  .  .  .  Name: &#34;int&#34;
</span></span><span class="line"><span class="cl">    58  .  .  .  .  .  .  .  }
</span></span><span class="line"><span class="cl">    59  .  .  .  .  .  .  }
</span></span><span class="line"><span class="cl">    60  .  .  .  .  .  }
</span></span><span class="line"><span class="cl">    61  .  .  .  .  .  Closing: -
</span></span><span class="line"><span class="cl">    62  .  .  .  .  }
</span></span><span class="line"><span class="cl">    63  .  .  .  }
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="way-one-standard-library-implementation-custom-linter">way one: standard library implementation custom linter</h2>
<p>With the <code>AST</code> structure above we can find out exactly which structure the function parameter type is on, as we can write the parsing code based on this structure as follows.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">main</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl"> <span class="s">&#34;fmt&#34;</span>
</span></span><span class="line"><span class="cl"> <span class="s">&#34;go/ast&#34;</span>
</span></span><span class="line"><span class="cl"> <span class="s">&#34;go/parser&#34;</span>
</span></span><span class="line"><span class="cl"> <span class="s">&#34;go/token&#34;</span>
</span></span><span class="line"><span class="cl"> <span class="s">&#34;log&#34;</span>
</span></span><span class="line"><span class="cl"> <span class="s">&#34;os&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="nx">v</span> <span class="o">:=</span> <span class="nx">visitor</span><span class="p">{</span><span class="nx">fset</span><span class="p">:</span> <span class="nx">token</span><span class="p">.</span><span class="nf">NewFileSet</span><span class="p">()}</span>
</span></span><span class="line"><span class="cl"> <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">filePath</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Args</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="nx">filePath</span> <span class="o">==</span> <span class="s">&#34;--&#34;</span> <span class="p">{</span> <span class="c1">// to be able to run this like &#34;go run main.go -- input.go&#34;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="k">continue</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">f</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">parser</span><span class="p">.</span><span class="nf">ParseFile</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">fset</span><span class="p">,</span> <span class="nx">filePath</span><span class="p">,</span> <span class="kc">nil</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="nx">log</span><span class="p">.</span><span class="nf">Fatalf</span><span class="p">(</span><span class="s">&#34;Failed to parse file %s: %s&#34;</span><span class="p">,</span> <span class="nx">filePath</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nx">ast</span><span class="p">.</span><span class="nf">Walk</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">v</span><span class="p">,</span> <span class="nx">f</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">visitor</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="nx">fset</span> <span class="o">*</span><span class="nx">token</span><span class="p">.</span><span class="nx">FileSet</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">v</span> <span class="o">*</span><span class="nx">visitor</span><span class="p">)</span> <span class="nf">Visit</span><span class="p">(</span><span class="nx">node</span> <span class="nx">ast</span><span class="p">.</span><span class="nx">Node</span><span class="p">)</span> <span class="nx">ast</span><span class="p">.</span><span class="nx">Visitor</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="nx">funcDecl</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">node</span><span class="p">.(</span><span class="o">*</span><span class="nx">ast</span><span class="p">.</span><span class="nx">FuncDecl</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="k">if</span> <span class="p">!</span><span class="nx">ok</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">v</span>
</span></span><span class="line"><span class="cl"> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="nx">params</span> <span class="o">:=</span> <span class="nx">funcDecl</span><span class="p">.</span><span class="nx">Type</span><span class="p">.</span><span class="nx">Params</span><span class="p">.</span><span class="nx">List</span> <span class="c1">// get params
</span></span></span><span class="line"><span class="cl"><span class="c1"></span> <span class="c1">// list is equal of zero that don&#39;t need to checker.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nx">params</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">v</span>
</span></span><span class="line"><span class="cl"> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="nx">firstParamType</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">params</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">Type</span><span class="p">.(</span><span class="o">*</span><span class="nx">ast</span><span class="p">.</span><span class="nx">SelectorExpr</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="k">if</span> <span class="nx">ok</span> <span class="o">&amp;&amp;</span> <span class="nx">firstParamType</span><span class="p">.</span><span class="nx">Sel</span><span class="p">.</span><span class="nx">Name</span> <span class="o">==</span> <span class="s">&#34;Context&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">v</span>
</span></span><span class="line"><span class="cl"> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;%s: %s function first params should be Context\n&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">v</span><span class="p">.</span><span class="nx">fset</span><span class="p">.</span><span class="nf">Position</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nf">Pos</span><span class="p">()),</span> <span class="nx">funcDecl</span><span class="p">.</span><span class="nx">Name</span><span class="p">.</span><span class="nx">Name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="k">return</span> <span class="nx">v</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Then execute the following command.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ go run ./main.go -- ./example.go
</span></span><span class="line"><span class="cl">./example.go:3:1: add <span class="k">function</span> first params should be Context
</span></span></code></pre></td></tr></table>
</div>
</div><p>We can see from the output that the first argument of the function <code>add()</code> must be <strong>Context</strong>; this is a simple implementation, because the structure of <code>AST</code> is really a bit complicated, so we won&rsquo;t go into detail about each structure here.</p>
<h2 id="way-two-goanalysis">way two: go/analysis</h2>
<p>Those who have read the above code must be a bit crazy, there are many entities exist, to develop a <code>linter</code>, we need to understand many entities, good thing <code>go/analysis</code> is encapsulated, <code>go/analysis</code> provides a unified interface for <code>linter</code>, it simplifies the integration with IDE, metalinters, code Review and other tools. For example, any <code>go/analysis</code> linter can be efficiently executed by <code>go vet</code>, and we introduce the advantages of <code>go/analysis</code> by way of code below.</p>
<p>The code structure of a new project is as follows.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">.
</span></span><span class="line"><span class="cl">├── firstparamcontext
</span></span><span class="line"><span class="cl">│   └── firstparamcontext.go
</span></span><span class="line"><span class="cl">├── go.mod
</span></span><span class="line"><span class="cl">├── go.sum
</span></span><span class="line"><span class="cl">└── testfirstparamcontext
</span></span><span class="line"><span class="cl">    ├── example.go
</span></span><span class="line"><span class="cl">    └── main.go
</span></span></code></pre></td></tr></table>
</div>
</div><p>Add the check module code to <code>firstparamcontext.go</code> by adding the following code.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">firstparamcontext</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl"> <span class="s">&#34;go/ast&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="s">&#34;golang.org/x/tools/go/analysis&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">Analyzer</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">analysis</span><span class="p">.</span><span class="nx">Analyzer</span><span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="nx">Name</span><span class="p">:</span> <span class="s">&#34;firstparamcontext&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="nx">Doc</span><span class="p">:</span>  <span class="s">&#34;Checks that functions first param type is Context&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="nx">Run</span><span class="p">:</span>  <span class="nx">run</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">run</span><span class="p">(</span><span class="nx">pass</span> <span class="o">*</span><span class="nx">analysis</span><span class="p">.</span><span class="nx">Pass</span><span class="p">)</span> <span class="p">(</span><span class="kd">interface</span><span class="p">{},</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="nx">inspect</span> <span class="o">:=</span> <span class="kd">func</span><span class="p">(</span><span class="nx">node</span> <span class="nx">ast</span><span class="p">.</span><span class="nx">Node</span><span class="p">)</span> <span class="kt">bool</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">funcDecl</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">node</span><span class="p">.(</span><span class="o">*</span><span class="nx">ast</span><span class="p">.</span><span class="nx">FuncDecl</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">!</span><span class="nx">ok</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="k">return</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">params</span> <span class="o">:=</span> <span class="nx">funcDecl</span><span class="p">.</span><span class="nx">Type</span><span class="p">.</span><span class="nx">Params</span><span class="p">.</span><span class="nx">List</span> <span class="c1">// get params
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1">// list is equal of zero that don&#39;t need to checker.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nx">params</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="k">return</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">firstParamType</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">params</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">Type</span><span class="p">.(</span><span class="o">*</span><span class="nx">ast</span><span class="p">.</span><span class="nx">SelectorExpr</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="nx">ok</span> <span class="o">&amp;&amp;</span> <span class="nx">firstParamType</span><span class="p">.</span><span class="nx">Sel</span><span class="p">.</span><span class="nx">Name</span> <span class="o">==</span> <span class="s">&#34;Context&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="k">return</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">pass</span><span class="p">.</span><span class="nf">Reportf</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nf">Pos</span><span class="p">(),</span> <span class="s">&#34;&#39;&#39;%s&#39; function first params should be Context\n&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nx">funcDecl</span><span class="p">.</span><span class="nx">Name</span><span class="p">.</span><span class="nx">Name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl"> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">f</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">pass</span><span class="p">.</span><span class="nx">Files</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">ast</span><span class="p">.</span><span class="nf">Inspect</span><span class="p">(</span><span class="nx">f</span><span class="p">,</span> <span class="nx">inspect</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="p">}</span>
</span></span><span class="line"><span class="cl"> <span class="k">return</span> <span class="kc">nil</span><span class="p">,</span> <span class="kc">nil</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Then add the analyzer.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">main</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl"> <span class="s">&#34;asong.cloud/Golang_Dream/code_demo/custom_linter/firstparamcontext&#34;</span>
</span></span><span class="line"><span class="cl"> <span class="s">&#34;golang.org/x/tools/go/analysis/singlechecker&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="nx">singlechecker</span><span class="p">.</span><span class="nf">Main</span><span class="p">(</span><span class="nx">firstparamcontext</span><span class="p">.</span><span class="nx">Analyzer</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Execute the following command.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ go run ./main.go -- ./example.go 
</span></span><span class="line"><span class="cl">/Users/go/src/asong.cloud/Golang_Dream/code_demo/custom_linter/testfirstparamcontext/example.go:3:1: <span class="s1">&#39;&#39;</span>add<span class="err">&#39;</span> <span class="k">function</span> first params should be Context
</span></span></code></pre></td></tr></table>
</div>
</div><p>If we want to add more rules, just use <code>golang.org/x/tools/go/analysis/multichecker</code> to append them.</p>
<h2 id="integration-to-golang-cli">Integration to golang-cli</h2>
<p>We can download the code of <code>golang-cli</code> locally and add <code>firstparamcontext.go</code> under <code>pkg/golinters</code> with the following code.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl"> <span class="s">&#34;golang.org/x/tools/go/analysis&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="s">&#34;github.com/golangci/golangci-lint/pkg/golinters/goanalysis&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="s">&#34;github.com/fisrtparamcontext&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">NewfirstparamcontextCheck</span><span class="p">()</span> <span class="o">*</span><span class="nx">goanalysis</span><span class="p">.</span><span class="nx">Linter</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="k">return</span> <span class="nx">goanalysis</span><span class="p">.</span><span class="nf">NewLinter</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;firstparamcontext&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Checks that functions first param type is Context&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">[]</span><span class="o">*</span><span class="nx">analysis</span><span class="p">.</span><span class="nx">Analyzer</span><span class="p">{</span><span class="nx">firstparamcontext</span><span class="p">.</span><span class="nx">Analyzer</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="kc">nil</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="p">).</span><span class="nf">WithLoadMode</span><span class="p">(</span><span class="nx">goanalysis</span><span class="p">.</span><span class="nx">LoadModeSyntax</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Then re-<code>make</code> a <code>golang-cli</code> executable file, add it to our project and that&rsquo;s it.</p>
<h2 id="summary">Summary</h2>
<p>The <code>pkg/golinters</code> directory in the <code>golang-cli</code> repository stores a lot of static checking code, the fastest way to learn a point of knowledge is to copy the code, first learn how to use it, and then slowly make it our own; this article does not do too much introduction to the <code>AST</code> standard library, because this part of the text description is difficult to understand, the best way or their own The best way is to read the official documentation, plus practice to understand faster.</p>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/golang/">golang</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2022-07/pushgateway/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Using Prometheus Pushgateway to push monitoring metrics</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2022-07/k8s-elk/">
            <span class="next-text nav-default">Deploying an Elasticsearch stack on a Kubernetes cluster</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  <script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox-3.1.20.min.js"></script>



<script type="text/javascript" src="/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
