<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>DNS &amp; CoreDNS - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="Explore DNS and CoreDNS." /><meta name="keywords" content="dns, Coredns" />






<meta name="generator" content="Hugo 0.96.0 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2022-07/dns-coredns/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link href="/lib/fancybox/jquery.fancybox-3.1.20.min.css" rel="stylesheet">


<meta property="og:title" content="DNS &amp; CoreDNS" />
<meta property="og:description" content="Explore DNS and CoreDNS." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2022-07/dns-coredns/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-07-05T13:03:32+08:00" />
<meta property="article:modified_time" content="2022-07-05T13:03:32+08:00" />

<meta itemprop="name" content="DNS &amp; CoreDNS">
<meta itemprop="description" content="Explore DNS and CoreDNS."><meta itemprop="datePublished" content="2022-07-05T13:03:32+08:00" />
<meta itemprop="dateModified" content="2022-07-05T13:03:32+08:00" />
<meta itemprop="wordCount" content="585">
<meta itemprop="keywords" content="dns," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="DNS &amp; CoreDNS"/>
<meta name="twitter:description" content="Explore DNS and CoreDNS."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SOBYTE</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SOBYTE</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">DNS &amp; CoreDNS</h1>

      <div class="post-meta">
        <span class="post-time"> 2022-07-05 13:03:32 </span>
        <div class="post-category">
            <a href="/categories/tutorials/"> tutorials </a>
            </div>
          <span class="more-meta"> 585 words </span>
          <span class="more-meta"> 3 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#dns">DNS</a>
          <ul>
            <li><a href="#authoritative-dns">Authoritative DNS</a></li>
            <li><a href="#recursive-dns">Recursive DNS</a></li>
            <li><a href="#dns-records">DNS records</a></li>
            <li><a href="#ttl">TTL</a></li>
            <li><a href="#dns-resolution-process">DNS resolution process</a></li>
          </ul>
        </li>
        <li><a href="#coredns">CoreDNS</a>
          <ul>
            <li><a href="#dns-in-kubernetes">DNS In Kubernetes</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/07/05/61d35800615641a29fc7c94e34e1b7d6.png" alt="DNS &amp; CoreDNS"></p>
<h2 id="dns">DNS</h2>
<p>DNS (Domain Name System) is a global distributed database for storing the mapping relationship between domain names and Internet IP addresses.</p>
<p>DNS is divided into two main categories: authoritative DNS, and recursive DNS.</p>
<h3 id="authoritative-dns">Authoritative DNS</h3>
<p>Authoritative DNS is a DNS server set up at the domain name registrar for a specific domain name record, and is used for the management of the specific domain name itself. It only resolves domain names that it owns, and denies access to domains that are not its own.</p>
<h3 id="recursive-dns">Recursive DNS</h3>
<p>Recursive DNS, also known as Local DNS, is used for domain name lookups. Recursive DNS iterates over the answers returned by the authoritative server until the final IP address is queried, returns it to the client, and caches the request results locally.</p>
<h3 id="dns-records">DNS records</h3>
<ul>
<li>A record: Points to an IPv4 address.</li>
<li>AAAA record: Points to an IPv6 address.</li>
<li>CNAME record: Points to a domain name.</li>
<li>NS record: Specifies the domain name resolution server, i.e., the server responsible for managing the IP records corresponding to the domain name.</li>
<li>MX record: Points to the mail server address.</li>
<li>TXT record: Can be filled in arbitrarily, or empty.</li>
</ul>
<h3 id="ttl">TTL</h3>
<p>Indicates the time in seconds that a resolution record is cached in the recursive DNS. When a recursive DNS gets a resolution record, it is cached according to the TTL, but it is possible that the recursive DNS does not follow the TTL, for example, the recursive DNS finds the TTL too small and frequent recursive requests exhaust the resources of the recursive DNS. Optimizing to reduce the number of requests to authoritative DNS servers and accessing recursive DNS as much as possible requires adjusting the TTL length higher to allow clients to access the recursive DNS cache as much as possible. However, longer TTL times may result in invalid changes to the source DNS record, since the record values are cached in the recursive dns according to the TTL specification.</p>
<h3 id="dns-resolution-process">DNS resolution process</h3>
<p>When a browser enters <code>www.airbnb.com</code> address, it first queries the DNS service based on the Domain and gives the corresponding IP. The complete recursive DNS query process requires a DNS server from the root domain &ldquo;.&rdquo; server, top-level domain name server &ldquo;.com&rdquo;, first-level domain name server &ldquo;airbnb.com&rdquo;, one level of recursive query, until finally find the authoritative server to obtain the results and return to the customer. At the same time, the recursive server caches the query results according to the domain name TTL, which facilitates repeated queries for the same domain name.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/07/05/7a29cee252964f218c936194d607eecb.png" alt="DNS resolution process"></p>
<p>The first resolution takes longer because there is a back source authority, and the second resolution record is cached in recursive DNS based on the TTL.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/07/05/de16344ae88d480cba5b05ea4debd5da.png" alt="DNS resolution process"></p>
<h2 id="coredns">CoreDNS</h2>
<p>CoreDNS is a flexible and scalable DNS server that acts as a Kubernetes cluster DNS. like Kubernetes, the CoreDNS project is hosted by CNCF and most of its functionality is implemented by plugins.</p>
<h3 id="dns-in-kubernetes">DNS In Kubernetes</h3>
<blockquote>
<p>DNS Policy: <a href="https://godoc.org/k8s.io/api/core/v1#DNSPolicy">https://godoc.org/k8s.io/api/core/v1#DNSPolicy</a></p>
</blockquote>
<p>Pod dnsPolicy is ClusterFirst, the cluster DNS is used instead of the host DNS configuration.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/07/05/24696fa7ddc14e679fcccbbd074bcb76.png" alt="Pod dnsPolicy"></p>
<p>Check the DNS configuration file /etc/resolv.conf in the Pod. nameserver is the Virtual IP for CoreDNS Service. search is the search list. options ndots means greater than a specific number, if you don&rsquo;t search, resolve according to the original domain name, otherwise you will resolve according to the search If all of them are Not Found, then it will be resolved according to the original domain name.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/07/05/cc3c07a26a424f6bbde6e13cd65401df.png" alt="Pod dnsPolicy"></p>
<p>CoreDNS SVC corresponds to the Virtual IP, which is the DNS profile nameserver server IP in the Pod.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/07/05/2ee349dcdb574143af4e0d7827e3a15d.png" alt="CoreDNS"></p>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/dns/">dns</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2022-07/www-root-record/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">WWW &amp; Root Record</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2022-07/task-queues/">
            <span class="next-text nav-default">Task Queues</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  <script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox-3.1.20.min.js"></script>



<script type="text/javascript" src="/js/main.min.64437849d125a2d603b3e71d6de5225d641a32d17168a58106e0b61852079683.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
