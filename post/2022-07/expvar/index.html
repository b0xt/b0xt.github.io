<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Exposing Go program runtime metrics with expvar - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="Explore how to expose Go program runtime metrics using expvar." /><meta name="keywords" content="expvar" />






<meta name="generator" content="Hugo 0.101.0 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2022-07/expvar/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link href="/lib/fancybox/jquery.fancybox-3.1.20.min.css" rel="stylesheet">


<meta property="og:title" content="Exposing Go program runtime metrics with expvar" />
<meta property="og:description" content="Explore how to expose Go program runtime metrics using expvar." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2022-07/expvar/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-07-25T13:21:38+08:00" />
<meta property="article:modified_time" content="2022-07-25T13:21:38+08:00" />

<meta itemprop="name" content="Exposing Go program runtime metrics with expvar">
<meta itemprop="description" content="Explore how to expose Go program runtime metrics using expvar."><meta itemprop="datePublished" content="2022-07-25T13:21:38+08:00" />
<meta itemprop="dateModified" content="2022-07-25T13:21:38+08:00" />
<meta itemprop="wordCount" content="1061">
<meta itemprop="keywords" content="golang," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Exposing Go program runtime metrics with expvar"/>
<meta name="twitter:description" content="Explore how to expose Go program runtime metrics using expvar."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SOBYTE</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SOBYTE</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Exposing Go program runtime metrics with expvar</h1>

      <div class="post-meta">
        <span class="post-time"> 2022-07-25 13:21:38 </span>
        <div class="post-category">
            <a href="/categories/tutorials/"> tutorials </a>
            </div>
          <span class="more-meta"> 1061 words </span>
          <span class="more-meta"> 5 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#pull-and-push">Pull and Push</a></li>
        <li><a href="#using-the-expvar-library">Using the expvar library</a></li>
        <li><a href="#highlights-of-the-expvar-library">Highlights of the expvar library</a></li>
        <li><a href="#complete-example">Complete Example</a></li>
        <li><a href="#summary">Summary</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>Obtaining the application&rsquo;s operational metrics gives us a better understanding of its actual status. By connecting these metrics to monitoring systems such as prometheus, zabbix, etc., the application can be continuously checked and any abnormalities can be alerted and handled in a timely manner.</p>
<h2 id="pull-and-push">Pull and Push</h2>
<p>There are two ways to interface with monitoring systems, one is Pull and the other is Push.</p>
<p>In the case of Prometheus, for example, the application exposes an HTTP interface for Prometheus to periodically grab metrics through, which is called Pull, while Push is when the application actively pushes metrics to PushGateway.</p>
<p>The Go standard library has a package called <a href="https://pkg.go.dev/expvar">expvar</a>, whose name is a combination of exp and var, meaning exported variable.</p>
<p>expvar provides a standardized interface to public variables and exposes them in Json format via HTTP, making it ideal for interfacing with monitoring systems using Pull.</p>
<h2 id="using-the-expvar-library">Using the expvar library</h2>
<p>expvar is a standard library, meaning we don&rsquo;t want additional dependencies, and it also provides some out-of-the-box metrics. Let&rsquo;s learn how to use the library.</p>
<p>When the expvar library is imported (<code>import &quot;expvar&quot;</code>), the following init functions will be called automatically.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">init</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="nx">http</span><span class="p">.</span><span class="nf">HandleFunc</span><span class="p">(</span><span class="s">&#34;/debug/vars&#34;</span><span class="p">,</span> <span class="nx">expvarHandler</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="nf">Publish</span><span class="p">(</span><span class="s">&#34;cmdline&#34;</span><span class="p">,</span> <span class="nf">Func</span><span class="p">(</span><span class="nx">cmdline</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"> <span class="nf">Publish</span><span class="p">(</span><span class="s">&#34;memstats&#34;</span><span class="p">,</span> <span class="nf">Func</span><span class="p">(</span><span class="nx">memstats</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>This function registers us with an HTTP service for the /debug/vars path, accessing which will give us the metrics in Json format.</p>
<p>Therefore, we also need to call ListenAndServe to bind the port and start serving HTTP requests.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">http</span><span class="p">.</span><span class="nf">ListenAndServe</span><span class="p">(</span><span class="s">&#34;:8080&#34;</span><span class="p">,</span> <span class="kc">nil</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The complete code is as follows.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">main</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl"> <span class="nx">_</span> <span class="s">&#34;expvar&#34;</span>
</span></span><span class="line"><span class="cl"> <span class="s">&#34;net/http&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="nx">http</span><span class="p">.</span><span class="nf">ListenAndServe</span><span class="p">(</span><span class="s">&#34;:8080&#34;</span><span class="p">,</span> <span class="kc">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>After running the program up and requesting it via curl, the following results are obtained.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ curl localhost:8080/debug/vars
</span></span><span class="line"><span class="cl"><span class="o">{</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;cmdline&#34;</span>: <span class="o">[</span><span class="s2">&#34;/var/folders/xk/gn46n46d503dsztbc6_9qb2h0000gn/T/go-build1657217338/b001/exe/main&#34;</span><span class="o">]</span>,
</span></span><span class="line"><span class="cl"><span class="s2">&#34;memstats&#34;</span>: <span class="o">{</span><span class="s2">&#34;Alloc&#34;</span>:278880,<span class="s2">&#34;TotalAlloc&#34;</span>:278880,<span class="s2">&#34;Sys&#34;</span>:8735760,<span class="s2">&#34;Lookups&#34;</span>:0,<span class="s2">&#34;Mallocs&#34;</span>:1169,<span class="s2">&#34;Frees&#34;</span>:87,<span class="s2">&#34;HeapAlloc&#34;</span>:278880,<span class="s2">&#34;HeapSys&#34;</span>:3866624,<span class="s2">&#34;HeapIdle&#34;</span>:2949120,<span class="s2">&#34;HeapInuse&#34;</span>:917504,<span class="s2">&#34;HeapReleased&#34;</span>:2899968,<span class="s2">&#34;HeapObjects&#34;</span>:1082,<span class="s2">&#34;StackInuse&#34;</span>:327680,<span class="s2">&#34;StackSys&#34;</span>:327680,<span class="s2">&#34;MSpanInuse&#34;</span>:28696,<span class="s2">&#34;MSpanSys&#34;</span>:32640,<span class="s2">&#34;MCacheInuse&#34;</span>:9600,<span class="s2">&#34;MCacheSys&#34;</span>:15600,<span class="s2">&#34;BuckHashSys&#34;</span>:3875,<span class="s2">&#34;GCSys&#34;</span>:3826448,<span class="s2">&#34;OtherSys&#34;</span>:662893,<span class="s2">&#34;NextGC&#34;</span>:4194304,<span class="s2">&#34;LastGC&#34;</span>:0,<span class="s2">&#34;PauseTotalNs&#34;</span>:0,<span class="s2">&#34;PauseNs&#34;</span>:<span class="o">[</span>0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0<span class="o">]</span>,<span class="s2">&#34;PauseEnd&#34;</span>:<span class="o">[</span>0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0<span class="o">]</span>,<span class="s2">&#34;NumGC&#34;</span>:0,<span class="s2">&#34;NumForcedGC&#34;</span>:0,<span class="s2">&#34;GCCPUFraction&#34;</span>:0,<span class="s2">&#34;EnableGC&#34;</span>:true,<span class="s2">&#34;DebugGC&#34;</span>:false,<span class="s2">&#34;BySize&#34;</span>:<span class="o">[{</span><span class="s2">&#34;Size&#34;</span>:0,<span class="s2">&#34;Mallocs&#34;</span>:0,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:8,<span class="s2">&#34;Mallocs&#34;</span>:41,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:16,<span class="s2">&#34;Mallocs&#34;</span>:496,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:24,<span class="s2">&#34;Mallocs&#34;</span>:63,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:32,<span class="s2">&#34;Mallocs&#34;</span>:28,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:48,<span class="s2">&#34;Mallocs&#34;</span>:134,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:64,<span class="s2">&#34;Mallocs&#34;</span>:50,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:80,<span class="s2">&#34;Mallocs&#34;</span>:17,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:96,<span class="s2">&#34;Mallocs&#34;</span>:17,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:112,<span class="s2">&#34;Mallocs&#34;</span>:6,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:128,<span class="s2">&#34;Mallocs&#34;</span>:9,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:144,<span class="s2">&#34;Mallocs&#34;</span>:9,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:160,<span class="s2">&#34;Mallocs&#34;</span>:18,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:176,<span class="s2">&#34;Mallocs&#34;</span>:6,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:192,<span class="s2">&#34;Mallocs&#34;</span>:0,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:208,<span class="s2">&#34;Mallocs&#34;</span>:37,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:224,<span class="s2">&#34;Mallocs&#34;</span>:6,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:240,<span class="s2">&#34;Mallocs&#34;</span>:0,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:256,<span class="s2">&#34;Mallocs&#34;</span>:12,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:288,<span class="s2">&#34;Mallocs&#34;</span>:7,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:320,<span class="s2">&#34;Mallocs&#34;</span>:2,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:352,<span class="s2">&#34;Mallocs&#34;</span>:13,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:384,<span class="s2">&#34;Mallocs&#34;</span>:1,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:416,<span class="s2">&#34;Mallocs&#34;</span>:30,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:448,<span class="s2">&#34;Mallocs&#34;</span>:1,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:480,<span class="s2">&#34;Mallocs&#34;</span>:2,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:512,<span class="s2">&#34;Mallocs&#34;</span>:0,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:576,<span class="s2">&#34;Mallocs&#34;</span>:5,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:640,<span class="s2">&#34;Mallocs&#34;</span>:5,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:704,<span class="s2">&#34;Mallocs&#34;</span>:3,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:768,<span class="s2">&#34;Mallocs&#34;</span>:0,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:896,<span class="s2">&#34;Mallocs&#34;</span>:6,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:1024,<span class="s2">&#34;Mallocs&#34;</span>:8,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:1152,<span class="s2">&#34;Mallocs&#34;</span>:10,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:1280,<span class="s2">&#34;Mallocs&#34;</span>:3,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:1408,<span class="s2">&#34;Mallocs&#34;</span>:1,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:1536,<span class="s2">&#34;Mallocs&#34;</span>:0,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:1792,<span class="s2">&#34;Mallocs&#34;</span>:7,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:2048,<span class="s2">&#34;Mallocs&#34;</span>:2,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:2304,<span class="s2">&#34;Mallocs&#34;</span>:3,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:2688,<span class="s2">&#34;Mallocs&#34;</span>:2,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:3072,<span class="s2">&#34;Mallocs&#34;</span>:0,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:3200,<span class="s2">&#34;Mallocs&#34;</span>:0,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:3456,<span class="s2">&#34;Mallocs&#34;</span>:0,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:4096,<span class="s2">&#34;Mallocs&#34;</span>:8,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:4864,<span class="s2">&#34;Mallocs&#34;</span>:1,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:5376,<span class="s2">&#34;Mallocs&#34;</span>:1,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:6144,<span class="s2">&#34;Mallocs&#34;</span>:2,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:6528,<span class="s2">&#34;Mallocs&#34;</span>:0,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:6784,<span class="s2">&#34;Mallocs&#34;</span>:0,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:6912,<span class="s2">&#34;Mallocs&#34;</span>:0,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:8192,<span class="s2">&#34;Mallocs&#34;</span>:2,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:9472,<span class="s2">&#34;Mallocs&#34;</span>:8,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:9728,<span class="s2">&#34;Mallocs&#34;</span>:0,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:10240,<span class="s2">&#34;Mallocs&#34;</span>:0,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:10880,<span class="s2">&#34;Mallocs&#34;</span>:0,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:12288,<span class="s2">&#34;Mallocs&#34;</span>:0,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:13568,<span class="s2">&#34;Mallocs&#34;</span>:0,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:14336,<span class="s2">&#34;Mallocs&#34;</span>:0,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:16384,<span class="s2">&#34;Mallocs&#34;</span>:0,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:18432,<span class="s2">&#34;Mallocs&#34;</span>:0,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}]}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>As you can see, expvar already provides two indicators by default, namely program execution commands (<code>os.Args</code>) and runtime memory allocation (<code>runtime.Memstats</code>) information.</p>
<h2 id="highlights-of-the-expvar-library">Highlights of the expvar library</h2>
<p>The most important things in expvar are the <code>Publish</code> function and the <code>Var</code> interface.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">Publish</span><span class="p">(</span><span class="nx">name</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">v</span> <span class="nx">Var</span><span class="p">)</span> <span class="p">{}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The Publish function takes two arguments in its signature, name is the name of the indicator we specify. For example, in the <code>Publish(&quot;cmdline&quot;, Func(cmdline))</code> code line under the init function of expvar above, where <code>cmdline</code> is the indicator name and <code>Func(cmdline)</code> is an expvar.Func variable that implements the Var interface.</p>
<p>Var interface, which defines only a String method. Note that the method must return a valid Json string.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// Var is an abstract type for all exported variables.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">type</span> <span class="nx">Var</span> <span class="kd">interface</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="c1">// String returns a valid JSON value for the variable.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span> <span class="c1">// Types with String methods that do not return valid JSON
</span></span></span><span class="line"><span class="cl"><span class="c1"></span> <span class="c1">// (such as time.Time) must not be used as a Var.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span> <span class="nf">String</span><span class="p">()</span> <span class="kt">string</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>For ease of use, five exported variable types are provided in the expvar library, all of which implement the Var interface.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">Int</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="nx">i</span> <span class="kt">int64</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">Float</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="nx">f</span> <span class="kt">uint64</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">Map</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="nx">m</span>      <span class="nx">sync</span><span class="p">.</span><span class="nx">Map</span> <span class="c1">// map[string]Var
</span></span></span><span class="line"><span class="cl"><span class="c1"></span> <span class="nx">keysMu</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">RWMutex</span>
</span></span><span class="line"><span class="cl"> <span class="nx">keys</span>   <span class="p">[]</span><span class="kt">string</span> <span class="c1">// sorted
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">String</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="nx">s</span> <span class="nx">atomic</span><span class="p">.</span><span class="nx">Value</span> <span class="c1">// string
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">Func</span> <span class="kd">func</span><span class="p">()</span> <span class="nx">any</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>We can create the first four types of variables and register the indicators by calling the expvar.NewXXX function respectively.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">intVar</span> <span class="p">=</span> <span class="nx">expvar</span><span class="p">.</span><span class="nf">NewInt</span><span class="p">(</span><span class="s">&#34;metricName&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nx">floatVar</span> <span class="p">=</span> <span class="nx">expvar</span><span class="p">.</span><span class="nf">NewFloat</span><span class="p">(</span><span class="s">&#34;metricName&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nx">mapVar</span> <span class="p">=</span> <span class="nx">expvar</span><span class="p">.</span><span class="nf">NewMap</span><span class="p">(</span><span class="s">&#34;metricName&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nx">stringVar</span> <span class="p">=</span> <span class="nx">expvar</span><span class="p">.</span><span class="nf">NewString</span><span class="p">(</span><span class="s">&#34;metricName&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>For example, the expvar.NewInt function calls the Publish method internally to bind the indicator name to a variable of type expvar.Int.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">NewInt</span><span class="p">(</span><span class="nx">name</span> <span class="kt">string</span><span class="p">)</span> <span class="o">*</span><span class="nx">Int</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="nx">v</span> <span class="o">:=</span> <span class="nb">new</span><span class="p">(</span><span class="nx">Int</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="nf">Publish</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">v</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="k">return</span> <span class="nx">v</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>And the expvar.Func type is actually designed to allow us to customize the export type.</strong></p>
<p>For example, let&rsquo;s say we want to expose the following defined structure.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">MyStruct</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="nx">Field1</span> <span class="kt">string</span>
</span></span><span class="line"><span class="cl"> <span class="nx">Field2</span> <span class="kt">int</span>
</span></span><span class="line"><span class="cl"> <span class="nx">Field3</span> <span class="kt">float64</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>First you need to create a data generation function. It is used to export the data in this function each time the HTTP service path is called.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">MyStructData</span><span class="p">()</span> <span class="kd">interface</span><span class="p">{}</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="k">return</span> <span class="nx">MyStruct</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">Field1</span><span class="p">:</span> <span class="s">&#34;Gopher&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">Field2</span><span class="p">:</span> <span class="mi">22</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">Field3</span><span class="p">:</span> <span class="mf">19.99</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Finally, just register the indicator name with the Publish function.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">expvar</span><span class="p">.</span><span class="nf">Publish</span><span class="p">(</span><span class="s">&#34;metricName&#34;</span><span class="p">,</span> <span class="nx">expvar</span><span class="p">.</span><span class="nf">Func</span><span class="p">(</span><span class="nx">MyStructData</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="complete-example">Complete Example</h2>
<p>Below, we give a complete example covering the five exported variable types.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">main</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl"> <span class="s">&#34;expvar&#34;</span>
</span></span><span class="line"><span class="cl"> <span class="s">&#34;github.com/shirou/gopsutil/v3/host&#34;</span>
</span></span><span class="line"><span class="cl"> <span class="s">&#34;github.com/shirou/gopsutil/v3/load&#34;</span>
</span></span><span class="line"><span class="cl"> <span class="s">&#34;github.com/shirou/gopsutil/v3/mem&#34;</span>
</span></span><span class="line"><span class="cl"> <span class="s">&#34;net/http&#34;</span>
</span></span><span class="line"><span class="cl"> <span class="s">&#34;time&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">Load</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="nx">Load1</span>  <span class="kt">float64</span>
</span></span><span class="line"><span class="cl"> <span class="nx">Load5</span>  <span class="kt">float64</span>
</span></span><span class="line"><span class="cl"> <span class="nx">Load15</span> <span class="kt">float64</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">AllLoadAvg</span><span class="p">()</span> <span class="kd">interface</span><span class="p">{}</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="k">return</span> <span class="nx">Load</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">Load1</span><span class="p">:</span>  <span class="nf">LoadAvg</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">  <span class="nx">Load5</span><span class="p">:</span>  <span class="nf">LoadAvg</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">  <span class="nx">Load15</span><span class="p">:</span> <span class="nf">LoadAvg</span><span class="p">(</span><span class="mi">15</span><span class="p">),</span>
</span></span><span class="line"><span class="cl"> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">LoadAvg</span><span class="p">(</span><span class="nx">loadNumber</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">float64</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="nx">avg</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">load</span><span class="p">.</span><span class="nf">Avg</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"> <span class="k">switch</span> <span class="nx">loadNumber</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="k">case</span> <span class="mi">5</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">avg</span><span class="p">.</span><span class="nx">Load5</span>
</span></span><span class="line"><span class="cl"> <span class="k">case</span> <span class="mi">15</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">avg</span><span class="p">.</span><span class="nx">Load15</span>
</span></span><span class="line"><span class="cl"> <span class="k">default</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">avg</span><span class="p">.</span><span class="nx">Load1</span>
</span></span><span class="line"><span class="cl"> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="kd">var</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="nx">aliveOfSeconds</span> <span class="p">=</span> <span class="nx">expvar</span><span class="p">.</span><span class="nf">NewInt</span><span class="p">(</span><span class="s">&#34;aliveOfSeconds&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nx">hostID</span>         <span class="p">=</span> <span class="nx">expvar</span><span class="p">.</span><span class="nf">NewString</span><span class="p">(</span><span class="s">&#34;hostID&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nx">lastLoad</span>       <span class="p">=</span> <span class="nx">expvar</span><span class="p">.</span><span class="nf">NewFloat</span><span class="p">(</span><span class="s">&#34;lastLoad&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nx">virtualMemory</span>  <span class="p">=</span> <span class="nx">expvar</span><span class="p">.</span><span class="nf">NewMap</span><span class="p">(</span><span class="s">&#34;virtualMemory&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="nx">expvar</span><span class="p">.</span><span class="nf">Publish</span><span class="p">(</span><span class="s">&#34;allLoadAvg&#34;</span><span class="p">,</span> <span class="nx">expvar</span><span class="p">.</span><span class="nf">Func</span><span class="p">(</span><span class="nx">AllLoadAvg</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"> <span class="nx">h</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">host</span><span class="p">.</span><span class="nf">HostID</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"> <span class="nx">hostID</span><span class="p">.</span><span class="nf">Set</span><span class="p">(</span><span class="nx">h</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="k">go</span> <span class="nx">http</span><span class="p">.</span><span class="nf">ListenAndServe</span><span class="p">(</span><span class="s">&#34;:8080&#34;</span><span class="p">,</span> <span class="kc">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="k">for</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">aliveOfSeconds</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nx">vm</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">mem</span><span class="p">.</span><span class="nf">VirtualMemory</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="nx">lastLoad</span><span class="p">.</span><span class="nf">Set</span><span class="p">(</span><span class="nf">LoadAvg</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="nx">virtualMemory</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">&#34;active&#34;</span><span class="p">,</span> <span class="nb">int64</span><span class="p">(</span><span class="nx">vm</span><span class="p">.</span><span class="nx">Active</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="nx">virtualMemory</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">&#34;buffer&#34;</span><span class="p">,</span> <span class="nb">int64</span><span class="p">(</span><span class="nx">vm</span><span class="p">.</span><span class="nx">Buffers</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="nx">time</span><span class="p">.</span><span class="nf">Sleep</span><span class="p">(</span><span class="mi">1</span> <span class="o">*</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In the above example, we get some system information through the <a href="https://github.com/shirou/gopsutil">gopsutil</a> library and show how to export this information through the various variable types in expvar.</p>
<p>Using curl to request <code>localhost:8080/debug/vars</code>, the result is as follows.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ curl localhost:8080/debug/vars
</span></span><span class="line"><span class="cl"><span class="o">{</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;aliveOfSeconds&#34;</span>: 1,
</span></span><span class="line"><span class="cl"><span class="s2">&#34;allLoadAvg&#34;</span>: <span class="o">{</span><span class="s2">&#34;Load1&#34;</span>:1.69580078125,<span class="s2">&#34;Load5&#34;</span>:1.97412109375,<span class="s2">&#34;Load15&#34;</span>:1.90283203125<span class="o">}</span>,
</span></span><span class="line"><span class="cl"><span class="s2">&#34;cmdline&#34;</span>: <span class="o">[</span><span class="s2">&#34;/var/folders/xk/gn46n46d503dsztbc6_9qb2h0000gn/T/go-build3566019824/b001/exe/main&#34;</span><span class="o">]</span>,
</span></span><span class="line"><span class="cl"><span class="s2">&#34;hostID&#34;</span>: <span class="s2">&#34;7a1a74f2-30fc-5bc1-b439-6b7aef22e58d&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="s2">&#34;lastLoad&#34;</span>: 1.69580078125,
</span></span><span class="line"><span class="cl"><span class="s2">&#34;memstats&#34;</span>: <span class="o">{</span><span class="s2">&#34;Alloc&#34;</span>:256208,<span class="s2">&#34;TotalAlloc&#34;</span>:256208,<span class="s2">&#34;Sys&#34;</span>:8735760,<span class="s2">&#34;Lookups&#34;</span>:0,<span class="s2">&#34;Mallocs&#34;</span>:1089,<span class="s2">&#34;Frees&#34;</span>:48,<span class="s2">&#34;HeapAlloc&#34;</span>:256208,<span class="s2">&#34;HeapSys&#34;</span>:3866624,<span class="s2">&#34;HeapIdle&#34;</span>:2891776,<span class="s2">&#34;HeapInuse&#34;</span>:974848,<span class="s2">&#34;HeapReleased&#34;</span>:2859008,<span class="s2">&#34;HeapObjects&#34;</span>:1041,<span class="s2">&#34;StackInuse&#34;</span>:327680,<span class="s2">&#34;StackSys&#34;</span>:327680,<span class="s2">&#34;MSpanInuse&#34;</span>:19992,<span class="s2">&#34;MSpanSys&#34;</span>:32640,<span class="s2">&#34;MCacheInuse&#34;</span>:9600,<span class="s2">&#34;MCacheSys&#34;</span>:15600,<span class="s2">&#34;BuckHashSys&#34;</span>:3905,<span class="s2">&#34;GCSys&#34;</span>:3851120,<span class="s2">&#34;OtherSys&#34;</span>:638191,<span class="s2">&#34;NextGC&#34;</span>:4194304,<span class="s2">&#34;LastGC&#34;</span>:0,<span class="s2">&#34;PauseTotalNs&#34;</span>:0,<span class="s2">&#34;PauseNs&#34;</span>:<span class="o">[</span>0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0<span class="o">]</span>,<span class="s2">&#34;PauseEnd&#34;</span>:<span class="o">[</span>0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0<span class="o">]</span>,<span class="s2">&#34;NumGC&#34;</span>:0,<span class="s2">&#34;NumForcedGC&#34;</span>:0,<span class="s2">&#34;GCCPUFraction&#34;</span>:0,<span class="s2">&#34;EnableGC&#34;</span>:true,<span class="s2">&#34;DebugGC&#34;</span>:false,<span class="s2">&#34;BySize&#34;</span>:<span class="o">[{</span><span class="s2">&#34;Size&#34;</span>:0,<span class="s2">&#34;Mallocs&#34;</span>:0,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:8,<span class="s2">&#34;Mallocs&#34;</span>:35,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:16,<span class="s2">&#34;Mallocs&#34;</span>:415,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:24,<span class="s2">&#34;Mallocs&#34;</span>:71,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:32,<span class="s2">&#34;Mallocs&#34;</span>:37,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:48,<span class="s2">&#34;Mallocs&#34;</span>:141,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:64,<span class="s2">&#34;Mallocs&#34;</span>:52,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:80,<span class="s2">&#34;Mallocs&#34;</span>:20,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:96,<span class="s2">&#34;Mallocs&#34;</span>:23,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:112,<span class="s2">&#34;Mallocs&#34;</span>:14,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:128,<span class="s2">&#34;Mallocs&#34;</span>:7,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:144,<span class="s2">&#34;Mallocs&#34;</span>:7,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:160,<span class="s2">&#34;Mallocs&#34;</span>:18,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:176,<span class="s2">&#34;Mallocs&#34;</span>:6,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:192,<span class="s2">&#34;Mallocs&#34;</span>:1,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:208,<span class="s2">&#34;Mallocs&#34;</span>:42,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:224,<span class="s2">&#34;Mallocs&#34;</span>:3,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:240,<span class="s2">&#34;Mallocs&#34;</span>:0,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:256,<span class="s2">&#34;Mallocs&#34;</span>:9,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:288,<span class="s2">&#34;Mallocs&#34;</span>:8,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:320,<span class="s2">&#34;Mallocs&#34;</span>:5,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:352,<span class="s2">&#34;Mallocs&#34;</span>:13,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:384,<span class="s2">&#34;Mallocs&#34;</span>:3,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:416,<span class="s2">&#34;Mallocs&#34;</span>:33,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:448,<span class="s2">&#34;Mallocs&#34;</span>:0,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:480,<span class="s2">&#34;Mallocs&#34;</span>:2,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:512,<span class="s2">&#34;Mallocs&#34;</span>:1,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:576,<span class="s2">&#34;Mallocs&#34;</span>:4,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:640,<span class="s2">&#34;Mallocs&#34;</span>:8,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:704,<span class="s2">&#34;Mallocs&#34;</span>:3,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:768,<span class="s2">&#34;Mallocs&#34;</span>:1,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:896,<span class="s2">&#34;Mallocs&#34;</span>:6,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:1024,<span class="s2">&#34;Mallocs&#34;</span>:8,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:1152,<span class="s2">&#34;Mallocs&#34;</span>:9,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:1280,<span class="s2">&#34;Mallocs&#34;</span>:3,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:1408,<span class="s2">&#34;Mallocs&#34;</span>:1,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:1536,<span class="s2">&#34;Mallocs&#34;</span>:1,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:1792,<span class="s2">&#34;Mallocs&#34;</span>:9,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:2048,<span class="s2">&#34;Mallocs&#34;</span>:1,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:2304,<span class="s2">&#34;Mallocs&#34;</span>:2,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:2688,<span class="s2">&#34;Mallocs&#34;</span>:2,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:3072,<span class="s2">&#34;Mallocs&#34;</span>:0,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:3200,<span class="s2">&#34;Mallocs&#34;</span>:1,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:3456,<span class="s2">&#34;Mallocs&#34;</span>:0,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:4096,<span class="s2">&#34;Mallocs&#34;</span>:5,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:4864,<span class="s2">&#34;Mallocs&#34;</span>:0,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:5376,<span class="s2">&#34;Mallocs&#34;</span>:1,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:6144,<span class="s2">&#34;Mallocs&#34;</span>:1,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:6528,<span class="s2">&#34;Mallocs&#34;</span>:0,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:6784,<span class="s2">&#34;Mallocs&#34;</span>:0,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:6912,<span class="s2">&#34;Mallocs&#34;</span>:0,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:8192,<span class="s2">&#34;Mallocs&#34;</span>:1,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:9472,<span class="s2">&#34;Mallocs&#34;</span>:8,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:9728,<span class="s2">&#34;Mallocs&#34;</span>:0,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:10240,<span class="s2">&#34;Mallocs&#34;</span>:0,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:10880,<span class="s2">&#34;Mallocs&#34;</span>:0,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:12288,<span class="s2">&#34;Mallocs&#34;</span>:0,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:13568,<span class="s2">&#34;Mallocs&#34;</span>:0,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:14336,<span class="s2">&#34;Mallocs&#34;</span>:0,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:16384,<span class="s2">&#34;Mallocs&#34;</span>:0,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}</span>,<span class="o">{</span><span class="s2">&#34;Size&#34;</span>:18432,<span class="s2">&#34;Mallocs&#34;</span>:0,<span class="s2">&#34;Frees&#34;</span>:0<span class="o">}]}</span>,
</span></span><span class="line"><span class="cl"><span class="s2">&#34;virtualMemory&#34;</span>: <span class="o">{</span><span class="s2">&#34;active&#34;</span>: 1957449728, <span class="s2">&#34;buffer&#34;</span>: 0<span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="summary">Summary</h2>
<p>The standard library expvar provides a standardized interface to the public variables that need to be exported and is relatively simple to use.</p>
<p>Several base types defined inside the expvar package are given concurrency-safe methods of operation. We don&rsquo;t need to implement them all over again, they are ready to use out of the box.</p>
<p>However, the number of imports of this library is less than 10,000 for the public projects counted on <a href="https://go.dev/">https://go.dev/</a>.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/07/25/9bbf0af988cf4fb6938074dd31793949.png" alt="expvar"></p>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/golang/">golang</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2022-07/postgresql15/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">PostgreSQL 15 improvements to UNIQUE and NULL</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2022-07/serde/">
            <span class="next-text nav-default">serde custom serialization</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  <script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox-3.1.20.min.js"></script>



<script type="text/javascript" src="/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
