<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Embrace Atomic CSS-in-JS - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="This article is about Atomic CSS." /><meta name="keywords" content="Atomic CSS, CSS-in-JS" />






<meta name="generator" content="Hugo 0.102.0 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2022-07/atomic-css/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link href="/lib/fancybox/jquery.fancybox-3.1.20.min.css" rel="stylesheet">


<meta property="og:title" content="Embrace Atomic CSS-in-JS" />
<meta property="og:description" content="This article is about Atomic CSS." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2022-07/atomic-css/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-07-27T12:12:02+08:00" />
<meta property="article:modified_time" content="2022-07-27T12:12:02+08:00" />

<meta itemprop="name" content="Embrace Atomic CSS-in-JS">
<meta itemprop="description" content="This article is about Atomic CSS."><meta itemprop="datePublished" content="2022-07-27T12:12:02+08:00" />
<meta itemprop="dateModified" content="2022-07-27T12:12:02+08:00" />
<meta itemprop="wordCount" content="3548">
<meta itemprop="keywords" content="css," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Embrace Atomic CSS-in-JS"/>
<meta name="twitter:description" content="This article is about Atomic CSS."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SOBYTE</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SOBYTE</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Embrace Atomic CSS-in-JS</h1>

      <div class="post-meta">
        <span class="post-time"> 2022-07-27 12:12:02 </span>
        <div class="post-category">
            <a href="/categories/tutorials/"> tutorials </a>
            </div>
          <span class="more-meta"> 3548 words </span>
          <span class="more-meta"> 8 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#history-of-css-authoring-methods">History of CSS authoring methods</a>
          <ul>
            <li><a href="#smacss">SMACSS</a></li>
            <li><a href="#bem">BEM</a></li>
            <li><a href="#css-modules">CSS Modules</a></li>
            <li><a href="#utility-first-css">Utility-First CSS</a></li>
          </ul>
        </li>
        <li><a href="#a-new-era-is-here---atomic-css-in-js">A new era is here - Atomic CSS-in-JS</a>
          <ul>
            <li><a href="#disadvantages-of-the-traditional-css-writing-approach">Disadvantages of the traditional CSS writing approach</a></li>
            <li><a href="#smaller-build-product">Smaller build product</a></li>
            <li><a href="#handling-the-insertion-order-of-css-rules">Handling the insertion order of CSS rules</a></li>
            <li><a href="#classic-implementations">Classic implementations</a></li>
          </ul>
        </li>
        <li><a href="#summary">Summary</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>Nowadays, Atomic CSS is gaining more and more attention. Compared to the traditional CSS writing method where each component has one CSS class. With Atomic CSS, each CSS class uniquely corresponds to a separate CSS rule. As the number of components grows, more and more CSS rules can be reused. The final CSS product is much smaller, allowing for a quantum leap in page load speed.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/07/27/460f0b862aeb426ea13073b5f019072c.png" alt="Atomic CSS-in-JS"></p>
<h2 id="history-of-css-authoring-methods">History of CSS authoring methods</h2>
<p>Before we introduce Atomic CSS, let&rsquo;s review the evolution of how CSS is written.</p>
<h3 id="smacss">SMACSS</h3>
<p><a href="http://smacss.com/">SMACSS</a> (Scalable &amp; Modular Architecture for CSS), is a theory of CSS proposed by Jonathan Snook. Its main principles are 3.</p>
<ul>
<li>Categorizing CSS Rules (for CSS categorization)</li>
<li>Naming Rules</li>
<li>Minimizing the Depth of Applicability</li>
</ul>
<h4 id="rules-classification">Rules Classification</h4>
<p>SMACSS classifies rules into five categories: Base, Layout, Module, State, and Theme.</p>
<p><strong>Base</strong> rules hold the default styles. These default styles are basically element selectors, but can also contain attribute selectors, pseudo-class selectors, child selectors, and sibling selectors. Essentially, a base style defines how an element should look at any location on the page.</p>
<p><strong>Layout</strong> rules split the page into sections, each of which may have one or more modules. As the name implies, this category is mainly used for the layout of the page as a whole or one of its areas.
<strong>Modules</strong> are the reusable, modular parts of our design. Illustrations, sidebars, article lists, etc. are all modules.
<strong>State</strong> rule defines how our module or layout should appear in a particular state. It may define how a module or layout should be displayed on different displays. It may also define how a module may look like on different pages (e.g. home page and inner page).
<strong>Theme</strong> rules are similar to status rules and define the appearance of a module or layout. This is how many websites implement features such as &ldquo;dark mode&rdquo; and &ldquo;switching themes&rdquo;.</p>
<h4 id="naming-rules">Naming Rules</h4>
<p>After separating the rules into five categories, a naming convention is needed. Naming conventions make it easy to immediately know which category a style belongs to and what role it plays in the overall page. In a large project, we may split a style into several files, and naming conventions make it easier to know which file the style belongs to.</p>
<p>It is recommended to use prefixes to distinguish layout, module, state, etc. rules. For example, using the <code>layout-</code> prefix for layout rules and the <code>is-</code> prefix for state rules is a good choice.</p>
<h4 id="minimize-adaptation-depth">Minimize adaptation depth</h4>
<p>Try not to rely on the structure of the document tree to write styles. This will make our styles more flexible and easier to maintain.</p>
<h3 id="bem">BEM</h3>
<p><a href="http://getbem.com/">BEM</a> (Block Element Modifier) is a front-end CSS naming methodology proposed by the Yandex team. It is a simple yet very useful naming convention. It makes front-end code easier to read and understand, easier to collaborate with, easier to control, more robust and clear, and tighter.</p>
<p>The pattern of the BEM naming convention is as follows.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-css" data-lang="css"><span class="line"><span class="cl"><span class="p">.</span><span class="nc">block</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">.</span><span class="nc">block__element</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">.</span><span class="nc">block--modifier</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><code>block</code> represents a <code>block</code>, which is used for the component body.</li>
<li><code>element</code> represents an <code>element</code> (also called a <code>sub-component</code>) of the <code>block</code>, which is the main member of the block composition.</li>
<li><code>modifier</code> represents a modifier of the block, indicating different states and versions. The distinction is made using <code>--</code> for &ldquo;blocks&rdquo; and &ldquo;elements&rdquo;, which are called &ldquo;block modifiers&rdquo; and &ldquo;element modifiers&rdquo; respectively.</li>
</ul>
<p>The reason why <code>__</code> and <code>--</code> are used to separate different parts of a name is that if more than one word appears in a part it needs to be separated by <code>-</code>, so as to avoid confusion.</p>
<h3 id="css-modules">CSS Modules</h3>
<p>As the number of CSS class names in a large front-end project grows, it is inevitable that there will be class name conflicts, which is why CSS Modules were created - to prevent conflicts by adding hashes to CSS class names and so on to produce unique names.</p>
<p><a href="https://github.com/css-modules/css-modules">CSS Modules</a> is not an official CSS standard, nor is it a browser feature, but rather a way of scoping CSS class names and selectors using some build tools such as Webpack.</p>
<h3 id="utility-first-css">Utility-First CSS</h3>
<p>At a time when most of the CSS methodologies used in traditional large-scale projects are the above-mentioned OOCSS, SMACSS, BEM, and other &ldquo;semantic CSS&rdquo; solutions that focus on &ldquo;separation of concerns&rdquo;, the Utility-First CSS concept is gaining attention from the community. The most well-known and typical of these is <a href="https://tailwindcss.com/">Tailwind CSS</a>.</p>
<p>Instead of putting component styles in a class like Semantic CSS, Utility-First CSS provides us with a toolbox of different functional classes that we can mix together and apply to page elements. This has the following benefits.</p>
<ul>
<li>not having to get hung up on naming class names.</li>
<li>the simpler the function of the class, the higher the reuse rate, which can reduce the final package size.</li>
<li>No global style pollution issues.</li>
<li>and so on.</li>
</ul>
<p>However, there are some shortcomings.</p>
<ul>
<li>The content of the <code>class</code> attribute is too long.</li>
<li>Problems related to the order of CSS rule insertion.</li>
<li>the role of the component cannot be known by the semantic class name.</li>
<li>The build product is too large without compression.</li>
</ul>
<h2 id="a-new-era-is-here---atomic-css-in-js">A new era is here - Atomic CSS-in-JS</h2>
<p>Taking the Utility-First CSS introduced in the previous article a step further, Atomic CSS has come to the forefront.</p>
<p>The idea behind Atomic CSS is the opposite of the old &ldquo;separation of concerns&rdquo; idea. The use of Atomic CSS actually couples the structure and style layers in a way that is largely accepted in modern CSS-in-JS codebases, as described further below.</p>
<p>Atomic CSS can be seen as the ultimate abstract version of Utility-First CSS, where each CSS class corresponds to a single CSS rule. But with such a complex set of CSS rules, writing Atomic CSS class names by hand is not a good solution. So Atomic CSS-in-JS was born, which can be thought of as &ldquo;Atomic CSS for automation&rdquo;.</p>
<ul>
<li>eliminating the need to manually design CSS class names.</li>
<li>the ability to extract the key CSS of a page and split the code.</li>
<li>can solve the classic CSS rule insertion order problem.</li>
</ul>
<h3 id="disadvantages-of-the-traditional-css-writing-approach">Disadvantages of the traditional CSS writing approach</h3>
<p>Christopher Chedeau has been working to promote the CSS-in-JS philosophy in the React ecosystem. In many of his talks, he has explained several of the major problems with CSS.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/07/27/dee3cf2e45f74b88b79365d3ec250654.png" alt="A few major problems with CSS"></p>
<ol>
<li>global namespace</li>
<li>dependencies</li>
<li>Useless code elimination</li>
<li>Code compression</li>
<li>shared constants</li>
<li>Non-Deterministic Parsing</li>
<li>isolation</li>
</ol>
<p>While Utility-First CSS and Atomic CSS solve some of these problems, they do not solve all of them (especially the non-deterministic parsing of styles).</p>
<p>As an example: Tailwind CSS generates a lot of useless code when it is generated, causing the style file to grow in size.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;before:bg-white before:p-4&#34;</span><span class="p">&gt;</span>content<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The generated style file looks like this.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-css" data-lang="css"><span class="line"><span class="cl"><span class="p">.</span><span class="nc">before</span><span class="err">\</span><span class="p">:</span><span class="nd">bg-white</span><span class="p">::</span><span class="nd">before</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">content</span><span class="p">:</span> <span class="nf">var</span><span class="p">(</span><span class="o">--</span><span class="n">tw</span><span class="o">-</span><span class="n">content</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nv">--tw-bg-opacity</span><span class="p">:</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">background-color</span><span class="p">:</span> <span class="nb">rgb</span><span class="p">(</span><span class="mi">255</span> <span class="mi">255</span> <span class="mi">255</span> <span class="o">/</span> <span class="nf">var</span><span class="p">(</span><span class="o">--</span><span class="n">tw</span><span class="o">-</span><span class="n">bg</span><span class="o">-</span><span class="n">opacity</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">.</span><span class="nc">before</span><span class="err">\</span><span class="p">:</span><span class="nd">p-4</span><span class="p">::</span><span class="nd">before</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">content</span><span class="p">:</span> <span class="nf">var</span><span class="p">(</span><span class="o">--</span><span class="n">tw</span><span class="o">-</span><span class="n">content</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">padding</span><span class="p">:</span> <span class="mi">1</span><span class="kt">rem</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>You can see that this file contains a lot of useless code, such as the repeated <code>content: var(--tw-content)</code>.</p>
<h3 id="smaller-build-product">Smaller build product</h3>
<p>Traditional CSS writing methods cannot reuse CSS rules that are repeated between components, such as the several rules highlighted in the image below each lying in their corresponding CSS class.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/07/27/26bcbea747da414f93535bc7e2f07e24.png" alt="css"></p>
<p>This results in a linear correlation between CSS product size and the complexity of the project and the number of components.</p>
<p>However, with Atomic CSS, these rules are extracted for reuse.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/07/27/bdd6db66fd5e4377a0a67ccd6146929e.png" alt="Atomic CSS"></p>
<p>As the number of components increases later, more and more CSS rules can be reused, and the final CSS product size is logarithmically related to the complexity of the project.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/07/27/87d458d9b1da4f079abec3bf23ae1ab3.png" alt="CSS product size is logarithmically related to the complexity of the project"></p>
<p>Facebook shared their data: on the old site, the login page alone required 413 KiB of style files to be loaded, while after rewriting with Atomic CSS-in-JS, the entire site only had 74 KiB of style files, including the dark color mode.</p>
<p>Although the size of the HTML is significantly larger with Atomic CSS, the high redundancy of these class names makes it possible to use gzip to compress a significant portion of the size.</p>
<h3 id="handling-the-insertion-order-of-css-rules">Handling the insertion order of CSS rules</h3>
<p>Let&rsquo;s go over this classic CSS rule insertion order problem again.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/07/27/4946c673f7d6455b9b465ca487027470.png" alt="CSS rule insertion order problem"></p>
<p>We all know that the last style to take effect is not the rule corresponding to the last class name, but the last rule inserted in the stylesheet.</p>
<p>So, how can this be handled in CSS-in-JS? The common practice is to filter out conflicting rules at the generation stage to avoid conflicts. Take for example the following component.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-css" data-lang="css"><span class="line"><span class="cl"><span class="nt">const</span> <span class="nt">styles</span> <span class="o">=</span> <span class="nt">style9</span><span class="p">.</span><span class="nc">create</span><span class="o">(</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">card</span><span class="p">:</span> <span class="err">{</span>
</span></span><span class="line"><span class="cl">    <span class="kc">color</span><span class="o">:</span> <span class="s1">&#39;#000000&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">profileCard</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">color</span><span class="p">:</span> <span class="s1">&#39;#ffffff&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span><span class="o">,</span>
</span></span><span class="line"><span class="cl"><span class="err">}</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">const</span> <span class="nt">Component</span> <span class="o">=</span> <span class="o">()</span> <span class="o">=&gt;</span> <span class="o">(</span>
</span></span><span class="line"><span class="cl">  <span class="o">&lt;</span><span class="nt">div</span> <span class="nt">className</span><span class="o">=</span><span class="p">{</span><span class="err">style9(styles.card,</span> <span class="err">styles.profileCard)</span><span class="p">}</span> <span class="o">/&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The actual style of the filtered component is as follows.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-css" data-lang="css"><span class="line"><span class="cl"><span class="nt">color</span><span class="o">:</span> <span class="p">#</span><span class="nn">ffffff</span><span class="o">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>If you switch the order of <code>styles.card</code> and <code>styles.profileCard</code> in the component style, the filtered style will look like this.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-css" data-lang="css"><span class="line"><span class="cl"><span class="nt">color</span><span class="o">:</span> <span class="p">#</span><span class="nn">000000</span><span class="o">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>However, there are some shorthand rules in CSS that obviously won&rsquo;t work if you just follow the rule names. Some libraries force developers not to use shorthand rules to avoid this problem, while others expand these shorthand rules into multiple rules and then filter them, for example <code>margin: 10px</code> can be split into <code>margin-top: 10px</code>, <code>margin-right: 10px</code>, <code>margin-bottom: 10px</code> and <code>margin-left: 10px</code> into four separate rules.</p>
<h3 id="classic-implementations">Classic implementations</h3>
<p>Atomic CSS-in-JS implementations are available as Runtime and Pre-Compile. The advantage of Runtime is that it can dynamically generate styles, which is more flexible than the pre-compiled libraries below. The disadvantage is that operations such as Vendor Prefix need to be performed in Runtime, so the Bundle must carry the relevant dependencies, resulting in a larger size. The advantage of Pre-Compile is that the dependencies are not packaged and sent to the client, which improves performance. The disadvantage is that the precompilation process is highly dependent on static code analysis, so it is difficult to achieve dynamic style generation and combination.</p>
<h4 id="styletron">Styletron</h4>
<p><a href="https://styletron.org/">Styletron</a> is a more typical runtime Atomic CSS-in-JS library developed by Uber that drives Uber&rsquo;s website and H5 pages.</p>
<p>Styletron also provides a set of implementations of Styled Components, which can be used in the following ways.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">styled</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;styletron-react&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">Component</span> <span class="o">=</span> <span class="nx">styled</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">marginTop</span><span class="o">:</span> <span class="s1">&#39;10px&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">marginBottom</span><span class="o">:</span> <span class="s1">&#39;10px&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="nx">Component</span> <span class="o">/&gt;</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>It is also possible to dynamically generate styles based on the value of prop.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-css" data-lang="css"><span class="line"><span class="cl"><span class="nt">const</span> <span class="nt">Component</span> <span class="o">=</span> <span class="nt">styled</span><span class="o">(</span><span class="s1">&#39;div&#39;</span><span class="o">,</span> <span class="o">(</span><span class="nt">props</span><span class="o">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="err">return</span> <span class="err">{</span> <span class="k">color</span><span class="p">:</span> <span class="n">props</span><span class="o">.</span><span class="err">$</span><span class="n">fraction</span> <span class="o">&lt;</span> <span class="mf">0.5</span> <span class="o">?</span> <span class="s1">&#39;red&#39;</span> <span class="o">:</span> <span class="s1">&#39;green&#39;</span> <span class="p">}</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="err">}</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="nt">Component</span> <span class="o">$</span><span class="nt">fraction</span><span class="o">=</span><span class="p">{</span><span class="err">Math.random()</span><span class="p">}</span> <span class="o">/&gt;;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="fela">Fela</h4>
<p>Joining Styletron as a runtime Atomic CSS-in-JS library is <a href="https://fela.js.org/">Fela</a>, developed by the former technical director of Volvo Cars, which drives the Volvo Cars website, Cloudflare Dashboard and Medium, among many other sites.</p>
<h4 id="vanilla-extract">vanilla-extract</h4>
<p><a href="https://www.youtube.com/watch?v=9JZHodNR184">Stylex</a> is a precompiled Atomic CSS-in-JS library from Meta (formerly Facebook) that has not yet been open sourced. However, due to Meta&rsquo;s delay in open sourcing stylex, several open source implementations based on its ideas have emerged in the community, with <a href="https://github.com/seek-oss/vanilla-extract">vanilla-extract</a> being the best known.</p>
<h4 id="style9">style9</h4>
<p>Pre-compiled Atomic CSS-in-JS libraries based on the stylex idea include <a href="https://github.com/johanholmerin/style9">style9</a> and <a href="https://github.com/necolas/styleq">styleQ</a> in addition to vanilla-extract.</p>
<h4 id="compiled">compiled</h4>
<p>Moving away from the stylex family, Atlassian also writes a pre-compiled Atomic CSS-in-JS library called <a href="https://compiledcssinjs.com/">compiled</a>. However, there are many pitfalls in my practical use, which may lead to duplicate style generation, and its support for TypeScript is not as good as it could be. However, there are many techniques in the code implementation that can be useful.</p>
<h5 id="styled-components">Styled Components</h5>
<p>compiled relies on a babel transformer to transform the code to insert styles.</p>
<p>In the <a href="https://github.com/atlassian-labs/compiled/blob/ba66b35b82be513bf206d46c4adbdd7aefa3f7f1/packages/react/src/styled/index.tsx#L59-L83"><code>packages/react/src/styled/index.tsx</code></a>, you can see that <code>@compiled/react</code> contains an object named <code>styled</code> that is exported and immediately throws an error when it is accessed, indicating that the transformer is not working properly .</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-tsx" data-lang="tsx"><span class="line"><span class="cl"><span class="kr">export</span> <span class="kr">const</span> <span class="nx">styled</span>: <span class="kt">StyledComponentInstantiator</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Proxy</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="p">{},</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">get</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// Blow up if the transformer isn&#39;t turned on.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">// This code won&#39;t ever be executed when setup correctly.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">throw</span> <span class="nx">createSetupError</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">      <span class="p">};</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span> <span class="kr">as</span> <span class="kt">any</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Then you can see that <code>styled</code> will be replaced by transformer and the corresponding entry logic is in <a href="https://github.com/atlassian-labs/compiled/blob/ba66b35b82be513bf206d46c4adbdd7aefa3f7f1/packages/babel-plugin/src/babel-plugin.tsx"><code>packages/babel-plugin/src/babel-plugin.tsx</code></a> file.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-tsx" data-lang="tsx"><span class="line"><span class="cl"><span class="nx">ImportDeclaration</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="nx">state</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 不是从 @compiled/react 导入的包不处理
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">if</span> <span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">value</span> <span class="o">!==</span> <span class="s1">&#39;@compiled/react&#39;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// 记录导入的模块
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">state</span><span class="p">.</span><span class="nx">compiledImports</span> <span class="o">=</span> <span class="p">{};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// 遍历导入数组中的所有元素
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">path</span><span class="p">.</span><span class="kr">get</span><span class="p">(</span><span class="s1">&#39;specifiers&#39;</span><span class="p">).</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">specifier</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">state</span><span class="p">.</span><span class="nx">compiledImports</span> <span class="o">||</span> <span class="o">!</span><span class="nx">specifier</span><span class="p">.</span><span class="nx">isImportSpecifier</span><span class="p">())</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">([</span><span class="s1">&#39;styled&#39;</span><span class="p">,</span> <span class="s1">&#39;ClassNames&#39;</span><span class="p">,</span> <span class="s1">&#39;css&#39;</span><span class="p">,</span> <span class="s1">&#39;keyframes&#39;</span><span class="p">]</span> <span class="kr">as</span> <span class="kr">const</span><span class="p">).</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">apiName</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="nx">state</span><span class="p">.</span><span class="nx">compiledImports</span> <span class="o">&amp;&amp;</span>
</span></span><span class="line"><span class="cl">        <span class="nx">t</span><span class="p">.</span><span class="nx">isIdentifier</span><span class="p">(</span><span class="nx">specifier</span><span class="p">.</span><span class="nx">node</span><span class="o">?</span><span class="p">.</span><span class="nx">imported</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
</span></span><span class="line"><span class="cl">        <span class="nx">specifier</span><span class="p">.</span><span class="nx">node</span><span class="o">?</span><span class="p">.</span><span class="nx">imported</span><span class="p">.</span><span class="nx">name</span> <span class="o">===</span> <span class="nx">apiName</span>
</span></span><span class="line"><span class="cl">      <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// 记录下导入后 API 的名称
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nx">state</span><span class="p">.</span><span class="nx">compiledImports</span><span class="p">[</span><span class="nx">apiName</span><span class="p">]</span> <span class="o">=</span> <span class="nx">specifier</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">local</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// 导入 @compiled/react/runtime 中的 API
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">appendRuntimeImports</span><span class="p">(</span><span class="nx">path</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">path</span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">},</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>This code documents the introduction of <code>@compiled/react</code> and facilitates the processing below.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="nx">TaggedTemplateExpression</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="nx">state</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">isIdentifier</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">tag</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">tag</span><span class="p">.</span><span class="nx">name</span> <span class="o">===</span> <span class="nx">state</span><span class="p">.</span><span class="nx">compiledImports</span><span class="o">?</span><span class="p">.</span><span class="nx">css</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">state</span><span class="p">.</span><span class="nx">pathsToCleanup</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span> <span class="nx">path</span><span class="p">,</span> <span class="nx">action</span><span class="o">:</span> <span class="s1">&#39;replace&#39;</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="nx">t</span><span class="p">.</span><span class="nx">isIdentifier</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">tag</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">tag</span><span class="p">.</span><span class="nx">name</span> <span class="o">===</span> <span class="nx">state</span><span class="p">.</span><span class="nx">compiledImports</span><span class="o">?</span><span class="p">.</span><span class="nx">keyframes</span>
</span></span><span class="line"><span class="cl">  <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">state</span><span class="p">.</span><span class="nx">pathsToCleanup</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span> <span class="nx">path</span><span class="p">,</span> <span class="nx">action</span><span class="o">:</span> <span class="s1">&#39;replace&#39;</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">state</span><span class="p">.</span><span class="nx">compiledImports</span><span class="o">?</span><span class="p">.</span><span class="nx">styled</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// 处理 styled component
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">visitStyledPath</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="p">{</span> <span class="nx">context</span><span class="o">:</span> <span class="s1">&#39;root&#39;</span><span class="p">,</span> <span class="nx">state</span><span class="p">,</span> <span class="nx">parentPath</span>: <span class="kt">path</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="nx">CallExpression</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="nx">state</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">state</span><span class="p">.</span><span class="nx">compiledImports</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="nx">t</span><span class="p">.</span><span class="nx">isIdentifier</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">callee</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">callee</span><span class="p">.</span><span class="nx">name</span> <span class="o">===</span> <span class="nx">state</span><span class="p">.</span><span class="nx">compiledImports</span><span class="o">?</span><span class="p">.</span><span class="nx">css</span> <span class="o">||</span>
</span></span><span class="line"><span class="cl">      <span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">callee</span><span class="p">.</span><span class="nx">name</span> <span class="o">===</span> <span class="nx">state</span><span class="p">.</span><span class="nx">compiledImports</span><span class="o">?</span><span class="p">.</span><span class="nx">keyframes</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">state</span><span class="p">.</span><span class="nx">pathsToCleanup</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span> <span class="nx">path</span><span class="p">,</span> <span class="nx">action</span><span class="o">:</span> <span class="s1">&#39;replace&#39;</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// 处理 styled component
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">visitStyledPath</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="p">{</span> <span class="nx">context</span><span class="o">:</span> <span class="s1">&#39;root&#39;</span><span class="p">,</span> <span class="nx">state</span><span class="p">,</span> <span class="nx">parentPath</span>: <span class="kt">path</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">},</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The handling of <code>TaggedTemplateExpression</code> and <code>CallExpression</code> corresponds to the two different ways of calling in the documentation.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="c1">// 模板字符串
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">styled</span><span class="p">.</span><span class="nx">a</span><span class="sb">`
</span></span></span><span class="line"><span class="cl"><span class="sb">  color: blue;
</span></span></span><span class="line"><span class="cl"><span class="sb">`</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 函数调用
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">styled</span><span class="p">.</span><span class="nx">a</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">color</span><span class="o">:</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Follow the definition of the <code>visitStyledPath</code> function to find <a href="https://github.com/atlassian-labs/compiled/blob/ba66b35b82be513bf206d46c4adbdd7aefa3f7f1/packages/babel-plugin/src/styled/index.tsx"><code>packages/babel-plugin/src/styled/index.tsx</code></a> file.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kr">export</span> <span class="kr">const</span> <span class="nx">visitStyledPath</span> <span class="o">=</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="nx">path</span>: <span class="kt">NodePath</span><span class="p">&lt;</span><span class="nt">t.TaggedTemplateExpression</span><span class="p">&gt;</span> <span class="o">|</span> <span class="nx">NodePath</span><span class="p">&lt;</span><span class="nt">t.CallExpression</span><span class="p">&gt;,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">meta</span>: <span class="kt">Metadata</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span><span class="o">:</span> <span class="k">void</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 判断是否是支持的操作
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">if</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="nx">t</span><span class="p">.</span><span class="nx">isTaggedTemplateExpression</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">hasInValidExpression</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">throw</span> <span class="nx">buildCodeFrameError</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">      <span class="sb">`A logical expression contains an invalid CSS declaration. 
</span></span></span><span class="line"><span class="cl"><span class="sb">      Compiled doesn&#39;t support CSS properties that are defined with a conditional rule that doesn&#39;t specify a default value.
</span></span></span><span class="line"><span class="cl"><span class="sb">      Eg. font-weight: </span><span class="err">\</span><span class="si">${</span><span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">props</span><span class="p">.</span><span class="nx">isPrimary</span> <span class="o">&amp;&amp;</span> <span class="nx">props</span><span class="p">.</span><span class="nx">isMaybe</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="s1">&#39;bold&#39;</span><span class="si">}</span><span class="sb">; is invalid.
</span></span></span><span class="line"><span class="cl"><span class="sb">      Use </span><span class="err">\</span><span class="si">${</span><span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">props</span><span class="p">.</span><span class="nx">isPrimary</span> <span class="o">&amp;&amp;</span> <span class="nx">props</span><span class="p">.</span><span class="nx">isMaybe</span> <span class="o">&amp;&amp;</span> <span class="p">({</span> <span class="s1">&#39;font-weight&#39;</span><span class="o">:</span> <span class="s1">&#39;bold&#39;</span> <span class="si">}</span><span class="sb">)}; instead`</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">meta</span><span class="p">.</span><span class="nx">parentPath</span>
</span></span><span class="line"><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// 提取样式信息
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">const</span> <span class="nx">styledData</span> <span class="o">=</span> <span class="nx">extractStyledDataFromNode</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">,</span> <span class="nx">meta</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">styledData</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 没有样式信息
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// 生成 CSS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">const</span> <span class="nx">cssOutput</span> <span class="o">=</span> <span class="nx">buildCss</span><span class="p">(</span><span class="nx">styledData</span><span class="p">.</span><span class="nx">cssNode</span><span class="p">,</span> <span class="nx">meta</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// 构建并替换节点
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">path</span><span class="p">.</span><span class="nx">replaceWith</span><span class="p">(</span><span class="nx">buildStyledComponent</span><span class="p">(</span><span class="nx">styledData</span><span class="p">.</span><span class="nx">tag</span><span class="p">,</span> <span class="nx">cssOutput</span><span class="p">,</span> <span class="nx">meta</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">parentVariableDeclaration</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">findParent</span><span class="p">((</span><span class="nx">x</span><span class="p">)</span> <span class="o">=&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">x</span><span class="p">.</span><span class="nx">isVariableDeclaration</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="nx">parentVariableDeclaration</span> <span class="o">&amp;&amp;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">t</span><span class="p">.</span><span class="nx">isVariableDeclaration</span><span class="p">(</span><span class="nx">parentVariableDeclaration</span><span class="p">.</span><span class="nx">node</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">variableDeclarator</span> <span class="o">=</span> <span class="nx">parentVariableDeclaration</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">declarations</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">isIdentifier</span><span class="p">(</span><span class="nx">variableDeclarator</span><span class="p">.</span><span class="nx">id</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="kr">const</span> <span class="nx">variableName</span> <span class="o">=</span> <span class="nx">variableDeclarator</span><span class="p">.</span><span class="nx">id</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="nx">parentVariableDeclaration</span><span class="p">.</span><span class="nx">insertAfter</span><span class="p">(</span><span class="nx">buildDisplayName</span><span class="p">(</span><span class="nx">variableName</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Let&rsquo;s look at the function <code>extractStyledDataFromNode</code> which extracts the style information using different methods depending on the situation.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">extractStyledDataFromNode</span> <span class="o">=</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="nx">node</span>: <span class="kt">t.TaggedTemplateExpression</span> <span class="o">|</span> <span class="nx">t</span><span class="p">.</span><span class="nx">CallExpression</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">meta</span>: <span class="kt">Metadata</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 使用模板字符串
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">if</span> <span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">isTaggedTemplateExpression</span><span class="p">(</span><span class="nx">node</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">extractStyledDataFromTemplateLiteral</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">meta</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// 使用函数调用
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">if</span> <span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">isCallExpression</span><span class="p">(</span><span class="nx">node</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">extractStyledDataFromObjectLiteral</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">meta</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// 提取不到信息
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">return</span> <span class="kc">undefined</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The function to build a new node is defined in <a href="https://github.com/atlassian-labs/compiled/blob/ba66b35b82be513bf206d46c4adbdd7aefa3f7f1/packages/babel-plugin/src/utils/ast-builders.tsx#L455-L496"><code>packages/babel-plugin/src/utils/ast-builders.tsx</code></a> file.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kr">export</span> <span class="kr">const</span> <span class="nx">buildStyledComponent</span> <span class="o">=</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="nx">tag</span>: <span class="kt">Tag</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">cssOutput</span>: <span class="kt">CSSOutput</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">meta</span>: <span class="kt">Metadata</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span><span class="o">:</span> <span class="nx">t</span><span class="p">.</span><span class="nx">Node</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">unconditionalCss</span>: <span class="kt">string</span><span class="p">[]</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">logicalCss</span>: <span class="kt">CssItem</span><span class="p">[]</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">cssOutput</span><span class="p">.</span><span class="nx">css</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">item</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="kr">type</span> <span class="o">===</span> <span class="s1">&#39;logical&#39;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">logicalCss</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">item</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">unconditionalCss</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">getItemCss</span><span class="p">(</span><span class="nx">item</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// 去重，只保留最后一个
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">const</span> <span class="nx">uniqueUnconditionalCssOutput</span> <span class="o">=</span> <span class="nx">transformCss</span><span class="p">(</span><span class="nx">unconditionalCss</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">logicalCssOutput</span> <span class="o">=</span> <span class="nx">transformItemCss</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">    <span class="nx">css</span>: <span class="kt">logicalCss</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">variables</span>: <span class="kt">cssOutput.variables</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">sheets</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">...</span><span class="nx">uniqueUnconditionalCssOutput</span><span class="p">.</span><span class="nx">sheets</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">...</span><span class="nx">logicalCssOutput</span><span class="p">.</span><span class="nx">sheets</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">classNames</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">...[</span><span class="nx">t</span><span class="p">.</span><span class="nx">stringLiteral</span><span class="p">(</span><span class="nx">uniqueUnconditionalCssOutput</span><span class="p">.</span><span class="nx">classNames</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">))],</span>
</span></span><span class="line"><span class="cl">    <span class="p">...</span><span class="nx">logicalCssOutput</span><span class="p">.</span><span class="nx">classNames</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// 返回构建好的节点
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">return</span> <span class="nx">styledTemplate</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">classNames</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">tag</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">sheets</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">variables</span>: <span class="kt">cssOutput.variables</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nx">meta</span>
</span></span><span class="line"><span class="cl">  <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>As for the operation of constructing nodes, it is a simpler string splicing.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">styledTemplate</span> <span class="o">=</span> <span class="p">(</span><span class="nx">opts</span>: <span class="kt">StyledTemplateOpts</span><span class="p">,</span> <span class="nx">meta</span>: <span class="kt">Metadata</span><span class="p">)</span><span class="o">:</span> <span class="nx">t</span><span class="p">.</span><span class="nx">Node</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">nonceAttribute</span> <span class="o">=</span> <span class="nx">meta</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">opts</span><span class="p">.</span><span class="nx">nonce</span>
</span></span><span class="line"><span class="cl">    <span class="o">?</span> <span class="sb">`nonce={</span><span class="si">${</span><span class="nx">meta</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">opts</span><span class="p">.</span><span class="nx">nonce</span><span class="si">}</span><span class="sb">}`</span>
</span></span><span class="line"><span class="cl">    <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">propsToDestructure</span>: <span class="kt">string</span><span class="p">[]</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// 提取样式
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">const</span> <span class="nx">styleProp</span> <span class="o">=</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">variables</span><span class="p">.</span><span class="nx">length</span>
</span></span><span class="line"><span class="cl">    <span class="o">?</span> <span class="nx">styledStyleProp</span><span class="p">(</span><span class="nx">opts</span><span class="p">.</span><span class="nx">variables</span><span class="p">,</span> <span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kr">const</span> <span class="nx">nestedArrowFunctionExpressionVisitor</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nx">noScope</span>: <span class="kt">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">MemberExpression</span><span class="p">(</span><span class="nx">path</span>: <span class="kt">NodePath</span><span class="p">&lt;</span><span class="nt">t.MemberExpression</span><span class="p">&gt;)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="kr">const</span> <span class="nx">propsToDestructureFromMemberExpression</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">              <span class="nx">handleMemberExpressionInStyledInterpolation</span><span class="p">(</span><span class="nx">path</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="nx">propsToDestructure</span><span class="p">.</span><span class="nx">push</span><span class="p">(...</span><span class="nx">propsToDestructureFromMemberExpression</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">          <span class="p">},</span>
</span></span><span class="line"><span class="cl">          <span class="nx">Identifier</span><span class="p">(</span><span class="nx">path</span>: <span class="kt">NodePath</span><span class="p">&lt;</span><span class="nt">t.Identifier</span><span class="p">&gt;)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="kr">const</span> <span class="nx">propsToDestructureFromIdentifier</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">              <span class="nx">handleDestructuringInStyledInterpolation</span><span class="p">(</span><span class="nx">path</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="nx">propsToDestructure</span><span class="p">.</span><span class="nx">push</span><span class="p">(...</span><span class="nx">propsToDestructureFromIdentifier</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">          <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">isArrowFunctionExpression</span><span class="p">(</span><span class="nx">node</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="k">return</span> <span class="nx">traverseStyledArrowFunctionExpression</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="nx">node</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nx">nestedArrowFunctionExpressionVisitor</span>
</span></span><span class="line"><span class="cl">          <span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">isBinaryExpression</span><span class="p">(</span><span class="nx">node</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="k">return</span> <span class="nx">traverseStyledBinaryExpression</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="nx">node</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nx">nestedArrowFunctionExpressionVisitor</span>
</span></span><span class="line"><span class="cl">          <span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nx">node</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="o">:</span> <span class="nx">t</span><span class="p">.</span><span class="nx">identifier</span><span class="p">(</span><span class="s1">&#39;style&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">unconditionalClassNames</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">logicalClassNames</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">opts</span><span class="p">.</span><span class="nx">classNames</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">item</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">isStringLiteral</span><span class="p">(</span><span class="nx">item</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">unconditionalClassNames</span> <span class="o">+=</span> <span class="sb">`</span><span class="si">${</span><span class="nx">item</span><span class="p">.</span><span class="nx">value</span><span class="si">}</span><span class="sb"> `</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">isLogicalExpression</span><span class="p">(</span><span class="nx">item</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">logicalClassNames</span> <span class="o">+=</span> <span class="sb">`</span><span class="si">${</span><span class="nx">generate</span><span class="p">(</span><span class="nx">item</span><span class="p">).</span><span class="nx">code</span><span class="si">}</span><span class="sb">, `</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// classNames 为生成好的类名
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">const</span> <span class="nx">classNames</span> <span class="o">=</span> <span class="sb">`&#34;</span><span class="si">${</span><span class="nx">unconditionalClassNames</span><span class="p">.</span><span class="nx">trim</span><span class="p">()</span><span class="si">}</span><span class="sb">&#34;, </span><span class="si">${</span><span class="nx">logicalClassNames</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// 此处的 &lt;CC /&gt;, &lt;CS /&gt; 是上文中处理 import 时从 @compiled/react/runtime 中导入的组件
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">return</span> <span class="nx">template</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="sb">`
</span></span></span><span class="line"><span class="cl"><span class="sb">  forwardRef(({
</span></span></span><span class="line"><span class="cl"><span class="sb">    as: C = </span><span class="si">${</span><span class="nx">buildComponentTag</span><span class="p">(</span><span class="nx">opts</span><span class="p">.</span><span class="nx">tag</span><span class="p">)</span><span class="si">}</span><span class="sb">,
</span></span></span><span class="line"><span class="cl"><span class="sb">    style,
</span></span></span><span class="line"><span class="cl"><span class="sb">    </span><span class="si">${</span><span class="kt">unique</span><span class="p">(</span><span class="nx">propsToDestructure</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">prop</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">prop</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="si">}</span><span class="sb">
</span></span></span><span class="line"><span class="cl"><span class="sb">    ...</span><span class="si">${</span><span class="nx">PROPS_IDENTIFIER_NAME</span><span class="si">}</span><span class="sb">
</span></span></span><span class="line"><span class="cl"><span class="sb">  }, ref) =&gt; (
</span></span></span><span class="line"><span class="cl"><span class="sb">    &lt;CC&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">      &lt;CS </span><span class="si">${</span><span class="nx">nonceAttribute</span><span class="si">}</span><span class="sb">&gt;{%%cssNode%%}&lt;/CS&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">      &lt;C
</span></span></span><span class="line"><span class="cl"><span class="sb">        {...</span><span class="si">${</span><span class="nx">PROPS_IDENTIFIER_NAME</span><span class="si">}</span><span class="sb">}
</span></span></span><span class="line"><span class="cl"><span class="sb">        style={%%styleProp%%}
</span></span></span><span class="line"><span class="cl"><span class="sb">        ref={ref}
</span></span></span><span class="line"><span class="cl"><span class="sb">        className={ax([</span><span class="si">${</span><span class="nx">classNames</span><span class="si">}</span><span class="sb"> </span><span class="si">${</span><span class="nx">PROPS_IDENTIFIER_NAME</span><span class="si">}</span><span class="sb">.className])}
</span></span></span><span class="line"><span class="cl"><span class="sb">      /&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">    &lt;/CC&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">  ));
</span></span></span><span class="line"><span class="cl"><span class="sb">`</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;jsx&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">)({</span>
</span></span><span class="line"><span class="cl">    <span class="nx">styleProp</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">cssNode</span>: <span class="kt">t.arrayExpression</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">      <span class="kt">unique</span><span class="p">(</span><span class="nx">opts</span><span class="p">.</span><span class="nx">sheets</span><span class="p">).</span><span class="nx">map</span><span class="p">((</span><span class="nx">sheet</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">hoistSheet</span><span class="p">(</span><span class="nx">sheet</span><span class="p">,</span> <span class="nx">meta</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="p">),</span>
</span></span><span class="line"><span class="cl">  <span class="p">})</span> <span class="kr">as</span> <span class="nx">t</span><span class="p">.</span><span class="nx">Node</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>This goes around in circles, pulling out the style of the component generated using the <code>styled</code> method and turning it into a compiled Atomic CSS-in-JS component.</p>
<h5 id="css-prop"><code>css</code> Prop</h5>
<p>compiled first <a href="https://github.com/atlassian-labs/compiled/blob/8470616bde0cd47b2b41d63dedb0efa7bf6f299f/packages/react/src/jsx/jsx-local-namespace.ts">adds TypeScript definition of <code>css</code> prop</a>, and then specialize this prop in the babel transform as with the styled component.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="nx">JSXOpeningElement</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="nx">state</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">state</span><span class="p">.</span><span class="nx">compiledImports</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// 处理 css prop
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">visitCssPropPath</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="p">{</span> <span class="nx">context</span><span class="o">:</span> <span class="s1">&#39;root&#39;</span><span class="p">,</span> <span class="nx">state</span><span class="p">,</span> <span class="nx">parentPath</span>: <span class="kt">path</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">},</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The handling of <code>css</code> prop looks much simpler than the complicated handling of styled components.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kr">export</span> <span class="kr">const</span> <span class="nx">visitCssPropPath</span> <span class="o">=</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="nx">path</span>: <span class="kt">NodePath</span><span class="p">&lt;</span><span class="nt">t.JSXOpeningElement</span><span class="p">&gt;,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">meta</span>: <span class="kt">Metadata</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span><span class="o">:</span> <span class="k">void</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">cssPropIndex</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">cssProp</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nx">attr</span><span class="p">,</span> <span class="nx">index</span><span class="p">)</span><span class="o">:</span> <span class="nx">attr</span> <span class="k">is</span> <span class="nx">t</span><span class="p">.</span><span class="nx">JSXAttribute</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">isJSXAttribute</span><span class="p">(</span><span class="nx">attr</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">attr</span><span class="p">.</span><span class="nx">name</span><span class="p">.</span><span class="nx">name</span> <span class="o">===</span> <span class="s1">&#39;css&#39;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">cssPropIndex</span> <span class="o">=</span> <span class="nx">index</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// 不存在 css prop 就不进行处理了
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">cssProp</span> <span class="o">||</span> <span class="o">!</span><span class="nx">cssProp</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// 从 css props 中提取样式信息
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">const</span> <span class="nx">cssOutput</span> <span class="o">=</span> <span class="nx">buildCss</span><span class="p">(</span><span class="nx">getJsxAttributeExpression</span><span class="p">(</span><span class="nx">cssProp</span><span class="p">),</span> <span class="nx">meta</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// 删除 css prop
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">cssPropIndex</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// 没有样式信息
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">cssOutput</span><span class="p">.</span><span class="nx">css</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// 构建并替换节点
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">path</span><span class="p">.</span><span class="nx">parentPath</span><span class="p">.</span><span class="nx">replaceWith</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="nx">buildCompiledComponent</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">      <span class="nx">path</span><span class="p">.</span><span class="nx">parentPath</span><span class="p">.</span><span class="nx">node</span> <span class="kr">as</span> <span class="nx">t</span><span class="p">.</span><span class="nx">JSXElement</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">cssOutput</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">meta</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The <code>buildCompiledComponent</code> function to build a new node is defined in <a href="https://github.com/atlassian-labs/compiled/blob/ba66b35b82be513bf206d46c4adbdd7aefa3f7f1/packages/babel-plugin/src/utils/ast-builders.tsx#L567-L651"><code>packages/babel-plugin/src/utils/ast-builders.tsx</code></a> file, this function mainly accomplishes the following operations.</p>
<ol>
<li>merges the existing <code>className</code>.</li>
<li>process the styles in the <code>css</code> prop.</li>
<li>generate the compiled Atomic CSS-in-JS component.</li>
</ol>
<p>This splits the component&rsquo;s <code>css</code> parameter into two parts &ndash; the static style and the <code>className</code> parameter value that is appended to the original component.</p>
<h4 id="other">Other</h4>
<p>Microsoft&rsquo;s recently open-sourced <a href="https://github.com/microsoft/griffel">Griffel</a> supports both runtime and pre-compiled modes, and has better TypeScript support, which is not a bad choice. This library currently drives Microsoft&rsquo;s official <a href="https://developer.microsoft.com/en-us/fluentui">Fluent UI</a>.</p>
<h2 id="summary">Summary</h2>
<p>That&rsquo;s all there is to know about Atomic CSS in this article.</p>
<p>Although Atomic CSS-in-JS is a new trend in the React ecosystem, it is important to think twice before using it - whether it fits the needs of your project, rather than using it blindly and sowing future maintenance hazards, but if there are obvious benefits to using it, then Why not?</p>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/css/">css</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2022-07/go-docker/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Golang in Docker</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2022-07/go-scanner-valuer/">
            <span class="next-text nav-default">Scanner and Valuer interfaces in the Golang database module</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  <script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox-3.1.20.min.js"></script>



<script type="text/javascript" src="/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js"></script>








</body>
</html>
