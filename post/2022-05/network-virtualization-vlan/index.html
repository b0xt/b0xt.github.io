<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>[Network Virtualization] VLAN - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="Explore VLAN in network virtualization." /><meta name="keywords" content="Network Virtualization, VLAN" />






<meta name="generator" content="Hugo 0.96.0 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2022-05/network-virtualization-vlan/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="[Network Virtualization] VLAN" />
<meta property="og:description" content="Explore VLAN in network virtualization." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2022-05/network-virtualization-vlan/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-05-01T16:39:50+08:00" />
<meta property="article:modified_time" content="2022-05-01T16:39:50+08:00" />

<meta itemprop="name" content="[Network Virtualization] VLAN">
<meta itemprop="description" content="Explore VLAN in network virtualization."><meta itemprop="datePublished" content="2022-05-01T16:39:50+08:00" />
<meta itemprop="dateModified" content="2022-05-01T16:39:50+08:00" />
<meta itemprop="wordCount" content="7191">
<meta itemprop="keywords" content="network virtualization," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="[Network Virtualization] VLAN"/>
<meta name="twitter:description" content="Explore VLAN in network virtualization."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SOBYTE</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a><a href="/ukraine/">
        <li class="mobile-menu-item">UKRAINE</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SOBYTE</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/ukraine/">UKRAINE</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">[Network Virtualization] VLAN</h1>

      <div class="post-meta">
        <span class="post-time"> 2022-05-01 16:39:50 </span>
        <div class="post-category">
            <a href="/categories/tutorials/"> tutorials </a>
            </div>
          <span class="more-meta"> 7191 words </span>
          <span class="more-meta"> 34 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#why-vlans-are-needed">Why VLANs are needed</a>
          <ul>
            <li><a href="#what-is-vlan">What is VLAN</a></li>
            <li><a href="#when-the-broadcast-domain-is-not-split">When the broadcast domain is not split</a></li>
            <li><a href="#are-broadcast-messages-that-frequent">Are broadcast messages that frequent?</a></li>
            <li><a href="#partitioning-of-broadcast-domains-and-the-need-for-vlans">Partitioning of broadcast domains and the need for VLANs</a></li>
          </ul>
        </li>
        <li><a href="#mechanisms-for-implementing-vlans">Mechanisms for implementing VLANs</a>
          <ul>
            <li><a href="#mechanisms-for-implementing-vlans-1">Mechanisms for Implementing VLANs</a></li>
            <li><a href="#visual-description-of-vlans">Visual description of VLANs</a></li>
            <li><a href="#what-to-do-when-you-need-to-communicate-between-vlans">What to do when you need to communicate between VLANs</a></li>
          </ul>
        </li>
        <li><a href="#access-link-of-the-vlan">Access Link of the VLAN</a>
          <ul>
            <li><a href="#port-type-of-the-switch">Port type of the switch</a></li>
            <li><a href="#access-link">Access Link</a></li>
            <li><a href="#summary-of-access-links">Summary of access links</a></li>
          </ul>
        </li>
        <li><a href="#vlan-aggregation-link-trunk-link">VLAN aggregation link Trunk Link</a>
          <ul>
            <li><a href="#when-you-need-to-set-up-vlans-that-span-multiple-switches">When you need to set up VLANs that span multiple switches</a></li>
            <li><a href="#what-is-a-trunk-link">What is a Trunk link?</a></li>
          </ul>
        </li>
        <li><a href="#aggregation-method-for-vlans">Aggregation method for VLANs</a>
          <ul>
            <li><a href="#aggregation-method">Aggregation method</a></li>
            <li><a href="#ieee-8021q">IEEE 802.1Q</a></li>
            <li><a href="#isl-inter-switch-link">ISL (Inter Switch Link)</a></li>
          </ul>
        </li>
        <li><a href="#inter-vlan-routing">Inter-VLAN Routing</a>
          <ul>
            <li><a href="#the-need-for-inter-vlan-routing">The need for inter-VLAN routing</a></li>
            <li><a href="#inter-vlan-routing-with-a-router">Inter-VLAN routing with a router</a></li>
            <li><a href="#layer-3-switches">Layer 3 Switches</a></li>
            <li><a href="#layer-3-switch">Layer 3 Switch</a></li>
          </ul>
        </li>
        <li><a href="#the-meaning-of-the-existence-of-traditional-type-of-router">The meaning of the existence of traditional type of router</a>
          <ul>
            <li><a href="#the-need-for-routers">The need for routers</a></li>
            <li><a href="#example-of-a-router-and-switch-paired-together-to-build-a-lan">Example of a router and switch paired together to build a LAN</a></li>
          </ul>
        </li>
        <li><a href="#designing-a-lan-with-vlans">Designing a LAN with VLANs</a>
          <ul>
            <li><a href="#features-of-designing-a-lan-using-vlans">Features of designing a LAN using VLANs</a></li>
            <li><a href="#change-of-network-composition-in-a-lan-without-vlans">Change of network composition in a LAN without VLANs</a></li>
            <li><a href="#change-of-network-composition-in-a-vlan-using-lan">Change of network composition in a VLAN-using LAN</a></li>
            <li><a href="#complication-of-network-structure-by-using-vlans">Complication of network structure by using VLANs</a></li>
            <li><a href="#logical-and-physical-structure-of-the-network">Logical and physical structure of the network</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <h2 id="why-vlans-are-needed">Why VLANs are needed</h2>
<h3 id="what-is-vlan">What is VLAN</h3>
<p>A LAN can be a network of a few home computers or a corporate network of hundreds of computers, and a VLAN (Virtual LAN) refers specifically to a network that is segmented using routers - that is, a broadcast domain.</p>
<p>Let&rsquo;s review the concept of a broadcast domain here.</p>
<p>The <strong>Broadcast Domain</strong> is the range to which a broadcast frame (with a destination MAC address of all 1s) can pass, i.e. the range to which it can communicate directly. Strictly speaking, it is not only broadcast frames, but Multicast frames and Unknown Unicast frames can also travel unimpeded in the same broadcast domain.</p>
<p>Originally, a Layer 2 switch could only build a single broadcast domain, but with the VLAN feature, it can <strong>partition the network into multiple broadcast domains</strong>.</p>
<h3 id="when-the-broadcast-domain-is-not-split">When the broadcast domain is not split</h3>
<p>So, why do you need to split the broadcast domain? That is because, if there is only one broadcast domain, it may affect the overall transmission performance of the network. The figure below shows a network consisting of five Layer 2 switches (switches 1 to 5) connected with a large number of clients.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/05/01/0f585d98b61040d7979fb986140d9a05.png" alt="network consisting of five Layer 2 switches"></p>
<p>Suppose at this point, Computer A needs to communicate with Computer B. In Ethernet-based communication, the destination MAC address must be specified in the data frame in order to communicate properly, so Computer A must first broadcast an ARP Request message to try to obtain Computer B&rsquo;s MAC address.</p>
<p>After switch 1 receives the broadcast frame (ARP Request), it will <strong>forward</strong> it to all ports except the receiving port, which is Flooding. Next, switch 2 receives the broadcast frame and Floods it as well. switches 3, 4, and 5 also Flood. eventually the ARP request is forwarded to <strong>all</strong> clients in the same network.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/05/01/f64f68542f374e41b13f56bf78655d8b.png" alt="ARP"></p>
<p>Please note that this ARP request was originally sent to get the MAC address of computer B. In other words: as long as computer B receives it, everything is fine. But in fact, the data frame is transmitted all over the network, causing all computers to receive it. In this way, on the one hand, the broadcast message consumes the overall bandwidth of the network, and on the other hand, the computer receiving the broadcast message consumes some CPU time to process it. This results in a significant <strong>unnecessary consumption</strong> of network bandwidth and CPU computing power.</p>
<h3 id="are-broadcast-messages-that-frequent">Are broadcast messages that frequent?</h3>
<p>As you read this, you may ask: Are broadcast messages really that frequent?</p>
<p>The answer is: Yes! Broadcast frames can actually occur very frequently. When communicating using the TCP/IP stack, in addition to the ARP that appeared earlier, there are many other types of broadcast messages that may need to be sent out such as DHCP, RIP, and so on.</p>
<p>The following are some common broadcast communications.</p>
<ul>
<li>ARP request: Establishes a mapping relationship between IP address and MAC address. It is issued when communication with other hosts is needed.</li>
<li>RIP: A routing protocol. Routers broadcast routing information to other routers in the vicinity every 30 seconds. routing protocols other than RIP use multicast to transmit routing information, which is also forwarded by the switch (Flooding)</li>
<li>DHCP: A protocol used to automatically set IP addresses. When a client requests a DHCP server to assign an IP address, it must send a DHCP broadcast.</li>
<li>NetBEUI: A network protocol used under Windows.</li>
<li>IPX: Network protocol used by NovellNetware.</li>
<li>Apple Talk: A network protocol used by Apple&rsquo;s Macintosh computers.</li>
</ul>
<p>If there is only one broadcast domain for the entire network, then once a broadcast message is sent, it travels throughout the network and places an additional burden on the hosts in the network. Therefore, when designing a LAN, attention needs to be paid to how you can effectively <strong>split</strong> the broadcast domain.</p>
<h3 id="partitioning-of-broadcast-domains-and-the-need-for-vlans">Partitioning of broadcast domains and the need for VLANs</h3>
<p>When splitting broadcast domains, it is generally <strong>necessary</strong> to use a router. When a router is used, the network interface (LAN Interface) on the router can be used as <strong>unit</strong> to divide the broadcast domain.</p>
<p>However, usually there are not too many network interfaces on the router, and the number of them is mostly around 1 to 4. With the popularity of broadband connections, broadband routers (or IP sharers) have become more common, but it should be noted that they come with multiple (usually about 4) network interfaces on the LAN side of the connection, but that is actually the router <strong>built-in</strong> switch and does not divide the broadcast domain.</p>
<p>In addition, if you use a router to split the broadcast domain, the number of splits depends entirely on the number of network interfaces on the router, making it impossible for users to freely split the broadcast domain according to their actual needs.</p>
<p>In contrast to routers, Layer 2 switches generally have multiple network interfaces. Therefore, if you can use it to split broadcast domains, you will undoubtedly have much more flexibility in using it.</p>
<p>The technology used to split broadcast domains on Layer 2 switches is <strong>VLAN</strong>. By using VLANs, we can freely design the composition of the broadcast domain and increase the freedom of network design.</p>
<h2 id="mechanisms-for-implementing-vlans">Mechanisms for implementing VLANs</h2>
<h3 id="mechanisms-for-implementing-vlans-1">Mechanisms for Implementing VLANs</h3>
<p>Having understood &ldquo;why VLANs are needed&rdquo;, let&rsquo;s look at how switches use VLANs to segment broadcast domains.</p>
<p>First, on a Layer 2 switch without any VLANs, any broadcast frames will be forwarded to all ports except the receiving port (Flooding). For example, after computer A sends a broadcast message, it is forwarded to ports 2, 3, and 4.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/05/01/e1c972b80a8b4ca0ad8080d233a0a5cf.png" alt="switch without any VLANs"></p>
<p>At this point, if two VLANs are generated on the switch, red and blue; ports 1 and 2 are in the red VLAN and ports 3 and 4 are in the blue VLAN, and if a broadcast frame is sent from A, the switch will <strong>only</strong> forward it to other ports in the same VLAN-that is, port 2 in the red VLAN-and <strong>not</strong> forward it to port 2 in the blue VLAN. If a broadcast frame is sent from A, the switch <strong>will</strong> forward it to another port in the same VLAN - that is, port 2 in the same red VLAN - and <strong>not</strong> to a port in the blue VLAN.</p>
<p>Similarly, when C sends a broadcast message, it will only be forwarded to other ports belonging to the blue VLAN, not to ports belonging to the red VLAN.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/05/01/39bec7bae45048d3984f2be42293afee.png" alt="roadcast message,"></p>
<p>In this way, VLANs are <strong>partitioned</strong> into broadcast domains by <strong>limiting</strong> the range of broadcast frames to be forwarded. The different VLANs are identified in red and blue in the figure above for illustration purposes, but in practice they are distinguished by <strong>VLAN ID</strong>.</p>
<h3 id="visual-description-of-vlans">Visual description of VLANs</h3>
<p>For a more intuitive description of VLANs, we can think of it as a switch that is <strong>logically partitioned into several switches</strong>. Generating red and blue VLANs on a switch can also be thought of as replacing one switch with two virtual switches, one red and one blue. When generating new VLANs in addition to the red and blue VLANs, it can be imagined as adding another new switch.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/05/01/035c264bcf2c45e3978a7e308d3e812b.png" alt="Visual description of VLANs"></p>
<p>However, the switches on the <strong>logical</strong> generated by the VLAN are <strong>not communicating with each other</strong>. Therefore, after setting up VLANs on a switch, it is impossible to communicate between VLANs if no other processing is done. The fact that you are obviously connected to the same switch, but you just can&rsquo;t communicate - this fact may be hard to accept. But it is both the feature that makes VLANs convenient and easy to use, and the reason that makes them so difficult to understand.</p>
<h3 id="what-to-do-when-you-need-to-communicate-between-vlans">What to do when you need to communicate between VLANs</h3>
<p>So what happens when we need to communicate between different VLANs? Please recall again: a VLAN is a broadcast domain. Usually two broadcast domains are connected by routers, and packets to and from broadcast domains are relayed by <strong>routers</strong>. Therefore, inter-VLAN communication also requires routers to provide trunking services, which is called <strong>Inter-VLAN routing</strong>.</p>
<p>For inter-VLAN routing, you can use a normal router or a Layer 3 switch. Here I hope you first remember that the routing function is needed when different VLANs communicate with each other.</p>
<h2 id="access-link-of-the-vlan">Access Link of the VLAN</h2>
<h3 id="port-type-of-the-switch">Port type of the switch</h3>
<p>The ports of the switch, which can be divided into the following two types.</p>
<ul>
<li>Access Link (Access Link)</li>
<li>Trunk Link (Aggregation Link)</li>
</ul>
<h3 id="access-link">Access Link</h3>
<p>An access link, a port that <strong>belongs to only one VLAN and forwards data frames</strong> to that VLAN only. In most cases, the access link is connected to a client machine.</p>
<p>The usual order of setting up VLANs is</p>
<ul>
<li>Generate VLANs</li>
<li>Set the access link (determine which VLAN each port <strong>belongs to</strong>)</li>
</ul>
<p>There are two ways to set up access links.</p>
<ul>
<li>Static VLAN: fixed in advance</li>
<li>Dynamic VLAN: ∂ dynamically change the settings according to the connected computers</li>
</ul>
<h4 id="static-vlans---portbased">Static VLANs - PortBased</h4>
<p>Static VLANs are also known as PortBased VLANs (PortBased VLANs). As the name implies, it is a setting method that explicitly specifies which VLAN each port belongs to.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/05/01/695c5dde61684a6e86da0d3421abf7f3.png" alt="PortBased VLANs"></p>
<p>Because of the need to specify ports one by one, the setup operation becomes cumbersome when the number of computers in the network exceeds a certain number (e.g., hundreds). Moreover, each time a client changes its port, it must also change the settings of the VLAN to which the port belongs - clearly not suitable for networks that require frequent topology changes.</p>
<h4 id="dynamic-vlans">Dynamic VLANs</h4>
<p>Dynamic VLANs, on the other hand, change the VLAN to which a port belongs at any time, depending on the computers connected to each port, thus avoiding the above-mentioned operations such as changing settings. Dynamic VLANs can be broadly classified into three categories.</p>
<ul>
<li>MAC address-based VLAN (MAC Based VLAN)</li>
<li>Subnet Based VLAN (Subnet Based VLAN)</li>
<li>User Based VLAN (User Based VLAN)</li>
</ul>
<p>The difference lies mainly in which layer of the OSI reference model determines which VLAN a port belongs to.</p>
<h5 id="mac-address-based-vlan">MAC address-based VLAN</h5>
<p><strong>MAC address-based VLAN</strong> determines the port&rsquo;s affiliation by querying and recording the MAC address of the computer&rsquo;s network card connected to the port. Assuming that a MAC address A is set by the switch to belong to VLAN 10, the port will be assigned to VLAN 10 regardless of which port the computer with MAC address A is connected to.</p>
<ul>
<li>When the computer is connected to port 1, port 1 belongs to VLAN 10</li>
<li>When the computer is connected to port 2, port 2 belongs to VLAN 10</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/05/01/d5dad00bb7174cf3851aad3415ec29c4.png" alt="MAC address-based VLAN"></p>
<p>Since it is based on the MAC address to determine the VLAN to which it belongs, it can be interpreted as a way to set the access link at the second layer of OSI.</p>
<p>However, for VLANs based on MAC addresses, the MAC addresses of all connected computers must be investigated and logged in when setting. And if the computers swap NICs, the settings still need to be changed.</p>
<h5 id="ip-address-based-vlans">IP address-based VLANs</h5>
<p><strong>Subnet-based VLAN</strong> determines the VLAN to which a port belongs by the IP address of the connected computer. Unlike MAC address-based VLANs, even if a computer&rsquo;s MAC address changes due to a switch of NICs or other reasons, it can still join the original VLAN as long as its IP address remains the same.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/05/01/80fcad5c934a4cbfab73adb25be5fd6c.png" alt="Subnet-based VLAN"></p>
<p>Therefore, it is possible to change the network structure more easily than MAC address-based VLANs. IP addresses are information at layer 3 in the OSI reference model, so we can understand that subnet-based VLANs are a method of setting access links at layer 3 of the OSI.</p>
<p>User-based VLANs, on the other hand, determine which VLAN the port belongs to based on the user currently logged in on the computer connected to each port of the switch. here, the user identification information is generally the user logged in by the computer&rsquo;s operating system, which can be, for example, the user name used in the Windows domain. This user name information, belongs to OSI layer 4 and above.</p>
<p>In general, the higher the level of information in the OSI utilized in determining the VLAN to which a port belongs, the more suitable it is for building a flexible and versatile network.</p>
<h3 id="summary-of-access-links">Summary of access links</h3>
<p>In summary, there are two techniques for setting access links, static VLANs and dynamic VLANs, of which dynamic VLANs can be further subdivided into several subcategories.</p>
<p>Among them, subnet-based VLANs and user-based VLANs are likely to be implemented by network equipment vendors using unique protocols, and interconnection between devices from different vendors may have compatibility issues; therefore, when selecting a switch, care must be taken to confirm in advance.</p>
<p>The following table summarizes the information about static VLANs and dynamic VLANs.</p>
<table>
<thead>
<tr>
<th>Kinds</th>
<th>Explanation</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>Static VLANs (port-based VLANs)</td>
<td>assign each port of the switch to a fixed VLAN</td>
<td></td>
</tr>
<tr>
<td>Dynamic VLANs</td>
<td>MAC address-based VLANs</td>
<td>are set based on the MAC address of the computer connected to each port</td>
</tr>
<tr>
<td>Subnet-based VLANs</td>
<td>based on the IP address of the computer attached to each port</td>
<td></td>
</tr>
<tr>
<td>User-based VLAN</td>
<td>based on the logged-in user on the computer connected to the port</td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="vlan-aggregation-link-trunk-link">VLAN aggregation link Trunk Link</h2>
<h3 id="when-you-need-to-set-up-vlans-that-span-multiple-switches">When you need to set up VLANs that span multiple switches</h3>
<p>Up to this point, we have learned about setting up VLANs using a single switch. What about when you need to set up VLANs that span multiple switches?</p>
<p>When planning an enterprise network, it is likely that users belonging to the same department will be scattered on different floors of the same building, and it may be necessary to consider how to set up VLANs across multiple switches. Suppose there is a network as shown in the figure below, and it is necessary to set A, C and B, D on different floors as the same VLAN.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/05/01/4640a2d77ea74b07ad7b84c3e8447585.png" alt="VLANs"></p>
<p>The most critical thing at this point is how to connect switch 1 and switch 2? The easiest way, naturally, is to set up a dedicated red and blue VLAN interface on each of Switch 1 and Switch 2 and interconnect them.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/05/01/317ec37fe8374b7593db107e61ed3367.png" alt="switch"></p>
<p>However, this approach is not good in terms of scalability and management efficiency. For example, when a new VLAN is created on top of the existing network, new network cables need to be connected between switches in order to make this VLAN interoperable. The vertical wiring between floors of a building is troublesome and generally cannot be done by the basic management at will. Moreover, the more VLANs there are, the more ports are required for interconnection between floors (strictly speaking, between switches), and the inefficient use of switch ports is a waste of resources and limits the expansion of the network.</p>
<p>In order to avoid this inefficient connection, people find a way to make the interconnection between switches to a single network cable, which is used <strong>Trunk Link</strong>.</p>
<h3 id="what-is-a-trunk-link">What is a Trunk link?</h3>
<p>A <strong>Trunk Link</strong> is a port that is capable of forwarding traffic from multiple different VLANs.</p>
<p>The data frames circulating on a trunk link are tagged with special information that identifies which VLAN they belong to.</p>
<p>Now let&rsquo;s go back and consider what would have happened if that network had used aggregation links. The user would simply set the ports on the <strong>interconnect</strong> between the switches to <strong>aggregated links</strong>. The network cable used at this point is still a normal UTP cable and not any other special cabling. The illustration shows an inter-switch interconnect, so it needs to be connected with <strong>crossover cable</strong>.</p>
<p>Next, let&rsquo;s look specifically at how the aggregation link is <strong>implemented</strong> across the VLANs between the switches.</p>
<p>When the data frame sent by A arrives at switch 2 via the aggregation link from switch 1, a <strong>tag</strong> indicating that it belongs to a red VLAN is <strong>appended</strong> to the data frame.</p>
<p>After receiving the data frame, Switch 2 finds that this data frame belongs to the red VLAN after checking the VLAN identifier, so <strong>Remove</strong> the tag and forward the recovered data frame to other ports belonging to the red VLAN only as needed. At this point, the forwarding means that after confirming the target MAC address and comparing it with the <strong>MAC address list</strong> only the ports connected to the target MAC address are forwarded. Only if the data frame is a broadcast frame, a multicast frame, or a frame with an unknown destination, it <strong>will</strong> be forwarded to all ports belonging to the red VLAN.</p>
<p>The same is true for data frames sent by the blue VLAN.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/05/01/7ba6df84968e4594ba360bf31fdfda16.png" alt="VLAN"></p>
<p>The VLAN identification information that is appended when passing through the aggregation link may support the standard IEEE 802.1Q protocol, or it may be ISL (Inter Switch Link), which is unique to Cisco products. If the switch supports these specifications, then users will be able to efficiently construct VLANs across multiple switches.</p>
<p>In addition, the aggregation link is naturally heavily loaded with data from multiple VLANs circulating on it. Therefore, when setting up an aggregation link, one prerequisite is that it must support a transmission speed of 100Mbps or more.</p>
<p>By default, the aggregation link forwards data from all the VLANs present on the switch. To reduce the load on the switch and to reduce the waste of bandwidth, we can limit the VLANs that can be interconnected via the aggregation link through user settings, since in practice it is likely that not all VLANs need to be forwarded.</p>
<p>The details of IEEE 802.1Q and ISL will be discussed in the next section.</p>
<h2 id="aggregation-method-for-vlans">Aggregation method for VLANs</h2>
<h3 id="aggregation-method">Aggregation method</h3>
<p>VLANs across multiple switches can be constructed by attaching VLAN information to data frames on the aggregation links of the switches. the most representative methods of attaching VLAN information are</p>
<ul>
<li>IEEE 802.1Q</li>
<li>ISL</li>
</ul>
<h3 id="ieee-8021q">IEEE 802.1Q</h3>
<p><a href="http://zh.wikipedia.org/wiki/IEEE_802.1Q">IEEE 802.1Q</a>, commonly known as &ldquo;Dot One Q&rdquo;, is an IEEE certified protocol for attaching VLAN identification information to data frames.</p>
<p>Here, please recall the standard format of Ethernet data frames.</p>
<p>The VLAN identification information appended by IEEE 802.1Q is located between the &ldquo;Sending Source MAC Address&rdquo; and the &ldquo;Type Field&rdquo; in the data frame. The content is</p>
<ul>
<li><strong>2 bytes</strong> of the TPID (Tag Protocol IDentifier)</li>
<li><strong>2 bytes</strong> of TCI (Tag Control Information), for a total of <strong>4 bytes</strong>.</li>
</ul>
<p>When 4 bytes are added to the data frame, then the CRC value will naturally change as well. In this case, the CRC on the data frame is the value obtained by recalculating the entire data frame including TPID and TCI after inserting them.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/05/01/75baa2b618af40c1bb8507489affda1b.png" alt="IEEE 802.1Q"></p>
<p>The TPID and TCI are removed when the data frame leaves the aggregation link, and a CRC recalculation is performed at that time.</p>
<p>The TPID field is located in the same position in an Ethernet message as the Protocol Type field in a message without a VLAN Tag.</p>
<ul>
<li>The value of TPID <strong>is fixed</strong> at 0x8100, which identifies the 802.1Q type carried by the network frame, by which the switch <strong>determines</strong> that IEEE 802.1Q-based VLAN information is appended within the data frame.</li>
<li>And essentially the <strong>VLAN ID</strong>, which is a 12-bit element in the TCI. Since there are 12 bits in total, up to 4096 VLANs can be identified.</li>
</ul>
<p>The VLAN information attached based on IEEE 802.1Q is like a <strong>Tag</strong> attached to the item being delivered. Therefore, it is also called Tagging VLAN.</p>
<h3 id="isl-inter-switch-link">ISL (Inter Switch Link)</h3>
<p>ISL is a protocol supported by Cisco products for attaching VLAN information to aggregation links similar to IEEE 802.1Q.</p>
<p>With ISL, an ISL Header of 26 bytes is appended to the header of each data frame, and a 4-byte CRC value is added to the end of the frame by calculating the entire data frame including the ISL Header. In other words, a total of 30 bytes of information is added.</p>
<p>In an environment where ISL is used, when the data frame <strong>leaves</strong> the aggregation link, it is simply <strong>removed</strong> from the ISL packet header and the new CRC. Since the original data frame and its CRC are kept intact, there is no need to recalculate the CRC.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/05/01/dc633e74a56a44cdbc43330f6225f82f.png" alt="ISL"></p>
<p>ISL has the effect of wrapping the entire original data frame with an ISL packet header and a new CRC, hence the term Encapsulated VLAN.</p>
<p>It should be noted that neither the Tagging VLAN of IEEE802.1Q, nor the Encapsulated VLAN of ISL is a very strict term. In different books and reference materials, the above terms may be mixed, so you need to pay extra attention when learning.</p>
<p>And because ISL is a unique Cisco protocol, so it can only be used for interconnection between Cisco network devices.</p>
<h2 id="inter-vlan-routing">Inter-VLAN Routing</h2>
<h3 id="the-need-for-inter-vlan-routing">The need for inter-VLAN routing</h3>
<p>Based on what we have learned so far, we already know that two computers cannot communicate directly with each other even if they are connected to the same switch, as long as they belong to different VLANs. The next thing we will learn is how to route between different VLANs so that hosts belonging to different VLANs can communicate with each other.</p>
<p>First, let&rsquo;s review why different VLANs can&rsquo;t communicate with each other without routing. To communicate within a LAN, the MAC address of the communication destination must be specified in the data frame header. And to get the MAC address, <strong>ARP</strong> is used under TCP/IP protocol. The method of resolving MAC address by ARP is through broadcast. In other words, if a broadcast message cannot be reached, then there is no way to resolve the MAC address, i.e., no direct communication is possible.</p>
<p>Computers belong to different VLANs, which means they belong to different broadcast domains, and naturally <strong>cannot receive</strong> each other&rsquo;s broadcast messages. Therefore, computers belonging to different VLANs cannot communicate with each other directly. In order to be able to communicate between VLANs, information from the <strong>higher layer</strong> of the OSI reference model - the network layer (IP address) - needs to be used for <strong>routing</strong>.</p>
<p>The routing function, in general, is mainly provided by routers. But in today&rsquo;s LANs, we also often use a switch with routing capabilities - a <strong>Layer 3 Switch</strong>. Let&rsquo;s take a look at what happens when routing between VLANs using a router and a Layer 3 Switch, respectively.</p>
<h3 id="inter-vlan-routing-with-a-router">Inter-VLAN routing with a router</h3>
<p>When using a router for inter-VLAN routing, similar to when building a VLAN across multiple switches, we still encounter the problem of &ldquo;how to connect the router to the switch&rdquo;. There are two general ways to wire a router to a switch.</p>
<ul>
<li>Connect the router to each VLAN on the switch separately</li>
<li>No matter how many VLANs there are, the router and the switch are connected with only one network cable.</li>
</ul>
<p>The easiest way to think of is &ldquo;connect the router to the switch with a separate cable for each VLAN&rdquo;. Set each port on the switch for interconnection with the router as <strong>Access Link</strong>, and then interconnect it with a separate port on the router using a network cable. As shown in the figure below.</p>
<ul>
<li>2 VLANs on the switch, then 2 ports need to be reserved on the switch for interconnection with the router.</li>
<li>The same 2 ports are required on the router; the two are connected separately with 2 network cables.</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/05/01/3f05b24ea0e84068b1ad4d3f5f9d84ab.png" alt="Inter-VLAN"></p>
<p>If this approach is used, one should have no trouble imagining that its scalability is problematic. Each new VLAN requires the consumption of the router&rsquo;s ports and access links on the switch, and a new network cable needs to be laid. Routers, on the other hand, usually do not come with too many LAN interfaces. When a new VLAN is created, the router must be upgraded to a high-end product with multiple LAN interfaces in order to correspond to the ports required for the additional VLAN.</p>
<p>What about the second option, &ldquo;use only one cable to connect the router to the switch, regardless of the number of VLANs&rdquo;? When using a network cable to connect the router to the switch, inter-VLAN routing, the need to use the aggregation link.</p>
<p>The process is as follows: First, the switch port used to connect the router is set as a Trunk Link, and the port on the router must also support the Trunk Link. The protocols used by both sides for the aggregation link must naturally be the same. Next, a &ldquo;Sub Interface&rdquo; (Sub Interface) is defined on the router for each VLAN. Although there is only one physical port that is actually connected to the switch, in theory we can split it into multiple virtual ports.</p>
<p>VLANs logically divide the switch into multiple units, so the routers used for inter-VLAN routing must also have virtual interfaces that correspond to each VLAN.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/05/01/dba182867b5f492d988941d7bac3e00a.png" alt="VLAN"></p>
<p>With this method, even if a new VLAN is created on the switch later, only one network cable is needed to connect the switch to the router. The user only needs to set up a new sub-interface on the router that corresponds to the new VLAN. Compared with the previous method, it is much more scalable, and there is no need to worry about upgrading routers with insufficient LAN interfaces or rewiring.</p>
<h4 id="communication-within-the-same-vlan">Communication within the same VLAN</h4>
<p>Next, let&rsquo;s move on to learn how inter-VLAN routing works when using aggregation links to connect the switch to the router. As shown in the figure below, IP addresses are set for each computer and the router&rsquo;s sub-interfaces.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/05/01/af3ed2583089454b9189c6201d9263b4.png" alt="Communication within the same VLAN"></p>
<p>The network address of the red VLAN (VLAN ID=1) is 192.168.1.0/24, and the network address of the blue VLAN (VLAN ID=2) is 192.168.2.0/24. The MAC addresses of each computer are A/B/C/D, and the MAC address of the router&rsquo;s aggregation link port is R. The switch generates the following MAC address list by learning the MAC addresses of the computers connected to each port. The switch generates the following MAC address list by learning the MAC addresses of the computers connected to each port.</p>
<table>
<thead>
<tr>
<th>Port</th>
<th>MAC Address</th>
<th>VLAN</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>A</td>
<td>1</td>
</tr>
<tr>
<td>2</td>
<td>B</td>
<td>1</td>
</tr>
<tr>
<td>3</td>
<td>C</td>
<td>2</td>
</tr>
<tr>
<td>4</td>
<td>D</td>
<td>2</td>
</tr>
<tr>
<td>5</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>6</td>
<td>R</td>
<td>Trunk</td>
</tr>
</tbody>
</table>
<p>First, consider the situation when computer A communicates with computer B in the same VLAN.</p>
<p>Computer A sends an ARP request message requesting resolution of B&rsquo;s MAC address. After the switch receives the data frame, it retrieves the table entries in the MAC address list that belong to the same VLAN as the receiving port. It turns out that computer B is connected to port 2, so the switch forwards the data frame to port 2, and finally computer B receives the frame. The communication between the sending and receiving parties is within the same VLAN, and all processing is done within the switch.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/05/01/b9dd47e6500d482684be8609ecfd904c.png" alt="switch"></p>
<h4 id="communication-between-different-vlans">Communication between different VLANs</h4>
<p>Next is the core of this talk, communication between different VLANs. Let&rsquo;s consider the situation when computer A communicates with computer C.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/05/01/aade92e883ba4b969b28dd96a189da54.png" alt="Communication between different VLANs"></p>
<ul>
<li><strong>Computer</strong> A derives from the IP address of the communication target (192.168.2.1) that C does not belong to the same network segment as this machine. So it will forward data frames to the set <strong>DefaultGateway</strong> (GW). Before sending the data frame, you need to use <strong>ARP</strong> to get the MAC address of the router.</li>
<li>After getting the router&rsquo;s MAC address R, the next step is to send a data frame to C as shown in the figure. In the data frame of ①, the target <strong>MAC address</strong> is the router&rsquo;s address R, but the embedded <strong>target IP address</strong> is still the address of the final object C to be communicated. This part is about the communication steps when forwarding through the router in the LAN, so I will explain it in detail when I have a chance.</li>
<li>After the switch receives the data frame of ① on port 1, it retrieves the table entries in the MAC address list that belong to the same VLAN as port 1. Since the aggregation link is treated as belonging to all VLANs, port 6 of the switch also belongs to the referenced object at this point. This way the switch knows that sending data frames to MAC address R needs to be forwarded through port 6.</li>
<li>When a data frame is sent from port 6, it is appended with VLAN identification information because it is an aggregated link. Since it is originally a data frame from the red VLAN, it will be entered into the aggregation link with the red VLAN identification information added as shown in ② in the figure. After the router receives the data frame of ②, it confirms its VLAN identification information, and since it is a data frame belonging to the red VLAN, it is handed over to the sub-interface responsible for the red VLAN to receive it.</li>
<li>Then, based on the router&rsquo;s internal <strong>routing table</strong>, determine where to relay to.</li>
<li>Since the target network 192.168.2.0/24 is a blue VLAN, and the network is directly connected to the router via a subinterface, it is sufficient to forward from the subinterface responsible for the blue VLAN. At this point, the destination MAC address of the data frame is rewritten to the destination address of computer C; and because it needs to be forwarded over the aggregation link, it is appended with the identifying information that it belongs to the blue VLAN. This is the data frame in figure ③.</li>
<li>After receiving data frame ③, the switch retrieves the table entry belonging to the blue VLAN from the MAC address list based on the VLAN identification information. Since the communication target, computer C, is connected to port 3 and port 3 is a normal access link, the switch forwards the data frame with the VLAN identification information removed (data frame ④) to port 3, and finally computer C can successfully receive this data frame.</li>
</ul>
<p>When communicating between VLANs, even if both communicating parties are connected to the same switch, they must go through a process of &ldquo;sender-switch-router-switch-receiver&rdquo;.</p>
<h3 id="layer-3-switches">Layer 3 Switches</h3>
<h4 id="problems-when-using-routers-for-inter-vlan-routing">Problems when using routers for inter-VLAN routing</h4>
<p>Now, we know that computers belonging to different VLANs can communicate with each other as long as inter-VLAN routing can be provided. However, if routers are used for inter-VLAN routing, it is likely that the routers will become a <strong>bottleneck</strong> for the entire network as traffic between VLANs continues to increase.</p>
<p>Switches use a dedicated hardware chip called an <strong>ASIC</strong> (ApplicationSpecified Integrated Circuit) to handle the switching of data frames, and on many models switching at cable speed (Wired Speed) is possible. Routers, on the other hand, are essentially software-based. Even if packets are received at cable speed, they cannot be forwarded out without a speed limit and therefore become a speed bottleneck. In the case of inter-VLAN routing, traffic is <strong>concentrated</strong> to the aggregated link portion of the router and switch <strong>interconnect</strong>, which is particularly prone to becoming a speed bottleneck. And from a hardware point of view, because of the need to set up separate routers and switches, in some small space environment may even become a problem to set up the place.</p>
<h3 id="layer-3-switch">Layer 3 Switch</h3>
<p>The Layer 3 Switch was created to solve the above problem. A Layer 3 switch is essentially a &ldquo;Layer 2 switch with routing&rdquo;. Routing is a function of the Layer 3 network layer in the OSI reference model, so a switch with Layer 3 routing is called a &ldquo;Layer 3 Switch&rdquo;.</p>
<p>The internal structure of a Layer 3 switch can be seen in the following sketch.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/05/01/cb7c3dc7be784577bef1a034118c58cd.png" alt="internal structure of a Layer 3 switch"></p>
<p>Within one local unit, a switch module and a router module are set up separately; and the built-in routing module is the same as the switch module and uses ASIC hardware to handle routing. As a result, high-speed routing is possible compared to conventional routers. Moreover, the routing and switching modules are convergently linked, and since they are internally connected, a considerable amount of bandwidth can be ensured.</p>
<h4 id="inter-vlan-routing-intra-vlan-communication-using-a-layer-3-switch">Inter-VLAN routing (intra-VLAN communication) using a Layer 3 switch</h4>
<p>How exactly does data propagate within a Layer 3 switch? Basically, it is the same as when using an aggregation link to connect a router to a switch.</p>
<p>Suppose there are four computers interconnected to a Layer 3 switch as shown in the figure below. When a router is used to connect, a sub-interface corresponding to each VLAN is usually set up on the LAN interface, while a Layer 3 switch generates a &ldquo;VLAN Interface&rdquo; (VLAN Interface) internally. <strong>VLAN Interface</strong> is the interface used to send and receive data for each VLAN. (Note: On Cisco&rsquo;s Catalyst series switches, the VLAN Interface is called <strong>SVI</strong> &ndash; Switched Virtual</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/05/01/da7e6016d163482abf00148051f66ce6.png" alt="Switched Virtual"></p>
<p>To compare with using a router for inter-VLAN routing, let&rsquo;s similarly consider the situation when computer A communicates with computer B. First, a data frame with destination address B is sent to the switch; by retrieving the MAC address list of the same VLAN, it is found that computer B is connected to port 2 of the switch; therefore, the data frame is forwarded to port 2.</p>
<h4 id="inter-vlan-routing-using-a-layer-3-switch-inter-vlan-communication">Inter-VLAN routing using a Layer 3 switch (inter-VLAN communication)</h4>
<p>Next, imagine the situation when computer A and computer C communicate with each other.</p>
<ul>
<li>In response to the destination IP address, computer A can determine that the communication does not belong to the same network and therefore sends data to the default gateway (Frame 1).</li>
<li>After retrieving the MAC address list, the switch forwards the data frame to the routing module via the internal aggregation link. When passing through the internal aggregation link, the data frame is <strong>appended</strong> with VLAN identification information belonging to the red VLAN (Frame 2).</li>
<li>When the routing module receives the data frame, it first distinguishes that it belongs to the red VLAN by the VLAN identification information attached to the data frame, and accordingly determines that the red VLAN interface is responsible for receiving and routing the data. Because the target network 192.168.2.0/24 is directly connected to the router&rsquo;s network and corresponds to the blue VLAN; therefore, it is then forwarded <strong>back</strong> to the switching module from the blue VLAN interface via the internal aggregation link. As it passes through the aggregation link, this time the frame is <strong>appended</strong> with the identification information of the blue VLAN (Frame 3).</li>
<li>Upon receiving this frame, the switch retrieves the MAC address list for the blue VLAN and confirms that it needs to be forwarded to port 3. Since port 3 is the usual access link, the VLAN identification information is <strong>removed</strong> (Frame 4) before forwarding. Eventually, computer C successfully receives the data frame forwarded by the switch.</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/05/01/e315988da0bc45a89da430629be2b413.png" alt="switch"></p>
<p>The overall flow is very similar to that of an external router - it goes through &ldquo;sender → switch module → routing module → switch module → receiver&rdquo;.</p>
<h2 id="the-meaning-of-the-existence-of-traditional-type-of-router">The meaning of the existence of traditional type of router</h2>
<h3 id="the-need-for-routers">The need for routers</h3>
<p>The price of Layer 3 switches, which were very expensive at the time of their introduction, has come down considerably. Some inexpensive foreign models are now selling for just over $10,000 when converted to RMB, and they continue to drop. Since Layer 3 switches can provide higher-speed routing than traditional routers, is there a need for routers in the network?</p>
<p>The answer is: &ldquo;Yes&rdquo;.</p>
<p>The necessity of using a router, mainly in the following ways.</p>
<ul>
<li>For connection to the WAN
<ul>
<li>Layer 3 switches are &ldquo;switches&rdquo; after all. That is, most models are equipped with only LAN (Ethernet) interfaces. A few high-end switches have serial or ATM interfaces to connect to the WAN, but in most cases, the router is needed to connect to the WAN.</li>
</ul>
</li>
<li>Network Security
<ul>
<li>On a Layer 3 switch, a certain level of network security can be ensured by packet filtering. However, with the various network security features provided by the router, users can build a more secure and reliable network.</li>
<li>In addition to the most basic packet filtering functions, the router provides network security features such as the ability to build a <strong>VPN</strong> (VirtualPrivate Network) based on IPSec, user authentication using RADIUS, and more.</li>
</ul>
</li>
<li>Support for heterogeneous network architectures other than TCP/IP
<ul>
<li>Although TCP/IP has become the mainstream of the current network protocol architecture, there are still many networks utilizing network protocols such as IPX/SPX under Novell Netware or AppleTalk under Macintosh. Layer 3 switches, except for some high-end models still basically only support TCP/IP, so the router is still essential in environments that require the use of network protocols other than TCP/IP.</li>
</ul>
</li>
</ul>
<p>Note: On a few high-end switches, the above router features can also be supported. For example, Cisco&rsquo;s Catalyst 6500 series, there is an optional interface module for connecting to the WAN; there is also an optional IPSec-based module for VPN implementation; and it can also support other network protocols other than TCP/IP.</p>
<h3 id="example-of-a-router-and-switch-paired-together-to-build-a-lan">Example of a router and switch paired together to build a LAN</h3>
<p>Let&rsquo;s look at an example of a router and switch paired together to build a LAN.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/05/01/ddd155de5e7149798abcd2da143611ef.png" alt="LAN"></p>
<p>VLANs are defined using the Layer 2 switches configured on each floor to connect TCP/IP client computers. Inter-VLAN communication between floors is realized by using high-speed routing of Layer 3 switches. If the network environment requires high reliability, redundant configuration of Layer 3 switches can also be considered.</p>
<p>The connection to the WAN is made through routers with various network interfaces. And, network security is achieved through the router&rsquo;s packet filtering and VPN functions. In addition, the use of routers can support networks beyond TCP/IP such as Novell Netware.</p>
<p>Only on the basis of fully mastering Layer 2 and Layer 3 switches as well as conventional routers can we compete for things and construct a highly efficient and cost-effective network.</p>
<h2 id="designing-a-lan-with-vlans">Designing a LAN with VLANs</h2>
<h3 id="features-of-designing-a-lan-using-vlans">Features of designing a LAN using VLANs</h3>
<p>By constructing a LAN using VLANs, users are able to freely partition broadcast domains without being restricted by physical links.</p>
<p>In addition, inter-VLAN routing provided by the previously mentioned routers and Layer 3 switches enables adaptation to flexible and changeable network composition.</p>
<p>However, since the use of VLANs tends to complicate the network composition, it can also make the composition of the entire network difficult to grasp.</p>
<p>It can be said that the use of VLANs has the advantage of &ldquo;flexible network composition&rdquo; and the disadvantage of &ldquo;complex network composition&rdquo;.</p>
<p>Let&rsquo;s take a look at a specific example.</p>
<h3 id="change-of-network-composition-in-a-lan-without-vlans">Change of network composition in a LAN without VLANs</h3>
<p>Suppose there is a &ldquo;no VLAN construction&rdquo; network consisting of one router and two switches as shown in the figure.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/05/01/b698732fb8514ad8a3d0951c49da5d4e.png" alt="switches"></p>
<p>The router in the picture with 2 LAN ports. The network on the left side is 192.168.1.0/24 and on the right side is 192.168.2.0/24.</p>
<p>Now if you want to transfer the 192.168.1.0/24 computer A on this network to 192.168.2.0/24, you need to change the physical connection, A to the switch on the right.</p>
<p>And, when the need for a new address 192.168.3.0/24 network, but also in the router to occupy another LAN interface and add a switch. And because this router with only two LAN interfaces, in order to add a new network must also be upgraded to a router with more than three LAN interfaces.</p>
<h3 id="change-of-network-composition-in-a-vlan-using-lan">Change of network composition in a VLAN-using LAN</h3>
<p>Next, suppose there is a &ldquo;VLAN-using&rdquo; LAN consisting of one router and two switches. The switch and the switch and the switch and the router are <strong>aggregation links</strong>; and suppose 192.168.1.0/24 corresponds to the red VLAN and 192.168.2.0/24 corresponds to the blue VLAN.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/05/01/93fcc240289e475e9ad8eb7504df85da.png" alt="Change of network composition in a VLAN-using LAN"></p>
<p>When you need to transfer Computer A connected to the network segment 192.168.1.0/24 on Switch 1 to 192.168.2.0/24, there is no need to change the physical cabling. Just generate the blue VLAN on the switch, and then add port 1 connected to computer A to the blue VLAN to make it an access link.</p>
<p>Then, just set the IP address, default gateway, and other information of Computer A as needed. If the IP address-related settings are obtained by DHCP, then it is possible to move between different network segments without any setting changes on the client side.</p>
<p>With the use of VLANs, we can freely carry out the logical design of the network without changing any physical wiring. If you are working in an environment that requires frequent changes to the network layout, the advantages of using VLANs are obvious.</p>
<p>And, when it is necessary to add a new segment with the address 192.168.3.0/24, it is only necessary to create a new VLAN corresponding to 192.168.3.0/24 on the switch and add the required ports to its access link.</p>
<p>If the network environment also requires the use of an external router, the entire operation can be completed by simply adding a new sub-interface setting on the aggregation port of the router without consuming more physical interfaces (LAN interfaces). To use a routing module that is internal to a Layer 3 switch, only one new VLAN interface is required.</p>
<p>The growth of a network environment is often unpredictable, and it is likely that there will often be a need to split an existing network or add a new one. These problems can be easily solved with the full live use of VLANs.</p>
<h3 id="complication-of-network-structure-by-using-vlans">Complication of network structure by using VLANs</h3>
<p>Although the use of VLANs allows for flexible network construction, it also brings the problem of network structure complexity.</p>
<p>In particular, it is difficult to accurately locate and troubleshoot faults when they occur because of the interlocking data flows.</p>
<p>To understand the complexity of data flow, suppose there is a network as shown in the figure below. When computer A sends data to computer C, the overall direction of the data flow is as follows.</p>
<p>Computer A → Switch 1 → Router → Switch 1 → Switch 2 → Computer C</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/05/01/f4625da2f5704879979b25fe30da1f6f.png" alt="VLANs"></p>
<p>First Computer A sends data to Switch 1 (①), after which the data is forwarded to the router (②) for inter-VLAN routing. After routing, the data is then returned to switch 1 (③) from the aggregation link. Since the communication target computer C is not directly connected to switch 1, it also needs to be forwarded to switch 2 (④) via the aggregation link. At switch 2, the data is finally forwarded to port 2, where C is connected, which completes the entire process (⑤).</p>
<p>In this example, the data flow is already so complex with only two switches forming the network, and if VLANs are constructed across multiple switches, it is clear that the flow of each data stream will be even more difficult to grasp.</p>
<h3 id="logical-and-physical-structure-of-the-network">Logical and physical structure of the network</h3>
<p>To cope with the increasing complexity of data flow, administrators need to grasp the current state of the network from both the &ldquo;logical structure&rdquo; and &ldquo;physical structure&rdquo;.</p>
<ul>
<li>Physical structure refers to the current state of the network as observed from the physical and data link layers, indicating the physical wiring pattern and VLAN settings of the network, etc.</li>
<li>Logical structure, on the other hand, indicates the structure of the network as observed from the network layer and above. Let&rsquo;s try to analyze the logical structure of an IP network with a router in mind.</li>
</ul>
<p>As in the previous example, the &ldquo;physical structure&rdquo; depicting cabling patterns and VLAN settings is shown below.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/05/01/925f6f9a6d964efeb4f76968ca7a3cdc.png" alt="VLAN"></p>
<p>After analyzing this physical structure and converting it into a logical structure centered on the router, we get the following logical structure diagram. When we need to set up routing or packet filtering, we have to do it on the basis of the logical structure.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/05/01/e0aabc0edaba450b83513a185ed0ae85.png" alt="logical structure"></p>
<p>It is important to understand the difference between these two network architecture diagrams, especially in modern enterprise networks where VLANs and Layer 3 switches are prevalent.</p>
<hr>
<p>Reference <code>https://houmin.cc/posts/190a27b7/</code></p>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/network-virtualization/">network virtualization</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2022-05/kubevirt/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Kubevirt Managing Virtual Machines</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2022-05/network-virtualization-macvlan/">
            <span class="next-text nav-default">[Network Virtualization] MacVLAN</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.64437849d125a2d603b3e71d6de5225d641a32d17168a58106e0b61852079683.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
