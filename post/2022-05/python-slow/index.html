<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Why is Python so slow? - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="Analyze the reasons for Python&#39;s slowness in three ways." /><meta name="keywords" content="python" />






<meta name="generator" content="Hugo 0.101.0 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2022-05/python-slow/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link href="/lib/fancybox/jquery.fancybox-3.1.20.min.css" rel="stylesheet">


<meta property="og:title" content="Why is Python so slow?" />
<meta property="og:description" content="Analyze the reasons for Python&#39;s slowness in three ways." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2022-05/python-slow/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-05-12T13:29:34+08:00" />
<meta property="article:modified_time" content="2022-05-12T13:29:34+08:00" />

<meta itemprop="name" content="Why is Python so slow?">
<meta itemprop="description" content="Analyze the reasons for Python&#39;s slowness in three ways."><meta itemprop="datePublished" content="2022-05-12T13:29:34+08:00" />
<meta itemprop="dateModified" content="2022-05-12T13:29:34+08:00" />
<meta itemprop="wordCount" content="1272">
<meta itemprop="keywords" content="python," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Why is Python so slow?"/>
<meta name="twitter:description" content="Analyze the reasons for Python&#39;s slowness in three ways."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SOBYTE</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SOBYTE</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Why is Python so slow?</h1>

      <div class="post-meta">
        <span class="post-time"> 2022-05-12 13:29:34 </span>
        <div class="post-category">
            <a href="/categories/tutorials/"> tutorials </a>
            </div>
          <span class="more-meta"> 1272 words </span>
          <span class="more-meta"> 6 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#gil">GIL</a></li>
        <li><a href="#it-is-an-interpreted-language">It is an interpreted language</a></li>
        <li><a href="#dynamic-typing">Dynamic typing</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>Python has become incredibly popular in recent years. The Python language is cheap to learn, writes like pseudo-code (even like English), is highly readable, and has many other obvious benefits. It is favored by DevOps, Data Science, and Web Development scenarios. But these reputations never include Python&rsquo;s speed. Compared to other languages, whether JIT or AOT, <a href="https://benchmarksgame-team.pages.debian.net/benchmarksgame/faster/python.html">Python is almost always the slowest</a>. There are many aspects that contribute to Python&rsquo;s performance problems, and this article tries to talk about them.</p>
<p>TL;DR</p>
<ol>
<li>Python has GIL</li>
<li>Python is an &ldquo;interpreted&rdquo; language</li>
<li>Python is a dynamically typed language</li>
</ol>
<h2 id="gil">GIL</h2>
<p>Modern computer processors generally have multiple cores, and some servers even have multiple processors. Therefore, the operating system abstracts Threads to spawn multiple Threads in a process, so that these Threads can run on multiple cores at the same time to maximize the efficiency of the processor. (You can see the number of threads in the system in the top command)</p>
<p>So it&rsquo;s clear that programming in Threads to run in parallel can increase speed.</p>
<p>But Python (sometimes) doesn&rsquo;t.</p>
<p>Python doesn&rsquo;t require you to manually manage memory (C requires manual malloc/free), it comes with its own garbage collector. This means that you can request and set variables as you like, and the Python interpreter will automatically determine when the variable will no longer be used (e.g., if the function exits, the function&rsquo;s internal variables will not be used), and then automatically release that memory. There are many ways to implement a garbage collection mechanism, and Python chooses reference counting + generational collection. Reference counting is dominant. The principle is that each object remembers how many other objects refer to itself, and when no one refers to itself, it is garbage.</p>
<p>But in the multi-threaded case, we all run together, reference counting multiple threads operating together, how to ensure that no <a href="https://zh.wikipedia.org/zh-hans/%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8">thread insecurity</a> will occur? Obviously multiple threads operating on the same object need to add locks.</p>
<p>This is GIL, except that the lock is so granular that only one Thread can run globally in the entire Python interpreter. See the <a href="https://dabeaz.blogspot.com/2010/01/python-gil-visualized.html">dabeaz blog</a> for more details.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/05/12/0c271861d5474a3b9ba765038807468e.png" alt="py gc"></p>
<p>Because other languages do not have GIL, many people have misconceptions about GIL. For example.</p>
<p>&ldquo;Python can only run one thread at a time, so I can write multi-threaded programs without locks.&rdquo; This is not true. &ldquo;Only one thread at a time&rdquo; means that the Python interpreter can only run one thread of bytecode at a time (Python code is compiled into bytecode for the Python virtual machine), at the opcode level. A line of Python code, such as a += 1, will actually compile multiple opcodes: first load parameter a, then a + 1, then save back to parameter a. If the load is done and not yet computed, then the thread switches and the other thread modifies the value of a, then switches back to continue performing the computation and storing a, then it will be thread-unsafe. So when multiple threads operate on a variable at the same time, you still need to add a lock.</p>
<p>&ldquo;Python can only run one thread at a time, so Python&rsquo;s multithreading is pointless.&rdquo; That&rsquo;s not entirely true. If you want to use multithreading to take advantage of the performance of multiple cores, then Python really can&rsquo;t. But if the CPU is not the bottleneck, and the network is, multithreading is still useful. The usual programming model is that one thread handles one network connection, and while only one thread is running, the other threads are waiting for the network connection and are not &ldquo;idle&rdquo;. In short, Python&rsquo;s multithreading is really useless for CPU-intensive tasks (even slower than single-threaded because of the overhead of switching between multiple threads), but it can still speed up IO-intensive tasks.</p>
<p>It&rsquo;s probably better to say that no matter how many cores your computer&rsquo;s CPU has, Python uses only 1 core.</p>
<p>Pypy has <a href="https://pypy.readthedocs.io/en/latest/faq.html#does-pypy-have-a-gil-why">GIL</a>, but it can be 3x faster than CPython. Jython is based on the JVM, which doesn&rsquo;t have GIL.</p>
<p>What about other languages? Java also uses reference counting, but its GC is <a href="https://stackoverflow.com/questions/25512146/how-jvm-ensures-thread-safety-of-memory-allocation-for-a-new-object">multithread-aware</a>, which is more complicated to implement (a friend told me that Java is no longer reference counting, so please pay attention to this place and attach a <a href="https://plumbr.io/handbook/garbage-collection-in-java">reference</a>). JavaScript is a single-threaded asynchronous programming model, so it does not have this problem.</p>
<h2 id="it-is-an-interpreted-language">It is an interpreted language</h2>
<p>Languages like C/C++/Rust are compiled directly into machine code and run as compiled languages; Python runs by a virtual machine reading in Python code (text), lexical analysis, compiling it into opcode that the virtual machine recognizes, and then the virtual machine interprets the opcode and executes it. But that&rsquo;s not really the main reason; Python import caches the compiled opcode afterwards, (either the pyc file or the <code>__pycache__</code> folder). So reading, lexical analysis and compiling doesn&rsquo;t take much time.</p>
<p>So which step is really slow? It&rsquo;s the later part where the virtual machine interprets the opcode execution. The front-end compilation is compiling Python code into intermediate code that the interpreter can understand, and the interpreter then translates the intermediate code into instructions that the CPU can understand. Compared to AOT (advance compiled languages, like C) compiling directly into machine code is definitely slower.</p>
<p>But why isn&rsquo;t Java slower?</p>
<p>Because Java has JIT, a just-in-time compilation technique to split the code into frames, the AOT compiler is responsible for translating the intermediate code into CPU-understandable code at runtime. This part is not much different from Python&rsquo;s interpreter, which still translates the intermediate code and executes it. The really fast part is that JIT can do optimizations at runtime. For example, if the VM finds a piece of code that is executing frequently (most of the time our programs are executing a piece of code over and over again), it will start optimizing and replace that piece of code with a changed version. This is an advantage that only virtual machine languages have, because of the runtime information that has to be collected. AOT compilers like gcc can only do some analysis based on static analysis.</p>
<p>Why doesn&rsquo;t Python have a JIT?</p>
<p>The first is that JIT is expensive and complex to develop, C# also has a good JIT because Microsoft has money.</p>
<p>The second is that JIT is slow, Java and C# VMs start a lot, CPython is slow, Pypy has JIT, it&rsquo;s 2x - 3x slower than CPython, and for long running programs, it&rsquo;s okay to start slower, after all, the code gets faster and more profitable after a long run time. But CPython is a general-purpose virtual machine, like command-line programs, and the slow start-up experience is much worse.</p>
<p>The third is that Java and C# are statically typed virtual machines, and the compiler can make some assumptions. (I don&rsquo;t know if this is right, because Lua also has a good JIT)</p>
<h2 id="dynamic-typing">Dynamic typing</h2>
<p>Statically typed languages like C, Java, and Go require that you declare variables with their types. Python doesn&rsquo;t. Python decides for you what type a variable is, and you can change it at will.</p>
<p>Why is dynamic typing slow? The overhead of checking the type and changing it every time is too high; it&rsquo;s hard to optimize with such dynamic types.</p>
<p>The benefits of dynamic typing are that it&rsquo;s very simple and intuitive to write (maintenance is another matter); you can modify the behavior of objects at runtime, and Monkey Patch is very simple.</p>
<p>Recent languages are statically typed, such as Go and Rust, and static types are not only more friendly to compilers, but also better for programmers to maintain. Personally, I think the future belongs to static types.</p>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/python/">python</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2022-05/apache-eventmesh/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">In-depth explanation of the distributed application efficiency improvement framework Apache EventMesh</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2022-05/transferring-files-ssh/">
            <span class="next-text nav-default">Transferring files with ssh</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  <script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox-3.1.20.min.js"></script>



<script type="text/javascript" src="/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js"></script>








</body>
</html>
