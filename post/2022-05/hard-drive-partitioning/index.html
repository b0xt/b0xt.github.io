<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Introduction to Hard Drive Partitioning - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="This article goes into depth, starting with the basics, and introduces the concepts about hard drive partitions, what they each do, and why they are necessary." /><meta name="keywords" content="Hard Drive Partitioning" />






<meta name="generator" content="Hugo 0.102.0 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2022-05/hard-drive-partitioning/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link href="/lib/fancybox/jquery.fancybox-3.1.20.min.css" rel="stylesheet">


<meta property="og:title" content="Introduction to Hard Drive Partitioning" />
<meta property="og:description" content="This article goes into depth, starting with the basics, and introduces the concepts about hard drive partitions, what they each do, and why they are necessary." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2022-05/hard-drive-partitioning/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-05-08T17:10:39+08:00" />
<meta property="article:modified_time" content="2022-05-08T17:10:39+08:00" />

<meta itemprop="name" content="Introduction to Hard Drive Partitioning">
<meta itemprop="description" content="This article goes into depth, starting with the basics, and introduces the concepts about hard drive partitions, what they each do, and why they are necessary."><meta itemprop="datePublished" content="2022-05-08T17:10:39+08:00" />
<meta itemprop="dateModified" content="2022-05-08T17:10:39+08:00" />
<meta itemprop="wordCount" content="3344">
<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Introduction to Hard Drive Partitioning"/>
<meta name="twitter:description" content="This article goes into depth, starting with the basics, and introduces the concepts about hard drive partitions, what they each do, and why they are necessary."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SOBYTE</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SOBYTE</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Introduction to Hard Drive Partitioning</h1>

      <div class="post-meta">
        <span class="post-time"> 2022-05-08 17:10:39 </span>
        <div class="post-category">
            <a href="/categories/tutorials/"> tutorials </a>
            </div>
          <span class="more-meta"> 3344 words </span>
          <span class="more-meta"> 7 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#understanding-hard-disks">Understanding hard disks</a></li>
        <li><a href="#why-do-we-need-partitions">Why do we need partitions?</a></li>
        <li><a href="#what-is-the-nature-of-partitioning">What is the nature of partitioning?</a>
          <ul>
            <li><a href="#primary-and-extended-partitions">Primary and extended partitions</a></li>
          </ul>
        </li>
        <li><a href="#sector-size-and-block-size">Sector Size and Block Size</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>This article introduces the knowledge and concepts related to hard drive partitioning. I think the content related to this is difficult to understand because part of it is a hardware concept and part of it is software (file system), and a lot of information is introduced without putting it together for comparison, so the reader will be very vague about some concepts when he sees it. For example, hard disk partitions have partition types and file systems have types, what is the difference between these two types? What is the difference between a hard drive with sector size and a file system with block size? This article tries to go deeper, starting from the basic principles, introducing some concepts, what they do respectively and why they do it.</p>
<h2 id="understanding-hard-disks">Understanding hard disks</h2>
<p>A hard drive in Linux is a block device, which is used to store data. You enter data into the hard drive, and the hard drive stores it in a location for you. The next time you need it, you read it out from that location.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/05/08/47eefa8b9e704ecbbff78720f50fe5e6.png" alt="disks"></p>
<p>So given a location, how does a hard drive go about finding data in that location?</p>
<p>This starts with the structure of the hard drive (although most machines now use SSDs, much of the data is based on mechanical hard drives, so here is an example of how CHS addressing works.) . A hard drive is made up of several discs, each of which can hold data on both the front and back sides.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/05/08/cfe0232525404773a3ad568f3b0b3a6a.png" alt="mechanical hard drives"></p>
<p>So the question is converted into: how to determine a position in several circular surfaces. First of all, how many parameters are needed to determine a position in a circle? Obviously 2, the distance from the center of the circle to determine a circle, plus an &ldquo;angle&rdquo; to determine a point on that circle. Then, in the structure of a hard disk, another parameter is added to determine the number of circular faces.</p>
<p>These parameters are called.</p>
<ul>
<li>Cylinder/Track: track, column surface, which determines the position from the center of the circle.</li>
<li>Head: Head, this is the physical device that reads and writes data, in fact, when the hard disk is running, it is the platter that is spinning, the head is responsible for moving and adjusting the column surface that is read;.</li>
<li>Sector: Sector. The above two parameters determine a circle, and Sector determines which sector is in this circle.</li>
</ul>
<p>This is how CHS addressing works.</p>
<p>It is also clear from this that the unit of hard drive storage is &ldquo;a sector&rdquo;. In fact, when partitioning, (the partitioning software) also uses the term &ldquo;sector to sector&rdquo; and does not involve you in Track and Head, which is something that the hardware itself uses for addressing.</p>
<p>Using <code>fdisk</code> we can see how many sectors the drive has and how big a sector is. In fact <a href="https://en.wikipedia.org/wiki/Disk_sector">almost all hard drive sectors since 1980 have been 512bytes in size</a>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ fdisk -l
</span></span><span class="line"><span class="cl">Disk /dev/sda: <span class="m">64</span> GiB, <span class="m">68719476736</span> bytes, <span class="m">134217728</span> sectors
</span></span><span class="line"><span class="cl">Disk model: VBOX HARDDISK
</span></span><span class="line"><span class="cl">Units: sectors of <span class="m">1</span> * <span class="nv">512</span> <span class="o">=</span> <span class="m">512</span> bytes
</span></span><span class="line"><span class="cl">Sector size <span class="o">(</span>logical/physical<span class="o">)</span>: <span class="m">512</span> bytes / <span class="m">512</span> bytes
</span></span><span class="line"><span class="cl">I/O size <span class="o">(</span>minimum/optimal<span class="o">)</span>: <span class="m">512</span> bytes / <span class="m">512</span> bytes
</span></span><span class="line"><span class="cl">Disklabel type: dos
</span></span><span class="line"><span class="cl">Disk identifier: 0x86ae6277
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">Device Boot Start End Sectors Size Id Type
</span></span><span class="line"><span class="cl">/dev/sda1 <span class="m">2048</span> <span class="m">4542463</span> <span class="m">4540416</span> 2.2G <span class="m">82</span> Linux swap / Solaris
</span></span><span class="line"><span class="cl">/dev/sda2 * <span class="m">4542464</span> <span class="m">35999743</span> <span class="m">31457280</span> 15G <span class="m">83</span> Linux
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="why-do-we-need-partitions">Why do we need partitions?</h2>
<p>Now we know that with sector locations, the drive can write or read data out. So why do we need partitioning? For the following reasons.</p>
<ul>
<li>
<p>Isolating file system rot (eggs not in one basket). We have to create the file system on the device in order for the OS to use the file system for reading and writing. The file system is a plan of the storage device, recording what is stored in each block (inode, block). In case the metadata of the file system is wrong, then the whole file system data may not be read.</p>
</li>
<li>
<p>Improve storage utilization. A file will occupy a minimum of one block, and if the block is too large, a lot of space will be wasted. For example, if the block size is 4k, and all the files stored are 1k, then 3/4 of the space is wasted. If the block is too small, the performance is very low, because the kernel is copied in blocks; we can divide it into a partition and build a file system with a block size of 512bytes to store these small files exclusively.</p>
</li>
<li>
<p>Limit file growth. crontab writing too many logs causes all processes to hang, which is certainly not reasonable. But file growth does not cross the file system and run to another partition, so we can allocate write space to specific processes by partitioning.</p>
</li>
</ul>
<p>Based on this, we can partition the system for different storage contents. For example, a separate partition for user programs <code>/usr</code> and a separate partition for <code>/home</code>.</p>
<h2 id="what-is-the-nature-of-partitioning">What is the nature of partitioning?</h2>
<p>Different partitions are still on one drive, which is equivalent to just managing different sectors in groups. So where is this grouping information stored?</p>
<p>The answer is on the first sector of the first hard drive. The first sector of the drive is also the first place the system reads when booting (<a href="https://en.wikipedia.org/wiki/Linux_startup_process">BIOS-based boot process</a>). As mentioned earlier, the size of a sector is 512bytes, what is in these 512bytes?</p>
<p>In Linux everything is a file, the hard disk is also a file, denoted by <code>/dev/sda</code> (this is the SCSI interface, the IDE interface would be <code>/dev/hda</code>, see here for naming and numbering (<a href="https://www.tldp.org/HOWTO/Partition/devices.html">https://www.tldp.org/HOWTO/Partition/devices.html</a>)). This way, we can copy the first 512bytes of the &ldquo;file&rdquo;.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ dd <span class="k">if</span><span class="o">=</span>/dev/sda <span class="nv">of</span><span class="o">=</span>mbr.bin <span class="nv">bs</span><span class="o">=</span><span class="m">512</span> <span class="nv">count</span><span class="o">=</span><span class="m">1</span>
</span></span><span class="line"><span class="cl">1+0 records in
</span></span><span class="line"><span class="cl">1+0 records out
</span></span><span class="line"><span class="cl"><span class="m">512</span> bytes copied, 0.000308004 s, 1.7 MB/s
</span></span></code></pre></td></tr></table>
</div>
</div><p>You can then look at the contents of this file using the <code>xxd</code> command that comes with Vim.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ xxd mbr.bin
</span></span><span class="line"><span class="cl">00000000: eb63 <span class="m">9010</span> 8ed0 bc00 b0b8 <span class="m">0000</span> 8ed8 8ec0  .c..............
</span></span><span class="line"><span class="cl">00000010: fbbe 007c bf00 06b9 <span class="m">0002</span> f3a4 ea21 <span class="m">0600</span>  ...<span class="p">|</span>.........!..
</span></span><span class="line"><span class="cl">00000020: 00be be07 <span class="m">3804</span> 750b 83c6 <span class="m">1081</span> fefe <span class="m">0775</span>  ....8.u........u
</span></span><span class="line"><span class="cl">00000030: f3eb 16b4 02b0 01bb 007c b280 8a74 018b  .........<span class="p">|</span>...t..
</span></span><span class="line"><span class="cl">00000040: 4c02 cd13 ea00 7c00 00eb fe00 <span class="m">0000</span> <span class="m">0000</span>  L.....<span class="p">|</span>.........
</span></span><span class="line"><span class="cl">00000050: <span class="m">0000</span> <span class="m">0000</span> <span class="m">0000</span> <span class="m">0000</span> <span class="m">0000</span> <span class="m">0080</span> <span class="m">0100</span> <span class="m">0000</span>  ................
</span></span><span class="line"><span class="cl">00000060: <span class="m">0000</span> <span class="m">0000</span> fffa <span class="m">9090</span> f6c2 <span class="m">8074</span> 05f6 c270  ...........t...p
</span></span><span class="line"><span class="cl">00000070: <span class="m">7402</span> b280 ea79 7c00 <span class="m">0031</span> c08e d88e d0bc  t....y<span class="p">|</span>..1......
</span></span><span class="line"><span class="cl">00000080: <span class="m">0020</span> fba0 647c 3cff <span class="m">7402</span> 88c2 52be 057c  . ..d<span class="p">|</span>&lt;.t...R..<span class="p">|</span>
</span></span><span class="line"><span class="cl">00000090: b441 bbaa 55cd 135a <span class="m">5272</span> 3d81 fb55 aa75  .A..U..ZRr<span class="o">=</span>..U.u
</span></span><span class="line"><span class="cl">000000a0: <span class="m">3783</span> e101 <span class="m">7432</span> 31c0 <span class="m">8944</span> <span class="m">0440</span> <span class="m">8844</span> ff89  7...t21..D.@.D..
</span></span><span class="line"><span class="cl">000000b0: <span class="m">4402</span> c704 <span class="m">1000</span> 668b 1e5c 7c66 895c <span class="m">0866</span>  D.....f..<span class="se">\|</span>f.<span class="se">\.</span>f
</span></span><span class="line"><span class="cl">000000c0: 8b1e 607c <span class="m">6689</span> 5c0c c744 <span class="m">0600</span> 70b4 42cd  ..<span class="sb">`</span><span class="p">|</span>f.<span class="se">\.</span>.D..p.B.
</span></span><span class="line"><span class="cl">000000d0: <span class="m">1372</span> 05bb <span class="m">0070</span> eb76 b408 cd13 730d 5a84  .r...p.v....s.Z.
</span></span><span class="line"><span class="cl">000000e0: d20f 83de 00be 857d e982 <span class="m">0066</span> 0fb6 c688  .......<span class="o">}</span>...f....
</span></span><span class="line"><span class="cl">000000f0: 64ff <span class="m">4066</span> <span class="m">8944</span> 040f b6d1 c1e2 <span class="m">0288</span> e888  d.@f.D..........
</span></span><span class="line"><span class="cl">00000100: f440 <span class="m">8944</span> 080f b6c2 c0e8 <span class="m">0266</span> <span class="m">8904</span> 66a1  .@.D.......f..f.
</span></span><span class="line"><span class="cl">00000110: 607c <span class="m">6609</span> c075 4e66 a15c 7c66 31d2 66f7  <span class="sb">`</span><span class="p">|</span>f..uNf.<span class="se">\|</span>f1.f.
</span></span><span class="line"><span class="cl">00000120: <span class="m">3488</span> d131 d266 f774 043b <span class="m">4408</span> 7d37 fec1  4..1.f.t.<span class="p">;</span>D.<span class="o">}</span>7..
</span></span><span class="line"><span class="cl">00000130: 88c5 30c0 c1e8 <span class="m">0208</span> c188 d05a 88c6 bb00  ..0........Z....
</span></span><span class="line"><span class="cl">00000140: 708e c331 dbb8 <span class="m">0102</span> cd13 721e 8cc3 601e  p..1......r...<span class="sb">`</span>.
</span></span><span class="line"><span class="cl">00000150: b900 018e db31 f6bf <span class="m">0080</span> 8ec6 fcf3 a51f  .....1..........
</span></span><span class="line"><span class="cl">00000160: 61ff 265a 7cbe 807d eb03 be8f 7de8 <span class="m">3400</span>  a.<span class="p">&amp;</span>Z<span class="p">|</span>..<span class="o">}</span>....<span class="o">}</span>.4.
</span></span><span class="line"><span class="cl">00000170: be94 7de8 2e00 cd18 ebfe <span class="m">4752</span> <span class="m">5542</span> <span class="m">2000</span>  ..<span class="o">}</span>.......GRUB .
</span></span><span class="line"><span class="cl">00000180: <span class="m">4765</span> 6f6d <span class="m">0048</span> <span class="m">6172</span> <span class="m">6420</span> <span class="m">4469</span> 736b <span class="m">0052</span>  Geom.Hard Disk.R
</span></span><span class="line"><span class="cl">00000190: <span class="m">6561</span> <span class="m">6400</span> <span class="m">2045</span> <span class="m">7272</span> 6f72 0d0a 00bb <span class="m">0100</span>  ead. Error......
</span></span><span class="line"><span class="cl">000001a0: b40e cd10 ac3c <span class="m">0075</span> f4c3 <span class="m">0000</span> <span class="m">0000</span> <span class="m">0000</span>  .....&lt;.u........
</span></span><span class="line"><span class="cl">000001b0: <span class="m">0000</span> <span class="m">0000</span> <span class="m">0000</span> <span class="m">0000</span> <span class="m">7762</span> ae86 <span class="m">0000</span> <span class="m">0004</span>  ........wb......
</span></span><span class="line"><span class="cl">000001c0: <span class="m">0104</span> 82fe c2ff <span class="m">0008</span> <span class="m">0000</span> <span class="m">0048</span> <span class="m">4500</span> 80fe  ...........HE...
</span></span><span class="line"><span class="cl">000001d0: c2ff 83bb c1bb <span class="m">0050</span> <span class="m">4500</span> <span class="m">0000</span> e001 <span class="m">0000</span>  .......PE.......
</span></span><span class="line"><span class="cl">000001e0: <span class="m">0000</span> <span class="m">0000</span> <span class="m">0000</span> <span class="m">0000</span> <span class="m">0000</span> <span class="m">0000</span> <span class="m">0000</span> <span class="m">0000</span>  ................
</span></span><span class="line"><span class="cl">000001f0: <span class="m">0000</span> <span class="m">0000</span> <span class="m">0000</span> <span class="m">0000</span> <span class="m">0000</span> <span class="m">0000</span> <span class="m">0000</span> 55aa  ..............U.
</span></span></code></pre></td></tr></table>
</div>
</div><p>The contents of this can be divided into 4 parts.</p>
<ol>
<li>001-440bytes (440bytes in total): the code given to the BIOS to execute; this is actually very interesting and those who are interested can dump this into machine code and have a look. The boot system needs to load the code into memory, but we need the system to boot in order to load the code. So this process is also called <a href="https://en.wikipedia.org/wiki/Bootstrapping">boot</a>, i.e. <em>&ldquo;pull oneself over a fence by one&rsquo;s bootstraps &ldquo;</em> .</li>
<li>441-446bytes (6bytes total): MBR Disk signature.</li>
<li><strong>447-510 (64bytes total): partition table in 4 parts of 16 bytes each;</strong></li>
<li>the last 511 and 512 (2bytes in total): fixed to 0x55AA, indicating that the drive is available for booting.</li>
</ol>
<p>From <code>00001be</code> to the last <code>00001fd</code>, the information of the partition table is recorded.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">000001c0: .... .... .... .... .... .... .... 80fe  ................
</span></span><span class="line"><span class="cl">000001d0: c2ff 83bb c1bb 0050 4500 0000 e001 0000  .......PE.......
</span></span><span class="line"><span class="cl">000001e0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
</span></span><span class="line"><span class="cl">000001f0: 0000 0000 0000 0000 0000 0000 0000 ....  ................
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Partition 1: <code>0004 0104 82fe c2ff 0008 0000 0048 4500</code></li>
<li>Partition 2: <code>80fe c2ff 83bb c1bb 0050 4500 0000 e001</code></li>
<li>Partition 3: <code>0000 0000 0000 0000 0000 0000 0000 0000</code></li>
<li>Partition 4: <code>0000 0000 0000 0000 0000 0000 0000 0000</code></li>
</ul>
<p>According to <code>fdisk -l</code> above, I only have two partitions on this machine, so partitions 3 and 4 are empty. What is recorded in these 16bytes? Let&rsquo;s take one of the partitions, let&rsquo;s use the 2nd one here.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">80fe c2ff 83fe c1bb <span class="m">0050</span> <span class="m">4500</span> <span class="m">0000</span> e001
</span></span></code></pre></td></tr></table>
</div>
</div><p>0 bytes, 80, is a flag for.</p>
<ul>
<li><code>80</code> This partition can be used for system booting.</li>
<li><code>00</code> This partition cannot be used for system booting.</li>
</ul>
<p>Bytes 1-3, <code>fe c2ff</code> This is represented by the CHS address we mentioned above, and the next 5-7 bytes, respectively, indicating that this partition starts at.</p>
<ul>
<li><code>fe</code> Cylinder location is <code>fe</code> ;</li>
<li><code>c2</code> Head starts at <code>c2</code> ;</li>
<li><code>ff</code> Sector starts at <code>ff</code> ;</li>
</ul>
<p>Accordingly, the end position of this partition is <code>bb c1 bb</code>.</p>
<p>The 4th byte between the beginning and the end is the partition type. In this case it is <code>83</code>, which means the type is Linux.</p>
<p>All types can be listed in <code>fdisk</code> with the <code>l</code> command.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">Command <span class="o">(</span>m <span class="k">for</span> <span class="nb">help</span><span class="o">)</span>: l
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"> <span class="m">0</span>  Empty           <span class="m">24</span>  NEC DOS         <span class="m">81</span>  Minix / old Lin bf  Solaris
</span></span><span class="line"><span class="cl"> <span class="m">1</span>  FAT12           <span class="m">27</span>  Hidden NTFS Win <span class="m">82</span>  Linux swap / So c1  DRDOS/sec <span class="o">(</span>FAT-
</span></span><span class="line"><span class="cl"> <span class="m">2</span>  XENIX root      <span class="m">39</span>  Plan <span class="m">9</span>          <span class="m">83</span>  Linux           c4  DRDOS/sec <span class="o">(</span>FAT-
</span></span><span class="line"><span class="cl"> <span class="m">3</span>  XENIX usr       3c  PartitionMagic  <span class="m">84</span>  OS/2 hidden or  c6  DRDOS/sec <span class="o">(</span>FAT-
</span></span><span class="line"><span class="cl"> <span class="m">4</span>  FAT16 &lt;32M      <span class="m">40</span>  Venix <span class="m">80286</span>     <span class="m">85</span>  Linux extended  c7  Syrinx
</span></span><span class="line"><span class="cl"> <span class="m">5</span>  Extended        <span class="m">41</span>  PPC PReP Boot   <span class="m">86</span>  NTFS volume <span class="nb">set</span> da  Non-FS data
</span></span><span class="line"><span class="cl"> <span class="m">6</span>  FAT16           <span class="m">42</span>  SFS             <span class="m">87</span>  NTFS volume <span class="nb">set</span> db  CP/M / CTOS / .
</span></span><span class="line"><span class="cl"> <span class="m">7</span>  HPFS/NTFS/exFAT 4d  QNX4.x          <span class="m">88</span>  Linux plaintext de  Dell Utility
</span></span><span class="line"><span class="cl"> <span class="m">8</span>  AIX             4e  QNX4.x 2nd part 8e  Linux LVM       df  BootIt
</span></span><span class="line"><span class="cl"> <span class="m">9</span>  AIX bootable    4f  QNX4.x 3rd part <span class="m">93</span>  Amoeba          e1  DOS access
</span></span><span class="line"><span class="cl"> a  OS/2 Boot Manag <span class="m">50</span>  OnTrack DM      <span class="m">94</span>  Amoeba BBT      e3  DOS R/O
</span></span><span class="line"><span class="cl"> b  W95 FAT32       <span class="m">51</span>  OnTrack DM6 Aux 9f  BSD/OS          e4  SpeedStor
</span></span><span class="line"><span class="cl"> c  W95 FAT32 <span class="o">(</span>LBA<span class="o">)</span> <span class="m">52</span>  CP/M            a0  IBM Thinkpad hi ea  Rufus alignment
</span></span><span class="line"><span class="cl"> e  W95 FAT16 <span class="o">(</span>LBA<span class="o">)</span> <span class="m">53</span>  OnTrack DM6 Aux a5  FreeBSD         eb  BeOS fs
</span></span><span class="line"><span class="cl"> f  W95 Ext<span class="err">&#39;</span>d <span class="o">(</span>LBA<span class="o">)</span> <span class="m">54</span>  OnTrackDM6      a6  OpenBSD         ee  GPT
</span></span><span class="line"><span class="cl"><span class="m">10</span>  OPUS            <span class="m">55</span>  EZ-Drive        a7  NeXTSTEP        ef  EFI <span class="o">(</span>FAT-12/16/
</span></span><span class="line"><span class="cl"><span class="m">11</span>  Hidden FAT12    <span class="m">56</span>  Golden Bow      a8  Darwin UFS      f0  Linux/PA-RISC b
</span></span><span class="line"><span class="cl"><span class="m">12</span>  Compaq diagnost 5c  Priam Edisk     a9  NetBSD          f1  SpeedStor
</span></span><span class="line"><span class="cl"><span class="m">14</span>  Hidden FAT16 &lt;<span class="m">3</span> <span class="m">61</span>  SpeedStor       ab  Darwin boot     f4  SpeedStor
</span></span><span class="line"><span class="cl"><span class="m">16</span>  Hidden FAT16    <span class="m">63</span>  GNU HURD or Sys af  HFS / HFS+      f2  DOS secondary
</span></span><span class="line"><span class="cl"><span class="m">17</span>  Hidden HPFS/NTF <span class="m">64</span>  Novell Netware  b7  BSDI fs         fb  VMware VMFS
</span></span><span class="line"><span class="cl"><span class="m">18</span>  AST SmartSleep  <span class="m">65</span>  Novell Netware  b8  BSDI swap       <span class="nb">fc</span>  VMware VMKCORE
</span></span><span class="line"><span class="cl">1b  Hidden W95 FAT3 <span class="m">70</span>  DiskSecure Mult bb  Boot Wizard hid fd  Linux raid auto
</span></span><span class="line"><span class="cl">1c  Hidden W95 FAT3 <span class="m">75</span>  PC/IX           bc  Acronis FAT32 L fe  LANstep
</span></span><span class="line"><span class="cl">1e  Hidden W95 FAT1 <span class="m">80</span>  Old Minix       be  Solaris boot    ff  BBT
</span></span></code></pre></td></tr></table>
</div>
</div><p>But actually, this partition type is not very useful in Linux, whether it&rsquo;s ext2 or ext3 or other Linux partitions, it&rsquo;s <code>83</code>. This flag is interpreted differently by different operating systems, for example, Windows uses this flag to distinguish between different partition types, so you see in this table that FAT32 and NTFS, the common Windows partitions, each occupy a flag bit. In the end, this flag bit is actually a common flag, and how it is interpreted goes to the operating system, even if different <a href="https://www.tldp.org/HOWTO/Partition/partition-types.html#types">operating systems installed on the same hard drive are also possible</a>, for example <code>0x07</code> For example, OS/2 considers this flag bit to be an HPFS type partition and Windows considers it to be an NTFS type partition.</p>
<p>It is important to note that this flag bit is not intrinsically related to the file system. Since Linux doesn&rsquo;t care about this flag bit, I can build a filesystem on this partition regardless of its type. I can even overwrite this flag bit while the system is running. For example, if I change this current partition to FAT12, there is no problem at all.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">Device     Boot    Start      End  Sectors  Size Id Type
</span></span><span class="line"><span class="cl">/dev/sda1           <span class="m">2048</span>  <span class="m">4542463</span>  <span class="m">4540416</span>  2.2G <span class="m">82</span> Linux swap / Solaris
</span></span><span class="line"><span class="cl">/dev/sda2  *     <span class="m">4542464</span> <span class="m">35999743</span> <span class="m">31457280</span>   15G  <span class="m">1</span> FAT12
</span></span><span class="line"><span class="cl">/dev/sda3       <span class="m">35999744</span> <span class="m">38096895</span>  <span class="m">2097152</span>    1G <span class="m">83</span> Linux
</span></span></code></pre></td></tr></table>
</div>
</div><p>8-11 bytes: 0050 4500 Absolute address of the first sector of the logical block address.</p>
<p>11-15 bytes: <code>0000 e001</code> How many sectors this partition has in total.</p>
<p><em>Limit of MBR partition</em>: From here, we can see that 4 bytes indicate the absolute address of the first sector and 4 bytes indicate how many sectors this partition has, so the maximum hard disk size that the MBR partition table can support is:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">512Bytes * 0xff ff ff ff          + 512Bytes * 0xff ff ff ff
</span></span><span class="line"><span class="cl">扇区大小    最大能表示的第一个扇区位置    扇区大小    最后一个分区的最大扇区数
</span></span></code></pre></td></tr></table>
</div>
</div><p>That is, <code>512 * (2^32 -1 ) * 2</code>, which is 4TiB-1Kb.</p>
<p>However, with such partitioning, the last partition must be 2TiB in order to take advantage of 4Tib. If a user has a 4TiB hard drive and wants to divide it evenly into 4 partitions of 1TiB each, it won&rsquo;t work. This will cause confusion to many users, so when it comes to commercial promotion, just say that MBR supports 2TiB.</p>
<h3 id="primary-and-extended-partitions">Primary and extended partitions</h3>
<p>As you can also see here, the partition data is 64bytes in total and each partition table needs 16bytes of information. So there can be 4 partitions in total. The first time I used a computer, it was Windows, and I never understood what &ldquo;local disk CDEF&rdquo; meant. Actually, it means that the fast partitioning mode of the partitioning software divides the hard disk into 4 partitions by default on average.</p>
<p>The partition table determines that we can only create 4 partitions, what if we want more partitions?</p>
<p>Remember what happens when block addressing in the file system exceeds the number of blocks that can be stored in an inode? The answer is that the actual content of the block stored in the inode is the address of the real block. The same principle is used here. We can create a primary partition of type Extended (with flag <code>5</code>), and then each partition in this partition holds the address to the next partition at the end.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/05/08/b7f1646502674ef79a2de14b572e8cf9.png" alt="partition"></p>
<p>Logical partitions must be contiguous (obviously), but primary partitions can be non-contiguous. Other than that there is no difference in the use of logical and primary partitions. Logical partitions can also be used to boot the system.</p>
<p>This introduction should solve most of the reader&rsquo;s problems (at least it answers many of my questions). For more in-depth questions, you may have to search for more detailed information based on this content.</p>
<h2 id="sector-size-and-block-size">Sector Size and Block Size</h2>
<p>You should know something about this from reading this article. Sector is a concept of hard disk, almost all hard disk sectors are 512Bytes, if not, it may be a problem. And Block refers to a logical concept. But there may still be some confusion about them in some scenarios. I&rsquo;ve done some research on the subject, so here&rsquo;s more or less how to save some time for those who have the same questions as me in the future, and can find it here.</p>
<p>There is very little difference in the concept of sector size. But Block has different meanings in different scenarios.</p>
<p><strong>The first is the block of the file system</strong>, where the block affects the size of the block used to store the file. The reason is simple: the file system is addressed in blocks, so if the block size is 4k, then even if the file is written to 1k, it will take 4k.</p>
<p>When a file system is created, the inode and block are automatically allocated:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ mkfs -t ext2 /dev/sda5
</span></span><span class="line"><span class="cl">mke2fs 1.45.3 <span class="o">(</span>14-Jul-2019<span class="o">)</span>
</span></span><span class="line"><span class="cl">Creating filesystem with <span class="m">131072</span> 1k blocks and <span class="m">32768</span> inodes
</span></span><span class="line"><span class="cl">Filesystem UUID: eac2bf41-3564-4f66-8740-e574593247fa
</span></span><span class="line"><span class="cl">Superblock backups stored on blocks:
</span></span><span class="line"><span class="cl">        8193, 24577, 40961, 57345, <span class="m">73729</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">Allocating group tables: <span class="k">done</span>
</span></span><span class="line"><span class="cl">Writing inode tables: <span class="k">done</span>
</span></span><span class="line"><span class="cl">Writing superblocks and filesystem accounting information: <span class="k">done</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Block in IO</strong> : IO is in blocks, this block is not necessarily the block size of the file system, nor the size of the sector, it can be smaller than the sector, but this is a waste, because the hard disk will write 512bytes per write, if the block of IO is 256bytes, then it is equivalent to writing the same sector, using two physical write operations. In addition, we have to write to disk through syscall, which copies data between user space and kernel space, also in blocks. We can use the <a href="https://www.oreilly.com/library/view/linux-system-programming/9781449341527/ch04.html"><code>madvice</code></a> system call to suggest the IO block size to the Kernel.</p>
<p>Here is the impact on the speed when I use dd to copy the same data from the hard disk, using different block sizes.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ dd <span class="k">if</span><span class="o">=</span>/dev/sda <span class="nv">of</span><span class="o">=</span>dump.bin <span class="nv">bs</span><span class="o">=</span><span class="m">200</span> <span class="nv">count</span><span class="o">=</span><span class="m">1000</span>
</span></span><span class="line"><span class="cl">1000+0 records in
</span></span><span class="line"><span class="cl">1000+0 records out
</span></span><span class="line"><span class="cl"><span class="m">200000</span> bytes <span class="o">(</span><span class="m">200</span> kB, <span class="m">195</span> KiB<span class="o">)</span> copied, 0.0111036 s, 18.0 MB/s
</span></span><span class="line"><span class="cl">$ dd <span class="k">if</span><span class="o">=</span>/dev/sda <span class="nv">of</span><span class="o">=</span>dump.bin <span class="nv">bs</span><span class="o">=</span><span class="m">512</span> <span class="nv">count</span><span class="o">=</span><span class="m">1000</span>
</span></span><span class="line"><span class="cl">1000+0 records in
</span></span><span class="line"><span class="cl">1000+0 records out
</span></span><span class="line"><span class="cl"><span class="m">512000</span> bytes <span class="o">(</span><span class="m">512</span> kB, <span class="m">500</span> KiB<span class="o">)</span> copied, 0.00905283 s, 56.6 MB/s
</span></span><span class="line"><span class="cl">$ dd <span class="k">if</span><span class="o">=</span>/dev/sda <span class="nv">of</span><span class="o">=</span>dump.bin <span class="nv">bs</span><span class="o">=</span><span class="m">1024</span> <span class="nv">count</span><span class="o">=</span><span class="m">1000</span>
</span></span><span class="line"><span class="cl">1000+0 records in
</span></span><span class="line"><span class="cl">1000+0 records out
</span></span><span class="line"><span class="cl"><span class="m">1024000</span> bytes <span class="o">(</span>1.0 MB, <span class="m">1000</span> KiB<span class="o">)</span> copied, 0.0061073 s, <span class="m">168</span> MB/s
</span></span></code></pre></td></tr></table>
</div>
</div><p>But IO is actually a very complex issue, and it is not clear in a few words. We recommend a book <em><a href="https://www.oreilly.com/library/view/linux-system-programming/9781449341527/">Linux System Programming</a></em>, which has four chapters on IO-related topics.</p>
<p>In addition, when you see a block, you have to pay attention to what context it is talking about. For example, the block shown by the <code>ls -s</code> command is shown with each block=1024bytes, while the block in <code>stat</code> is <code>512bytes</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ ls -s a.txt
</span></span><span class="line"><span class="cl"><span class="m">4</span> a.txt
</span></span><span class="line"><span class="cl">$ stat a.txt
</span></span><span class="line"><span class="cl">  File: a.txt
</span></span><span class="line"><span class="cl">  Size: <span class="m">6</span>               Blocks: <span class="m">8</span>          IO Block: <span class="m">4096</span>   regular file
</span></span><span class="line"><span class="cl">Device: 802h/2050d      Inode: <span class="m">656578</span>      Links: <span class="m">1</span>
</span></span><span class="line"><span class="cl">Access: <span class="o">(</span>0644/-rw-r--r--<span class="o">)</span>  Uid: <span class="o">(</span>    0/    root<span class="o">)</span>   Gid: <span class="o">(</span>    0/    root<span class="o">)</span>
</span></span><span class="line"><span class="cl">Context: unconfined_u:object_r:user_home_t:s0
</span></span><span class="line"><span class="cl">Access: 2019-12-01 09:49:27.651029032 +0000
</span></span><span class="line"><span class="cl">Modify: 2019-12-01 09:51:26.508134896 +0000
</span></span><span class="line"><span class="cl">Change: 2019-12-01 09:51:26.508134896 +0000
</span></span><span class="line"><span class="cl"> Birth: 2019-12-01 09:49:27.651029032 +0000
</span></span></code></pre></td></tr></table>
</div>
</div><p>It is recommended to practice partitioning with the relevant tools, and it is recommended to operate inside the virtual machine without worrying about messing up the host. Play with these commands.</p>
<ul>
<li>xxd (provided by vim)</li>
<li>fdisk</li>
<li>mount</li>
<li>grub</li>
<li>ss</li>
<li>dd</li>
</ul>

    </div>

    
<footer class="post-footer">
      
      <nav class="post-nav">
        <a class="prev" href="/post/2022-05/user-bin/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">The story of /bin /usr/bin and /usr/local/bin</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2022-05/docker-image-tips/">
            <span class="next-text nav-default">Some tips for building Docker images</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  <script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox-3.1.20.min.js"></script>



<script type="text/javascript" src="/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js"></script>








</body>
</html>
