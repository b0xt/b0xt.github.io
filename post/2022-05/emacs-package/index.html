<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Emacs Package Management Guide - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="This article presents my personal experience in optimizing the configuration of the main content: the principle of package loading and management practices." /><meta name="keywords" content="emacs, Package, git" />






<meta name="generator" content="Hugo 0.101.0 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2022-05/emacs-package/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link href="/lib/fancybox/jquery.fancybox-3.1.20.min.css" rel="stylesheet">


<meta property="og:title" content="Emacs Package Management Guide" />
<meta property="og:description" content="This article presents my personal experience in optimizing the configuration of the main content: the principle of package loading and management practices." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2022-05/emacs-package/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-05-03T17:26:40+08:00" />
<meta property="article:modified_time" content="2022-05-03T17:26:40+08:00" />

<meta itemprop="name" content="Emacs Package Management Guide">
<meta itemprop="description" content="This article presents my personal experience in optimizing the configuration of the main content: the principle of package loading and management practices."><meta itemprop="datePublished" content="2022-05-03T17:26:40+08:00" />
<meta itemprop="dateModified" content="2022-05-03T17:26:40+08:00" />
<meta itemprop="wordCount" content="1370">
<meta itemprop="keywords" content="emacs," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Emacs Package Management Guide"/>
<meta name="twitter:description" content="This article presents my personal experience in optimizing the configuration of the main content: the principle of package loading and management practices."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SOBYTE</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SOBYTE</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Emacs Package Management Guide</h1>

      <div class="post-meta">
        <span class="post-time"> 2022-05-03 17:26:40 </span>
        <div class="post-category">
            <a href="/categories/tutorials/"> tutorials </a>
            </div>
          <span class="more-meta"> 1370 words </span>
          <span class="more-meta"> 3 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#packageel-issues">Package.el issues</a></li>
        <li><a href="#package-loading-principles">Package loading principles</a>
          <ul>
            <li><a href="#autoload">Autoload</a></li>
            <li><a href="#feature">Feature</a></li>
            <li><a href="#load">Load</a></li>
          </ul>
        </li>
        <li><a href="#submodule-management-package">Submodule Management Package</a>
          <ul>
            <li><a href="#use-package-bootstrap">use-package bootstrap</a></li>
            <li><a href="#common-git-commands">Common Git Commands</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>For Emacs users, optimizing their configuration is fun and a sure way to become an Emacs expert. Generally speaking, a novice&rsquo;s configuration is pieced together, which is the fastest and most efficient way to learn. As you get deeper into Emacs, the configuration becomes more complex, and it is hard to imagine continuing to have fun with Emacs without refactoring your previously disorganized configuration.</p>
<p>This article will introduce my personal experience in optimizing <a href="https://github.com/jiacai2050/dotfiles/tree/master/.emacs.d">configuration</a>, the main content: package loading principles and management practices, I hope it will be of some help to readers in optimizing their own configurations.</p>
<h2 id="packageel-issues">Package.el issues</h2>
<p>It is no exaggeration to say that the high degree of extensibility is the main reason why Emacs continues to live and die for decades. <code>(length package-alist)</code> counts the number of packages installed via <a href="https://wikemacs.org/wiki/Package.el">package.el</a>, which is 137 for me.</p>
<p>Although package.el provides a convenient way to install packages, it does not provide versioning, which is the most basic feature of any package manager, and I&rsquo;ve had many times where the feature failed due to package upgrades, which is very frustrating, see <a href="https://emacs-china.org/t/package-el-autoloads/8049/12?u=jiacai2050">here</a>.</p>
<p>There are some solutions in the community, such as <a href="https://github.com/raxod502/straight.el">straight</a>, <a href="https://github.com/emacscollective/borg">borg</a> , but to avoid introducing new problems and to reduce the learning burden. I currently do not use these solutions, but use git&rsquo;s own submodule to manage some <a href="https://github.com/jiacai2050/dotfiles/tree/master/.emacs.d/vendor">heavily used packages</a> (e.g. lsp-mode/magit). You can then work on upgrades at your leisure, and if you have a problem with an upgrade, you can just fall back to the previous commit. No more worries about being interrupted by tools.</p>
<h2 id="package-loading-principles">Package loading principles</h2>
<p>For packages managed by package.el, users do not need to know how Emacs loads packages in order to use them, but they need to know the details of how to manage them completely on their own. First, the definition of a package is clear.</p>
<blockquote>
<p>A package is a collection of <a href="(https://www.gnu.org/software/emacs/manual/html_node/elisp/Simple-Packages.html)">one</a> or <a href="https://www.gnu.org/software/emacs/manual/html_node/elisp/Multi_002dfile-Packages.html">more</a> ELisp files that Emacs searches in the folder specified by <a href="https://www.gnu.org/software/emacs/manual/html_node/elisp/Library-Search.html">load-path</a>.</p>
</blockquote>
<p>Emacs provides two types of high-level interfaces for package autoloading: Autoload and Feature.</p>
<h3 id="autoload">Autoload</h3>
<p><a href="https://www.gnu.org/software/emacs/manual/html_node/elisp/Autoload.html">Autoload</a> functions can declare functions or macros and then load their corresponding files when they are actually used.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-lisp" data-lang="lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">autoload</span> <span class="nv">filename</span> <span class="nv">docstring</span> <span class="nv">interactive</span> <span class="k">type</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Generally do not use autoload function directly, but autoload magic comment, then use some function to parse the magic comment to automatically generate autoload function, for example, in my-mode folder there is a file <code>hello-world.el</code>, the content is.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="p">;;;</span>###<span class="n">autoload</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="n">defun</span><span class="w"> </span><span class="n">my</span><span class="o">-</span><span class="n">hello</span><span class="w"> </span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="n">interactive</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="n">message</span><span class="w"> </span><span class="s">&#34;hello world&#34;</span><span class="p">))</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Use the following command to generate the autoloads file.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-lisp" data-lang="lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">package-generate-autoloads</span> <span class="s">&#34;hello-world&#34;</span> <span class="s">&#34;~/my-mode&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Generate the <code>hello-world-autoloads.el</code> file in the same directory, with the following contents</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-lisp" data-lang="lisp"><span class="line"><span class="cl"><span class="c1">;;; hello-world-autoloads.el --- automatically extracted autoloads</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;; Code:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;load-path</span> <span class="p">(</span><span class="nv">directory-file-name</span>
</span></span><span class="line"><span class="cl">                      <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nv">file-name-directory</span> <span class="err">#</span><span class="nv">$</span><span class="p">)</span> <span class="p">(</span><span class="nf">car</span> <span class="nv">load-path</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;;;### (autoloads nil &#34;hello-world&#34; &#34;hello-world.el&#34; (0 0 0 0))</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;; Generated autoloads from hello-world.el</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">autoload</span> <span class="ss">&#39;my-hello</span> <span class="s">&#34;hello-world&#34;</span> <span class="no">nil</span> <span class="no">t</span> <span class="no">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;;;***</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;; Local Variables:</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; version-control: never</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; no-byte-compile: t</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; no-update-autoloads: t</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; coding: utf-8</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; End:</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;; hello-world-autoloads.el ends here</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>This means that only the first time <code>M-x my-hello</code> goes back to load the <code>hello-world.el</code> file.</p>
<p>Note here that in order for Emacs to recognize the declaration of the my-hello function, it needs to go back and load the hello-world-autoloads.el file. For packages managed through package.el, package.el does the following when downloading the package.</p>
<ol>
<li>parse the dependencies and download them recursively</li>
<li>append the package directory to the load-path</li>
<li>automatically generate the autoloads file and load it</li>
</ol>
<p>This allows the user to use the functions provided by the package directly. If you use submodule management, you will need to implement the above operations yourself, which will be described later.</p>
<h3 id="feature">Feature</h3>
<p><a href="https://www.gnu.org/software/emacs/manual/html_node/elisp/Named-Features.html">Feature</a> is another mechanism provided by Emacs to automatically load ELisp files, example of use.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-lisp" data-lang="lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">my-hello</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">interactive</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">message</span> <span class="s">&#34;hello world&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;; feature 名与文件名相同</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nf">provide</span> <span class="ss">&#39;hello-world</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The above code generates a feature called hello-world, and since it has the same name as the file, just use my-hello before <code>(require 'hello-world)</code> and it will go ahead and load hello-world.el automatically.</p>
<h3 id="load">Load</h3>
<p><a href="https://www.gnu.org/software/emacs/manual/html_node/elisp/How-Programs-Do-Loading.html">Load</a>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-lisp" data-lang="lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nf">load</span> <span class="nv">filename</span> <span class="k">&amp;optional</span> <span class="nv">missing-ok</span> <span class="nv">nomessage</span> <span class="nv">nosuffix</span> <span class="nv">must-suffix</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The above autoload and feature will call the load function to load the file. load is a relatively low-level API and is not recommended to be called directly by the upper layer.</p>
<h2 id="submodule-management-package">Submodule Management Package</h2>
<p>In the introduction to autoload above, the general steps for downloading a package were described in package.el. Here is a refresher:</p>
<ol>
<li>parse the dependencies and download them recursively</li>
<li>append the package directory to the load-path</li>
<li>automatically generate the autoloads file and load it</li>
</ol>
<p>If you use a submodule, you can only download the package itself, so you need to do all three steps above. I currently use <a href="https://github.com/jwiegley/use-package">use-package</a> to download and configure packages, and the following example shows its usage.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-lisp" data-lang="lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nf">use-package</span> <span class="nv">lsp-mode</span>
</span></span><span class="line"><span class="cl">  <span class="c1">;; 配置 load-path，lsp-mode 通过 submodule 下载到 ~/.emacs.d/vendor/lsp-mode 目录内</span>
</span></span><span class="line"><span class="cl">  <span class="ss">:load-path</span> <span class="p">(</span><span class="s">&#34;~/.emacs.d/vendor/lsp-mode&#34;</span> <span class="s">&#34;~/.emacs.d/vendor/lsp-mode/clients&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="ss">:init</span> <span class="p">(</span><span class="k">setq</span> <span class="nv">lsp-keymap-prefix</span> <span class="s">&#34;C-c l&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="c1">;; 配置 mode 的 hook</span>
</span></span><span class="line"><span class="cl">  <span class="ss">:hook</span> <span class="p">((</span><span class="nv">go-mode</span> <span class="o">.</span> <span class="nv">lsp-deferred</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="c1">;; 生成 autoloads</span>
</span></span><span class="line"><span class="cl">  <span class="ss">:commands</span> <span class="p">(</span><span class="nv">lsp</span> <span class="nv">lsp-deferred</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="c1">;; 配置 custom 变量</span>
</span></span><span class="line"><span class="cl">  <span class="ss">:custom</span> <span class="p">((</span><span class="nv">lsp-log-io</span> <span class="no">nil</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="ss">:config</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nf">require</span> <span class="ss">&#39;lsp-modeline</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">push</span> <span class="s">&#34;[/\\\\]vendor$&#34;</span> <span class="nv">lsp-file-watch-ignored-directories</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="c1">;; 配置 mode-map 快捷键</span>
</span></span><span class="line"><span class="cl">  <span class="ss">:bind</span> <span class="p">(</span><span class="ss">:map</span> <span class="nv">lsp-mode-map</span>
</span></span><span class="line"><span class="cl">              <span class="p">(</span><span class="s">&#34;M-.&#34;</span> <span class="o">.</span> <span class="nv">lsp-find-definition</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">              <span class="p">(</span><span class="s">&#34;M-n&#34;</span> <span class="o">.</span> <span class="nv">lsp-find-references</span><span class="p">)))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>As you can see, the use-package macro is very concise and unifies the various configurations of the package, and is highly recommended. Expanding use-package using <a href="https://www.gnu.org/software/emacs/manual/html_node/elisp/Expansion.html">macroexpand-1</a> shows that it is not much different from the code we configured manually.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-lisp" data-lang="lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="k">progn</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">eval-and-compile</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;load-path</span> <span class="s">&#34;~/.emacs.d/vendor/lsp-mode&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">eval-and-compile</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;load-path</span> <span class="s">&#34;~/.emacs.d/vendor/lsp-mode/clients&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="k">let</span>
</span></span><span class="line"><span class="cl">      <span class="p">((</span><span class="nv">custom--inhibit-theme-enable</span> <span class="no">nil</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">unless</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nv">memq</span> <span class="ss">&#39;use-package</span> <span class="nv">custom-known-themes</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">deftheme</span> <span class="nf">use-package</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">enable-theme</span> <span class="ss">&#39;use-package</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="k">setq</span> <span class="nv">custom-enabled-themes</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="nv">remq</span> <span class="ss">&#39;use-package</span> <span class="nv">custom-enabled-themes</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">custom-theme-set-variables</span> <span class="ss">&#39;use-package</span>
</span></span><span class="line"><span class="cl">                                <span class="o">&#39;</span><span class="p">(</span><span class="nv">lsp-log-io</span> <span class="no">nil</span> <span class="no">nil</span> <span class="no">nil</span> <span class="s">&#34;Customized with use-package lsp-mode&#34;</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">unless</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nf">fboundp</span> <span class="ss">&#39;lsp-deferred</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">autoload</span> <span class="nf">#&#39;</span><span class="nv">lsp-deferred</span> <span class="s">&#34;lsp-mode&#34;</span> <span class="no">nil</span> <span class="no">t</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">unless</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nf">fboundp</span> <span class="ss">&#39;lsp-find-definition</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">autoload</span> <span class="nf">#&#39;</span><span class="nv">lsp-find-definition</span> <span class="s">&#34;lsp-mode&#34;</span> <span class="no">nil</span> <span class="no">t</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">unless</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nf">fboundp</span> <span class="ss">&#39;lsp-find-references</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">autoload</span> <span class="nf">#&#39;</span><span class="nv">lsp-find-references</span> <span class="s">&#34;lsp-mode&#34;</span> <span class="no">nil</span> <span class="no">t</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">unless</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nf">fboundp</span> <span class="ss">&#39;lsp</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">autoload</span> <span class="nf">#&#39;</span><span class="nv">lsp</span> <span class="s">&#34;lsp-mode&#34;</span> <span class="no">nil</span> <span class="no">t</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">condition-case-unless-debug</span> <span class="nv">err</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="k">setq</span> <span class="nv">lsp-keymap-prefix</span> <span class="s">&#34;C-c l&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="kt">error</span>
</span></span><span class="line"><span class="cl">     <span class="p">(</span><span class="nf">funcall</span> <span class="nv">use-package--warning139</span> <span class="ss">:init</span> <span class="nv">err</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">eval-after-load</span> <span class="ss">&#39;lsp-mode</span>
</span></span><span class="line"><span class="cl">    <span class="o">&#39;</span><span class="p">(</span><span class="k">progn</span>
</span></span><span class="line"><span class="cl">       <span class="p">(</span><span class="nf">require</span> <span class="ss">&#39;lsp-modeline</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">       <span class="p">(</span><span class="nb">push</span> <span class="s">&#34;[/\\\\]vendor$&#34;</span> <span class="nv">lsp-file-watch-ignored-directories</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">       <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;go-mode-hook</span> <span class="nf">#&#39;</span><span class="nv">lsp-deferred</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">bind-keys</span> <span class="ss">:package</span> <span class="nv">lsp-mode</span> <span class="ss">:map</span> <span class="nv">lsp-mode-map</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="s">&#34;M-.&#34;</span> <span class="o">.</span> <span class="nv">lsp-find-definition</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="s">&#34;M-n&#34;</span> <span class="o">.</span> <span class="nv">lsp-find-references</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>use-package solves the cumbersome configuration problem, but does not solve the problem of package dependencies, which can only be downloaded one by one (see the <code>Package-Requires</code> declaration of the package for specific dependencies).</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-lisp" data-lang="lisp"><span class="line"><span class="cl"><span class="c1">;; lsp-mode deps</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nf">use-package</span> <span class="nv">spinner</span>
</span></span><span class="line"><span class="cl">  <span class="ss">:defer</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nf">use-package</span> <span class="nv">lv</span>
</span></span><span class="line"><span class="cl">  <span class="ss">:defer</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; ...</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>use-package will automatically use package.el to download these dependencies if they are not found in the load-path. My approach here is a compromise, for some lighter packages there is no need to manage them with submodule. The reader may find this manual management of dependencies tedious, but in reality the dependencies are likely to be the same for different packages, e.g. <a href="https://github.com/magnars/dash.el">dash.el</a>, <a href="https://github.com/magnars/s.el">s.el</a>, <a href="https://github.com/rejeep/f.el">f.el</a>, and other such base packages, so there are not many dependencies that actually need to be managed manually.</p>
<h3 id="use-package-bootstrap">use-package bootstrap</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Lisp" data-lang="Lisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">package-initialize</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nf">not</span> <span class="nv">package-archive-contents</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">package-refresh-contents</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">dolist</span> <span class="p">(</span><span class="nv">p</span> <span class="o">&#39;</span><span class="p">(</span><span class="nf">use-package</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nf">not</span> <span class="p">(</span><span class="nv">package-installed-p</span> <span class="nv">p</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">package-install</span> <span class="nv">p</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="k">setq</span> <span class="nv">use-package-always-ensure</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl">      <span class="nv">use-package-verbose</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;; 后面就可以直接使用 use-package 来安装、配置包了</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="common-git-commands">Common Git Commands</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># 修改 .gitmodules 后</span>
</span></span><span class="line"><span class="cl">git submodule sync
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 更新到最新 commit</span>
</span></span><span class="line"><span class="cl">git submodule update --init --recursive --remote
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># https://stackoverflow.com/a/18854453/2163429</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 更新到 .gitmodules 中指定的 commit</span>
</span></span><span class="line"><span class="cl">git submodule update --init
</span></span></code></pre></td></tr></table>
</div>
</div><p>For adding and removing submodules, you can do it directly in magit by pressing <code>o</code> under <code>magit-status-mode</code>.</p>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/emacs/">emacs</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2022-05/js-property-descriptor/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Property Descriptor for JavaScript objects</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2022-05/trait-usage/">
            <span class="next-text nav-default">Trait use and principle analysis</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  <script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox-3.1.20.min.js"></script>



<script type="text/javascript" src="/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js"></script>








</body>
</html>
