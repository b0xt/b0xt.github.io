<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Use the curl command to analyze the time consumed by the request - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="Learn how to use the curl command to analyze the time consumption of requests." /><meta name="keywords" content="curl, Analyze Request" />






<meta name="generator" content="Hugo 0.101.0 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2022-05/use-curl-to-analyze-request/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link href="/lib/fancybox/jquery.fancybox-3.1.20.min.css" rel="stylesheet">


<meta property="og:title" content="Use the curl command to analyze the time consumed by the request" />
<meta property="og:description" content="Learn how to use the curl command to analyze the time consumption of requests." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2022-05/use-curl-to-analyze-request/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-05-04T11:12:48+08:00" />
<meta property="article:modified_time" content="2022-05-04T11:12:48+08:00" />

<meta itemprop="name" content="Use the curl command to analyze the time consumed by the request">
<meta itemprop="description" content="Learn how to use the curl command to analyze the time consumption of requests."><meta itemprop="datePublished" content="2022-05-04T11:12:48+08:00" />
<meta itemprop="dateModified" content="2022-05-04T11:12:48+08:00" />
<meta itemprop="wordCount" content="694">
<meta itemprop="keywords" content="curl," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Use the curl command to analyze the time consumed by the request"/>
<meta name="twitter:description" content="Learn how to use the curl command to analyze the time consumption of requests."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SOBYTE</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SOBYTE</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Use the curl command to analyze the time consumed by the request</h1>

      <div class="post-meta">
        <span class="post-time"> 2022-05-04 11:12:48 </span>
        <div class="post-category">
            <a href="/categories/tutorials/"> tutorials </a>
            </div>
          <span class="more-meta"> 694 words </span>
          <span class="more-meta"> 4 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents"></nav>
  </div>
</div>
    <div class="post-content">
      <p>I recently ran into a problem at work where the response to a request was particularly slow, so I wanted a way to analyze which step of the request was taking longer so I could find the cause of the problem further. After searching the web, I found a very useful method, the <code>curl</code> command, which can help you analyze the time spent on each part of the request.</p>
<p>The <code>curl</code> command provides the <code>-w</code> parameter, which is explained in the manpage as follows</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">-w, --write-out &lt;format&gt;
</span></span><span class="line"><span class="cl">              Make curl display information on stdout after a completed transfer. The format is a string that may contain plain text mixed with any number of variables. The  format
</span></span><span class="line"><span class="cl">              can  be  specified  as  a literal &#34;string&#34;, or you can have curl read the format from a file with &#34;@filename&#34; and to tell curl to read the format from stdin you write
</span></span><span class="line"><span class="cl">              &#34;@-&#34;.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">              The variables present in the output format will be substituted by the value or text that curl thinks fit, as described below. All variables are specified  as  %{vari‐
</span></span><span class="line"><span class="cl">              able_name} and to output a normal % you just write them as %%. You can output a newline by using \n, a carriage return with \r and a tab space with \t.
</span></span></code></pre></td></tr></table>
</div>
</div><p>It can print certain information in a specified format, it can use certain variables, and it supports <code>\n</code>, <code>\t</code> and <code>\r</code> escape characters. There are many variables provided, such as <code>status_code</code>, <code>local_port</code>, <code>size_download</code>, etc. In this article we will only focus on variables related to the request time (variables starting with <code>time_</code>).</p>
<p>First, write the following to the text file <code>curl-format.txt</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">➜  ~ cat curl-format.txt
</span></span><span class="line"><span class="cl">    time_namelookup:  %<span class="o">{</span>time_namelookup<span class="o">}</span><span class="se">\n</span>
</span></span><span class="line"><span class="cl">       time_connect:  %<span class="o">{</span>time_connect<span class="o">}</span><span class="se">\n</span>
</span></span><span class="line"><span class="cl">    time_appconnect:  %<span class="o">{</span>time_appconnect<span class="o">}</span><span class="se">\n</span>
</span></span><span class="line"><span class="cl">      time_redirect:  %<span class="o">{</span>time_redirect<span class="o">}</span><span class="se">\n</span>
</span></span><span class="line"><span class="cl">   time_pretransfer:  %<span class="o">{</span>time_pretransfer<span class="o">}</span><span class="se">\n</span>
</span></span><span class="line"><span class="cl"> time_starttransfer:  %<span class="o">{</span>time_starttransfer<span class="o">}</span><span class="se">\n</span>
</span></span><span class="line"><span class="cl">                    ----------<span class="se">\n</span>
</span></span><span class="line"><span class="cl">         time_total:  %<span class="o">{</span>time_total<span class="o">}</span><span class="se">\n</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>So what do all these variables mean? Let me explain.</p>
<ul>
<li><code>time_namelookup</code> : the time when DNS domain name is resolved, which is the process of converting <code>https://zhihu.com</code> into an ip address</li>
<li><code>time_connect</code> : the time of TCP connection establishment, that is, the time of three handshakes</li>
<li><code>time_appconnect</code> : the time it takes for SSL/SSH and other upper layer protocols to establish a connection, such as connect/handshake</li>
<li><code>time_redirect</code> : the time from the beginning to the last request transaction</li>
<li><code>time_pretransfer</code> : the time from the start of the request to the start of the response transmission</li>
<li><code>time_starttransfer</code> : the time from the start of the request until the first byte will be transferred</li>
<li><code>time_total</code> : the total time spent on this request</li>
</ul>
<p>Let&rsquo;s look at the time of a simple request without redirection and without SSL protocol.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">➜  ~ curl -w <span class="s2">&#34;@curl-format.txt&#34;</span> -o /dev/null -s -L <span class="s2">&#34;http://cizixs.com&#34;</span>
</span></span><span class="line"><span class="cl">    time_namelookup:  0.012
</span></span><span class="line"><span class="cl">       time_connect:  0.227
</span></span><span class="line"><span class="cl">    time_appconnect:  0.000
</span></span><span class="line"><span class="cl">      time_redirect:  0.000
</span></span><span class="line"><span class="cl">   time_pretransfer:  0.227
</span></span><span class="line"><span class="cl"> time_starttransfer:  0.443
</span></span><span class="line"><span class="cl">                    ----------
</span></span><span class="line"><span class="cl">         time_total:  0.867
</span></span></code></pre></td></tr></table>
</div>
</div><p>You can see that the time of each step of this request is printed out, and the unit of each number is seconds, so that you can analyze which step is more time-consuming, and it is convenient to locate the problem. The meaning of each parameter of this command.</p>
<ul>
<li><code>-w</code> : read the format of the information to be printed from the file</li>
<li><code>-o /dev/null</code> : discard the response, because we don&rsquo;t care about it here, only about the time consumption of the request</li>
<li><code>-s</code> : don&rsquo;t print the progress bar</li>
</ul>
<p>From this output, we can calculate the time for each step.</p>
<ul>
<li>DNS query: 12ms</li>
<li>TCP connection time: pretransfter(227) - namelookup(12) = 215ms</li>
<li>Server processing time: starttransfter(443) - pretransfer(227) = 216ms</li>
<li>Content transfer time: total(867) - starttransfer(443) = 424ms</li>
</ul>
<p>To a more complex, access to the home page of Baidu, with redirects and SSL protocols in between.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">➜  ~ curl -w <span class="s2">&#34;@curl-format.txt&#34;</span> -o /dev/null -s -L <span class="s2">&#34;https://baidu.com&#34;</span>
</span></span><span class="line"><span class="cl">    time_namelookup:  0.012
</span></span><span class="line"><span class="cl">       time_connect:  0.018
</span></span><span class="line"><span class="cl">    time_appconnect:  0.328
</span></span><span class="line"><span class="cl">      time_redirect:  0.356
</span></span><span class="line"><span class="cl">   time_pretransfer:  0.018
</span></span><span class="line"><span class="cl"> time_starttransfer:  0.027
</span></span><span class="line"><span class="cl">                    ----------
</span></span><span class="line"><span class="cl">         time_total:  0.384
</span></span></code></pre></td></tr></table>
</div>
</div><p>You can see that both <code>time_appconnect</code> and <code>time_redirect</code> are not 0 anymore, where the SSL protocol processing time is <code>328-18=310ms</code>. And the time for <code>pretransfer</code> and <code>starttransfer</code> have both been reduced, which is the time for requests after redirection.</p>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/curl/">curl</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2022-05/linux-lsof-primer/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Guide to using the linux lsof command</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2022-05/js-decorator/">
            <span class="next-text nav-default">JavaScript（ECMAScript） Decorator</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  <script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox-3.1.20.min.js"></script>



<script type="text/javascript" src="/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js"></script>








</body>
</html>
