<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Linux free command usage and understanding - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="Learn how to use the Linux free command and the meaning of each column of the command." /><meta name="keywords" content="linux, free" />






<meta name="generator" content="Hugo 0.96.0 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2022-05/linux-free/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link href="/lib/fancybox/jquery.fancybox-3.1.20.min.css" rel="stylesheet">


<meta property="og:title" content="Linux free command usage and understanding" />
<meta property="og:description" content="Learn how to use the Linux free command and the meaning of each column of the command." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2022-05/linux-free/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-05-31T19:12:01+08:00" />
<meta property="article:modified_time" content="2022-05-31T19:12:01+08:00" />

<meta itemprop="name" content="Linux free command usage and understanding">
<meta itemprop="description" content="Learn how to use the Linux free command and the meaning of each column of the command."><meta itemprop="datePublished" content="2022-05-31T19:12:01+08:00" />
<meta itemprop="dateModified" content="2022-05-31T19:12:01+08:00" />
<meta itemprop="wordCount" content="816">
<meta itemprop="keywords" content="linux," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Linux free command usage and understanding"/>
<meta name="twitter:description" content="Learn how to use the Linux free command and the meaning of each column of the command."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SOBYTE</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SOBYTE</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Linux free command usage and understanding</h1>

      <div class="post-meta">
        <span class="post-time"> 2022-05-31 19:12:01 </span>
        <div class="post-category">
            <a href="/categories/tutorials/"> tutorials </a>
            </div>
          <span class="more-meta"> 816 words </span>
          <span class="more-meta"> 4 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#1-basic-use-of-the-free-command">1. Basic use of the free command</a></li>
        <li><a href="#2-meaning-of-each-column-of-the-free-command">2. Meaning of each column of the free command</a></li>
        <li><a href="#3-should-i-focus-on-the-free-column-or-avaliable-for-available-memory">3. Should I focus on the free column or avaliable for available memory?</a></li>
        <li><a href="#4-conclusion">4. Conclusion</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>When using linux operating systems, it is a common requirement to check memory usage, for example, to analyze system health or to determine if the machine is ready to deploy more new services, etc. This is a common requirement.</p>
<p>The solution to this problem is also very simple. Most cloud vendors provide consoles that display monitoring information for various machine metrics, and memory usage monitoring is definitely essential. For those who know a little bit about linux, you can also use the free command to view more detailed information. When executing the free command, I wonder if you have the same confusion as I do.</p>
<ul>
<li>What do all the columns in the printout mean? How do these columns relate to each other?</li>
<li>Which indicator should I look at for memory availability, free or available?</li>
</ul>
<h2 id="1-basic-use-of-the-free-command">1. Basic use of the free command</h2>
<p>Basic use: free [options]</p>
<p>Common parameters:</p>
<ul>
<li><code>-h</code> human-readable format printing</li>
<li><code>-w</code> print cache &amp; buffer separately</li>
<li><code>-t</code> show total for RAM + swap</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ free -wth
</span></span><span class="line"><span class="cl">              total        used        free      shared     buffers       cache   available
</span></span><span class="line"><span class="cl">Mem:           125G        6.5G         87G        1.3G        3.5M         30G        116G
</span></span><span class="line"><span class="cl">Swap:            0B          0B          0B
</span></span><span class="line"><span class="cl">Total:         125G        6.5G         87G
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="2-meaning-of-each-column-of-the-free-command">2. Meaning of each column of the free command</h2>
<p>The free command prints information from <code>/proc/meminfo</code> (<strong>/proc is not a directory on the physical disk, but a virtual directory used to provide kernel information</strong>), and parses the contents of the file to show the usage of physical memory and Swap memory.</p>
<table>
<thead>
<tr>
<th>metrics</th>
<th>meaning</th>
<th>/proc/meminfo data source</th>
</tr>
</thead>
<tbody>
<tr>
<td>total</td>
<td>Total physical memory available, but not kernel &amp; OS memory usage</td>
<td>MemTotal</td>
</tr>
<tr>
<td>free</td>
<td>The amount of memory space that is not used</td>
<td>MemFree</td>
</tr>
<tr>
<td>buffers</td>
<td>the amount of space used for caching by the kernel</td>
<td>Buffers</td>
</tr>
<tr>
<td>cache</td>
<td>the amount of free memory used for process page cache and slabs (slab is used as OS cache)</td>
<td>Cached &amp; SReclaimable</td>
</tr>
<tr>
<td>used</td>
<td>calculated by other parameters</td>
<td>total - free - buffers - cache</td>
</tr>
<tr>
<td>shared</td>
<td>memory space used as tmpfs</td>
<td>Shmem</td>
</tr>
<tr>
<td>avaliable</td>
<td>predicted memory space available for starting a new application</td>
<td>MemAvailable</td>
</tr>
</tbody>
</table>
<h2 id="3-should-i-focus-on-the-free-column-or-avaliable-for-available-memory">3. Should I focus on the free column or avaliable for available memory?</h2>
<p><strong>To determine how much memory space is available for starting a new process, you need to pay attention to the avaliable value.</strong> The avaliable value is usually larger than the free value, because it adds some of the space occupied by cache &amp; buffer. However, it is smaller than free + cache + buffers.</p>
<p>The existence of cache is due to the need to improve performance in OS operation. In accordance with the locality principle, process memory pages that may be used in the future are cached, reducing the probability of a page-out interruption the next time that data is needed. Because every time a page-out interrupt occurs, the process needs to be put out, perform disk I/O to read the data, and then put the process into the ready state, which is a time-consuming operation. Not doing the necessary cache will result in frequent disk I/O, memory jitter, and ultimately low CPU usage.</p>
<p>The avaliable statistics do not include all cache &amp; buffer, because it is reasonable for the system to do some caching for good performance. From <a href="https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=34e431b0a">source</a>, the system calculates the available memory by subtracting <code>min(pagecache / 2, wmark _low)</code>, which is the minimum value between 1/2 the cache size and the minimum amount of free memory to be saved, which will not be counted as free memory. So that&rsquo;s why the true avaliable value is larger than free and smaller than free + cache + buffers.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="n">for_each_zone</span><span class="p">(</span><span class="n">zone</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="n">wmark_low</span> <span class="o">+=</span> <span class="n">zone</span><span class="o">-&gt;</span><span class="n">watermark</span><span class="p">[</span><span class="n">WMARK_LOW</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm">* Estimate the amount of memory available for userspace allocations,
</span></span></span><span class="line"><span class="cl"><span class="cm">* without causing swapping.
</span></span></span><span class="line"><span class="cl"><span class="cm">*
</span></span></span><span class="line"><span class="cl"><span class="cm">* Free memory cannot be taken below the low watermark, before the
</span></span></span><span class="line"><span class="cl"><span class="cm">* system starts swapping.
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="cl"><span class="n">available</span> <span class="o">=</span> <span class="n">i</span><span class="p">.</span><span class="n">freeram</span> <span class="o">-</span> <span class="n">wmark_low</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm">* Not all the page cache can be freed, otherwise the system will
</span></span></span><span class="line"><span class="cl"><span class="cm">* start swapping. Assume at least half of the page cache, or the
</span></span></span><span class="line"><span class="cl"><span class="cm">* low watermark worth of cache, needs to stay.
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="cl"><span class="n">pagecache</span> <span class="o">=</span> <span class="n">pages</span><span class="p">[</span><span class="n">LRU_ACTIVE_FILE</span><span class="p">]</span> <span class="o">+</span> <span class="n">pages</span><span class="p">[</span><span class="n">LRU_INACTIVE_FILE</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="n">pagecache</span> <span class="o">-=</span> <span class="n">min</span><span class="p">(</span><span class="n">pagecache</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">wmark_low</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">available</span> <span class="o">+=</span> <span class="n">pagecache</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm">* Part of the reclaimable swap consists of items that are in use,
</span></span></span><span class="line"><span class="cl"><span class="cm">* and cannot be freed. Cap this estimate at the low watermark.
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="cl"><span class="n">available</span> <span class="o">+=</span> <span class="n">global_page_state</span><span class="p">(</span><span class="n">NR_SLAB_RECLAIMABLE</span><span class="p">)</span> <span class="o">-</span>
</span></span><span class="line"><span class="cl">        <span class="n">min</span><span class="p">(</span><span class="n">global_page_state</span><span class="p">(</span><span class="n">NR_SLAB_RECLAIMABLE</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">wmark_low</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="n">available</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="n">available</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="4-conclusion">4. Conclusion</h2>
<p><code>free</code> is a common command when operating a linux system, and there is a certain threshold for understanding the intrinsic meaning of its various metrics. Memory management in operating systems is complex, and the essential problem is <strong>how to use the limited memory space to maximize the number of processes and reduce the rate of out-of-page interruptions</strong>.</p>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/linux/">linux</a>
          </div>
      <nav class="post-nav">
        
        <a class="next" href="/post/2022-05/go-progress-bar/">
            <span class="next-text nav-default">How to get upload progress bar related data and implement Graceful Shutdown</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  <script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox-3.1.20.min.js"></script>



<script type="text/javascript" src="/js/main.min.64437849d125a2d603b3e71d6de5225d641a32d17168a58106e0b61852079683.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
