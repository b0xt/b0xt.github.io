<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Accelerate Sagemaker AI model training with AWS EFS or FSx Lustre - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="Learn how to accelerate Sagemaker AI model training with AWS EFS or FSx Lustre." /><meta name="keywords" content="AWS EFS, FSx Lustre, Sagemaker AI" />






<meta name="generator" content="Hugo 0.96.0 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2022-05/speed-up-amazon-sagemaker-training-using-efs-or-fsx-lustre/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link href="/lib/fancybox/jquery.fancybox-3.1.20.min.css" rel="stylesheet">


<meta property="og:title" content="Accelerate Sagemaker AI model training with AWS EFS or FSx Lustre" />
<meta property="og:description" content="Learn how to accelerate Sagemaker AI model training with AWS EFS or FSx Lustre." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2022-05/speed-up-amazon-sagemaker-training-using-efs-or-fsx-lustre/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-05-30T12:36:58+08:00" />
<meta property="article:modified_time" content="2022-05-30T12:36:58+08:00" />

<meta itemprop="name" content="Accelerate Sagemaker AI model training with AWS EFS or FSx Lustre">
<meta itemprop="description" content="Learn how to accelerate Sagemaker AI model training with AWS EFS or FSx Lustre."><meta itemprop="datePublished" content="2022-05-30T12:36:58+08:00" />
<meta itemprop="dateModified" content="2022-05-30T12:36:58+08:00" />
<meta itemprop="wordCount" content="1322">
<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Accelerate Sagemaker AI model training with AWS EFS or FSx Lustre"/>
<meta name="twitter:description" content="Learn how to accelerate Sagemaker AI model training with AWS EFS or FSx Lustre."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SOBYTE</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SOBYTE</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Accelerate Sagemaker AI model training with AWS EFS or FSx Lustre</h1>

      <div class="post-meta">
        <span class="post-time"> 2022-05-30 12:36:58 </span>
        <div class="post-category">
            <a href="/categories/tutorials/"> tutorials </a>
            </div>
          <span class="more-meta"> 1322 words </span>
          <span class="more-meta"> 7 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#upload-process">Upload process</a></li>
        <li><a href="#file-problem">File Problem</a></li>
        <li><a href="#using-amazon-fsx-for-lustre">Using Amazon FSx for Lustre</a></li>
        <li><a href="#using-amazon-elastic-file-system">Using Amazon Elastic File System</a></li>
        <li><a href="#summary">Summary</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/05/30/f56e3219e8dc4089a3a094c723bfa8ce.png" alt="AI platform"></p>
<p>This article will introduce how to prepare the Dataset and integrate SageMaker before training AI models, and what problems and challenges are encountered in the process. The team provides an AI platform that allows users to upload their own Dataset to be used with the team&rsquo;s internal default Dataset for AI model training, and then make the model available to users for download. Simply put, users only need to provide the Dataset and set the AI training parameters, and then they can get the final model for subsequent integration development. Next, we explore the process of uploading Dataset by users.</p>
<h2 id="upload-process">Upload process</h2>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/05/30/14e2b6b6f8084016b62a1068f61f18be.png" alt="Upload process"></p>
<p>After getting the file, it needs to be converted to tfrecord format and then repackaged and uploaded to <a href="https://aws.amazon.com/tw/s3/">AWS S3</a> space. Once the upload is finished, S3 will send Push Event to <a href="https://aws.amazon.com/tw/sqs/">AWS SQS</a>, and then the backend will provide another service to receive the SQS message. Each time it gets the message, it will download the file for conversion, pack it and upload it back to S3, and send the process message back to the API service to notify the front-end.</p>
<h2 id="file-problem">File Problem</h2>
<p>Before we talk about the problem, let&rsquo;s take a look at the SageMaker training model process, and the Training Job process first:</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/05/30/15e44c99390b4b299776d9f9710931b7.png" alt="Training Job process"></p>
<p>You can see that the second step is <code>Downloading</code>, that is, every time the training process, you need to download from S3, so each training, you need to waste download time, and this time in SageMaker is counted in the training time, that is, the need to spend money, assuming that the file has a 100G, not only let the training model to increase a lot of time outside, but also It costs a lot of extra money.</p>
<p>In addition to the Dataset provided by the user, we also need to add our own <code>1TB</code> Dataset for training, so if we put the 1TB data on S3, it may take an hour from downloading to decompressing, so this solution through S3 is definitely not possible, wasting time and money. Therefore, we finally discussed with Taiwan AWS team to use <a href="https://aws.amazon.com/tw/fsx/lustre/?">AWS FSx for Lustre</a> solution.</p>
<h2 id="using-amazon-fsx-for-lustre">Using Amazon FSx for Lustre</h2>
<p>First of all, Lustre is a cloud network disk, its biggest advantage is that it can integrate with AWS S3, as long as S3 has added any files, Lustre will sync the files in at any time, but this is limited to one-way sync, that is <code>S3 -&gt; Lustre</code>, if you mount Lustre on EC2 and cut off any files, it will not sync to S3. This point needs to be noted very carefully.</p>
<p>Originally, the team thought that it would be good to synchronize S3 to Lustre, but the problem is that there is an AWS S3 Bucket with <code>ObjectCreated</code> bound to SQS, as in the following <a href="https://github.com/hashicorp/hcl">HCL syntax</a> example ( <a href="https://www.terraform.io/">Terraform</a>), but as long as you use S3 to sync to Lustre, you need to bind the same Event, which is not configurable at all, and will spray API errors, which means that the developer has to choose one or the other, which is actually quite strange. It is only right that AWS S3 should be able to send the same Event to different Targets, and because of this, the team cancelled the transfer of the user&rsquo;s Dataset to the Lustre disk.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">resource</span> <span class="s">&#34;aws_s3_bucket&#34;</span> <span class="s">&#34;tl_s3&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">bucket</span> <span class="p">=</span> <span class="s">&#34;tl-dataset&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">acl</span>    <span class="p">=</span> <span class="s">&#34;private&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">versioning</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">enabled</span> <span class="p">=</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">tags</span> <span class="p">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">Name</span>        <span class="p">=</span> <span class="s">&#34;tl s3&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">Project</span>     <span class="p">=</span> <span class="kd">var</span><span class="p">.</span><span class="nx">project_name</span>
</span></span><span class="line"><span class="cl">    <span class="nx">Environment</span> <span class="p">=</span> <span class="kd">var</span><span class="p">.</span><span class="nx">project_env</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">resource</span> <span class="s">&#34;aws_s3_bucket_notification&#34;</span> <span class="s">&#34;tl_bucket_notification&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">bucket</span> <span class="p">=</span> <span class="nx">aws_s3_bucket</span><span class="p">.</span><span class="nx">tl_s3</span><span class="p">.</span><span class="nx">id</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">queue</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">queue_arn</span>     <span class="p">=</span> <span class="nx">aws_sqs_queue</span><span class="p">.</span><span class="nx">tl_queue</span><span class="p">.</span><span class="nx">arn</span>
</span></span><span class="line"><span class="cl">    <span class="nx">events</span>        <span class="p">=</span> <span class="p">[</span><span class="s">&#34;s3:ObjectCreated:*&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="nx">filter_prefix</span> <span class="p">=</span> <span class="s">&#34;datasets/&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In the end, the team only put their own Dataset (800G) on Lustre. As a reminder, the low consumption of Lustre is <code>1.2TB</code>, so if the team only has a small amount of Dataset, they should not use Lustre.</p>
<h2 id="using-amazon-elastic-file-system">Using Amazon Elastic File System</h2>
<p>The above Lustre integration with SageMaker was quite successful, and the whole training model process was set up smoothly. However, since most of the customers are in China, we moved the entire Global AWS architecture to AWS China Beijing Region. However, during the build process, we received the following error message directly from the SageMaker API.</p>
<blockquote>
<p>FSx for Lustre is currently not supported in the region cn-north-1 for SageMaker</p>
</blockquote>
<p>I was really dumbfounded to see this message, so I opened AWS Web Console directly to see if there were any missing features, but it turned out that the File System feature was not available from the UI.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images1/2022/05/30/ad9d252e4bbc4ffda89086f2f0305003.png" alt="AWS Web Console"></p>
<p>We immediately checked with the AWS team to see if Lustre was supported, and the answer was that only EFS was supported, and the UI did not support EFS, but could only be connected through the API. The backend team immediately started to convert Lustre to EFS, and encountered some configuration issues during the conversion process, such as the following:</p>
<blockquote>
<p>ClientError: Unable to mount file system: fs-0337a79e, directory path: /efs/mtk. File system connection timed out. Please ensure that mount target IP address of file system is reachable and the security groups you associate with file system must allow inbound access on NFS port.</p>
</blockquote>
<p>EFS uses the <code>2049/TCP</code> port, so a new lower firewall needs to be added and set under the Security Group of EFS.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">resource</span> <span class="s">&#34;aws_security_group&#34;</span> <span class="s">&#34;efs&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">name</span>        <span class="p">=</span> <span class="s">&#34;allow_efs&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">description</span> <span class="p">=</span> <span class="s">&#34;Allow EFS inbound traffic&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">vpc_id</span>      <span class="p">=</span> <span class="nx">aws_vpc</span><span class="p">.</span><span class="nx">cai</span><span class="p">.</span><span class="nx">id</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">ingress</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">from_port</span>   <span class="p">=</span> <span class="mi">2049</span>
</span></span><span class="line"><span class="cl">    <span class="nx">to_port</span>     <span class="p">=</span> <span class="mi">2049</span>
</span></span><span class="line"><span class="cl">    <span class="nx">protocol</span>    <span class="p">=</span> <span class="s">&#34;tcp&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">cidr_blocks</span> <span class="p">=</span> <span class="p">[</span><span class="s">&#34;0.0.0.0/0&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="nx">description</span> <span class="p">=</span> <span class="s">&#34;allow nfs rule&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>After fixing the above network problem, I encountered the following problem:</p>
<blockquote>
<p>ClientError: Unable to mount file system: fs-0337a79e, directory path: /efs/mtk. No such file or directory: /efs/mtk.</p>
</blockquote>
<p>This is a relatively easy problem to solve. The reason is that Lustre itself provides a mount point in a specific location, like <code>/efs</code>, and EFS itself has a mount point preset at <code>/</code>, so you just need to reset it in the API.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">inputDataConfig</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="nx">inputDataConfig</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="o">&amp;</span><span class="nx">sagemaker</span><span class="p">.</span><span class="nx">Channel</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">ChannelName</span><span class="p">:</span> <span class="nx">aws</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="s">&#34;mtk&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="nx">DataSource</span><span class="p">:</span> <span class="o">&amp;</span><span class="nx">sagemaker</span><span class="p">.</span><span class="nx">DataSource</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">FileSystemDataSource</span><span class="p">:</span> <span class="o">&amp;</span><span class="nx">sagemaker</span><span class="p">.</span><span class="nx">FileSystemDataSource</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">DirectoryPath</span><span class="p">:</span>        <span class="nx">aws</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">FSX</span><span class="p">.</span><span class="nx">Path</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="nx">FileSystemAccessMode</span><span class="p">:</span> <span class="nx">aws</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="nx">sagemaker</span><span class="p">.</span><span class="nx">FileSystemAccessModeRo</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="nx">FileSystemId</span><span class="p">:</span>         <span class="nx">aws</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">FSX</span><span class="p">.</span><span class="nx">ID</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="nx">FileSystemType</span><span class="p">:</span>       <span class="nx">aws</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="nx">sagemaker</span><span class="p">.</span><span class="nx">FileSystemTypeFsxLustre</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>After fixing the above path problem, I encountered another network problem:</p>
<blockquote>
<p>ClientError: Data download failed:Please ensure that the subnet&rsquo;s route table has a route to an S3 VPC endpoint or a NAT device, and both the security groups and the subnet&rsquo;s network ACL allow outbound traffic to S3.</p>
</blockquote>
<p>The main factor for successful access is that this EC2 is in the <code>Public Subnet</code>, which has permission to access the Internet, and the Public Subnet mainly has route table with <a href="https://docs.aws.amazon.com/vpc/latest/userguide/VPC_Internet_Gateway.html">internet gateway</a> to access the Internet.</p>
<p>The reason for this problem is that the architecture is using <code>Private Subnet</code> and this Subnet cannot access the Internet, so we need to use S3 VPC endpoints to solve this problem. So you can access S3 files by setting S3 VPC Endpoint method.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">resource</span> <span class="s">&#34;aws_vpc_endpoint&#34;</span> <span class="s">&#34;s3&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">vpc_id</span>          <span class="p">=</span> <span class="nx">aws_vpc</span><span class="p">.</span><span class="nx">cai</span><span class="p">.</span><span class="nx">id</span>
</span></span><span class="line"><span class="cl">  <span class="nx">service_name</span>    <span class="p">=</span> <span class="s">&#34;com.amazonaws.cn-north-1.s3&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">route_table_ids</span> <span class="p">=</span> <span class="p">[</span><span class="nx">aws_route_table</span><span class="p">.</span><span class="nx">cai</span><span class="p">.</span><span class="nx">id</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="summary">Summary</h2>
<p>A key conclusion here is that if the team really wants to build in AWS China, they need to test Gloabl AWS and also go to China to see if the same features are available or else the whole process will be modified quite a bit. The good thing is that we only encountered AWS Lustre switching to AWS EFS this time.</p>
<p>In addition, when setting up the whole AWS environment, we need to have a certain concept of network, and firewall, the team is very strict for the privilege part, the privilege that is not useful is pulled out, or the privilege on the IAM is opened slowly, not all at once.</p>

    </div>

    
<footer class="post-footer">
      
      <nav class="post-nav">
        <a class="prev" href="/post/2022-05/drone-license/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Is the open source Drone CI/CD platform really free?</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2022-05/supervisord/">
            <span class="next-text nav-default">Manage system programs with Supervisor</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  <script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox-3.1.20.min.js"></script>



<script type="text/javascript" src="/js/main.min.64437849d125a2d603b3e71d6de5225d641a32d17168a58106e0b61852079683.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
