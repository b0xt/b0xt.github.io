<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Writing high-quality Python code - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="Learn how to write high-quality Python code." /><meta name="keywords" content="python, high quality code" />






<meta name="generator" content="Hugo 0.101.0 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2022-05/writing-high-quality-python/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link href="/lib/fancybox/jquery.fancybox-3.1.20.min.css" rel="stylesheet">


<meta property="og:title" content="Writing high-quality Python code" />
<meta property="og:description" content="Learn how to write high-quality Python code." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2022-05/writing-high-quality-python/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-05-15T10:56:58+08:00" />
<meta property="article:modified_time" content="2022-05-15T10:56:58+08:00" />

<meta itemprop="name" content="Writing high-quality Python code">
<meta itemprop="description" content="Learn how to write high-quality Python code."><meta itemprop="datePublished" content="2022-05-15T10:56:58+08:00" />
<meta itemprop="dateModified" content="2022-05-15T10:56:58+08:00" />
<meta itemprop="wordCount" content="15454">
<meta itemprop="keywords" content="python," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Writing high-quality Python code"/>
<meta name="twitter:description" content="Learn how to write high-quality Python code."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SOBYTE</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SOBYTE</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Writing high-quality Python code</h1>

      <div class="post-meta">
        <span class="post-time"> 2022-05-15 10:56:58 </span>
        <div class="post-category">
            <a href="/categories/tutorials/"> tutorials </a>
            </div>
          <span class="more-meta"> 15454 words </span>
          <span class="more-meta"> 31 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#developing-a-pythonic-mindset">Developing a Pythonic mindset</a>
          <ul>
            <li><a href="#1-look-up-the-version-of-python-youre-using">1. Look up the version of Python you&rsquo;re using</a></li>
            <li><a href="#2-follow-the-pep-8-style-guide">2. Follow the PEP 8 Style Guide</a></li>
            <li><a href="#3-understanding-the-difference-between-bytes-and-str">3. Understanding the difference between bytes and str</a></li>
            <li><a href="#4-replacing-c-style-format-strings-with-interpolation-enabled-f-strings-and-strformat-methods">4. Replacing C-style format strings with interpolation-enabled f-strings and str.format methods</a></li>
            <li><a href="#5-replacing-complex-expressions-with-helper-functions">5. Replacing Complex Expressions with Helper Functions</a></li>
            <li><a href="#7-replace-range-with-enumerate-whenever-possible">7. Replace range with enumerate whenever possible</a></li>
            <li><a href="#8-iterating-over-two-iterators-at-once-with-the-zip-function">8. Iterating over two iterators at once with the zip function</a></li>
            <li><a href="#9-dont-write-else-blocks-after-for-and-while-loops">9. Don&rsquo;t write else blocks after for and while loops</a></li>
            <li><a href="#10-reducing-code-repetition-with-assignment-expressions">10. Reducing Code Repetition with Assignment Expressions</a></li>
          </ul>
        </li>
        <li><a href="#lists-and-dictionaries">Lists and dictionaries</a>
          <ul>
            <li><a href="#11-learning-to-slice-sequences">11. Learning to Slice Sequences</a></li>
            <li><a href="#12-dont-specify-both-a-startend-subscript-and-a-step-in-a-slice">12. Don&rsquo;t specify both a start/end subscript and a step in a slice</a></li>
            <li><a href="#13-capture-multiple-elements-by-unpacking-with-an-asterisk-not-slicing">13. Capture multiple elements by unpacking with an asterisk, not slicing</a></li>
            <li><a href="#14-representing-complex-sorting-logic-with-the-key-argument-of-the-sort-method">14. Representing complex sorting logic with the key argument of the sort method</a></li>
            <li><a href="#15-dont-rely-too-much-on-the-order-you-use-when-adding-entries-to-a-dictionary">15. Don&rsquo;t rely too much on the order you use when adding entries to a dictionary</a></li>
            <li><a href="#key-points">Key points</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <h2 id="developing-a-pythonic-mindset">Developing a Pythonic mindset</h2>
<h3 id="1-look-up-the-version-of-python-youre-using">1. Look up the version of Python you&rsquo;re using</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ python --version
</span></span><span class="line"><span class="cl">$ python -V
</span></span><span class="line"><span class="cl">$ python3 --version
</span></span><span class="line"><span class="cl">$ python3 -V
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">&gt;&gt;&gt; import sys
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; print<span class="o">(</span>sys.version_info<span class="o">)</span>
</span></span><span class="line"><span class="cl">sys.version_info<span class="o">(</span><span class="nv">major</span><span class="o">=</span>3, <span class="nv">minor</span><span class="o">=</span>6, <span class="nv">micro</span><span class="o">=</span>15, <span class="nv">releaselevel</span><span class="o">=</span><span class="s1">&#39;final&#39;</span>, <span class="nv">serial</span><span class="o">=</span>0<span class="o">)</span>
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; print<span class="o">(</span>sys.version<span class="o">)</span>
</span></span><span class="line"><span class="cl">3.6.15 <span class="o">(</span>default, Apr <span class="m">20</span> 2022, 13:05:41<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>GCC 5.4.0 20160609<span class="o">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Python 2 retires on January 1, 2020, at which point all bug fixes, security patches, and backward porting of features will cease. After that, if you stick with Python 2, you&rsquo;ll face a lot of disadvantages because it won&rsquo;t be officially maintained anymore. Developers who rely heavily on the Python 2 codebase might consider transitioning to Python 3 with tools like 2to3 (Python&rsquo;s pre-installed tools) and <a href="https://six.readthedocs.io/">six</a>.</p>
<h3 id="2-follow-the-pep-8-style-guide">2. Follow the PEP 8 Style Guide</h3>
<h4 id="whitespace-related-advice">Whitespace-related advice</h4>
<p>Whitespace is syntactically important in Python, and Python programmers are particularly concerned about the use of whitespace characters, as they can affect the clarity of code. Here are a few suggestions to follow in this regard.</p>
<ul>
<li>Indent with spaces (spaces), not tabs (tabs).</li>
<li>Use 4 spaces for each level of indentation related to syntax.</li>
<li>No more than 79 characters per line.</li>
<li>For long expressions that occupy multiple lines, all but the first line should be indented with 4 spaces above the usual indentation level.</li>
<li>In the same document, functions are separated from classes by two blank lines.</li>
<li>Within the same class, methods are separated from each other by a single blank line.</li>
<li>When using dictionaries, no space is added between keys and colons, and a space should be added between colons and values written on the same line.</li>
<li>When assigning a value to a variable, one space to the left and one to the right of the assignment symbol, and just one space.</li>
<li>When annotating the type of a variable (annotation), do not separate the variable name from the colon, but there should be a space before the type information.</li>
</ul>
<h4 id="naming-related-suggestions">Naming-related suggestions</h4>
<p>PEP 8 recommends a different approach to naming parts of Python code, so that when reading the code, you can see their roles in the Python language based on those names. Follow these naming-related recommendations.</p>
<ul>
<li>Functions, variables, and properties are spelled with lowercase letters, and words are linked by underscores, for example: <code>lowercase_underscore</code>.</li>
<li>Protected instance properties, start with an underscore, e.g. <code>_leading_underscore</code> .</li>
<li>Private instance attributes that begin with two underscores, e.g., <code>__double_leading_underscore</code> .</li>
<li>Classes (including exceptions) are named with the first letter of each word capitalized, e.g., CapitalizedWord.</li>
<li>Constants at the module level, all letters are capitalized and words are linked by underscores, e.g. <code>ALL_CAPS</code> .</li>
<li>The first parameter of an instance method in a class should be named self, to indicate the object itself.</li>
<li>The first argument of a class method should be named cls, which is used to represent the class itself.</li>
</ul>
<h4 id="suggestions-related-to-expressions-and-statements">Suggestions related to expressions and statements</h4>
<p>The Zen of Python says that <code>everything should be done simply, and preferably only one way.</code> PEP 8 tries to apply this idea to the way expressions and statements are written.</p>
<ul>
<li>Use in-line negation, i.e., write the negation directly in front of what is to be negated, not in front of the entire expression; for example, you should write <code>if a is not b</code>, not <code>if not a is b</code>.</li>
<li>Do not determine whether a container or sequence is empty by its length, for example, do not determine whether somelist is empty by <code>if len(somelist) == 0</code>, but instead should be written like <code>if not somelist</code>, because Python automatically evaluates null values to False.</li>
<li>If you want to determine whether a container or sequence has contents inside it (for example, to determine whether somelist is a non-null value like <code>[1]</code> or <code>'hi'</code>), you should also not judge by length, but instead use an <code>if somelist</code> statement, because Python automatically evaluates non-null values as True.</li>
<li>Don&rsquo;t cram if statements, for loops, while loops, and except compound statements onto one line. It&rsquo;s clearer to break them up into multiple lines.</li>
<li>If an expression does not fit on one line, enclose it in parentheses, and add line breaks and indents as appropriate for readability. Multi-line expressions should be enclosed in parentheses and not continued with the <code>\</code> symbol.</li>
</ul>
<h4 id="suggestions-related-to-importing">Suggestions related to importing</h4>
<p>PEP 8 gives the following advice on how to introduce and use modules in your code.</p>
<ul>
<li>The import statement (with <code>from x import y</code>) should always be placed at the beginning of the file.</li>
<li>When introducing modules, you should always use absolute names, not relative names based on the current module path. For example, to introduce the foo module in the bar package, you should write <code>from bar import foo</code> in its entirety, even if the current path is in the bar package, and not abbreviate it to <code>import foo</code>.</li>
<li>If you must write the import statement with a relative name, it should be written explicitly as <code>from . import foo</code>. The import statement in the file should be divided into three parts in order: first into modules from the standard library, then into third-party modules, and finally into your own modules. The import statements belonging to the same section are listed in alphabetical order.</li>
</ul>
<h3 id="3-understanding-the-difference-between-bytes-and-str">3. Understanding the difference between bytes and str</h3>
<p>Python has two types for representing sequences of characters: bytes and str.</p>
<p>The bytes instance contains raw data, which is an 8-bit unsigned value (usually displayed according to the ASCII encoding standard).</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">a</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;h</span><span class="se">\x65</span><span class="s1">llo&#39;</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="mi">104</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span> <span class="mi">111</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="sa">b</span><span class="s1">&#39;hello&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The str instance contains Unicode code points (also called code points) that correspond to text characters in human languages.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">a</span> <span class="o">=</span> <span class="s1">&#39;a</span><span class="se">\u0300</span><span class="s1"> propos&#39;</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;̀&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span><span class="err">̀</span> <span class="n">propos</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The two different character types correspond to two common use cases in Python.</p>
<ul>
<li>Developers need to manipulate raw 8-bit sequences of values, and those 8-bit values inside the sequences together represent a string that should be encoded in UTF-8 or some other standard encoding.</li>
<li>Developers need to manipulate generic Unicode strings, not strings of a particular encoding.</li>
</ul>
<p>We usually need to write two helper functions to convert between these two cases to ensure that the input value type matches the developer&rsquo;s expected form.</p>
<p>The first helper function accepts bytes or str instances and returns str.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">to_str</span><span class="p">(</span><span class="n">bytes_or_str</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bytes_or_str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">value</span> <span class="o">=</span> <span class="n">bytes_or_str</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">value</span> <span class="o">=</span> <span class="n">bytes_or_str</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">value</span> <span class="c1"># Instance of str</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">to_str</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;foo&#39;</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">to_str</span><span class="p">(</span><span class="s1">&#39;bar&#39;</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="s1">&#39;foo&#39;</span>
</span></span><span class="line"><span class="cl"><span class="s1">&#39;bar&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The second helper function also accepts bytes or str instances, but it returns bytes.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">to_bytes</span><span class="p">(</span><span class="n">bytes_or_str</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bytes_or_str</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">value</span> <span class="o">=</span> <span class="n">bytes_or_str</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">value</span> <span class="o">=</span> <span class="n">bytes_or_str</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">value</span> <span class="c1"># Instance of bytes</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">to_bytes</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;foo&#39;</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">to_bytes</span><span class="p">(</span><span class="s1">&#39;bar&#39;</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="sa">b</span><span class="s1">&#39;foo&#39;</span>
</span></span><span class="line"><span class="cl"><span class="sa">b</span><span class="s1">&#39;bar&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>There are two issues to be aware of when using raw 8-bit values with Unicode strings in Python.</p>
<p>The first issue is that the two types, bytes and str, seem to work in the same way, but their instances are not mutually compatible, so their types must be taken into account when passing sequences of characters.</p>
<p>Bytes can be added to bytes with the + operator, and str can do the same.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;one&#39;</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;two&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;one&#39;</span> <span class="o">+</span> <span class="s1">&#39;two&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="sa">b</span><span class="s1">&#39;onetwo&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">onetwo</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>But you cannot add str instances to bytes instances.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="sa">b</span><span class="s1">&#39;one&#39;</span> <span class="o">+</span> <span class="s1">&#39;two&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">Traceback</span> <span class="o">...</span>
</span></span><span class="line"><span class="cl"><span class="ne">TypeError</span><span class="p">:</span> <span class="n">can</span><span class="s1">&#39;t concat str to bytes</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>It is also not possible to add bytes instances to str instances.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="s1">&#39;one&#39;</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;two&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">Traceback</span> <span class="o">...</span>
</span></span><span class="line"><span class="cl"><span class="ne">TypeError</span><span class="p">:</span> <span class="n">can</span> <span class="n">only</span> <span class="n">concatenate</span> <span class="nb">str</span> <span class="p">(</span><span class="ow">not</span> <span class="s2">&#34;bytes&#34;</span><span class="p">)</span> <span class="n">to</span> <span class="nb">str</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The binary operator can be used to compare the size between bytes and bytes, and between str and str.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="k">assert</span> <span class="sa">b</span><span class="s1">&#39;red&#39;</span> <span class="o">&gt;</span> <span class="sa">b</span><span class="s1">&#39;blue&#39;</span>
</span></span><span class="line"><span class="cl"><span class="k">assert</span> <span class="s1">&#39;red&#39;</span> <span class="o">&gt;</span> <span class="s1">&#39;blue&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>However, str instances cannot be compared with bytes instances.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="k">assert</span> <span class="s1">&#39;red&#39;</span> <span class="o">&gt;</span> <span class="sa">b</span><span class="s1">&#39;blue&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">Traceback</span> <span class="o">...</span>
</span></span><span class="line"><span class="cl"><span class="ne">TypeError</span><span class="p">:</span> <span class="s1">&#39;&gt;&#39;</span> <span class="ow">not</span> <span class="n">supported</span> <span class="n">between</span> <span class="n">instances</span> <span class="n">of</span> <span class="s1">&#39;str&#39;</span> <span class="ow">and</span> <span class="s1">&#39;bytes&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The reverse is also true, i.e. bytes instances cannot be compared with str instances.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="k">assert</span> <span class="sa">b</span><span class="s1">&#39;blue&#39;</span> <span class="o">&lt;</span> <span class="s1">&#39;red&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">Traceback</span> <span class="o">...</span>
</span></span><span class="line"><span class="cl"><span class="ne">TypeError</span><span class="p">:</span> <span class="s1">&#39;&lt;&#39;</span> <span class="ow">not</span> <span class="n">supported</span> <span class="n">between</span> <span class="n">instances</span> <span class="n">of</span> <span class="s1">&#39;bytes&#39;</span> <span class="ow">and</span> <span class="s1">&#39;str&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Determining whether bytes and str instances are equal always evaluates to False, even if the two instances represent the exact same character, they are not equal. For example, in the following example, they both represent strings that are equivalent to foo in ASCII encoding.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;foo&#39;</span> <span class="o">==</span> <span class="s1">&#39;foo&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="kc">False</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Instances of both types can appear to the right of the % operator, replacing the %s in the format string on the left.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;red </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="sa">b</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;red </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="s1">&#39;blue&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="sa">b</span><span class="s1">&#39;red blue&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">red</span> <span class="n">blue</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>If the format string is of type bytes, you can&rsquo;t replace the %s with an instance of str, because Python doesn&rsquo;t know what scheme the str should be encoded in.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;red </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="s1">&#39;blue&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">Traceback</span> <span class="o">...</span>
</span></span><span class="line"><span class="cl"><span class="ne">TypeError</span><span class="p">:</span> <span class="o">%</span><span class="n">b</span> <span class="n">requires</span> <span class="n">a</span> <span class="nb">bytes</span><span class="o">-</span><span class="n">like</span> <span class="nb">object</span><span class="p">,</span> <span class="ow">or</span> <span class="n">an</span> <span class="nb">object</span> <span class="n">that</span> <span class="n">implements</span> <span class="n">_bytes_</span><span class="p">,</span> <span class="ow">not</span> <span class="s1">&#39;str&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>But the opposite is possible, that is, if the format string is of type str, you can replace the %s in it with an instance of bytes, the problem is that this may not be the result you want.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;red </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="sa">b</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">red</span> <span class="sa">b</span><span class="s1">&#39;blue&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Doing so causes the system to call the <code>__repr__</code> method on top of the bytes instance (see clause 75) and then replace the %s in the format string with the result of that call, so the program outputs <code>b'blue'</code> directly instead of blue itself, as you might expect.</p>
<p>The second problem occurs when manipulating file handles, in this case the handles returned by the built-in open function. Such handles require Unicode string manipulation by default, rather than raw bytes, and developers used to Python 2 are particularly likely to run into this problem, which can lead to strange errors in their programs. For example, when writing binary data to a file, this is actually the wrong way to write it.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;data.bin&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">   <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\xf1\xf2\xf3\xf4\xf5</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">Traceback</span> <span class="o">...</span>
</span></span><span class="line"><span class="cl"><span class="ne">TypeError</span><span class="p">:</span> <span class="n">write</span><span class="p">()</span> <span class="n">argument</span> <span class="n">must</span> <span class="n">be</span> <span class="nb">str</span><span class="p">,</span> <span class="ow">not</span> <span class="nb">bytes</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The exception occurred because when the open function was called, the <code>'w'</code> mode was specified, so the system requires that it be written in text mode. If you wanted to use binary mode, you would have specified <code>'wb'</code>. In text mode, the write method accepts str instances that contain Unicode data, not bytes instances that contain binary data. So, we have to change the mode to <code>'wb'</code> to solve the problem.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;data.bin&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">   <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\xf1\xf2\xf3\xf4\xf5</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>There is a similar problem when reading files. For example, if you want to read out the binary file you just wrote, then you can&rsquo;t use the following write method, you need to change it to <code>'rb'</code> as well.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;data.bin&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">   <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">Traceback</span> <span class="o">...</span>
</span></span><span class="line"><span class="cl"><span class="ne">UnicodeDecodeError</span><span class="p">:</span> <span class="s1">&#39;utf-8&#39;</span> <span class="n">codec</span> <span class="n">can</span><span class="s1">&#39;t decode byte 0xf1 in position 0: invalid continuation byte</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Another alternative is to explicitly specify the encoding standard in the encoding parameter when calling the open function to ensure that platform-specific behavior does not interfere with the code&rsquo;s performance. For example, if the binary data you just wrote to the file represents a string encoded using the &lsquo;cp1252&rsquo; standard (cp1252 is an old Windows encoding scheme), you could write it like this</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;data.bin&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;cp1252&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">   <span class="n">data</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">assert</span> <span class="n">data</span> <span class="o">==</span> <span class="s1">&#39;ioooδ&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>This way the program won&rsquo;t throw an exception, but the returned string is also very different from what would be returned by reading the raw byte data. With this example, we want to remind ourselves of the current default encoding standard of the operating system (which can be seen by running the command <code>python3 -c 'import locale; print(locale.getpreferredencoding())</code>) to see if it matches what you expect. If you&rsquo;re not sure, then explicitly specify the encoding argument when you call open.</p>
<h3 id="4-replacing-c-style-format-strings-with-interpolation-enabled-f-strings-and-strformat-methods">4. Replacing C-style format strings with interpolation-enabled f-strings and str.format methods</h3>
<p>The most common way to format strings in Python is with the % formatting operator.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">a</span> <span class="o">=</span> <span class="mb">0b10111011</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span> <span class="o">=</span> <span class="mh">0xc5f</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Binary is </span><span class="si">%d</span><span class="s1">, hex is </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">Binary</span> <span class="ow">is</span> <span class="mi">187</span><span class="p">,</span> <span class="nb">hex</span> <span class="ow">is</span> <span class="mi">3167</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>C-style format strings, however, have four disadvantages in Python.</p>
<ol>
<li>
<p>If the value inside that tuple to the right of % changes in type or order, then the program may get an error because of an incompatibility problem when converting types. For example, the following simple formatting expression is correct.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;my_var&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">value</span> <span class="o">=</span> <span class="mf">1.234</span>
</span></span><span class="line"><span class="cl"><span class="n">formatted</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%-10s</span><span class="s1"> = </span><span class="si">%.2f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">formatted</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">my_var</span>     <span class="o">=</span> <span class="mf">1.23</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>However, if the key and value are swapped, the program will throw an exception at runtime.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">reordered_tuple</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%-10s</span><span class="s1"> = </span><span class="si">%.2f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">Traceback</span> <span class="o">...</span>
</span></span><span class="line"><span class="cl"><span class="ne">TypeError</span><span class="p">:</span> <span class="n">must</span> <span class="n">be</span> <span class="n">real</span> <span class="n">number</span><span class="p">,</span> <span class="ow">not</span> <span class="nb">str</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>This error also occurs if the right side of % is written the same way, but the two specifiers in the format string on the left side are reversed in order.</p>
</li>
<li>
<p>It is often necessary to do something with the value before filling in the template, but then the whole expression may be written in a long and confusing way. The code below is used to list the various ingredients in the kitchen, and the way it is written now does not pre-adjust the three values that are filled into the format string (i.e., the ingredient number i, the ingredient name item, and the ingredient quantity count).</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">pantry</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="s1">&#39;avocados&#39;</span><span class="p">,</span> <span class="mf">1.25</span><span class="p">),</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="s1">&#39;bananas&#39;</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">),</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="s1">&#39;cherries&#39;</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pantry</span><span class="p">):</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;#</span><span class="si">%d</span><span class="s1">: </span><span class="si">%-10s</span><span class="s1"> = </span><span class="si">%.2f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">count</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="c1">#0: avocados   = 1.25</span>
</span></span><span class="line"><span class="cl"><span class="c1">#1: bananas    = 2.50</span>
</span></span><span class="line"><span class="cl"><span class="c1">#2: cherries   = 15.00</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>If you want to make the printed information more understandable, you may have to adjust the values a bit, but after that, the ternary to the right of the % operator is particularly long, so you need to split it over multiple lines to make it fit, which affects the readability of the program.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">pantry</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="s1">&#39;avocados&#39;</span><span class="p">,</span> <span class="mf">1.25</span><span class="p">),</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="s1">&#39;bananas&#39;</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">),</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="s1">&#39;cherries&#39;</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pantry</span><span class="p">):</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;#</span><span class="si">%d</span><span class="s1">: </span><span class="si">%-10s</span><span class="s1"> = </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">item</span><span class="o">.</span><span class="n">title</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">    <span class="nb">round</span><span class="p">(</span><span class="n">count</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="c1">#1: Avocados   = 1</span>
</span></span><span class="line"><span class="cl"><span class="c1">#2: Bananas    = 2</span>
</span></span><span class="line"><span class="cl"><span class="c1">#3: Cherries   = 15</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>If you want to fill multiple positions in the format string with the same value, you must repeat the value multiple times in the tuple to the right of the % operator accordingly.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">template</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> loves food. See </span><span class="si">%s</span><span class="s1"> cook.&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Max&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">formatted</span> <span class="o">=</span> <span class="n">template</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">formatted</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">Max</span> <span class="n">loves</span> <span class="n">food</span><span class="o">.</span> <span class="n">See</span> <span class="n">Max</span> <span class="n">cook</span><span class="o">.</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>This is especially annoying and error-prone if you want to change the value before filling it, but you have to change multiple things at once. For example, if you want to fill in name.title() instead of name, then you have to remind yourself to change all the names to name.title(). If something is changed and something is not changed, the output may not be consistent.</p>
<p>To solve some of the problems mentioned above, Python&rsquo;s % operator allows us to replace the tuple with a dict, so that we can have the format string specifiers correspond to the keys in the dict by their corresponding names, e.g., the %(key)s specifier means that the string (s) represents the value held by the key named key in the dict. The %(key)s descriptor is a string (s) representing the value of the key named key in the dict. The first disadvantage of this approach is the mismatch in the order of the % operator.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;my_var&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">value</span> <span class="o">=</span> <span class="mf">1.234</span>
</span></span><span class="line"><span class="cl"><span class="n">old_way</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%-10s</span><span class="s1"> = </span><span class="si">%.2f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">new_way</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%(key)-10s</span><span class="s1"> = </span><span class="si">%(value).2f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">value</span><span class="p">}</span>  <span class="c1"># Original</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">reordered</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%(key)-10s</span><span class="s1"> = </span><span class="si">%(value).2f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">value</span><span class="p">,</span> <span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="n">key</span><span class="p">}</span>  <span class="c1"># Swapped</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">assert</span> <span class="n">old_way</span> <span class="o">==</span> <span class="n">new_way</span> <span class="o">==</span> <span class="n">reordered</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>This way of writing also solves the third drawback mentioned earlier, which is the problem of replacing multiple formatting specifiers with the same value. By writing it this way, we don&rsquo;t have to repeat the value to the right of the % operator.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Max&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">template</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> loves food .See </span><span class="si">%s</span><span class="s1"> cook.&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">before</span> <span class="o">=</span> <span class="n">template</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>  <span class="c1"># Tuple</span>
</span></span><span class="line"><span class="cl"><span class="n">template</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%(name)s</span><span class="s1"> loves food .See </span><span class="si">%(name)s</span><span class="s1"> cook.&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">after</span> <span class="o">=</span> <span class="n">template</span> <span class="o">%</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">}</span>  <span class="c1"># Dictionary</span>
</span></span><span class="line"><span class="cl"><span class="k">assert</span> <span class="n">before</span> <span class="o">==</span> <span class="n">after</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>However, this way of writing makes the second disadvantage just mentioned even worse, because with the introduction of dictionary formatted strings, we have to define key names for each value and add a colon to the right of the key name, and formatting expressions becomes even more lengthy and confusing looking. We can realize the disadvantages of this writing method more clearly by comparing the writing method without dict with the writing method with dict.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">pantry</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="s1">&#39;avocados&#39;</span><span class="p">,</span> <span class="mf">1.25</span><span class="p">),</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="s1">&#39;bananas&#39;</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">),</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="s1">&#39;cherries&#39;</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pantry</span><span class="p">):</span>
</span></span><span class="line"><span class="cl"><span class="n">before</span> <span class="o">=</span> <span class="s1">&#39;#</span><span class="si">%d</span><span class="s1">: </span><span class="si">%-10s</span><span class="s1"> = </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">item</span><span class="o">.</span><span class="n">title</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">    <span class="nb">round</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">after</span> <span class="o">=</span> <span class="s1">&#39;#</span><span class="si">%(loop)d</span><span class="s1">: </span><span class="si">%(item)-10s</span><span class="s1"> = </span><span class="si">%(count)d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;loop&#39;</span><span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;item&#39;</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">title</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;count&#39;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">count</span><span class="p">),</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">assert</span> <span class="n">before</span> <span class="o">==</span> <span class="n">after</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>Writing a dict inside a formatted expression makes the code more. Each key would have to be written at least twice: once in the formatting specifier and once as a key in the dictionary. In addition, when defining the dictionary, a variable might have to be dedicated to the value corresponding to the key, and the variable might also have the same name as the key name, so that&rsquo;s three times.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">soup</span> <span class="o">=</span> <span class="s1">&#39;lentil&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">formatted</span> <span class="o">=</span> <span class="s1">&#39;Today</span><span class="se">\&#39;</span><span class="s1">s soup is </span><span class="si">%(soup)s</span><span class="s1">.&#39;</span> <span class="o">%</span> <span class="p">{</span><span class="s1">&#39;soup&#39;</span><span class="p">:</span> <span class="n">soup</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">formatted</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">Today</span><span class="s1">&#39;s soup is lentil.</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In addition to writing the key names repeatedly, the use of dict in formatted expressions makes the expressions particularly long and usually has to be split into multiple lines, and in order to correspond to the multi-line formatting of the formatted strings, the dictionaries are defined by setting the corresponding values for each key line by line.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">menu</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="s1">&#39;soup&#39;</span><span class="p">:</span> <span class="s1">&#39;lentil&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="s1">&#39;oyster&#39;</span><span class="p">:</span> <span class="s1">&#39;kumamoto&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="s1">&#39;special&#39;</span><span class="p">:</span> <span class="s1">&#39;schnitzel&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">template</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Today</span><span class="se">\&#39;</span><span class="s1">s soup is </span><span class="si">%(soup)s</span><span class="s1">, &#39;</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;buy one get two </span><span class="si">%(oyster)s</span><span class="s1"> oysters, &#39;</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;and our special entree is </span><span class="si">%(special)s</span><span class="s1">.&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">formatted</span> <span class="o">=</span> <span class="n">template</span> <span class="o">%</span> <span class="n">menu</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">formatted</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">Today</span><span class="s1">&#39;s soup is lentil, buy one get two kumamoto oysters, and our special entree is schnitzel.</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>To see which key in the format string corresponds to which key in the dictionary, you have to jump back and forth between the two pieces of code, which can make it difficult to find bugs, and if you want to make minor changes to the key name, you have to change the format string descriptor at the same time, which makes the code even more cumbersome and less readable.</p>
</li>
</ol>
<h4 id="the-built-in-format-function-and-the-str-classs-format-method">The built-in format function and the str class&rsquo;s format method</h4>
<p>Python 3 adds advanced string formatting, which is more expressive than old C-style format strings, and no longer uses the % operator.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">a</span> <span class="o">=</span> <span class="mf">1234.5678</span>
</span></span><span class="line"><span class="cl"><span class="n">formatted</span> <span class="o">=</span> <span class="nb">format</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="s1">&#39;,.2f&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">formatted</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span> <span class="o">=</span> <span class="s1">&#39;my string&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">formatted</span> <span class="o">=</span> <span class="nb">format</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="s1">&#39;^20s&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">formatted</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span><span class="p">,</span><span class="mf">234.57</span>
</span></span><span class="line"><span class="cl"><span class="o">*</span>      <span class="n">my</span> <span class="n">string</span>       <span class="o">*</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;my_var&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">value</span> <span class="o">=</span> <span class="mf">1.234</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">formatted</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">formatted</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">my_var</span> <span class="o">=</span> <span class="mf">1.234</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>You can write a colon in {}, and then write the format specifier to the right of the colon to specify how the value received by the format method should be formatted. Type help(&lsquo;FORMATTING&rsquo;) in the Python interpreter to see the rules that underlie this set of format specifiers used by str.format in detail.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;my_var&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">value</span> <span class="o">=</span> <span class="mf">1.234</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">formatted</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:&lt;10}</span><span class="s1"> = </span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">formatted</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">my_var</span>     <span class="o">=</span> <span class="mf">1.23</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Procedure: The system first passes each value received by str.format to the built-in format function, and finds the {} corresponding to the value in the string, and also passes the format written inside the {} to the format function, for example, when the system is processing value, it passes format(value, &lsquo;. 2f&rsquo;). The result returned by the format function is then written in the location of the entire formatted string {}. In addition, each class can be customized with a special method, <code>__format__</code>, so that the format function will follow this logic when converting instances of that class to strings.</p>
<p>C-style format strings use the % operator to guide the format specifier, so if you want to output the symbol as is, you must escape it, i.e., write two %s in a row.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%.2f%%</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="mf">12.5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> replaces {{}}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mf">1.23</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="mf">12.50</span><span class="o">%</span>
</span></span><span class="line"><span class="cl"><span class="mf">1.23</span> <span class="n">replaces</span> <span class="p">{}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>When calling the str.format method, you can also write a number to the {} of str to refer to the position index of the parameter value received by the format method at that position. Later, even if the order of these {}&rsquo;s in the format string changes, you don&rsquo;t have to swap the arguments passed to the format method. Thus, this avoids the order problem mentioned in the first drawback mentioned earlier.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;my_var&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">value</span> <span class="o">=</span> <span class="mf">1.234</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">formatted</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{1}</span><span class="s1"> = </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">formatted</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="mf">1.234</span> <span class="o">=</span> <span class="n">my_var</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The same position index can appear in multiple {}&rsquo;s of str, all of which refer to the value received by the format method at the corresponding position. This eliminates the need to repeatedly pass the value to the format method, thus solving the third drawback mentioned earlier.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Max&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">formatted</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> loves food. See </span><span class="si">{0}</span><span class="s1"> cook.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">formatted</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">Max</span> <span class="n">loves</span> <span class="n">food</span><span class="o">.</span> <span class="n">See</span> <span class="n">Max</span> <span class="n">cook</span><span class="o">.</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>However, this new str.format method does not address the second drawback mentioned above. If the value is adjusted before it is filled, the code written in this way is still as messy and poorly readable as before. If you compare the original method with the new method, you will see that the new method is not much better than the original one.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">pantry</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s1">&#39;avocados&#39;</span><span class="p">,</span> <span class="mf">1.25</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s1">&#39;bananas&#39;</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s1">&#39;cherries&#39;</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pantry</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">old_style</span> <span class="o">=</span> <span class="s1">&#39;#</span><span class="si">%d</span><span class="s1">: </span><span class="si">%-10s</span><span class="s1"> = </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">item</span><span class="o">.</span><span class="n">title</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">        <span class="nb">round</span><span class="p">(</span><span class="n">count</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">new_style</span> <span class="o">=</span> <span class="s1">&#39;#</span><span class="si">{}</span><span class="s1">: </span><span class="si">{:&lt;10s}</span><span class="s1"> = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">item</span><span class="o">.</span><span class="n">title</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">        <span class="nb">round</span><span class="p">(</span><span class="n">count</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="k">assert</span> <span class="n">old_style</span> <span class="o">==</span> <span class="n">new_style</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Of course, this {} form of the descriptor also supports some more advanced uses, such as querying the value of a key in a dict, accessing an element at a position in a list, and converting values to Unicode or repr strings. The following code combines these three features.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">menu</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;soup&#39;</span><span class="p">:</span> <span class="s1">&#39;lentil&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;oyster&#39;</span><span class="p">:</span> <span class="s1">&#39;kumamoto&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;special&#39;</span><span class="p">:</span> <span class="s1">&#39;schnitzel&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">formatted</span> <span class="o">=</span> <span class="s1">&#39;First letter is </span><span class="si">{menu[oyster][0]!r}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">menu</span><span class="o">=</span><span class="n">menu</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">formatted</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">First</span> <span class="n">letter</span> <span class="ow">is</span> <span class="s1">&#39;k&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>These features, however, still don&rsquo;t solve the fourth drawback mentioned earlier, the one where key names need to be repeated multiple times. Here&rsquo;s a comparison of the C-style formatting expressions with the new str.format method to see what the difference is between the two writing styles when dealing with data in the form of key-value pairs.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">old_template</span> <span class="o">=</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;Today</span><span class="se">\&#39;</span><span class="s1">s soup is </span><span class="si">%(soup)s</span><span class="s1">, &#39;</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;buy one get two </span><span class="si">%(oyster)s</span><span class="s1"> oysters, &#39;</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;and our special entree is </span><span class="si">%(special)s</span><span class="s1">.&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">old_formatted</span> <span class="o">=</span> <span class="n">old_template</span> <span class="o">%</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;soup&#39;</span><span class="p">:</span> <span class="s1">&#39;lentil&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;oyster&#39;</span><span class="p">:</span> <span class="s1">&#39;kumamoto&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;special&#39;</span><span class="p">:</span> <span class="s1">&#39;schnitzel&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">new_template</span> <span class="o">=</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;Today</span><span class="se">\&#39;</span><span class="s1">s soup is </span><span class="si">{soup}</span><span class="s1">, &#39;</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;buy one get two </span><span class="si">{oyster}</span><span class="s1"> oysters, &#39;</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;and our special entree is </span><span class="si">{special}</span><span class="s1">.&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">new_formatted</span> <span class="o">=</span> <span class="n">new_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">soup</span><span class="o">=</span><span class="s1">&#39;lentil&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">oyster</span><span class="o">=</span><span class="s1">&#39;kumamoto&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">special</span><span class="o">=</span><span class="s1">&#39;schnitzel&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">assert</span> <span class="n">old_formatted</span> <span class="o">==</span> <span class="n">new_formatted</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The new way is a little better because it doesn&rsquo;t need to define a dict, so you don&rsquo;t need to enclose the key names in <code>' '</code>. Its descriptors are also simpler than those of the old way of writing. However, these advantages are not outstanding. Also, although we can access keys in dictionaries and elements in lists in the new style, these features cover only a small fraction of the features of Python expressions, and the str.format method still doesn&rsquo;t bring out the full benefits of Python expressions.</p>
<h4 id="interpolated-format-strings">Interpolated format strings</h4>
<p>Python 3.6 added a new feature called interpolatedformat string (f-string for short) that solves all of the problems mentioned above. The new syntax feature requires that format strings be prefixed with the letter f, similar to how the letters b and r are used, i.e., to prefix byte-format strings and raw (or unescaped) strings, respectively.</p>
<p>The f-string maximizes the expressiveness of formatted strings by completely solving the fourth drawback mentioned above, namely the programmatic redundancy caused by duplicate key names. Instead of defining a dict specifically, as we do with C-style format expressions, or passing a value to a parameter, as we do when calling the str.format method, we can simply refer to all names in the current Python range in the {} of the f-string, thereby simplifying things.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;my_var&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">value</span> <span class="o">=</span> <span class="mf">1.234</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">formatted</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1"> = </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">formatted</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">my_var</span> <span class="o">=</span> <span class="mf">1.234</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The same set of minilanguage rules supported by str.format, which are used to the right of the colon inside {}, can now be used in f-string, and the value can be converted to Unicode and repr by the ! symbols to Unicode and repr strings, as was the case with str.format.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;my_var&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">value</span> <span class="o">=</span> <span class="mf">1.234</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">formatted</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">!r:</span><span class="s1">&lt;10</span><span class="si">}</span><span class="s1"> = </span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">formatted</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="s1">&#39;my_var&#39;</span>   <span class="o">=</span> <span class="mf">1.23</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Using f-string to solve the same problem is always easier than using C-style format strings via the % operator, and it is also easier than the str.format method. Here&rsquo;s a comparison of the space taken up by these writing methods in order from shortest to longest, with the left side of the assignment symbol (=) aligned to the same position in each writing method, so it&rsquo;s easy to see how much code is to the right of the symbol.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;my_var&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">value</span> <span class="o">=</span> <span class="mf">1.234</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">f_string</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">:</span><span class="s1">&lt;10</span><span class="si">}</span><span class="s1"> = </span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">c_tuple</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%-10s</span><span class="s1"> = </span><span class="si">%.2f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">str_args</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:&lt;10}</span><span class="s1"> = </span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">str_kw</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{key:&lt;10}</span><span class="s1"> = </span><span class="si">{value:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                          <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">c_dict</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%(key)-10s</span><span class="s1"> = </span><span class="si">%(value).2f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">{</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                       <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">value</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">assert</span> <span class="n">c_tuple</span> <span class="o">==</span> <span class="n">c_dict</span> <span class="o">==</span> <span class="n">f_string</span>
</span></span><span class="line"><span class="cl"><span class="k">assert</span> <span class="n">str_args</span> <span class="o">==</span> <span class="n">str_kw</span> <span class="o">==</span> <span class="n">f_string</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In the f-string method, all kinds of Python expressions can appear in {}, so this solves the second drawback mentioned earlier. We can now fine-tune the values that need to be filled into the string in a fairly concise way; C-style writing and writing with the str.format method might make for a long expression, but with f-string instead, you can probably write it in one line.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">pantry</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s1">&#39;avocados&#39;</span><span class="p">,</span> <span class="mf">1.25</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s1">&#39;bananas&#39;</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s1">&#39;cherries&#39;</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pantry</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">old_style</span> <span class="o">=</span> <span class="s1">&#39;#</span><span class="si">%d</span><span class="s1">: </span><span class="si">%-10s</span><span class="s1"> = </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">item</span><span class="o">.</span><span class="n">title</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">        <span class="nb">round</span><span class="p">(</span><span class="n">count</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">new_style</span> <span class="o">=</span> <span class="s1">&#39;#</span><span class="si">{}</span><span class="s1">: </span><span class="si">{:&lt;10s}</span><span class="s1"> = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">item</span><span class="o">.</span><span class="n">title</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">        <span class="nb">round</span><span class="p">(</span><span class="n">count</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">f_string</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;#</span><span class="si">{</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">item</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="si">:</span><span class="s1">&lt;10s</span><span class="si">}</span><span class="s1"> = </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">count</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="k">assert</span> <span class="n">old_style</span> <span class="o">==</span> <span class="n">new_style</span> <span class="o">==</span> <span class="n">f_string</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>For more clarity, you can write the f-string as a multi-line string, similar to the adjacent-string concatenation in C. This is longer than a single-line f-string, but it is still better than the other two multi-line forms.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">pantry</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s1">&#39;avocados&#39;</span><span class="p">,</span> <span class="mf">1.25</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s1">&#39;bananas&#39;</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s1">&#39;cherries&#39;</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pantry</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">f_string</span> <span class="o">=</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="sa">f</span><span class="s1">&#39;# </span><span class="si">{</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="si">}</span><span class="s1">: &#39;</span>
</span></span><span class="line"><span class="cl">        <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">item</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="si">:</span><span class="s1">&lt;10s</span><span class="si">}</span><span class="s1"> = &#39;</span>
</span></span><span class="line"><span class="cl">        <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">count</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">f_string</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 1: Avocados   = 1</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 2: Bananas    = 2</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 3: Cherries   = 15</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Python expressions can also appear in format specifiers. For example, the following code represents the number of digits after the decimal point in a variable, and then puts the variable&rsquo;s name, places, enclosed in {} in a format specifier, which is more flexible than using hard code.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">places</span> <span class="o">=</span> <span class="mi">3</span>
</span></span><span class="line"><span class="cl"><span class="n">number</span> <span class="o">=</span> <span class="mf">1.23456</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;My number is </span><span class="si">{</span><span class="n">number</span><span class="si">:</span><span class="s1">.</span><span class="si">{</span><span class="n">places</span><span class="si">}</span><span class="s1">f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">My</span> <span class="n">number</span> <span class="ow">is</span> <span class="mf">1.235</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Of the four string formatting approaches built into Python, f-string can express many kinds of logic succinctly and clearly, which makes it the best choice for programmers. If you want to fill a string with values in the proper format, the first thing you should consider is using f-string to do it.</p>
<h4 id="summary">Summary</h4>
<ol>
<li>using the % operator to fill a value into a C-style format string can be problematic and tedious to write.</li>
<li>str.format defines its formatting specifiers exclusively in a mini-language that gives us some useful concepts, but otherwise suffers from many of the same drawbacks as C-style format strings, so we should avoid using it as well.</li>
<li>f-string solves the biggest problem posed by C-style format strings by using a new way of writing the values into the string. f-string is a clean and powerful mechanism for embedding arbitrary Python expressions directly inside format specifiers.</li>
</ol>
<h3 id="5-replacing-complex-expressions-with-helper-functions">5. Replacing Complex Expressions with Helper Functions</h3>
<p>Python&rsquo;s syntax is fairly straightforward, so sometimes you can implement a lot of logic with just one expression. For example, to split the query string in a URL into key-value pairs, you can simply use the parse_qs function. The following example parses each parameter in the query string and puts them into a dict with their corresponding integer values.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">parse_qs</span>
</span></span><span class="line"><span class="cl"><span class="n">my_values</span> <span class="o">=</span> <span class="n">parse_qs</span><span class="p">(</span><span class="s1">&#39;red=5&amp;blue=0&amp;green=&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                     <span class="n">keep_blank_values</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">my_values</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span><span class="s1">&#39;red&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;5&#39;</span><span class="p">],</span> <span class="s1">&#39;blue&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;0&#39;</span><span class="p">],</span> <span class="s1">&#39;green&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>When parsing the query string, you can find that some parameters may have multiple values, some parameters may have only one value, and some parameters may have blank values, and you may also encounter cases where the parameter is not provided at all. The following three lines of code query the result dictionary for each of the three parameters in the get method, which correspond to the three different cases.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">parse_qs</span>
</span></span><span class="line"><span class="cl"><span class="n">my_values</span> <span class="o">=</span> <span class="n">parse_qs</span><span class="p">(</span><span class="s1">&#39;red=5&amp;blue=0&amp;green=&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                     <span class="n">keep_blank_values</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Red:         &#39;</span><span class="p">,</span> <span class="n">my_values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;red&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Green:       &#39;</span><span class="p">,</span> <span class="n">my_values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;green&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Opacity:     &#39;</span><span class="p">,</span> <span class="n">my_values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;opacity&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">Red</span><span class="p">:</span>          <span class="p">[</span><span class="s1">&#39;5&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">Green</span><span class="p">:</span>        <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">Opacity</span><span class="p">:</span>      <span class="kc">None</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>It would be nice if both cases, missing arguments and arguments with blank values, could be treated as 0 by default. But such a small piece of logic doesn&rsquo;t seem worth writing a special if statement or helper function for, so some people will just use Boolean expressions to implement it.</p>
<p>Boolean expressions are easy to write in Python syntax, because Python treats blank strings, blank lists, and 0 values as False when evaluating such expressions. So, you just put the result of the get method to the left of the or operator and write 0 to the right. In this way, as long as the left subexpression is False, the value of the whole expression will be evaluated as the value of the right expression, which is 0.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">parse_qs</span>
</span></span><span class="line"><span class="cl"><span class="n">my_values</span> <span class="o">=</span> <span class="n">parse_qs</span><span class="p">(</span><span class="s1">&#39;red=5&amp;blue=0&amp;green=&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                     <span class="n">keep_blank_values</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># For query string &#39;red=5&amp;blue=0&amp;green=&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">red</span> <span class="o">=</span> <span class="n">my_values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="n">green</span> <span class="o">=</span> <span class="n">my_values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="n">opacity</span> <span class="o">=</span> <span class="n">my_values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;opacity&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Red:     </span><span class="si">{</span><span class="n">red</span><span class="si">!r}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Green:   </span><span class="si">{</span><span class="n">green</span><span class="si">!r}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Opacity: </span><span class="si">{</span><span class="n">opacity</span><span class="si">!r}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">Red</span><span class="p">:</span>     <span class="s1">&#39;5&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">Green</span><span class="p">:</span>   <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="n">Opacity</span><span class="p">:</span> <span class="mi">0</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The expression looks awkward when written like this, and it doesn&rsquo;t achieve exactly what we want, because we still have to make sure that the parsed parameter value is an integer that can directly participate in mathematical operations. So, we need to convert the string parsed by this expression into an integer by using the built-in int().</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">red</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">my_values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The code is now even harder to read because it looks even messier than it was. This code is horrible to read: if you are reading the code for the first time, you have to break the whole expression down layer by layer to understand what the line of code means, which takes a long time. The code should certainly be shorter, but that doesn&rsquo;t mean it has to be crammed into a single line.</p>
<p>Python can implement ternary conditional expressions with if/else constructs, which are much clearer than what you just wrote, and keep the code short.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">red_str</span> <span class="o">=</span> <span class="n">my_values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">red</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">red_str</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">if</span> <span class="n">red_str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">else</span> <span class="mi">0</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>But in our case, this is still not as good as the full multi-line if/else structure, which is very easy to read, although it takes a few more lines to write.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">green_str</span> <span class="o">=</span> <span class="n">my_values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="n">green_str</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">    <span class="n">green</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">green_str</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">green</span> <span class="o">=</span> <span class="mi">0</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>If this logic is to be used repeatedly, it is better to write it as a helper function, and even if it is only used two or three times as in the example below, it is still worth doing so.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">get_first_int</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">found</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">found</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">found</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">default</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="summary-1">Summary</h4>
<ol>
<li>Python&rsquo;s syntax makes it easy to squeeze complex meanings into the same line of expressions, which is hard to understand.</li>
<li>complex expressions, especially those that need to be reused, should be written inside helper functions.</li>
<li>Conditional expressions written in if/else constructs are better understood than Boolean expressions written in or and.</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">snack_calories</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;chips&#39;</span><span class="p">:</span> <span class="mi">140</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;popcorn&#39;</span><span class="p">:</span> <span class="mi">80</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;nuts&#39;</span><span class="p">:</span> <span class="mi">190</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">items</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">snack_calories</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">((</span><span class="s1">&#39;chips&#39;</span><span class="p">,</span> <span class="mi">140</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;popcorn&#39;</span><span class="p">,</span> <span class="mi">80</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;nuts&#39;</span><span class="p">,</span> <span class="mi">190</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>We can use integers as subscripts to access the corresponding elements inside a tuple.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">item</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Peanut butter&#39;</span><span class="p">,</span> <span class="s1">&#39;Jelly&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">first</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">second</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="s1">&#39;and&#39;</span><span class="p">,</span> <span class="n">second</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">Peanut</span> <span class="n">butter</span> <span class="ow">and</span> <span class="n">Jelly</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Once a tuple is created, it is not possible to assign new values to its elements via subscripts.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">pair</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Chocolate&#39;</span><span class="p">,</span> <span class="s1">&#39;Peanut butter&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Honey&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">Traceback</span> <span class="o">...</span>
</span></span><span class="line"><span class="cl"><span class="ne">TypeError</span><span class="p">:</span> <span class="s1">&#39;tuple&#39;</span> <span class="nb">object</span> <span class="n">does</span> <span class="ow">not</span> <span class="n">support</span> <span class="n">item</span> <span class="n">assignment</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Python also has a way of writing things called unpacking. This way of writing allows us to assign the elements inside a tuple to multiple variables with just one statement.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">item</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Peanut butter&#39;</span><span class="p">,</span> <span class="s1">&#39;Jelly&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">first</span><span class="p">,</span> <span class="n">second</span> <span class="o">=</span> <span class="n">item</span>  <span class="c1"># Unpacking</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="s1">&#39;and&#39;</span><span class="p">,</span> <span class="n">second</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">Peanut</span> <span class="n">butter</span> <span class="ow">and</span> <span class="n">Jelly</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Assigning values by unpacking is clearer than accessing elements of a tuple by subscripts, and it usually requires less code to write. Of course, the left side of the assignment operation can be written as a list, a sequence, or an iterable of arbitrary depth, in addition to listing individual variables.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">favorite_snacks</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;salty&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;pretzels&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;sweet&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;cookies&#39;</span><span class="p">,</span> <span class="mi">180</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;veggie&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;carrots&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">((</span><span class="n">type1</span><span class="p">,</span> <span class="p">(</span><span class="n">name1</span><span class="p">,</span> <span class="n">cals1</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl"> <span class="p">(</span><span class="n">type2</span><span class="p">,</span> <span class="p">(</span><span class="n">name2</span><span class="p">,</span> <span class="n">cals2</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl"> <span class="p">(</span><span class="n">type3</span><span class="p">,</span> <span class="p">(</span><span class="n">name3</span><span class="p">,</span> <span class="n">cals3</span><span class="p">)))</span> <span class="o">=</span> <span class="n">favorite_snacks</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Favorite </span><span class="si">{</span><span class="n">type1</span><span class="si">}</span><span class="s1"> is </span><span class="si">{</span><span class="n">name1</span><span class="si">}</span><span class="s1"> with </span><span class="si">{</span><span class="n">cals1</span><span class="si">}</span><span class="s1"> calories&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Favorite </span><span class="si">{</span><span class="n">type2</span><span class="si">}</span><span class="s1"> is </span><span class="si">{</span><span class="n">name2</span><span class="si">}</span><span class="s1"> with </span><span class="si">{</span><span class="n">cals2</span><span class="si">}</span><span class="s1"> calories&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Favorite </span><span class="si">{</span><span class="n">type3</span><span class="si">}</span><span class="s1"> is </span><span class="si">{</span><span class="n">name3</span><span class="si">}</span><span class="s1"> with </span><span class="si">{</span><span class="n">cals3</span><span class="si">}</span><span class="s1"> calories&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">Favorite</span> <span class="n">salty</span> <span class="ow">is</span> <span class="n">pretzels</span> <span class="k">with</span> <span class="mi">100</span> <span class="n">calories</span>
</span></span><span class="line"><span class="cl"><span class="n">Favorite</span> <span class="n">sweet</span> <span class="ow">is</span> <span class="n">cookies</span> <span class="k">with</span> <span class="mi">180</span> <span class="n">calories</span>
</span></span><span class="line"><span class="cl"><span class="n">Favorite</span> <span class="n">veggie</span> <span class="ow">is</span> <span class="n">carrots</span> <span class="k">with</span> <span class="mi">20</span> <span class="n">calories</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">snacks</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;bacon&#39;</span><span class="p">,</span> <span class="mi">350</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;donut&#39;</span><span class="p">,</span> <span class="mi">240</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;muffin&#39;</span><span class="p">,</span> <span class="mi">190</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">rank</span><span class="p">,</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">calories</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">snacks</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;#</span><span class="si">{</span><span class="n">rank</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1"> has </span><span class="si">{</span><span class="n">calories</span><span class="si">}</span><span class="s1"> calories&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="c1">#1: bacon has 350 calories</span>
</span></span><span class="line"><span class="cl"><span class="c1">#2: donut has 240 calories</span>
</span></span><span class="line"><span class="cl"><span class="c1">#3: muffin has 190 calories</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>This is the Python style of writing (Pythonic style), so we don&rsquo;t need to go through the subscripts layer by layer. It saves space and is easier to understand.</p>
<h3 id="7-replace-range-with-enumerate-whenever-possible">7. Replace range with enumerate whenever possible</h3>
<p>Python&rsquo;s built-in range function is good for iterating over a series of integers.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">randint</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">random_bits</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">32</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">random_bits</span> <span class="o">|=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">i</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="nb">bin</span><span class="p">(</span><span class="n">random_bits</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="mb">0b100101010010000001011011010011</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>If you want to iterate over a data structure, such as a list of strings, you can iterate over the sequence directly, without setting a range of values by range, and then using each integer value in the range as a subscript to access the elements of the list in turn.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">flavor_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;vanilla&#39;</span><span class="p">,</span> <span class="s1">&#39;chocolate&#39;</span><span class="p">,</span> <span class="s1">&#39;pecan&#39;</span><span class="p">,</span> <span class="s1">&#39;strawberry&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">flavor</span> <span class="ow">in</span> <span class="n">flavor_list</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">flavor</span><span class="si">}</span><span class="s1"> is delicious&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">vanilla</span> <span class="ow">is</span> <span class="n">delicious</span>
</span></span><span class="line"><span class="cl"><span class="n">chocolate</span> <span class="ow">is</span> <span class="n">delicious</span>
</span></span><span class="line"><span class="cl"><span class="n">pecan</span> <span class="ow">is</span> <span class="n">delicious</span>
</span></span><span class="line"><span class="cl"><span class="n">strawberry</span> <span class="ow">is</span> <span class="n">delicious</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Of course, there are times when you need to know the position of the element you are currently working on in the list as you iterate through the list. For example, I write my favorite ice cream flavors in the <code>flavor_list</code> list, and when I print each flavor, I also want to indicate the ranking of the flavor in my mind. To do this, we can use the traditional range approach.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">flavor_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;vanilla&#39;</span><span class="p">,</span> <span class="s1">&#39;chocolate&#39;</span><span class="p">,</span> <span class="s1">&#39;pecan&#39;</span><span class="p">,</span> <span class="s1">&#39;strawberry&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">flavor_list</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">    <span class="n">flavor</span> <span class="o">=</span> <span class="n">flavor_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">flavor</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span><span class="p">:</span> <span class="n">vanilla</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span><span class="p">:</span> <span class="n">chocolate</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span><span class="p">:</span> <span class="n">pecan</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span><span class="p">:</span> <span class="n">strawberry</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>range(len(favor_list))</code> is too complicated to write and can be replaced by enumerate. enumerate can encapsulate any kind of iterator into a lazy generator (see article 30).</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">flavor_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;vanilla&#39;</span><span class="p">,</span> <span class="s1">&#39;chocolate&#39;</span><span class="p">,</span> <span class="s1">&#39;pecan&#39;</span><span class="p">,</span> <span class="s1">&#39;strawberry&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">it</span> <span class="o">=</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">flavor_list</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">it</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">it</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;vanilla&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;chocolate&#39;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">flavor_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;vanilla&#39;</span><span class="p">,</span> <span class="s1">&#39;chocolate&#39;</span><span class="p">,</span> <span class="s1">&#39;pecan&#39;</span><span class="p">,</span> <span class="s1">&#39;strawberry&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">flavor</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">flavor_list</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">flavor</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span><span class="p">:</span> <span class="n">vanilla</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span><span class="p">:</span> <span class="n">chocolate</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span><span class="p">:</span> <span class="n">pecan</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span><span class="p">:</span> <span class="n">strawberry</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Alternatively, you can specify the starting number with the second parameter of enumerate so that you don&rsquo;t have to adjust it each time you print. For example, this example can start from 1.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">flavor</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">flavor_list</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">flavor</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="summary-2">Summary</h4>
<ol>
<li>the enumerate function can iterate over iterators with concise code, and can indicate the number of the current loop.</li>
<li>Instead of specifying a range of subscripts and then using the subscripts to access the sequence, you should iterate directly with the enumerate function.</li>
<li>You can specify the starting number (default is 0) by the second parameter of enumerate.</li>
</ol>
<h3 id="8-iterating-over-two-iterators-at-once-with-the-zip-function">8. Iterating over two iterators at once with the zip function</h3>
<p>When writing Python code, it&rsquo;s common to create many new lists related to a list based on the objects in that list. A list derivation mechanism such as the one below applies an expression to each element of the source list to produce a derived list (see #27).</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Cecilia&#39;</span><span class="p">,</span> <span class="s1">&#39;Lise&#39;</span><span class="p">,</span> <span class="s1">&#39;Marie&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">counts</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">names</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">counts</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The elements in the derived list have some relationship with the elements above the corresponding position in the source list. If you want to iterate through both lists, then you can do iterations based on the length of the source list.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Cecilia&#39;</span><span class="p">,</span> <span class="s1">&#39;Lise&#39;</span><span class="p">,</span> <span class="s1">&#39;Marie&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">counts</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">names</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">longest_name</span> <span class="o">=</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl"><span class="n">max_count</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">    <span class="n">count</span> <span class="o">=</span> <span class="n">counts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="n">max_count</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">longest_name</span> <span class="o">=</span> <span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">max_count</span> <span class="o">=</span> <span class="n">count</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">longest_name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">Cecilia</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The problem with this approach is that the entire loop code looks messy. We want to access the elements of the names and counts lists via subscripts, so the loop variable i, which represents the subscript, must appear twice in the loop body, which makes the code less understandable. The enumerate implementation (see #7) is a little better, but still not ideal.</p>
<p>To make the code clearer, you can use Python&rsquo;s built-in zip function. This function wraps two or more iterators into a lazy generator.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">counts</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="n">max_count</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">longest_name</span> <span class="o">=</span> <span class="n">name</span>
</span></span><span class="line"><span class="cl">        <span class="n">max_count</span> <span class="o">=</span> <span class="n">count</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The zip only takes one element at a time from each of those iterators it wraps, so even if the source list is long, the program won&rsquo;t crash because it takes up too much memory. However, be careful if the length of the lists entered into the zip is inconsistent. For example, I added another name to the names list, but forgot to update its length to the counts list. In this case, traversing both lists with the zip will produce strange results.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">itertools</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Cecilia&#39;</span><span class="p">,</span> <span class="s1">&#39;Lise&#39;</span><span class="p">,</span> <span class="s1">&#39;Marie&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">counts</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">names</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">longest_name</span> <span class="o">=</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl"><span class="n">max_count</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">counts</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="n">max_count</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">longest_name</span> <span class="o">=</span> <span class="n">name</span>
</span></span><span class="line"><span class="cl">        <span class="n">max_count</span> <span class="o">=</span> <span class="n">count</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Rosalind&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">zip_longest</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">counts</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">Cecilia</span><span class="p">:</span> <span class="mi">7</span>
</span></span><span class="line"><span class="cl"><span class="n">Lise</span><span class="p">:</span> <span class="mi">4</span>
</span></span><span class="line"><span class="cl"><span class="n">Marie</span><span class="p">:</span> <span class="mi">5</span>
</span></span><span class="line"><span class="cl"><span class="n">Rosalind</span><span class="p">:</span> <span class="kc">None</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>If some of these lists have already been traversed, then <code>zip_longest</code> will fill in the gaps with the value passed to the fillvalue parameter (in this case, the length of the string <code>'Rosalind'</code>), the default value being None.</p>
<h4 id="summary-3">Summary</h4>
<ol>
<li>the built-in zip function can iterate over multiple iterators at the same time.</li>
<li>zip creates inert generators so that it only generates one tuple at a time, so no matter how long the input data is, it is processed one at a time.</li>
<li>If the provided iterators are not of the same length, zip will stop as soon as any of them has finished iterating. If you want to iterate over the longest iterator, then use the <code>zip_longest</code> function in the built-in itertools module instead.</li>
</ol>
<h3 id="9-dont-write-else-blocks-after-for-and-while-loops">9. Don&rsquo;t write else blocks after for and while loops</h3>
<p>One feature of Python loops that most programming languages don&rsquo;t support is the ability to put else blocks right after the entire loop structure.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Loop&#39;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Else block!&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">Loop</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="n">Loop</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="n">Loop</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="n">Else</span> <span class="n">block</span><span class="err">!</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>If the loop is not executed from start to finish (i.e., the loop terminates early), the code in the else block is not executed. Using a break statement in a loop actually skips the else block. This is much different from the actual imagined functionality.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Loop&#39;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">break</span>
</span></span><span class="line"><span class="cl"><span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Else block!&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">Loop</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="n">Loop</span> <span class="mi">1</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Another strange thing is that if you do a for loop on a blank sequence, the program immediately executes an else block.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[]:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Never runs&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;For Else block!&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">For</span> <span class="n">Else</span> <span class="n">block</span><span class="err">!</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The same is true for while loops, if the first loop encounters False, then the program will also run the else block immediately.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="k">while</span> <span class="kc">False</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Never runs&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;While Else block!&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">While</span> <span class="n">Else</span> <span class="n">block</span><span class="err">!</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The else is designed in such a way that you can use it to implement search logic. For example, if you want to determine whether two numbers are mutually exclusive (i.e., whether no number other than 1 can divide them at the same time), you can use this structure. First, you try each number that can divide them at the same time, and if you don&rsquo;t find such a number after trying them all, then the loop is executed from beginning to end (which means that the loop doesn&rsquo;t break early), and then the program executes the code in the else block.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">a</span> <span class="o">=</span> <span class="mi">4</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span> <span class="o">=</span> <span class="mi">9</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Testing&#39;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">a</span> <span class="o">%</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">b</span> <span class="o">%</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Not coprime&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">break</span>
</span></span><span class="line"><span class="cl"><span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Coprime&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">Testing</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="n">Testing</span> <span class="mi">3</span>
</span></span><span class="line"><span class="cl"><span class="n">Testing</span> <span class="mi">4</span>
</span></span><span class="line"><span class="cl"><span class="n">Coprime</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In practice, an auxiliary function will be used instead to complete the calculation. Such auxiliary functions have two common ways of writing.</p>
<ol>
<li>
<p>Whenever a condition is found to hold, it is returned immediately. If this is never encountered, the loop is executed in its entirety, leaving the program to return the value at the end of the function as the default return value.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">coprime</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">a</span> <span class="o">%</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">b</span> <span class="o">%</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl"><span class="k">return</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">assert</span> <span class="n">coprime</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">assert</span> <span class="ow">not</span> <span class="n">coprime</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>Use the variable to keep track of whether you encounter such a situation during the loop, and if so, then jump out of the loop early with break; if not, the loop will execute in full, returning the value of the variable at the end anyway.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">coprime_alternate</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
</span></span><span class="line"><span class="cl"><span class="n">is_coprime</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">a</span> <span class="o">%</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">b</span> <span class="o">%</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">is_coprime</span> <span class="o">=</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">        <span class="k">break</span>
</span></span><span class="line"><span class="cl"><span class="k">return</span> <span class="n">is_coprime</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">assert</span> <span class="n">coprime_alternate</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">assert</span> <span class="ow">not</span> <span class="n">coprime_alternate</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ol>
<p>While the for/else or while/else construct itself allows for certain logical expressions, the confusion it brings has overshadowed its benefits.</p>
<h4 id="summary-4">Summary</h4>
<ol>
<li>Python has a special syntax that allows you to put an else block right after the entire for or while loop.</li>
<li>the else block will only execute if the whole loop doesn&rsquo;t jump out beforehand because of break</li>
<li>Putting the else block immediately after the entire loop makes it less obvious what the code means, so avoid writing it that way.</li>
</ol>
<h3 id="10-reducing-code-repetition-with-assignment-expressions">10. Reducing Code Repetition with Assignment Expressions</h3>
<p>Assignment expressions are a new syntax introduced in Python 3.8, and they use the walrus operator. This style of writing can solve some of the long-standing code repetition problems.</p>
<p>This expression is useful for implementing assignments in situations where normal assignment statements cannot be applied, such as inside the if statement of a conditional expression. The value of the assignment expression is the value assigned to the identifier to the left of the walrus operator.</p>
<p>As an example. If there is a basket of fresh fruit to be used as ingredients for a juice store, then we can define its contents like this.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">fresh_fruit</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;apple&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;banana&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;lemon&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">make_lemonade</span><span class="p">(</span><span class="n">count</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">out_of_stock</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">count</span> <span class="o">=</span> <span class="n">fresh_fruit</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;lemon&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="n">count</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">make_lemonade</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">out_of_stock</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>This code may look simple, but it is a bit loose because the count variable is defined on top of the entire if/else structure, yet only the if statement uses it, the else block does not need to use it at all. So, this way of writing makes it look like count is an important variable that is used in both if and else, but it is not.</p>
<p>In Python, we often want to get a value, determine if it&rsquo;s non-zero, and then execute a piece of code if it is. For this kind of use, we used to have to use tricks to avoid having variables like count repeatedly appear in our code, and these tricks sometimes made the code harder to understand (see the ones mentioned in #5). Python introduced assignment expressions to solve this problem. The following is written using the walrus operator instead.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="k">if</span> <span class="n">count</span> <span class="o">:=</span> <span class="n">fresh_fruit</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;lemon&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">make_lemonade</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">out_of_stock</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The new code is much clearer to read, even though only one line is omitted, because the way it is written clearly shows that the count variable is only relevant to the if block. The assignment expression first assigns the value to the right of <code>:=</code> to the count variable on the left, and then evaluates itself, i.e., treats the value of the variable as the value of the entire expression. Since the expression follows the if, the program will decide whether to execute the if block based on whether its value is non-zero. This assignment followed by a judgment is exactly what the walrus operator is trying to say.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">fresh_fruit</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;apple&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;banana&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;lemon&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">make_cider</span><span class="p">(</span><span class="n">count</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">count</span> <span class="o">=</span> <span class="n">fresh_fruit</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;apple&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="n">count</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">make_cider</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">out_of_stock</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Similarly the above code can be modified as follows.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="n">count</span> <span class="o">:=</span> <span class="n">fresh_fruit</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;apple&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">make_lemonade</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">out_of_stock</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>As in the previous example, the modified code has one less line than the original. But this time, let&rsquo;s also notice another phenomenon: the assignment expression itself is placed inside a pair of parentheses. Why do we do this? Because we want to compare the result of this expression with the value 4 in the if statement. The lemonade example didn&rsquo;t have parentheses because the if/else was determined by the value of the assignment expression itself: as long as the value of the expression was not 0, the program went to the if branch. But not this time. This time, the assignment expression has to be placed inside a larger expression, so it has to be enclosed in parentheses. Of course, it&rsquo;s better to try not to add parentheses when they are not necessary.</p>
<p>There is also a similar logic that results in the duplicate code mentioned earlier, which means that we have to assign a different value to a variable depending on the situation, and then immediately call a function with that variable as a parameter. For example, if a customer orders a banana smoothie, we first have to cut the banana into several portions and use two of them to make the smoothie. If we don&rsquo;t have enough bananas, then we throw an OutOfBananas exception. This logic is implemented in the following traditional way of writing.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">slice_bananas</span><span class="p">(</span><span class="n">count</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">OutofBananas</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">make_smoothies</span><span class="p">(</span><span class="n">count</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">fresh_fruit</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;apple&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;banana&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;lemon&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">pieces</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="n">count</span> <span class="o">=</span> <span class="n">fresh_fruit</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;banana&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="n">count</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">pieces</span> <span class="o">=</span> <span class="n">slice_bananas</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">smoothies</span> <span class="o">=</span> <span class="n">make_smoothies</span><span class="p">(</span><span class="n">pieces</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">except</span> <span class="n">OutofBananas</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">out_of_stock</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Another traditional way of writing is also common, which is to move the assignment statement with pieces = 0 above the if/else structure to the else block.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">count</span> <span class="o">=</span> <span class="n">fresh_fruit</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;banana&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="n">count</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">pieces</span> <span class="o">=</span> <span class="n">slice_bananas</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">pieces</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">smoothies</span> <span class="o">=</span> <span class="n">make_smoothies</span><span class="p">(</span><span class="n">pieces</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">except</span> <span class="n">OutofBananas</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">out_of_stock</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>This looks slightly odd, because both the if and else branches define initial values for pieces variables. According to Python&rsquo;s scoping rules, this way of defining the initial values of variables separately is valid (see Rule 21). Although this is true, it looks awkward, so many people prefer the first way, which is to set the initial value of pieces before entering the if/else structure.</p>
<p>By using the walrus operator instead, we can write one less line of code and keep the count variable low, so that it only appears in the if block, and we are more aware that the pieces variable is the focus of the code.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">pieces</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="n">count</span> <span class="o">:=</span> <span class="n">fresh_fruit</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;banana&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">pieces</span> <span class="o">=</span> <span class="n">slice_bananas</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">smoothies</span> <span class="o">=</span> <span class="n">make_smoothies</span><span class="p">(</span><span class="n">pieces</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">except</span> <span class="n">OutofBananas</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">out_of_stock</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>For writing with separate pieces variables inside the if and else branches, the walrus operator also makes the code clear because this time you don&rsquo;t have to put the count variable above the entire if/else block.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="n">count</span> <span class="o">:=</span> <span class="n">fresh_fruit</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;banana&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">pieces</span> <span class="o">=</span> <span class="n">slice_bananas</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">pieces</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">smoothies</span> <span class="o">=</span> <span class="n">make_smoothies</span><span class="p">(</span><span class="n">pieces</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">except</span> <span class="n">OutofBananas</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">out_of_stock</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Python newbies often have trouble finding a good way to implement switch/case constructs. The closest you can get to this is to continue nesting if/else constructs inside of them, or to use if/elif/else constructs.</p>
<p>For example, we want to automatically make drinks for our guests in a certain order so that we don&rsquo;t have to order them. The following logic first determines if it can make a banana smoothie, if not, it makes apple juice, and if that doesn&rsquo;t work, it makes lemon juice.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">count</span> <span class="o">=</span> <span class="n">fresh_fruit</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;banana&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="n">count</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">pieces</span> <span class="o">=</span> <span class="n">slice_bananas</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">to_enjoy</span> <span class="o">=</span> <span class="n">make_smoothies</span><span class="p">(</span><span class="n">pieces</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">count</span> <span class="o">=</span> <span class="n">fresh_fruit</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;apple&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">to_enjoy</span> <span class="o">=</span> <span class="n">make_cider</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">count</span> <span class="o">=</span> <span class="n">fresh_fruit</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;lemon&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">count</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">to_enjoy</span> <span class="o">=</span> <span class="n">make_lemonade</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">to_enjoy</span> <span class="o">=</span> <span class="s1">&#39;Nothing&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>This ugly way of writing is actually particularly common in Python code. Fortunately, we now have the walrus operator, which allows us to easily mimic something very close to the switch/case scenario.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="n">count</span> <span class="o">:=</span> <span class="n">fresh_fruit</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;banana&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">pieces</span> <span class="o">=</span> <span class="n">slice_bananas</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">to_enjoy</span> <span class="o">=</span> <span class="n">make_smoothies</span><span class="p">(</span><span class="n">pieces</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">elif</span> <span class="p">(</span><span class="n">count</span> <span class="o">:=</span> <span class="n">fresh_fruit</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;apple&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">to_enjoy</span> <span class="o">=</span> <span class="n">make_cider</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">elif</span> <span class="n">count</span> <span class="o">:=</span> <span class="n">fresh_fruit</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;lemon&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">to_enjoy</span> <span class="o">=</span> <span class="n">make_lemonade</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">to_enjoy</span> <span class="o">=</span> <span class="s1">&#39;Nothing&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>This version is only five lines shorter than the original, but it looks much clearer because the nesting depth and the number of indentation levels have been reduced. Whenever we encounter an unsightly structure like the one we just saw, we should consider whether we can write it with the walrus operator instead.</p>
<p>Another difficulty that Python newbies will encounter is the lack of do/while loop structures. For example, we want to make juice from new fruit and bottle it up until we run out of fruit. Here&rsquo;s how to do it using a normal while loop.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">pick_fruit</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">make_juice</span><span class="p">(</span><span class="n">fruit</span><span class="p">,</span> <span class="n">count</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">bottles</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl"><span class="n">fresh_fruit</span> <span class="o">=</span> <span class="n">pick_fruit</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="k">while</span> <span class="n">fresh_fruit</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">fruit</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">fresh_fruit</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">        <span class="n">batch</span> <span class="o">=</span> <span class="n">make_juice</span><span class="p">(</span><span class="n">fruit</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">bottles</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">fresh_fruit</span> <span class="o">=</span> <span class="n">pick_fruit</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>This way you have to write <code>fresh_fruit = pick_fruit()</code> twice, first before entering the while loop, because we have to set the initial value for <code>fresh_fruit</code>, and second at the end of the while loop body, because we have to fill <code>fresh_fruit</code> with the list of fruits that need to be processed in the next round. inside. If you want to reuse this line of code, consider the loop-and-a-half pattern. This pattern eliminates repetition, but it makes the while loop look stupid because it becomes an infinite loop, and the program can only jump out of the loop with a break statement.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">bottles</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl"><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">   <span class="n">fresh_fruit</span> <span class="o">=</span> <span class="n">pick_fruit</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">   <span class="k">if</span> <span class="ow">not</span> <span class="n">fresh_fruit</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">      <span class="k">break</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">fruit</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">fresh_fruit</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">        <span class="n">batch</span> <span class="o">=</span> <span class="n">make_juice</span><span class="p">(</span><span class="n">fruit</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">bottles</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>With the walrus operator, there is no need to use the <code>loop-and-a-half</code> pattern; we can assign a value to the <code>fresh_fruit</code> variable at the beginning of each loop and decide whether to continue the loop based on the value of the variable. This is easy to read, so it should be the preferred solution.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">bottles</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl"><span class="k">while</span> <span class="n">fresh_fruit</span> <span class="o">:=</span> <span class="n">pick_fruit</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">fruit</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">fresh_fruit</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">        <span class="n">batch</span> <span class="o">=</span> <span class="n">make_juice</span><span class="p">(</span><span class="n">fruit</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">bottles</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In other cases, assignment expressions can also reduce repetitive code (see clause 29). In short, if an expression or assignment operation appears multiple times in a set of code, consider making the code simpler with assignment expressions.</p>
<h4 id="summary-5">Summary</h4>
<ol>
<li>Assignment expressions assign a value to a variable by the walrus operator (:=) and make the value the result of this expression, so we can use this feature to reduce the code. If the assignment expression is part of a larger expression, you&rsquo;ll have to enclose it in a pair of parentheses.</li>
<li>Python doesn&rsquo;t support switch/case and do/while constructs, but you can use assignment expressions to clearly model this logic.</li>
</ol>
<h2 id="lists-and-dictionaries">Lists and dictionaries</h2>
<h3 id="11-learning-to-slice-sequences">11. Learning to Slice Sequences</h3>
<p>Python has a way to slice parts of a sequence so that we can easily access some subset of the original sequence. The simplest use is to slice the built-in lists, str, and bytes; in fact, any class that implements the special methods <code>__getitem__</code> and <code>__setitem__</code> can slice (see #43).</p>
<p>The most basic way to do this is to use the form <code>somelist[start:end]</code>, which means that you start at the start and go all the way to the end, but not the end itself.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Middle two:   &#39;</span><span class="p">,</span> <span class="n">a</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">5</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;All but ends: &#39;</span><span class="p">,</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">7</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">Middle</span> <span class="n">two</span><span class="p">:</span>    <span class="p">[</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">All</span> <span class="n">but</span> <span class="n">ends</span><span class="p">:</span>  <span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>If the list is cut from the beginning, then the subscript 0 to the left of the colon should be omitted to make it look clearer.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="k">assert</span> <span class="n">a</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>If you take it all the way to the end of the list, then you should omit the subscript to the right of the colon, because you don&rsquo;t need to write it out specifically.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="k">assert</span> <span class="n">a</span><span class="p">[</span><span class="mi">5</span><span class="p">:]</span> <span class="o">==</span> <span class="n">a</span><span class="p">[</span><span class="mi">5</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Using negative numbers as subscripts means counting from the end of the list to the front. The following cuts should make sense even to someone who just saw this code.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">[:])</span> <span class="c1"># [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;, &#39;e&#39;, &#39;f&#39;, &#39;g&#39;, &#39;h&#39;]</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span> <span class="c1"># [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;, &#39;e&#39;]</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="c1"># [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;, &#39;e&#39;, &#39;f&#39;, &#39;g&#39;]</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">4</span><span class="p">:])</span> <span class="c1"># [&#39;e&#39;, &#39;f&#39;, &#39;g&#39;, &#39;h&#39;]</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:])</span> <span class="c1"># [&#39;f&#39;, &#39;g&#39;, &#39;h&#39;]</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">5</span><span class="p">])</span> <span class="c1"># [&#39;c&#39;, &#39;d&#39;, &#39;e&#39;]</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="c1"># [&#39;c&#39;, &#39;d&#39;, &#39;e&#39;, &#39;f&#39;, &#39;g&#39;]</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="c1"># [&#39;f&#39;, &#39;g&#39;]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>If the range determined by the start and end points is beyond the boundary of the list, then the system automatically ignores the non-existent elements. Using this feature, it is easy to construct an input sequence with at most a number of elements, e.g.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">first_twenty_items</span> <span class="o">=</span> <span class="n">a</span><span class="p">[:</span><span class="mi">20</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">last_twenty_items</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="o">-</span><span class="mi">20</span><span class="p">:]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The subscripts used for cutting can be crossed, but not when accessing the list directly, which would cause the program to throw an exception.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">a</span><span class="p">[</span><span class="mi">20</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">Traceback</span> <span class="o">...</span>
</span></span><span class="line"><span class="cl"><span class="ne">IndexError</span><span class="p">:</span> <span class="nb">list</span> <span class="n">index</span> <span class="n">out</span> <span class="n">of</span> <span class="nb">range</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The cut list is a completely new list. Even if an element is replaced, it does not affect the corresponding position in the original list. The element in that position still has its old value.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Before:&#39;</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">99</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;After: &#39;</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No change:&#39;</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">Before</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">After</span><span class="p">:</span>  <span class="p">[</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">No</span> <span class="n">change</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The slice can appear to the left of the assignment symbol, indicating that the elements of the original list within this range are replaced by those on the right. Unlike unpacking, this assignment does not require that the number of elements specified on either side of the equal sign be the same (in the case of unpacking, the number of variables on the left side of the equal sign to receive values must match the number of values provided on the right side of the equal sign, e.g., a, b = c[:2], see Section 6). In the original list, those elements before and after the slice range are preserved, but the length of the list may change. For example, in the following example, the list is shorter because the right-hand side of the assignment symbol provides only 3 values, but the slice on the left-hand side covers 5 values, and the list is two elements shorter than before.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Before &#39;</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">99</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">14</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;After  &#39;</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">Before</span>  <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">After</span>   <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The following code will make the list longer because the number of elements to the right of the assignment symbol is greater than the number of elements covered by that slice on the left.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Before &#39;</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">47</span><span class="p">,</span> <span class="mi">11</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;After  &#39;</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">Before</span>  <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">After</span>   <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="mi">47</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Slices that are left empty at the start and end positions, and that appear to the right of the assignment symbol, indicate that a copy of this list is made, so that the new list produced has the same content as the original list, but with a different identity.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="p">[:]</span>
</span></span><span class="line"><span class="cl"><span class="k">assert</span> <span class="n">b</span> <span class="o">==</span> <span class="n">a</span> <span class="ow">and</span> <span class="n">b</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">a</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Putting the slice without the start/stop subscript to the left of the assignment symbol means replacing the entire contents of the left list with a copy of the list on the right (note that the left list still retains its original identity and no new list will be assigned).</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span> <span class="o">=</span> <span class="n">a</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span> <span class="o">=</span> <span class="n">a</span><span class="p">[:]</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Before a&#39;</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Before b&#39;</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Before c&#39;</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">101</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">103</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="k">assert</span> <span class="n">b</span> <span class="ow">is</span> <span class="n">a</span> <span class="ow">and</span> <span class="n">c</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">a</span>  <span class="c1"># Still the same list object</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;After a &#39;</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>  <span class="c1"># Now has different contents</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;After b &#39;</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>  <span class="c1"># Same list, so same contents as a</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;After c &#39;</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>  <span class="c1"># Not same list, same contents as a</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">Before</span> <span class="n">a</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">Before</span> <span class="n">b</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">Before</span> <span class="n">c</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">After</span> <span class="n">a</span>  <span class="p">[</span><span class="mi">101</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">103</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">After</span> <span class="n">b</span>  <span class="p">[</span><span class="mi">101</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">103</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">After</span> <span class="n">c</span>  <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="summarize">Summarize</h4>
<ol>
<li>keep the slice as simple as possible: omit the start subscript 0 if you pick from the beginning, or omit the end subscript if you pick to the end of the sequence.</li>
<li>Slices allow start or stop subscripts to go out of bounds, so it is easy to express things like &ldquo;how many elements to take at the beginning&rdquo; (e.g. <code>a[:20]</code>) or &ldquo;how many elements to take at the end&rdquo; (e.g. <code>a[-20:0]</code>) without having to worry about whether the slice really has that many elements.</li>
<li>Putting the slice on the left side of the assignment symbol can replace the elements in this range of the original list with the elements on the right side of the assignment symbol, but it may change the length of the original list.</li>
</ol>
<h3 id="12-dont-specify-both-a-startend-subscript-and-a-step-in-a-slice">12. Don&rsquo;t specify both a start/end subscript and a step in a slice</h3>
<p>In addition to the basic way of writing slices (see Rule 11), Python has a special form of step slicing, <code>somelist[start : end : stride]</code>. This form picks one out of every n elements, so that elements in odd and even positions can easily be picked out by <code>x[::2]</code> and <code>x[1::2]</code> respectively.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="s1">&#39;yellow&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="s1">&#39;purple&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">odds</span> <span class="o">=</span> <span class="n">x</span><span class="p">[::</span><span class="mi">2</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">evens</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">odds</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">evens</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;yellow&#39;</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="s1">&#39;purple&#39;</span><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Slicing with steps can often have unintended effects and make programs buggy; for example, a common trick in Python is to use -1 as a step value to slice strings of type bytes so that the string is reversed.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">x</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;mongoose&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="sa">b</span><span class="s1">&#39;esoognom&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Strings in Unicode form can also be inverted in this way (see clause 3).</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">x</span> <span class="o">=</span> <span class="s1">&#39;多喝水&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">水喝多</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>However, if such strings are encoded as UTF-8 standard byte data, you cannot use this trick to invert them.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">x</span> <span class="o">=</span> <span class="s1">&#39;多喝水&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">z</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">Traceback</span> <span class="o">...</span>
</span></span><span class="line"><span class="cl"><span class="ne">UnicodeDecodeError</span><span class="p">:</span> <span class="s1">&#39;utf-8&#39;</span> <span class="n">codec</span> <span class="n">can</span><span class="s1">&#39;t decode byte 0xb4 in position 0: invalid start byte</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Does it make sense to use negative numbers other than -1 as step values? Consider the following example.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">[::</span><span class="mi">2</span><span class="p">])</span>  <span class="c1"># [&#39;a&#39;, &#39;c&#39;, &#39;e&#39;, &#39;g&#39;]</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">[::</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>  <span class="c1"># [&#39;h&#39;, &#39;f&#39;, &#39;d&#39;, &#39;b&#39;]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In the above example, <code>::2</code> means select backward from the beginning, one out of every two elements. The meaning of <code>::-2</code> is a little more circular, as it means to select from the end to the front, one out of every two elements.</p>
<p>Using both start/stop subscripts and step makes slicing hard to understand. Writing three values inside square brackets is too crowded and not easy to read, and when specifying a step value (especially a negative step value), we have to think very carefully: is this a backward or a backward step?</p>
<p>To avoid this problem, I recommend that you do not write both the start/stop subscript and the step value in the slice. If you must specify a step, try to use a positive number and leave both the start and stop subscripts blank. Even if you have to use both step and start/stop subscripts, you should consider writing them twice.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="p">[::</span><span class="mi">2</span><span class="p">]</span>  <span class="c1"># [&#39;a&#39;, &#39;c&#39;, &#39;e&#39;, &#39;g&#39;]</span>
</span></span><span class="line"><span class="cl"><span class="n">z</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># [&#39;c&#39;, &#39;e&#39;]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Selecting and then slicing as we just did will make the program do one more shallow copy. So, you should put the slice operation that can reduce the list length the most first. If the program doesn&rsquo;t have the time or memory for a two-step operation, you can use the islice method in the built-in itertools module instead (see article 36), which is clearer to use because it can&rsquo;t have a negative start/stop position or step value.</p>
<h4 id="summary-6">Summary</h4>
<ol>
<li>It can be difficult to understand the start/stop subscript and the step value of a slice at the same time.</li>
<li>If you want to specify a step value, omit the start and stop subscripts, and preferably use a positive number as the step value, not a negative one.</li>
<li>Do not write the start position, end position and step value all in the same slice operation. If you have to use all three metrics at the same time, do it twice (once to pick and once to cut), or use the islice method in the itertools built-in module instead.</li>
</ol>
<h3 id="13-capture-multiple-elements-by-unpacking-with-an-asterisk-not-slicing">13. Capture multiple elements by unpacking with an asterisk, not slicing</h3>
<p>One limitation of the basic unpacking operation (see clause 6) is that the length of the sequence to be unpacked must be determined in advance. For example, when selling cars, we might write the age of each car in a list, and then arrange them in order from oldest to youngest. If you try to get the oldest two of these cars by a basic unpacking operation, the program will run with an exception.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">car_ages</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">15</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">car_ages_descending</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">car_ages</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">oldest</span><span class="p">,</span> <span class="n">second_oldest</span> <span class="o">=</span> <span class="n">car_ages_descending</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">Traceback</span> <span class="o">...</span>
</span></span><span class="line"><span class="cl"><span class="ne">ValueError</span><span class="p">:</span> <span class="n">too</span> <span class="n">many</span> <span class="n">values</span> <span class="n">to</span> <span class="n">unpack</span> <span class="p">(</span><span class="n">expected</span> <span class="mi">2</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Python novices often deal with this problem by subscripting and slicing (see #11). For example, you can explicitly subscript the two oldest and second oldest cars, and then put the rest of the cars in another list.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">car_ages</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">15</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">car_ages_descending</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">car_ages</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">oldest</span> <span class="o">=</span> <span class="n">car_ages_descending</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">second_oldest</span> <span class="o">=</span> <span class="n">car_ages_descending</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">others</span> <span class="o">=</span> <span class="n">car_ages_descending</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">oldest</span><span class="p">,</span> <span class="n">second_oldest</span><span class="p">,</span> <span class="n">others</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="mi">20</span> <span class="mi">19</span> <span class="p">[</span><span class="mi">15</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>This is fine, but subscripts and slicing can make the code look messy. Also, splitting elements in a sequence into multiple subsets in this way is actually quite error-prone, because we usually tend to over- or under-write the subscript by one position. For example, if you modify one of the rows but forget to update another, you will encounter this error.</p>
<p>This problem is better solved by using starred expressions, which are unpacking operations that include elements that cannot be picked up by normal variables. Here&rsquo;s how to rewrite that code using the unpacking operation with an asterisk, this time without subscripts or slicing.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">car_ages</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">15</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">car_ages_descending</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">car_ages</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">oldest</span><span class="p">,</span> <span class="n">second_oldest</span><span class="p">,</span> <span class="o">*</span><span class="n">others</span> <span class="o">=</span> <span class="n">car_ages_descending</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">oldest</span><span class="p">,</span> <span class="n">second_oldest</span><span class="p">,</span> <span class="n">others</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="mi">20</span> <span class="mi">19</span> <span class="p">[</span><span class="mi">15</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>This is short and easy to read, and it is not error-prone, because it does not require us to remember to update the other subscripts simultaneously after modifying one of them.</p>
<p>This expression with an asterisk can appear at any position, so it can capture any segment of elements in the sequence.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">car_ages</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">15</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">car_ages_descending</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">car_ages</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">oldest</span><span class="p">,</span> <span class="o">*</span><span class="n">others</span><span class="p">,</span> <span class="n">youngest</span> <span class="o">=</span> <span class="n">car_ages_descending</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">oldest</span><span class="p">,</span> <span class="n">youngest</span><span class="p">,</span> <span class="n">others</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">*</span><span class="n">others</span><span class="p">,</span> <span class="n">second_youngest</span><span class="p">,</span> <span class="n">youngest</span> <span class="o">=</span> <span class="n">car_ages_descending</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">youngest</span><span class="p">,</span> <span class="n">second_youngest</span><span class="p">,</span> <span class="n">others</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="mi">20</span> <span class="mi">0</span> <span class="p">[</span><span class="mi">19</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span> <span class="mi">1</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Only, when using this writing style, you must have at least one normal receiving variable with it, otherwise a SyntaxError will occur. e.g. you can&rsquo;t just use an expression with an asterisk without a normal variable, like the following.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">car_ages</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">15</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">car_ages_descending</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">car_ages</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">*</span><span class="n">others</span> <span class="o">=</span> <span class="n">car_ages_descending</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="ne">SyntaxError</span><span class="p">:</span> <span class="n">starred</span> <span class="n">assignment</span> <span class="n">target</span> <span class="n">must</span> <span class="n">be</span> <span class="ow">in</span> <span class="n">a</span> <span class="nb">list</span> <span class="ow">or</span> <span class="nb">tuple</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In addition, for single-level structures, unpacking with an asterisk can occur at most once within the same level.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">first</span><span class="p">,</span> <span class="o">*</span><span class="n">middle</span><span class="p">,</span> <span class="o">*</span><span class="n">second_middle</span><span class="p">,</span> <span class="n">last</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="ne">SyntaxError</span><span class="p">:</span> <span class="n">two</span> <span class="n">starred</span> <span class="n">expressions</span> <span class="ow">in</span> <span class="n">assignment</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>If the structure to be disassembled has many layers, the unpacking operation with an asterisk can appear in different parts of the same level. This is not recommended (see Section 19 for a similar recommendation). The reason for this example is to help you understand what kind of unpacking can be achieved by such an asterisked expression.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">car_inventory</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;Downtown&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Silver Shadow&#39;</span><span class="p">,</span> <span class="s1">&#39;Pinto&#39;</span><span class="p">,</span> <span class="s1">&#39;DMC&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;Airport&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Skyline&#39;</span><span class="p">,</span> <span class="s1">&#39;Viper&#39;</span><span class="p">,</span> <span class="s1">&#39;Gremlin&#39;</span><span class="p">,</span> <span class="s1">&#39;Nova&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">((</span><span class="n">loc1</span><span class="p">,</span> <span class="p">(</span><span class="n">best1</span><span class="p">,</span> <span class="o">*</span><span class="n">rest1</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl"> <span class="p">(</span><span class="n">loc2</span><span class="p">,</span> <span class="p">(</span><span class="n">best2</span><span class="p">,</span> <span class="o">*</span><span class="n">rest2</span><span class="p">)))</span> <span class="o">=</span> <span class="n">car_inventory</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Best at </span><span class="si">{</span><span class="n">loc1</span><span class="si">}</span><span class="s1"> is </span><span class="si">{</span><span class="n">best1</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">rest1</span><span class="p">)</span><span class="si">}</span><span class="s1"> others&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Best at </span><span class="si">{</span><span class="n">loc2</span><span class="si">}</span><span class="s1"> is </span><span class="si">{</span><span class="n">best2</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">rest2</span><span class="p">)</span><span class="si">}</span><span class="s1"> others&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">Best</span> <span class="n">at</span> <span class="n">Downtown</span> <span class="ow">is</span> <span class="n">Silver</span> <span class="n">Shadow</span><span class="p">,</span> <span class="mi">2</span> <span class="n">others</span>
</span></span><span class="line"><span class="cl"><span class="n">Best</span> <span class="n">at</span> <span class="n">Airport</span> <span class="ow">is</span> <span class="n">Skyline</span><span class="p">,</span> <span class="mi">3</span> <span class="n">others</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>An expression with an asterisk always forms a list instance. If there are no more elements left in the sequence to be split, the list is blank. This feature is useful if you can determine in advance that there will be at least N elements in the sequence to be processed.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">short_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">first</span><span class="p">,</span> <span class="n">second</span><span class="p">,</span> <span class="o">*</span><span class="n">rest</span> <span class="o">=</span> <span class="n">short_list</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">second</span><span class="p">,</span> <span class="n">rest</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span> <span class="mi">2</span> <span class="p">[]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The unpacking operation can also be used on an iterator, but it is not as advantageous as the basic way of splitting the data into multiple variables. For example, I could construct a range of values of length 2, wrap it in an iterator, and split the values into first and second variables. But it would be simpler to just use a static list that matches the form (e.g., [1, 2]).</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">it</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">first</span><span class="p">,</span> <span class="n">second</span> <span class="o">=</span> <span class="n">it</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">first</span><span class="si">}</span><span class="s1"> and </span><span class="si">{</span><span class="n">second</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span> <span class="ow">and</span> <span class="mi">2</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The benefit of doing unpacking operations on iterators is mainly reflected in the usage with an asterisk, which makes the splitting values of the iterator clearer. For example, here&rsquo;s a generator that takes one row of data at a time from a CSV file containing a whole week&rsquo;s worth of car orders.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">generate_csv</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">yield</span> <span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="s1">&#39;Make&#39;</span><span class="p">,</span> <span class="s1">&#39;Model&#39;</span><span class="p">,</span> <span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="s1">&#39;Price&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># ...</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>We could use subscripts and slices to handle the results given by this generator, but this would take many lines of code to write and look confusing.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">generate_csv</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">yield</span> <span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="s1">&#39;Make&#39;</span><span class="p">,</span> <span class="s1">&#39;Model&#39;</span><span class="p">,</span> <span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="s1">&#39;Price&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">yield</span> <span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="s1">&#39;Make&#39;</span><span class="p">,</span> <span class="s1">&#39;Model&#39;</span><span class="p">,</span> <span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="s1">&#39;Price&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">yield</span> <span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="s1">&#39;Make&#39;</span><span class="p">,</span> <span class="s1">&#39;Model&#39;</span><span class="p">,</span> <span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="s1">&#39;Price&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">yield</span> <span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="s1">&#39;Make&#39;</span><span class="p">,</span> <span class="s1">&#39;Model&#39;</span><span class="p">,</span> <span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="s1">&#39;Price&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">yield</span> <span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="s1">&#39;Make&#39;</span><span class="p">,</span> <span class="s1">&#39;Model&#39;</span><span class="p">,</span> <span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="s1">&#39;Price&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># ...</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">all_csv_rows</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">generate_csv</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="n">header</span> <span class="o">=</span> <span class="n">all_csv_rows</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">rows</span> <span class="o">=</span> <span class="n">all_csv_rows</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;CSV Header:&#39;</span><span class="p">,</span> <span class="n">header</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Row count:&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">CSV</span> <span class="n">Header</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="s1">&#39;Make&#39;</span><span class="p">,</span> <span class="s1">&#39;Model&#39;</span><span class="p">,</span> <span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="s1">&#39;Price&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Row</span> <span class="n">count</span><span class="p">:</span> <span class="mi">4</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Using the unpacking operation with an asterisk, we can put the first row (the table header) in a separate header variable and combine the rest of the contents given by the iterator into a rows variable. This is much clearer to write.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">generate_csv</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">yield</span> <span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="s1">&#39;Make&#39;</span><span class="p">,</span> <span class="s1">&#39;Model&#39;</span><span class="p">,</span> <span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="s1">&#39;Price&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">yield</span> <span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="s1">&#39;Make&#39;</span><span class="p">,</span> <span class="s1">&#39;Model&#39;</span><span class="p">,</span> <span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="s1">&#39;Price&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">yield</span> <span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="s1">&#39;Make&#39;</span><span class="p">,</span> <span class="s1">&#39;Model&#39;</span><span class="p">,</span> <span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="s1">&#39;Price&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">yield</span> <span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="s1">&#39;Make&#39;</span><span class="p">,</span> <span class="s1">&#39;Model&#39;</span><span class="p">,</span> <span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="s1">&#39;Price&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">yield</span> <span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="s1">&#39;Make&#39;</span><span class="p">,</span> <span class="s1">&#39;Model&#39;</span><span class="p">,</span> <span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="s1">&#39;Price&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># ...</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">it</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">generate_csv</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="n">header</span><span class="p">,</span> <span class="o">*</span><span class="n">rows</span> <span class="o">=</span> <span class="n">it</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;CSV Header:&#39;</span><span class="p">,</span> <span class="n">header</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Row count:&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">CSV</span> <span class="n">Header</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="s1">&#39;Make&#39;</span><span class="p">,</span> <span class="s1">&#39;Model&#39;</span><span class="p">,</span> <span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="s1">&#39;Price&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Row</span> <span class="n">count</span><span class="p">:</span> <span class="mi">4</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The part with an asterisk always forms a list, so be aware that this may use up all of the computer&rsquo;s memory and cause the program to crash. You must first make sure that the system has enough memory to store the split result data before you can use unpacking with an asterisk on the iterator (there is another way to do this, see article 31).</p>
<h4 id="summary-7">Summary</h4>
<ol>
<li>When splitting a data structure and assigning its data to a variable, you can use an asterisked expression to capture the contents of the structure that cannot be matched to a normal variable in a list.</li>
<li>This asterisked expression can appear anywhere to the left of the assignment symbol, and it will always result in a list with zero or more values.</li>
<li>The asterisked unpacking is clearer when breaking the list into non-overlapping parts, while the subscripted and sliced approach is error-prone.</li>
</ol>
<h3 id="14-representing-complex-sorting-logic-with-the-key-argument-of-the-sort-method">14. Representing complex sorting logic with the key argument of the sort method</h3>
<p>The built-in list type provides a method called sort that sorts the elements of a list instance by a number of metrics. By default, the sort method always sorts the elements in the list in natural ascending order. For example, if the elements of the list are all integers, then it sorts them from smallest to largest value.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">numbers</span> <span class="o">=</span> <span class="p">[</span><span class="mi">93</span><span class="p">,</span> <span class="mi">86</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">70</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">numbers</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">numbers</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="mi">11</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">86</span><span class="p">,</span> <span class="mi">93</span><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Here a Tool class is defined to represent various construction tools, with a <code>__repr__</code> method, so we can print instances of this class as strings.</p>
<p>If we just write it this way, there is no way to sort this list of objects of this class with the sort method, because the sort method finds that the special methods needed for sorting are not defined in the Tool class.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Tool</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">weight</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">weight</span> <span class="o">=</span> <span class="n">weight</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;Tool(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">!r}</span><span class="s1">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="si">}</span><span class="s1">)&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">tools</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="n">Tool</span><span class="p">(</span><span class="s1">&#39;level&#39;</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">Tool</span><span class="p">(</span><span class="s1">&#39;hammer&#39;</span><span class="p">,</span> <span class="mf">1.25</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">Tool</span><span class="p">(</span><span class="s1">&#39;screwdriver&#39;</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">Tool</span><span class="p">(</span><span class="s1">&#39;chisel&#39;</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">),</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">tools</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">Traceback</span> <span class="o">...</span>
</span></span><span class="line"><span class="cl"><span class="ne">TypeError</span><span class="p">:</span> <span class="s1">&#39;&lt;&#39;</span> <span class="ow">not</span> <span class="n">supported</span> <span class="n">between</span> <span class="n">instances</span> <span class="n">of</span> <span class="s1">&#39;Tool&#39;</span> <span class="ow">and</span> <span class="s1">&#39;Tool&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The following function is defined using the lambda keyword, which is passed to the key argument of the sort method, allowing us to sort the Tool objects alphabetically by name.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Tool</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">weight</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">weight</span> <span class="o">=</span> <span class="n">weight</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;Tool(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">!r}</span><span class="s1">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="si">}</span><span class="s1">)&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">tools</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="n">Tool</span><span class="p">(</span><span class="s1">&#39;level&#39;</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">Tool</span><span class="p">(</span><span class="s1">&#39;hammer&#39;</span><span class="p">,</span> <span class="mf">1.25</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">Tool</span><span class="p">(</span><span class="s1">&#39;screwdriver&#39;</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">Tool</span><span class="p">(</span><span class="s1">&#39;chisel&#39;</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">),</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Unsorted:&#39;</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">tools</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">tools</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Sorted:&#39;</span><span class="p">,</span> <span class="n">tools</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">Unsorted</span><span class="p">:</span> <span class="p">[</span><span class="n">Tool</span><span class="p">(</span><span class="s1">&#39;level&#39;</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">),</span> <span class="n">Tool</span><span class="p">(</span><span class="s1">&#39;hammer&#39;</span><span class="p">,</span> <span class="mf">1.25</span><span class="p">),</span> <span class="n">Tool</span><span class="p">(</span><span class="s1">&#39;screwdriver&#39;</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">Tool</span><span class="p">(</span><span class="s1">&#39;chisel&#39;</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Sorted</span><span class="p">:</span> <span class="p">[</span><span class="n">Tool</span><span class="p">(</span><span class="s1">&#39;chisel&#39;</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">),</span> <span class="n">Tool</span><span class="p">(</span><span class="s1">&#39;hammer&#39;</span><span class="p">,</span> <span class="mf">1.25</span><span class="p">),</span> <span class="n">Tool</span><span class="p">(</span><span class="s1">&#39;level&#39;</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">),</span> <span class="n">Tool</span><span class="p">(</span><span class="s1">&#39;screwdriver&#39;</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Sometimes we may need to sort with more than one criterion. This can be done using the properties of tuples: if the first element of two tuples are equal, compare the second element, and if they are still equal, continue down the list.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Tool</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">weight</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">weight</span> <span class="o">=</span> <span class="n">weight</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;Tool(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">!r}</span><span class="s1">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="si">}</span><span class="s1">)&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">power_tools</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="n">Tool</span><span class="p">(</span><span class="s1">&#39;drill&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">Tool</span><span class="p">(</span><span class="s1">&#39;circular saw&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">Tool</span><span class="p">(</span><span class="s1">&#39;jackhammer&#39;</span><span class="p">,</span> <span class="mi">40</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">Tool</span><span class="p">(</span><span class="s1">&#39;sander&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">power_tools</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">weight</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">power_tools</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">power_tools</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">weight</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">name</span><span class="p">),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">power_tools</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="n">Tool</span><span class="p">(</span><span class="s1">&#39;drill&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">Tool</span><span class="p">(</span><span class="s1">&#39;sander&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">Tool</span><span class="p">(</span><span class="s1">&#39;circular saw&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">Tool</span><span class="p">(</span><span class="s1">&#39;jackhammer&#39;</span><span class="p">,</span> <span class="mi">40</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="n">Tool</span><span class="p">(</span><span class="s1">&#39;jackhammer&#39;</span><span class="p">,</span> <span class="mi">40</span><span class="p">),</span> <span class="n">Tool</span><span class="p">(</span><span class="s1">&#39;circular saw&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">Tool</span><span class="p">(</span><span class="s1">&#39;sander&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">Tool</span><span class="p">(</span><span class="s1">&#39;drill&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The disadvantage of this approach is that the tuple constructed by the key function can only compare the indicators it represents in the same sorting direction (if ascending, they must all be ascending; if descending, they must all be descending).</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">power_tools</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="o">.</span><span class="n">weight</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">power_tools</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>However, the str type does not support the unary subtraction operator, so the sort method can be called multiple times to achieve different directions of sorting, taking advantage of the principle that the sort method is a stable sorting algorithm.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">power_tools</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>  <span class="c1"># Name ascending</span>
</span></span><span class="line"><span class="cl"><span class="n">power_tools</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">weight</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># Weight descending</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">power_tools</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>No matter how many sorting indicators there are, they can be implemented in this way, and each indicator can be sorted in its own direction, not all in ascending order or all in descending order. Just write them backwards, i.e., put the most dominant one in the last round. In the example above, the primary indicator is weight descending, and the secondary indicator is name ascending, so it is sorted first by name ascending, and then by weight descending.</p>
<p>Although both ideas achieve the same result, it is still easier to call sort only once than to call sort multiple times. Therefore, when implementing multiple metrics sorted in different directions, you should give priority to having the key function return a tuple and take the opposite number of the corresponding metrics in the tuple. Only as a last resort should multiple calls to the sort method be considered.</p>
<h4 id="summary-8">Summary</h4>
<ol>
<li>the sort method of a list can sort the elements of built-in types such as strings, integers, and tuples according to their natural order.</li>
<li>ordinary objects that have a natural order defined by a special method can also be sorted using the sort method, but such objects are not common.</li>
<li>you can pass a helper function to the key argument of the sort method and let sort sort the elements according to the value returned by this function, instead of sorting the elements themselves.</li>
<li>If there are many indicators to sort on, you can put them in a tuple and have the key function return such a tuple. For types that support the one-decimal operator, you can invert this indicator separately and let the sorting algorithm process in the opposite direction on this indicator.</li>
<li>If these metrics do not support the unary subtraction operator, you can call the sort method multiple times and specify the key function and the reverse argument separately in each call. The least important metrics are processed in the first round, then the more important metrics are processed step by step, and the first metrics are processed in the last round.</li>
</ol>
<h3 id="15-dont-rely-too-much-on-the-order-you-use-when-adding-entries-to-a-dictionary">15. Don&rsquo;t rely too much on the order you use when adding entries to a dictionary</h3>
<p>In Python 3.5 and earlier, the order you see when iterating through a dictionary (dict) seems to be arbitrary, and not necessarily in the same order as when you added the key-value pairs to the dictionary in the first place.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="c1"># Python 3.5</span>
</span></span><span class="line"><span class="cl"><span class="n">baby_names</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;cat&#39;</span><span class="p">:</span> <span class="s1">&#39;kitten&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;dog&#39;</span><span class="p">:</span> <span class="s1">&#39;puppy&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">baby_names</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span><span class="s1">&#39;dog&#39;</span><span class="p">:</span> <span class="s1">&#39;puppy&#39;</span><span class="p">,</span> <span class="s1">&#39;cat&#39;</span><span class="p">:</span> <span class="s1">&#39;kitten&#39;</span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>This effect occurs because the dictionary type was previously implemented using a hash table algorithm (this algorithm runs through a built-in hash function with a random seed number that is determined each time the Python interpreter is started). So, such a mechanism results in these key-value pairs not necessarily being stored in the same order in the dictionary as they were when they were added, and the order of storage may be different each time you run the program.</p>
<p>Starting with Python 3.6, the dictionary retains the order in which these key-value pairs were added, and the Python 3.7 language specification formalizes this rule. So, in newer versions of Python, it&rsquo;s always possible to iterate through these key-value pairs in the same order in which they were created.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">baby_names</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;cat&#39;</span><span class="p">:</span> <span class="s1">&#39;kitten&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;dog&#39;</span><span class="p">:</span> <span class="s1">&#39;puppy&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">baby_names</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span><span class="s1">&#39;cat&#39;</span><span class="p">:</span> <span class="s1">&#39;kitten&#39;</span><span class="p">,</span> <span class="s1">&#39;dog&#39;</span><span class="p">:</span> <span class="s1">&#39;puppy&#39;</span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In Python 3.5 and earlier, many of the methods provided by dict (including keys, values, items, popitem, etc.) are not guaranteed to be in a fixed order, so they feel like they are processed randomly.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">baby_names</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;cat&#39;</span><span class="p">:</span> <span class="s1">&#39;kitten&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;dog&#39;</span><span class="p">:</span> <span class="s1">&#39;puppy&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Python 3.5</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">baby_names</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">baby_names</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">baby_names</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">baby_names</span><span class="o">.</span><span class="n">popitem</span><span class="p">())</span>  <span class="c1"># Randomly chooses an item</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="s1">&#39;dog&#39;</span><span class="p">,</span> <span class="s1">&#39;cat&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="s1">&#39;puppy&#39;</span><span class="p">,</span> <span class="s1">&#39;kitten&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">[(</span><span class="s1">&#39;dog&#39;</span><span class="p">,</span> <span class="s1">&#39;puppy&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;cat&#39;</span><span class="p">,</span> <span class="s1">&#39;kitten&#39;</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="s1">&#39;dog&#39;</span><span class="p">,</span> <span class="s1">&#39;puppy&#39;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In newer versions of Python, these methods can now be handled in the same order as they were when the key-value pairs were first added.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">baby_names</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;cat&#39;</span><span class="p">:</span> <span class="s1">&#39;kitten&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;dog&#39;</span><span class="p">:</span> <span class="s1">&#39;puppy&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">baby_names</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">baby_names</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">baby_names</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">baby_names</span><span class="o">.</span><span class="n">popitem</span><span class="p">())</span>  <span class="c1"># Randomly chooses an item</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="s1">&#39;cat&#39;</span><span class="p">,</span> <span class="s1">&#39;dog&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="s1">&#39;kitten&#39;</span><span class="p">,</span> <span class="s1">&#39;puppy&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">[(</span><span class="s1">&#39;cat&#39;</span><span class="p">,</span> <span class="s1">&#39;kitten&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;dog&#39;</span><span class="p">,</span> <span class="s1">&#39;puppy&#39;</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="s1">&#39;dog&#39;</span><span class="p">,</span> <span class="s1">&#39;puppy&#39;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>This change has had a number of implications for features of Python that rely on dictionary types and their implementation details.</p>
<p>Keyword arguments to functions (including the almighty <code>**kwargs</code> argument, see #23), which used to appear in near-random order, made function call operations difficult to debug.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="c1"># Python 3.5</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">my_func</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">my_func</span><span class="p">(</span><span class="n">goose</span><span class="o">=</span><span class="s1">&#39;gosling&#39;</span><span class="p">,</span> <span class="n">kangaroo</span><span class="o">=</span><span class="s1">&#39;joey&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">kangaroo</span> <span class="o">=</span> <span class="n">joey</span>
</span></span><span class="line"><span class="cl"><span class="n">goose</span> <span class="o">=</span> <span class="n">gosling</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Now, these keyword arguments always retain the set of order specified when the function is called.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">my_func</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">my_func</span><span class="p">(</span><span class="n">goose</span><span class="o">=</span><span class="s1">&#39;gosling&#39;</span><span class="p">,</span> <span class="n">kangaroo</span><span class="o">=</span><span class="s1">&#39;joey&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">goose</span> <span class="o">=</span> <span class="n">gosling</span>
</span></span><span class="line"><span class="cl"><span class="n">kangaroo</span> <span class="o">=</span> <span class="n">joey</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Also, classes make use of dictionaries to hold some of the data that an instance of that class has. In earlier versions of Python, the fields in an object looked as if they appeared in random order.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">MyClass</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">alligator</span> <span class="o">=</span> <span class="s1">&#39;hatchling&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">elephant</span> <span class="o">=</span> <span class="s1">&#39;calf&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">a</span> <span class="o">=</span> <span class="n">MyClass</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Python 3.5</span>
</span></span><span class="line"><span class="cl"><span class="n">elephant</span> <span class="o">=</span> <span class="n">calf</span>
</span></span><span class="line"><span class="cl"><span class="n">alligator</span> <span class="o">=</span> <span class="n">hatchling</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Python &gt; 3.5</span>
</span></span><span class="line"><span class="cl"><span class="n">alligator</span> <span class="o">=</span> <span class="n">hatchling</span>
</span></span><span class="line"><span class="cl"><span class="n">elephant</span> <span class="o">=</span> <span class="n">calf</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The Python language specification now requires that dictionaries preserve the order in which key-value pairs are added. So, we can use this feature to implement some functionality, and we can incorporate it into our own APIs for classes and functions.</p>
<blockquote>
<p>In fact, the built-in collections module already provides a dictionary that preserves the order of insertion, called OrderedDict, which behaves much like the standard dict type (since Python 3.7), but with a significant performance difference. If you want to insert or pop key-value pairs frequently (for example, to implement least-recently-used caching), then OrderedDict may be more appropriate than the standard Python dict type (see Section 70 for how to determine whether you should switch to this type).</p>
</blockquote>
<p>When dealing with dictionaries, you can&rsquo;t always assume that all dictionaries preserve the order in which key-value pairs are inserted. Python is not a statically typed language, and most code operates on a duck typing mechanism (i.e., objects can be used as data of whatever behavior they support, without any attachment to their status in the class system). can be used as whatever data it supports, without being obsessed with its place in the class system). This feature can create unexpected problems.</p>
<p>For example, now we want to write a program that counts the popularity of various critters. We can set up a dictionary that associates each animal with the number of votes it gets.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">votes</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;otter&#39;</span><span class="p">:</span> <span class="mi">1281</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;polar bear&#39;</span><span class="p">:</span> <span class="mi">587</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;fox&#39;</span><span class="p">:</span> <span class="mi">863</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Now define a function to handle the polling data. The user can pass an empty dictionary to this function, in which case it will put each animal and its ranking in this dictionary. Such a dictionary can act as a data model to give data to elements with a user interface (UI).</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">populate_ranks</span><span class="p">(</span><span class="n">votes</span><span class="p">,</span> <span class="n">ranks</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">votes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">    <span class="n">names</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">votes</span><span class="o">.</span><span class="n">get</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">ranks</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>We also need to write a function to find out the most popular animals. This function assumes that populate_ranks always writes key-value pairs to the dictionary in ascending order, so that the first one to appear in the dictionary should be the top-ranked animal.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">get_winner</span><span class="p">(</span><span class="n">ranks</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">ranks</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Here&rsquo;s how to verify the functions you just designed and see if they achieve the desired results.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">votes</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;otter&#39;</span><span class="p">:</span> <span class="mi">1281</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;polar bear&#39;</span><span class="p">:</span> <span class="mi">587</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;fox&#39;</span><span class="p">:</span> <span class="mi">863</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">populate_ranks</span><span class="p">(</span><span class="n">votes</span><span class="p">,</span> <span class="n">ranks</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">votes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">    <span class="n">names</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">votes</span><span class="o">.</span><span class="n">get</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">ranks</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">get_winner</span><span class="p">(</span><span class="n">ranks</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">ranks</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ranks</span> <span class="o">=</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl"><span class="n">populate_ranks</span><span class="p">(</span><span class="n">votes</span><span class="p">,</span> <span class="n">ranks</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">ranks</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">winner</span> <span class="o">=</span> <span class="n">get_winner</span><span class="p">(</span><span class="n">ranks</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">winner</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span><span class="s1">&#39;otter&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;fox&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;polar bear&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">otter</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The result is not a problem. But let&rsquo;s say the requirements have changed and we now want to display them in the UI in alphabetical order, rather than by name as we did before. To achieve this effect, we define such a class using the built-in collections.abc module. This class has the same functionality as a dictionary and iterates through its contents in alphabetical order.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">MutableMapping</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">SortedDict</span><span class="p">(</span><span class="n">MutableMapping</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">        <span class="n">keys</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">yield</span> <span class="n">key</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">votes</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;otter&#39;</span><span class="p">:</span> <span class="mi">1281</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;polar bear&#39;</span><span class="p">:</span> <span class="mi">587</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;fox&#39;</span><span class="p">:</span> <span class="mi">863</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">populate_ranks</span><span class="p">(</span><span class="n">votes</span><span class="p">,</span> <span class="n">ranks</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">votes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">    <span class="n">names</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">votes</span><span class="o">.</span><span class="n">get</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">ranks</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">get_winner</span><span class="p">(</span><span class="n">ranks</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">ranks</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">sorted_ranks</span> <span class="o">=</span> <span class="n">SortedDict</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">populate_ranks</span><span class="p">(</span><span class="n">votes</span><span class="p">,</span> <span class="n">sorted_ranks</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">sorted_ranks</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">winner</span> <span class="o">=</span> <span class="n">get_winner</span><span class="p">(</span><span class="n">sorted_ranks</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">winner</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span><span class="s1">&#39;otter&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;fox&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;polar bear&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">fox</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>It doesn&rsquo;t get the expected result, so why is that? Because the <code>get_winner</code> function always assumes that the dictionary should be iterated over in the same order as the <code>populate_ranks</code> function inserted the data into the dictionary in the first place. But this time, we&rsquo;re using a SortedDict instance instead of a standard dict instance, so this assumption doesn&rsquo;t hold. Therefore, the function returns the data that appears first in alphabetical order, i.e. <code>'fox'</code>, with the following 3 solutions.</p>
<ol>
<li>
<p>Reimplement the <code>get_winner</code> function so that it no longer assumes that the ranks dictionary can always be iterated over in a fixed order. This is the safest and most secure solution.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">get_winner</span><span class="p">(</span><span class="n">ranks</span><span class="p">):</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">rank</span> <span class="ow">in</span> <span class="n">ranks</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">rank</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">name</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">winner</span> <span class="o">=</span> <span class="n">get_winner</span><span class="p">(</span><span class="n">sorted_ranks</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">winner</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">otter</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>The function starts by determining whether ranks is a standard dict as expected. If not, an exception is thrown. This approach has better performance than the one just described.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">get_winner</span><span class="p">(</span><span class="n">ranks</span><span class="p">):</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ranks</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;must provide a dict instance&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">return</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">ranks</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">get_winner</span><span class="p">(</span><span class="n">sorted_ranks</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">Traceback</span> <span class="o">...</span>
</span></span><span class="line"><span class="cl"><span class="ne">TypeError</span><span class="p">:</span> <span class="n">must</span> <span class="n">provide</span> <span class="n">a</span> <span class="nb">dict</span> <span class="n">instance</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>The type annotation ensures that the <code>get_winner</code> function is actually a real dict instance and not a MutableMapping that behaves like a standard dictionary (see clause 90). The mypy tool is run in strict mode on the annotated code.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">MutableMapping</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">populate_ranks</span><span class="p">(</span><span class="n">votes</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                <span class="n">ranks</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl"><span class="n">names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">votes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="n">names</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">votes</span><span class="o">.</span><span class="n">get</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">ranks</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">get_winner</span><span class="p">(</span><span class="n">ranks</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span></span><span class="line"><span class="cl"><span class="k">return</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">ranks</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">SortedDict</span><span class="p">(</span><span class="n">MutableMapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]):</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="fm">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">    <span class="n">keys</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">yield</span> <span class="n">key</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">votes</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="s1">&#39;otter&#39;</span><span class="p">:</span> <span class="mi">1281</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="s1">&#39;polar bear&#39;</span><span class="p">:</span> <span class="mi">587</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="s1">&#39;fox&#39;</span><span class="p">:</span> <span class="mi">863</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">sorted_ranks</span> <span class="o">=</span> <span class="n">SortedDict</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">populate_ranks</span><span class="p">(</span><span class="n">votes</span><span class="p">,</span> <span class="n">sorted_ranks</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">sorted_ranks</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">winner</span> <span class="o">=</span> <span class="n">get_winner</span><span class="p">(</span><span class="n">sorted_ranks</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">winner</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">$</span> <span class="n">python3</span> <span class="o">-</span><span class="n">m</span> <span class="n">mypy</span> <span class="o">--</span><span class="n">strict</span> <span class="n">test</span><span class="o">.</span><span class="n">py</span>
</span></span><span class="line"><span class="cl"><span class="n">test</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">42</span><span class="p">:</span> <span class="n">error</span><span class="p">:</span> <span class="n">Argument</span> <span class="mi">2</span> <span class="n">to</span> <span class="s2">&#34;populate_ranks&#34;</span> <span class="n">has</span> <span class="n">incompatible</span> <span class="nb">type</span> <span class="s2">&#34;SortedDict&#34;</span><span class="p">;</span> <span class="n">expected</span> <span class="s2">&#34;Dict[str, int]&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">test</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">44</span><span class="p">:</span> <span class="n">error</span><span class="p">:</span> <span class="n">Argument</span> <span class="mi">1</span> <span class="n">to</span> <span class="s2">&#34;get_winner&#34;</span> <span class="n">has</span> <span class="n">incompatible</span> <span class="nb">type</span> <span class="s2">&#34;SortedDict&#34;</span><span class="p">;</span> <span class="n">expected</span> <span class="s2">&#34;Dict[str, int]&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>This checks for type mismatches, and mypy flags the incorrect usage by pointing out that the function asks for a dict but passes in a MutableMapping. this solution ensures that the static types are accurate without affecting the efficiency of the program.</p>
</li>
</ol>
<h3 id="key-points">Key points</h3>
<ol>
<li>Starting with Python 3.7, we can be sure that the order we see when we iterate over a standard dictionary is the same as the order in which these key-value pairs are inserted into the dictionary.</li>
<li>In Python code, it&rsquo;s easy to define objects that look like standard dictionaries but aren&rsquo;t themselves dict instances. For this type of object, you can&rsquo;t assume that the order you see it when iterating is necessarily the same as the order in which it is inserted.</li>
<li>If you do not want to treat this type, which is very similar to a standard dictionary, as a standard dictionary, there are three approaches to consider.
<ol>
<li>do not rely on the order in which the code is written at insertion time.</li>
<li>explicitly determine at program runtime whether it is a standard dictionary or not.</li>
<li>add type annotations to the code and do static analysis.</li>
</ol>
</li>
</ol>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/python/">python</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2022-05/deep-learn-generators/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">In-depth understanding of Generators</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2022-05/k8s-health-checks/">
            <span class="next-text nav-default">K8S Best Practices - Health Check</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  <script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox-3.1.20.min.js"></script>



<script type="text/javascript" src="/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js"></script>








</body>
</html>
