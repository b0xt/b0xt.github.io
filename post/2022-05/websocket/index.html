<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Getting to know WebSocket - SoByte</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356451834813761" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-E8GRRGBTEZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E8GRRGBTEZ');
</script>


<meta name="author" content="" /><meta name="description" content="Explore the past life of WebSocket and the details of the communication protocol, as well as perform practice." /><meta name="keywords" content="websocket" />






<meta name="generator" content="Hugo 0.102.0 with theme even" />


<link rel="canonical" href="https://www.sobyte.net/post/2022-05/websocket/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link href="/lib/fancybox/jquery.fancybox-3.1.20.min.css" rel="stylesheet">


<meta property="og:title" content="Getting to know WebSocket" />
<meta property="og:description" content="Explore the past life of WebSocket and the details of the communication protocol, as well as perform practice." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.sobyte.net/post/2022-05/websocket/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-05-07T19:08:42+08:00" />
<meta property="article:modified_time" content="2022-05-07T19:08:42+08:00" />

<meta itemprop="name" content="Getting to know WebSocket">
<meta itemprop="description" content="Explore the past life of WebSocket and the details of the communication protocol, as well as perform practice."><meta itemprop="datePublished" content="2022-05-07T19:08:42+08:00" />
<meta itemprop="dateModified" content="2022-05-07T19:08:42+08:00" />
<meta itemprop="wordCount" content="1580">
<meta itemprop="keywords" content="websocket," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Getting to know WebSocket"/>
<meta name="twitter:description" content="Explore the past life of WebSocket and the details of the communication protocol, as well as perform practice."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">SOBYTE</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">SOBYTE</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Getting to know WebSocket</h1>

      <div class="post-meta">
        <span class="post-time"> 2022-05-07 19:08:42 </span>
        <div class="post-category">
            <a href="/categories/tutorials/"> tutorials </a>
            </div>
          <span class="more-meta"> 1580 words </span>
          <span class="more-meta"> 8 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#birth-of-websocket">Birth of WebSocket</a></li>
        <li><a href="#how-to-make-a-websocket-connection">How to make a WebSocket connection</a>
          <ul>
            <li><a href="#establishing-a-connection">Establishing a connection</a></li>
            <li><a href="#data-transfer">Data transfer</a></li>
            <li><a href="#closing-a-connection">Closing a connection</a></li>
            <li><a href="#heartbeat-mechanism">Heartbeat mechanism</a></li>
          </ul>
        </li>
        <li><a href="#socketio">Socket.io</a></li>
        <li><a href="#a-simple-implementation">A simple implementation</a>
          <ul>
            <li><a href="#server-side-node">Server-side (Node)</a></li>
            <li><a href="#client-side-javascript">Client side (JavaScript)</a></li>
            <li><a href="#client-ios">Client (iOS)</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <h2 id="birth-of-websocket">Birth of WebSocket</h2>
<p>In 2005, with the birth and application of AJAX technology, it became possible to request data from a web page to a server and render the page dynamically. HTTP is a one-way transmission protocol that can only be sent by the client, and it is really difficult to obtain continuous real-time information. People started this fancy exploration of real-time access to information technology.</p>
<p>Relying on the HTTP protocol, the more widespread way is polling. The client sends requests continuously at regular intervals, and the server returns the latest data. The shorter the polling time, the more real-time the message is. The disadvantages of this approach are obvious. Since HTTP is stateless and every request is a full HTTP request, a lot of polling will keep carrying useless headers and wasting resources. In addition, if the server does not have too many messages, then most of the bombarding polling requests are actually useless and inefficient. In some scenarios requiring low latency, such as real-time matchmaking games, this timed request design is also no way to meet the requirements.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/05/07/587f63e0af6744d89f87bb3464b31fc0.png" alt="http polling"></p>
<p>Another technique is long polling, which is an improvement over the previous short polling scheme. In the long polling technique, the client sends an HTTP request to the server, which receives and maintains this connection. It waits until the server has new data and then returns. Then the client initiates the next request and re-initiates the connection with the server.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/05/07/54d6bf5fe2e4479b8dcb38c67e3c7124.png" alt="http long polling"></p>
<p>In addition, there are other, more hacked solutions, such as iframe, htmlfile, etc., which together with long polling can be called Comet.</p>
<p>All of these solutions are desperate measures. Because of the limitations of the HTTP mechanism, it is impossible for the server to initiate a connection to notify the client, so there are so many Hack schemes.</p>
<p>To solve these problems, the WebSocket protocol was born in 2008. It is a full-duplex communication protocol built on a TCP connection, which can continuously send and receive data with a single handshake. With WebSocket, two-way real-time communication between server and client is finally possible, and in 2011, WebSocket became an international standard and is widely supported.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/05/07/bae2a1946fc94732a71ce065d8c2c92d.png" alt="websocket"></p>
<p>Unlike the HTTP protocol, WebSocket solves many of these problems.</p>
<ul>
<li><strong>Passivity</strong>. HTTP can only be sent from the client to the server, while WebSocket can use its own established TCP long connection channel to enable the server to actively push messages to the client.</li>
<li><strong>Stateless</strong>. HTTP does not save the client&rsquo;s information after the request is completed, and when there is another HTTP request, the client&rsquo;s information needs to be retransmitted to tell the server who it is. In contrast, during the whole process of WebSocket communication, the server always knows the client&rsquo;s information, so it does not need to carry its own information again and only needs to pass the content proper, so it can greatly save communication traffic.</li>
</ul>
<h2 id="how-to-make-a-websocket-connection">How to make a WebSocket connection</h2>
<h3 id="establishing-a-connection">Establishing a connection</h3>
<p>During the handshake phase of a WebSocket connection, the client sends an HTTP request to the server (this is the only connection between WebSocket and HTTP).</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">GET /chat HTTP/1.1
</span></span><span class="line"><span class="cl">Host: server.example.com
</span></span><span class="line"><span class="cl">Upgrade: websocket
</span></span><span class="line"><span class="cl">Connection: Upgrade
</span></span><span class="line"><span class="cl">Sec-WebSocket-Key: dGhlIHNhbXBsZSBub25jZQ==
</span></span><span class="line"><span class="cl">Sec-WebSocket-Protocol: chat, superchat
</span></span><span class="line"><span class="cl">Sec-WebSocket-Version: 13
</span></span><span class="line"><span class="cl">Origin: http://example.com
</span></span></code></pre></td></tr></table>
</div>
</div><p>Server&rsquo;s response.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">HTTP/1.1 101 Switching Protocols
</span></span><span class="line"><span class="cl">Upgrade: websocket
</span></span><span class="line"><span class="cl">Connection: Upgrade
</span></span><span class="line"><span class="cl">Sec-WebSocket-Accept: s3pPLMBiTxaQ9kYGzzhZRbK+xOo=
</span></span><span class="line"><span class="cl">Sec-WebSocket-Protocol: chat
</span></span></code></pre></td></tr></table>
</div>
</div><p>In the client&rsquo;s send request, the core two fields are <code>Connection: Upgrade</code> and <code>Upgrade: websocket</code>. The Connection=Upgrade header indicates that the client wants to upgrade the connection, while the Upgrade=websocket header indicates that the target protocol for the upgrade is WebSocket.</p>
<p>In addition, <code>Sec-WebSocket-Key</code> and <code>Sec-WebSocket-Accept</code> are a layer of verification to verify whether the server really supports WebSocket, similar to the signature mechanism.</p>
<p>After the handshake is completed, the server upgrades the HTTP protocol to WebSocket protocol, and the two ends can send data to each other.</p>
<h3 id="data-transfer">Data transfer</h3>
<p>As mentioned earlier, WebSocket can be a great traffic saver because it does not carry each request over HTTP. the frame data of WebSocket is as follows.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl"> 0                   1                   2                   3
</span></span><span class="line"><span class="cl">  0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
</span></span><span class="line"><span class="cl"> +-+-+-+-+-------+-+-------------+-------------------------------+
</span></span><span class="line"><span class="cl"> |F|R|R|R| opcode|M| Payload len |    Extended payload length    |
</span></span><span class="line"><span class="cl"> |I|S|S|S|  (4)  |A|     (7)     |             (16/64)           |
</span></span><span class="line"><span class="cl"> |N|V|V|V|       |S|             |   (if payload len==126/127)   |
</span></span><span class="line"><span class="cl"> | |1|2|3|       |K|             |                               |
</span></span><span class="line"><span class="cl"> +-+-+-+-+-------+-+-------------+ - - - - - - - - - - - - - - - +
</span></span><span class="line"><span class="cl"> |     Extended payload length continued, if payload len == 127  |
</span></span><span class="line"><span class="cl"> + - - - - - - - - - - - - - - - +-------------------------------+
</span></span><span class="line"><span class="cl"> |                               |Masking-key, if MASK set to 1  |
</span></span><span class="line"><span class="cl"> +-------------------------------+-------------------------------+
</span></span><span class="line"><span class="cl"> | Masking-key (continued)       |          Payload Data         |
</span></span><span class="line"><span class="cl"> +-------------------------------- - - - - - - - - - - - - - - - +
</span></span><span class="line"><span class="cl"> :                     Payload Data continued ...                :
</span></span><span class="line"><span class="cl"> + - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - +
</span></span><span class="line"><span class="cl"> |                     Payload Data continued ...                |
</span></span><span class="line"><span class="cl"> +---------------------------------------------------------------+
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Opcode: type of packet (intermediate packet, text type, binary type, disconnect type, ping-pong type, etc.)</li>
<li>Payload Data: data content</li>
</ul>
<p>In terms of data transfer, because it is a duplex communication, the events and methods of the client and server are basically the same, including OnOpen (connection success), OnError (connection failure), Send (send message), OnMessage (receive message), Close (close connection), OnClose (connection is closed), Ping, Pong, etc.</p>
<h3 id="closing-a-connection">Closing a connection</h3>
<p>Unlike establishing a connection, closing a connection does not require an HTTP request to be sent, only a packet of the closing type to be sent within the channel by the party actively closing. The reason for closing the connection can be carried further in Paylaod Data.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/05/07/c2d7298ff60349fbbe6d3ce194e6a7f9.png" alt="Closing a connection"></p>
<h3 id="heartbeat-mechanism">Heartbeat mechanism</h3>
<p>The heartbeat mechanism is not necessary, but it is very necessary. If the network is good enough, as long as the long connection channel is established, any time one end sends a message, the other end will definitely receive it; one end can also notify the other end through the long connection channel before it goes offline actively. However, sometimes, due to network instability and other reasons, the client or server suddenly drops the connection, but the other end is not notified. The connection state of TCP is not a physical state, but a logical state established by three handshakes. Therefore, if the other end does not receive notification of the drop, the logical connection remains open until the next time when the client initiates a message and finds out that the other end is no longer there.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/05/07/b741a4a4338a42f5bb4c092a2a7cd190.png" alt="Client disconnection"></p>
<p>The heartbeat mechanism is a mechanism developed to detect physical disconnections early and avoid idle occupation. After a WebSocket connection is established, one end of the connection channel sends a Ping message to the other end at regular intervals, and the other end receives it and returns the content (also called Pong). If the initiating end receives a Pong message, the connection is OK, otherwise the connection may be faulty.</p>
<p><img src="https://cdn.jsdelivr.net/gh/b0xt/sobyte-images/2022/05/07/3323dbb6f47c459b81fb96e473308b0e.png" alt="Heartbeat Mechanism"></p>
<h2 id="socketio">Socket.io</h2>
<p>The APIs of the client-side and server-side WebSocket frameworks are mostly &ldquo;primitive&rdquo;, except for the common methods of sending and receiving messages, connecting to the server, etc., which you need to implement yourself. Socket.io is based on a WebSocket wrapper, and not just a wrapper. In order to solve possible compatibility issues, Socket.io supports automatic downgrading to polling and other schemes in case the WebSocket protocol is not supported. In addition, Socket.io provides out-of-the-box operations for broadcasting, rooms, namespaces, etc. It also provides a scheme for automatic heartbeat maintenance. Using Socket.io lowers the barrier to entry and use of WebSocket to a great extent.</p>
<h2 id="a-simple-implementation">A simple implementation</h2>
<h3 id="server-side-node">Server-side (Node)</h3>
<p>In Node.js, you can quickly start a server using <code>ws</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">WebSocket</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;ws&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">wss</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WebSocket</span><span class="p">.</span><span class="nx">Server</span><span class="p">({</span> <span class="nx">port</span><span class="o">:</span> <span class="mi">8080</span> <span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">wss</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;connection&#39;</span><span class="p">,</span> <span class="nx">ws</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">ws</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="nx">message</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;received: %s&#39;</span><span class="p">,</span> <span class="nx">message</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Broadcast
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">wss</span><span class="p">.</span><span class="nx">clients</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">client</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span><span class="nx">client</span> <span class="o">!==</span> <span class="nx">ws</span> <span class="o">&amp;&amp;</span> <span class="nx">client</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">===</span> <span class="nx">WebSocket</span><span class="p">.</span><span class="nx">OPEN</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">client</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl">  <span class="p">})</span>
</span></span><span class="line"><span class="cl">  <span class="nx">ws</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;close&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;closed&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">})</span>
</span></span><span class="line"><span class="cl">  <span class="nx">ws</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s1">&#39;Connect success.&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="client-side-javascript">Client side (JavaScript)</h3>
<p>A client application can be started directly in the browser using a WebSocket object.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">ws</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WebSocket</span><span class="p">(</span><span class="s1">&#39;wss://echo.websocket.org&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">ws</span><span class="p">.</span><span class="nx">onopen</span> <span class="o">=</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Connection open.&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">ws</span><span class="p">.</span><span class="nx">onmessage</span> <span class="o">=</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Received Message: &#39;</span> <span class="o">+</span> <span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">ws</span><span class="p">.</span><span class="nx">onclose</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Connection closed.&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="client-ios">Client (iOS)</h3>
<p>There are equally many options for clients in the iOS client, such as <code>SocketRocket</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="err">@</span><span class="n">interface</span> <span class="n">YourObject</span> <span class="p">()</span> <span class="o">&lt;</span><span class="n">SRWebSocketDelegate</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="err">@</span><span class="n">property</span> <span class="p">(</span><span class="n">strong</span><span class="p">,</span> <span class="n">nonatomic</span><span class="p">)</span> <span class="n">SRWebSocket</span> <span class="o">*</span><span class="n">socket</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="err">@</span><span class="n">end</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl"><span class="err">@</span><span class="n">implementation</span> <span class="n">YourObject</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">initSocket</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">NSURL</span> <span class="o">*</span><span class="n">url</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSURL</span> <span class="nl">URLWithString</span><span class="p">:</span><span class="err">@</span><span class="s">&#34;wss://echo.websocket.org&#34;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="n">SRWebSocket</span> <span class="o">*</span><span class="n">socket</span> <span class="o">=</span> <span class="p">[[</span><span class="n">SRWebSocket</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithURL</span><span class="p">:</span><span class="n">url</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="n">socket</span><span class="p">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="n">self</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">self</span><span class="p">.</span><span class="n">socket</span> <span class="o">=</span> <span class="n">socket</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">socket</span> <span class="n">open</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nl">webSocket</span><span class="p">:(</span><span class="n">SRWebSocket</span> <span class="o">*</span><span class="p">)</span><span class="n">webSocket</span> <span class="nl">didReceiveMessage</span><span class="p">:(</span><span class="n">id</span><span class="p">)</span><span class="n">message</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">NSLog</span><span class="p">(</span><span class="err">@</span><span class="s">&#34;didReceiveMessage: %@&#34;</span><span class="p">,</span> <span class="n">message</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nl">webSocket</span><span class="p">:(</span><span class="n">SRWebSocket</span> <span class="o">*</span><span class="p">)</span><span class="n">webSocket</span> <span class="nl">didFailWithError</span><span class="p">:(</span><span class="n">NSError</span> <span class="o">*</span><span class="p">)</span><span class="n">error</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">NSLog</span><span class="p">(</span><span class="err">@</span><span class="s">&#34;didFailWithError: %@&#34;</span><span class="p">,</span> <span class="n">error</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nl">webSocket</span><span class="p">:(</span><span class="n">SRWebSocket</span> <span class="o">*</span><span class="p">)</span><span class="n">webSocket</span> <span class="nl">didCloseWithCode</span><span class="p">:(</span><span class="n">NSInteger</span><span class="p">)</span><span class="n">code</span> <span class="nl">reason</span><span class="p">:(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="n">reason</span> <span class="nl">wasClean</span><span class="p">:(</span><span class="n">BOOL</span><span class="p">)</span><span class="n">wasClean</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">NSLog</span><span class="p">(</span><span class="err">@</span><span class="s">&#34;didCloseWithCode: %@&#34;</span><span class="p">,</span> <span class="err">@</span><span class="p">(</span><span class="n">code</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nl">webSocketDidOpen</span><span class="p">:(</span><span class="n">SRWebSocket</span> <span class="o">*</span><span class="p">)</span><span class="n">webSocket</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">NSLog</span><span class="p">(</span><span class="err">@</span><span class="s">&#34;webSocketDidOpen: %@&#34;</span><span class="p">,</span> <span class="n">webSocket</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">socket</span> <span class="nl">send</span><span class="p">:</span><span class="err">@</span><span class="s">&#34;Hello WebSocket&#34;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div>
    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/websocket/">websocket</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2022-05/unplugin-vue-components/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Unplugin Vue Components</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2022-05/victoriametrics-clustering/">
            <span class="next-text nav-default">Use of VictoriaMetrics Clustering Mode</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://www.sobyte.net/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  <script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox-3.1.20.min.js"></script>



<script type="text/javascript" src="/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js"></script>








</body>
</html>
